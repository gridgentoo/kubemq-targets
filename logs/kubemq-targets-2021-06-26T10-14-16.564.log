2021-06-26T13:14:07.750+0300	INFO	request: {"metadata":{"bucket_name":"kubemq-targets","item_name":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/grpc/Kubemq.javax","method":"upload_item"},"data":"Ly8gR2VuZXJhdGVkIGJ5IHRoZSBwcm90b2NvbCBidWZmZXIgY29tcGlsZXIuICBETyBOT1QgRURJVCENCi8vIHNvdXJjZToga3ViZW1xLnByb3RvDQoNCnBhY2thZ2UgaW8ua3ViZW1xLnNkay5ncnBjOw0KDQpwdWJsaWMgZmluYWwgY2xhc3MgS3ViZW1xIHsNCiAgcHJpdmF0ZSBLdWJlbXEoKSB7fQ0KICBwdWJsaWMgc3RhdGljIHZvaWQgcmVnaXN0ZXJBbGxFeHRlbnNpb25zKA0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgcmVnaXN0cnkpIHsNCiAgfQ0KDQogIHB1YmxpYyBzdGF0aWMgdm9pZCByZWdpc3RlckFsbEV4dGVuc2lvbnMoDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5IHJlZ2lzdHJ5KSB7DQogICAgcmVnaXN0ZXJBbGxFeHRlbnNpb25zKA0KICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUpIHJlZ2lzdHJ5KTsNCiAgfQ0KICAvKioNCiAgICogUHJvdG9idWYgZW51bSB7QGNvZGUga3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlfQ0KICAgKi8NCiAgcHVibGljIGVudW0gU3RyZWFtUmVxdWVzdFR5cGUNCiAgICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90b2NvbE1lc3NhZ2VFbnVtIHsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5TdHJlYW1SZXF1ZXN0VHlwZVVua25vd24gPSAwOzwvY29kZT4NCiAgICAgKi8NCiAgICBTdHJlYW1SZXF1ZXN0VHlwZVVua25vd24oMCksDQogICAgLyoqDQogICAgICogPGNvZGU+UmVjZWl2ZU1lc3NhZ2UgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBSZWNlaXZlTWVzc2FnZSgxKSwNCiAgICAvKioNCiAgICAgKiA8Y29kZT5BY2tNZXNzYWdlID0gMjs8L2NvZGU+DQogICAgICovDQogICAgQWNrTWVzc2FnZSgyKSwNCiAgICAvKioNCiAgICAgKiA8Y29kZT5SZWplY3RNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICovDQogICAgUmVqZWN0TWVzc2FnZSgzKSwNCiAgICAvKioNCiAgICAgKiA8Y29kZT5Nb2RpZnlWaXNpYmlsaXR5ID0gNDs8L2NvZGU+DQogICAgICovDQogICAgTW9kaWZ5VmlzaWJpbGl0eSg0KSwNCiAgICAvKioNCiAgICAgKiA8Y29kZT5SZXNlbmRNZXNzYWdlID0gNTs8L2NvZGU+DQogICAgICovDQogICAgUmVzZW5kTWVzc2FnZSg1KSwNCiAgICAvKioNCiAgICAgKiA8Y29kZT5TZW5kTW9kaWZpZWRNZXNzYWdlID0gNjs8L2NvZGU+DQogICAgICovDQogICAgU2VuZE1vZGlmaWVkTWVzc2FnZSg2KSwNCiAgICBVTlJFQ09HTklaRUQoLTEpLA0KICAgIDsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPlN0cmVhbVJlcXVlc3RUeXBlVW5rbm93biA9IDA7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFN0cmVhbVJlcXVlc3RUeXBlVW5rbm93bl9WQUxVRSA9IDA7DQogICAgLyoqDQogICAgICogPGNvZGU+UmVjZWl2ZU1lc3NhZ2UgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSZWNlaXZlTWVzc2FnZV9WQUxVRSA9IDE7DQogICAgLyoqDQogICAgICogPGNvZGU+QWNrTWVzc2FnZSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFja01lc3NhZ2VfVkFMVUUgPSAyOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPlJlamVjdE1lc3NhZ2UgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSZWplY3RNZXNzYWdlX1ZBTFVFID0gMzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5Nb2RpZnlWaXNpYmlsaXR5ID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTW9kaWZ5VmlzaWJpbGl0eV9WQUxVRSA9IDQ7DQogICAgLyoqDQogICAgICogPGNvZGU+UmVzZW5kTWVzc2FnZSA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJlc2VuZE1lc3NhZ2VfVkFMVUUgPSA1Ow0KICAgIC8qKg0KICAgICAqIDxjb2RlPlNlbmRNb2RpZmllZE1lc3NhZ2UgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTZW5kTW9kaWZpZWRNZXNzYWdlX1ZBTFVFID0gNjsNCg0KDQogICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIoKSB7DQogICAgICBpZiAodGhpcyA9PSBVTlJFQ09HTklaRUQpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oDQogICAgICAgICAgICAiQ2FuJ3QgZ2V0IHRoZSBudW1iZXIgb2YgYW4gdW5rbm93biBlbnVtIHZhbHVlLiIpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEBkZXByZWNhdGVkIFVzZSB7QGxpbmsgI2Zvck51bWJlcihpbnQpfSBpbnN0ZWFkLg0KICAgICAqLw0KICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgIHB1YmxpYyBzdGF0aWMgU3RyZWFtUmVxdWVzdFR5cGUgdmFsdWVPZihpbnQgdmFsdWUpIHsNCiAgICAgIHJldHVybiBmb3JOdW1iZXIodmFsdWUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgU3RyZWFtUmVxdWVzdFR5cGUgZm9yTnVtYmVyKGludCB2YWx1ZSkgew0KICAgICAgc3dpdGNoICh2YWx1ZSkgew0KICAgICAgICBjYXNlIDA6IHJldHVybiBTdHJlYW1SZXF1ZXN0VHlwZVVua25vd247DQogICAgICAgIGNhc2UgMTogcmV0dXJuIFJlY2VpdmVNZXNzYWdlOw0KICAgICAgICBjYXNlIDI6IHJldHVybiBBY2tNZXNzYWdlOw0KICAgICAgICBjYXNlIDM6IHJldHVybiBSZWplY3RNZXNzYWdlOw0KICAgICAgICBjYXNlIDQ6IHJldHVybiBNb2RpZnlWaXNpYmlsaXR5Ow0KICAgICAgICBjYXNlIDU6IHJldHVybiBSZXNlbmRNZXNzYWdlOw0KICAgICAgICBjYXNlIDY6IHJldHVybiBTZW5kTW9kaWZpZWRNZXNzYWdlOw0KICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3RyZWFtUmVxdWVzdFR5cGU+DQogICAgICAgIGludGVybmFsR2V0VmFsdWVNYXAoKSB7DQogICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsNCiAgICB9DQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDwNCiAgICAgICAgU3RyZWFtUmVxdWVzdFR5cGU+IGludGVybmFsVmFsdWVNYXAgPQ0KICAgICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPFN0cmVhbVJlcXVlc3RUeXBlPigpIHsNCiAgICAgICAgICAgIHB1YmxpYyBTdHJlYW1SZXF1ZXN0VHlwZSBmaW5kVmFsdWVCeU51bWJlcihpbnQgbnVtYmVyKSB7DQogICAgICAgICAgICAgIHJldHVybiBTdHJlYW1SZXF1ZXN0VHlwZS5mb3JOdW1iZXIobnVtYmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvcg0KICAgICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpLmdldFZhbHVlcygpLmdldChvcmRpbmFsKCkpOw0KICAgIH0NCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuZ2V0RGVzY3JpcHRvcigpLmdldEVudW1UeXBlcygpLmdldCgwKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJlYW1SZXF1ZXN0VHlwZVtdIFZBTFVFUyA9IHZhbHVlcygpOw0KDQogICAgcHVibGljIHN0YXRpYyBTdHJlYW1SZXF1ZXN0VHlwZSB2YWx1ZU9mKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IgZGVzYykgew0KICAgICAgaWYgKGRlc2MuZ2V0VHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAiRW51bVZhbHVlRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlwZS4iKTsNCiAgICAgIH0NCiAgICAgIGlmIChkZXNjLmdldEluZGV4KCkgPT0gLTEpIHsNCiAgICAgICAgcmV0dXJuIFVOUkVDT0dOSVpFRDsNCiAgICAgIH0NCiAgICAgIHJldHVybiBWQUxVRVNbZGVzYy5nZXRJbmRleCgpXTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGZpbmFsIGludCB2YWx1ZTsNCg0KICAgIHByaXZhdGUgU3RyZWFtUmVxdWVzdFR5cGUoaW50IHZhbHVlKSB7DQogICAgICB0aGlzLnZhbHVlID0gdmFsdWU7DQogICAgfQ0KDQogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2NvcGU6a3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlKQ0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBQaW5nUmVzdWx0T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUGluZ1Jlc3VsdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgSG9zdCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0SG9zdCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBIb3N0ID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEhvc3RCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFZlcnNpb24gPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFZlcnNpb24oKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRWZXJzaW9uQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFNlcnZlclN0YXJ0VGltZSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGxvbmcgZ2V0U2VydmVyU3RhcnRUaW1lKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBTZXJ2ZXJVcFRpbWVTZWNvbmRzID0gNDs8L2NvZGU+DQogICAgICovDQogICAgbG9uZyBnZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5QaW5nUmVzdWx0fQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUGluZ1Jlc3VsdCBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5QaW5nUmVzdWx0KQ0KICAgICAgUGluZ1Jlc3VsdE9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBQaW5nUmVzdWx0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBQaW5nUmVzdWx0KGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUGluZ1Jlc3VsdCgpIHsNCiAgICAgIGhvc3RfID0gIiI7DQogICAgICB2ZXJzaW9uXyA9ICIiOw0KICAgICAgc2VydmVyU3RhcnRUaW1lXyA9IDBMOw0KICAgICAgc2VydmVyVXBUaW1lU2Vjb25kc18gPSAwTDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgUGluZ1Jlc3VsdCgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHRoaXMoKTsNCiAgICAgIGlmIChleHRlbnNpb25SZWdpc3RyeSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIGludCBtdXRhYmxlX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0NCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKCk7DQogICAgICB0cnkgew0KICAgICAgICBib29sZWFuIGRvbmUgPSBmYWxzZTsNCiAgICAgICAgd2hpbGUgKCFkb25lKSB7DQogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsNCiAgICAgICAgICBzd2l0Y2ggKHRhZykgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGRQcm90bzMoDQogICAgICAgICAgICAgICAgICBpbnB1dCwgdW5rbm93bkZpZWxkcywgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsNCiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTA6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgaG9zdF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTg6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgdmVyc2lvbl8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMjQ6IHsNCg0KICAgICAgICAgICAgICBzZXJ2ZXJTdGFydFRpbWVfID0gaW5wdXQucmVhZEludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAzMjogew0KDQogICAgICAgICAgICAgIHNlcnZlclVwVGltZVNlY29uZHNfID0gaW5wdXQucmVhZEludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9QaW5nUmVzdWx0X2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUGluZ1Jlc3VsdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSE9TVF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBob3N0XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgSG9zdCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEhvc3QoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGhvc3RfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGhvc3RfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBIb3N0ID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRIb3N0Qnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGhvc3RfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGhvc3RfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZFUlNJT05fRklFTERfTlVNQkVSID0gMjsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgdmVyc2lvbl87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFZlcnNpb24gPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRWZXJzaW9uKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSB2ZXJzaW9uXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICB2ZXJzaW9uXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0VmVyc2lvbkJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSB2ZXJzaW9uXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICB2ZXJzaW9uXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTRVJWRVJTVEFSVFRJTUVfRklFTERfTlVNQkVSID0gMzsNCiAgICBwcml2YXRlIGxvbmcgc2VydmVyU3RhcnRUaW1lXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBTZXJ2ZXJTdGFydFRpbWUgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRTZXJ2ZXJTdGFydFRpbWUoKSB7DQogICAgICByZXR1cm4gc2VydmVyU3RhcnRUaW1lXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTRVJWRVJVUFRJTUVTRUNPTkRTX0ZJRUxEX05VTUJFUiA9IDQ7DQogICAgcHJpdmF0ZSBsb25nIHNlcnZlclVwVGltZVNlY29uZHNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFNlcnZlclVwVGltZVNlY29uZHMgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCkgew0KICAgICAgcmV0dXJuIHNlcnZlclVwVGltZVNlY29uZHNfOw0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKCFnZXRIb3N0Qnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCBob3N0Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldFZlcnNpb25CeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDIsIHZlcnNpb25fKTsNCiAgICAgIH0NCiAgICAgIGlmIChzZXJ2ZXJTdGFydFRpbWVfICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDY0KDMsIHNlcnZlclN0YXJ0VGltZV8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlcnZlclVwVGltZVNlY29uZHNfICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDY0KDQsIHNlcnZlclVwVGltZVNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIHVua25vd25GaWVsZHMud3JpdGVUbyhvdXRwdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7DQogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2l6ZTsNCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsNCg0KICAgICAgc2l6ZSA9IDA7DQogICAgICBpZiAoIWdldEhvc3RCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIGhvc3RfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0VmVyc2lvbkJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMiwgdmVyc2lvbl8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlcnZlclN0YXJ0VGltZV8gIT0gMEwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQ2NFNpemUoMywgc2VydmVyU3RhcnRUaW1lXyk7DQogICAgICB9DQogICAgICBpZiAoc2VydmVyVXBUaW1lU2Vjb25kc18gIT0gMEwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQ2NFNpemUoNCwgc2VydmVyVXBUaW1lU2Vjb25kc18pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldEhvc3QoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0SG9zdCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRWZXJzaW9uKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFZlcnNpb24oKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFNlcnZlclN0YXJ0VGltZSgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0U2VydmVyU3RhcnRUaW1lKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBIT1NUX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEhvc3QoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgVkVSU0lPTl9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRWZXJzaW9uKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNFUlZFUlNUQVJUVElNRV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hMb25nKA0KICAgICAgICAgIGdldFNlcnZlclN0YXJ0VGltZSgpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNFUlZFUlVQVElNRVNFQ09ORFNfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoTG9uZygNCiAgICAgICAgICBnZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCkpOw0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0IHBhcnNlRnJvbShieXRlW10gZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0IHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5QaW5nUmVzdWx0fQ0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8QnVpbGRlcj4gaW1wbGVtZW50cw0KICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9pbXBsZW1lbnRzOmt1YmVtcS5QaW5nUmVzdWx0KQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHRPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1BpbmdSZXN1bHRfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1BpbmdSZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5CdWlsZGVyLmNsYXNzKTsNCiAgICAgIH0NCg0KICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICBob3N0XyA9ICIiOw0KDQogICAgICAgIHZlcnNpb25fID0gIiI7DQoNCiAgICAgICAgc2VydmVyU3RhcnRUaW1lXyA9IDBMOw0KDQogICAgICAgIHNlcnZlclVwVGltZVNlY29uZHNfID0gMEw7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9QaW5nUmVzdWx0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOw0KICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCh0aGlzKTsNCiAgICAgICAgcmVzdWx0Lmhvc3RfID0gaG9zdF87DQogICAgICAgIHJlc3VsdC52ZXJzaW9uXyA9IHZlcnNpb25fOw0KICAgICAgICByZXN1bHQuc2VydmVyU3RhcnRUaW1lXyA9IHNlcnZlclN0YXJ0VGltZV87DQogICAgICAgIHJlc3VsdC5zZXJ2ZXJVcFRpbWVTZWNvbmRzXyA9IHNlcnZlclVwVGltZVNlY29uZHNfOw0KICAgICAgICBvbkJ1aWx0KCk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsb25lKCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0RmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhckZpZWxkKGZpZWxkKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyT25lb2YoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5PbmVvZkRlc2NyaXB0b3Igb25lb2YpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhck9uZW9mKG9uZW9mKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgaW50IGluZGV4LCBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0UmVwZWF0ZWRGaWVsZChmaWVsZCwgaW5kZXgsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmFkZFJlcGVhdGVkRmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0KSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0KW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0SG9zdCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGhvc3RfID0gb3RoZXIuaG9zdF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRWZXJzaW9uKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgdmVyc2lvbl8gPSBvdGhlci52ZXJzaW9uXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0U2VydmVyU3RhcnRUaW1lKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRTZXJ2ZXJTdGFydFRpbWUob3RoZXIuZ2V0U2VydmVyU3RhcnRUaW1lKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRTZXJ2ZXJVcFRpbWVTZWNvbmRzKG90aGVyLmdldFNlcnZlclVwVGltZVNlY29uZHMoKSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgaG9zdF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEhvc3QgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0SG9zdCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBob3N0XzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgaG9zdF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBIb3N0ID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRIb3N0Qnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gaG9zdF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgaG9zdF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEhvc3QgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0SG9zdCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGhvc3RfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEhvc3QgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJIb3N0KCkgew0KICAgICAgICANCiAgICAgICAgaG9zdF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRIb3N0KCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEhvc3QgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0SG9zdEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBob3N0XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCB2ZXJzaW9uXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRWZXJzaW9uKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHZlcnNpb25fOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICB2ZXJzaW9uXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFZlcnNpb24gPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldFZlcnNpb25CeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSB2ZXJzaW9uXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICB2ZXJzaW9uXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRWZXJzaW9uKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgdmVyc2lvbl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclZlcnNpb24oKSB7DQogICAgICAgIA0KICAgICAgICB2ZXJzaW9uXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFZlcnNpb24oKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgVmVyc2lvbiA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRWZXJzaW9uQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHZlcnNpb25fID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHNlcnZlclN0YXJ0VGltZV8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBTZXJ2ZXJTdGFydFRpbWUgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0U2VydmVyU3RhcnRUaW1lKCkgew0KICAgICAgICByZXR1cm4gc2VydmVyU3RhcnRUaW1lXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgU2VydmVyU3RhcnRUaW1lID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNlcnZlclN0YXJ0VGltZShsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBzZXJ2ZXJTdGFydFRpbWVfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgU2VydmVyU3RhcnRUaW1lID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU2VydmVyU3RhcnRUaW1lKCkgew0KICAgICAgICANCiAgICAgICAgc2VydmVyU3RhcnRUaW1lXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBzZXJ2ZXJVcFRpbWVTZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDY0IFNlcnZlclVwVGltZVNlY29uZHMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0U2VydmVyVXBUaW1lU2Vjb25kcygpIHsNCiAgICAgICAgcmV0dXJuIHNlcnZlclVwVGltZVNlY29uZHNfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBTZXJ2ZXJVcFRpbWVTZWNvbmRzID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNlcnZlclVwVGltZVNlY29uZHMobG9uZyB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgc2VydmVyVXBUaW1lU2Vjb25kc18gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBTZXJ2ZXJVcFRpbWVTZWNvbmRzID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU2VydmVyVXBUaW1lU2Vjb25kcygpIHsNCiAgICAgICAgDQogICAgICAgIHNlcnZlclVwVGltZVNlY29uZHNfID0gMEw7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIHNldFVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIuc2V0VW5rbm93bkZpZWxkc1Byb3RvMyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgbWVyZ2VVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLm1lcmdlVW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTprdWJlbXEuUGluZ1Jlc3VsdCkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlBpbmdSZXN1bHQpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0IERFRkFVTFRfSU5TVEFOQ0U7DQogICAgc3RhdGljIHsNCiAgICAgIERFRkFVTFRfSU5TVEFOQ0UgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UGluZ1Jlc3VsdD4NCiAgICAgICAgUEFSU0VSID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuQWJzdHJhY3RQYXJzZXI8UGluZ1Jlc3VsdD4oKSB7DQogICAgICBwdWJsaWMgUGluZ1Jlc3VsdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFBpbmdSZXN1bHQoaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgcHVibGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxQaW5nUmVzdWx0PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UGluZ1Jlc3VsdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogIH0NCg0KICBwdWJsaWMgaW50ZXJmYWNlIEVtcHR5T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuRW1wdHkpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuRW1wdHl9DQogICAqLw0KICBwdWJsaWMgIHN0YXRpYyBmaW5hbCBjbGFzcyBFbXB0eSBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5FbXB0eSkNCiAgICAgIEVtcHR5T3JCdWlsZGVyIHsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7DQogICAgLy8gVXNlIEVtcHR5Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBFbXB0eShjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIEVtcHR5KCkgew0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBFbXB0eSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHRoaXMoKTsNCiAgICAgIGlmIChleHRlbnNpb25SZWdpc3RyeSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IGUuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKA0KICAgICAgICAgICAgZSkuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnVua25vd25GaWVsZHMgPSB1bmtub3duRmllbGRzLmJ1aWxkKCk7DQogICAgICAgIG1ha2VFeHRlbnNpb25zSW1tdXRhYmxlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0VtcHR5X2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRW1wdHlfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5KSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IG90aGVyID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5FbXB0eX0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuRW1wdHkpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHlPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0VtcHR5X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FbXB0eV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRW1wdHlfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOw0KICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSh0aGlzKTsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkpIHsNCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5KW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsNCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5KSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLkVtcHR5KQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuRW1wdHkpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8RW1wdHk+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPEVtcHR5PigpIHsNCiAgICAgIHB1YmxpYyBFbXB0eSBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IEVtcHR5KGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8RW1wdHk+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxFbXB0eT4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBSZXN1bHRPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5SZXN1bHQpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldEV2ZW50SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFdmVudElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgU2VudCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gZ2V0U2VudCgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gMzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5SZXN1bHR9DQogICAqLw0KICBwdWJsaWMgIHN0YXRpYyBmaW5hbCBjbGFzcyBSZXN1bHQgZXh0ZW5kcw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMgaW1wbGVtZW50cw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KG1lc3NhZ2VfaW1wbGVtZW50czprdWJlbXEuUmVzdWx0KQ0KICAgICAgUmVzdWx0T3JCdWlsZGVyIHsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7DQogICAgLy8gVXNlIFJlc3VsdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0Lg0KICAgIHByaXZhdGUgUmVzdWx0KGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUmVzdWx0KCkgew0KICAgICAgZXZlbnRJRF8gPSAiIjsNCiAgICAgIHNlbnRfID0gZmFsc2U7DQogICAgICBlcnJvcl8gPSAiIjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgUmVzdWx0KA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBldmVudElEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxNjogew0KDQogICAgICAgICAgICAgIHNlbnRfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI2OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXN1bHRfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFVkVOVElEX0ZJRUxEX05VTUJFUiA9IDE7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGV2ZW50SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXZlbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXZlbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgZXZlbnRJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEV2ZW50SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXZlbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgZXZlbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU0VOVF9GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgYm9vbGVhbiBzZW50XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ib29sIFNlbnQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRTZW50KCkgew0KICAgICAgcmV0dXJuIHNlbnRfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVSUk9SX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGVycm9yXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXJyb3JfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEVycm9yQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBlcnJvcl8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldEV2ZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIGV2ZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmIChzZW50XyAhPSBmYWxzZSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCb29sKDIsIHNlbnRfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDMsIGVycm9yXyk7DQogICAgICB9DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRFdmVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgxLCBldmVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoc2VudF8gIT0gZmFsc2UpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCb29sU2l6ZSgyLCBzZW50Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldEVycm9yQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgzLCBlcnJvcl8pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCkpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLmVxdWFscyhvYmopOw0KICAgICAgfQ0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldEV2ZW50SUQoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0RXZlbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0U2VudCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0U2VudCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRFcnJvcigpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVZFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRFdmVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNFTlRfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRTZW50KCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0RXJyb3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlJlc3VsdH0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuUmVzdWx0KQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdE9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzdWx0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICBldmVudElEXyA9ICIiOw0KDQogICAgICAgIHNlbnRfID0gZmFsc2U7DQoNCiAgICAgICAgZXJyb3JfID0gIiI7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXN1bHRfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQodGhpcyk7DQogICAgICAgIHJlc3VsdC5ldmVudElEXyA9IGV2ZW50SURfOw0KICAgICAgICByZXN1bHQuc2VudF8gPSBzZW50XzsNCiAgICAgICAgcmVzdWx0LmVycm9yXyA9IGVycm9yXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0KSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0RXZlbnRJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGV2ZW50SURfID0gb3RoZXIuZXZlbnRJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldFNlbnQoKSAhPSBmYWxzZSkgew0KICAgICAgICAgIHNldFNlbnQob3RoZXIuZ2V0U2VudCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldEVycm9yKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgZXJyb3JfID0gb3RoZXIuZXJyb3JfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0KSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBldmVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFdmVudElEKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGV2ZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBldmVudElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldEV2ZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBldmVudElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBldmVudElEXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFdmVudElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXZlbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckV2ZW50SUQoKSB7DQogICAgICAgIA0KICAgICAgICBldmVudElEXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEV2ZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFdmVudElEQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGV2ZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIHNlbnRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBTZW50ID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldFNlbnQoKSB7DQogICAgICAgIHJldHVybiBzZW50XzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBTZW50ID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNlbnQoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgc2VudF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIFNlbnQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTZW50KCkgew0KICAgICAgICANCiAgICAgICAgc2VudF8gPSBmYWxzZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBlcnJvcl8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXJyb3JfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRXJyb3IoKSB7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRFcnJvcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFcnJvckJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5SZXN1bHQpDQogICAgfQ0KDQogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOmt1YmVtcS5SZXN1bHQpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdCgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVzdWx0Pg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxSZXN1bHQ+KCkgew0KICAgICAgcHVibGljIFJlc3VsdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFJlc3VsdChpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFJlc3VsdD4gcGFyc2VyKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFJlc3VsdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgRXZlbnRPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5FdmVudCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0RXZlbnRJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEV2ZW50SURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENoYW5uZWxCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRNZXRhZGF0YSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgU3RvcmUgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGdldFN0b3JlKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0VGFnc0NvdW50KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBjb250YWluc1RhZ3MoDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KTsNCiAgICAvKioNCiAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICovDQogICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgIGdldFRhZ3MoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFnc01hcCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuRXZlbnR9DQogICAqLw0KICBwdWJsaWMgIHN0YXRpYyBmaW5hbCBjbGFzcyBFdmVudCBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5FdmVudCkNCiAgICAgIEV2ZW50T3JCdWlsZGVyIHsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7DQogICAgLy8gVXNlIEV2ZW50Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBFdmVudChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIEV2ZW50KCkgew0KICAgICAgZXZlbnRJRF8gPSAiIjsNCiAgICAgIGNsaWVudElEXyA9ICIiOw0KICAgICAgY2hhbm5lbF8gPSAiIjsNCiAgICAgIG1ldGFkYXRhXyA9ICIiOw0KICAgICAgYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQogICAgICBzdG9yZV8gPSBmYWxzZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgRXZlbnQoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGV2ZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE4OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAyNjogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAzNDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBtZXRhZGF0YV8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDI6IHsNCg0KICAgICAgICAgICAgICBib2R5XyA9IGlucHV0LnJlYWRCeXRlcygpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDg6IHsNCg0KICAgICAgICAgICAgICBzdG9yZV8gPSBpbnB1dC5yZWFkQm9vbCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTg6IHsNCiAgICAgICAgICAgICAgaWYgKCEoKG11dGFibGVfYml0RmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4MDAwMDAwNDApKSB7DQogICAgICAgICAgICAgICAgdGFnc18gPSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLm5ld01hcEZpZWxkKA0KICAgICAgICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgICAgICAgICAgbXV0YWJsZV9iaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICAgICAgICB0YWdzX18gPSBpbnB1dC5yZWFkTWVzc2FnZSgNCiAgICAgICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5LmdldFBhcnNlckZvclR5cGUoKSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICAgICAgICB0YWdzXy5nZXRNdXRhYmxlTWFwKCkucHV0KA0KICAgICAgICAgICAgICAgICAgdGFnc19fLmdldEtleSgpLCB0YWdzX18uZ2V0VmFsdWUoKSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE1hcEZpZWxkKA0KICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICBzd2l0Y2ggKG51bWJlcikgew0KICAgICAgICBjYXNlIDc6DQogICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAiSW52YWxpZCBtYXAgZmllbGQgbnVtYmVyOiAiICsgbnVtYmVyKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFVkVOVElEX0ZJRUxEX05VTUJFUiA9IDE7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGV2ZW50SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXZlbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXZlbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgZXZlbnRJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEV2ZW50SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXZlbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgZXZlbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0xJRU5USURfRklFTERfTlVNQkVSID0gMjsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2xpZW50SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENsaWVudElEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGNsaWVudElEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDSEFOTkVMX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNoYW5uZWxfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENoYW5uZWxCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgY2hhbm5lbF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUVUQURBVEFfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgbWV0YWRhdGFfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TWV0YWRhdGFCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWV0YWRhdGFfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIG1ldGFkYXRhXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBCT0RZX0ZJRUxEX05VTUJFUiA9IDU7DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYm9keV87DQogICAgLyoqDQogICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsNCiAgICAgIHJldHVybiBib2R5XzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVE9SRV9GSUVMRF9OVU1CRVIgPSA2Ow0KICAgIHByaXZhdGUgYm9vbGVhbiBzdG9yZV87DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBTdG9yZSA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldFN0b3JlKCkgew0KICAgICAgcmV0dXJuIHN0b3JlXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUdTX0ZJRUxEX05VTUJFUiA9IDc7DQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY2xhc3MgVGFnc0RlZmF1bHRFbnRyeUhvbGRlciB7DQogICAgICBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTwNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBkZWZhdWx0RW50cnkgPQ0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEVudHJ5DQogICAgICAgICAgICAgIC48amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz5uZXdEZWZhdWx0SW5zdGFuY2UoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfVGFnc0VudHJ5X2Rlc2NyaXB0b3IsIA0KICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5XaXJlRm9ybWF0LkZpZWxkVHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuV2lyZUZvcm1hdC5GaWVsZFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgIiIpOw0KICAgIH0NCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IHRhZ3NfOw0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgIGludGVybmFsR2V0VGFncygpIHsNCiAgICAgIGlmICh0YWdzXyA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLmVtcHR5TWFwRmllbGQoDQogICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICB9DQogICAgICByZXR1cm4gdGFnc187DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRUYWdzQ291bnQoKSB7DQogICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuc2l6ZSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5jb250YWluc0tleShrZXkpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICovDQogICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgIHJldHVybiBnZXRUYWdzTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFnc01hcCgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIHJldHVybiBtYXAuY29udGFpbnNLZXkoa2V5KSA/IG1hcC5nZXQoa2V5KSA6IGRlZmF1bHRWYWx1ZTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIGlmICghbWFwLmNvbnRhaW5zS2V5KGtleSkpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBtYXAuZ2V0KGtleSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldEV2ZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIGV2ZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDIsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDMsIGNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TWV0YWRhdGFCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDQsIG1ldGFkYXRhXyk7DQogICAgICB9DQogICAgICBpZiAoIWJvZHlfLmlzRW1wdHkoKSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCeXRlcyg1LCBib2R5Xyk7DQogICAgICB9DQogICAgICBpZiAoc3RvcmVfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woNiwgc3RvcmVfKTsNCiAgICAgIH0NCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgIC5zZXJpYWxpemVTdHJpbmdNYXBUbygNCiAgICAgICAgICBvdXRwdXQsDQogICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCksDQogICAgICAgICAgVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnksDQogICAgICAgICAgNyk7DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRFdmVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgxLCBldmVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENsaWVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgyLCBjbGllbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgzLCBjaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldE1ldGFkYXRhQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSg0LCBtZXRhZGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFib2R5Xy5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoNSwgYm9keV8pOw0KICAgICAgfQ0KICAgICAgaWYgKHN0b3JlXyAhPSBmYWxzZSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDYsIHN0b3JlXyk7DQogICAgICB9DQogICAgICBmb3IgKGphdmEudXRpbC5NYXAuRW50cnk8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZW50cnkNCiAgICAgICAgICAgOiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5lbnRyeVNldCgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnk8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgICAgdGFnc19fID0gVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnkubmV3QnVpbGRlckZvclR5cGUoKQ0KICAgICAgICAgICAgLnNldEtleShlbnRyeS5nZXRLZXkoKSkNCiAgICAgICAgICAgIC5zZXRWYWx1ZShlbnRyeS5nZXRWYWx1ZSgpKQ0KICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg3LCB0YWdzX18pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50KSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IG90aGVyID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldEV2ZW50SUQoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0RXZlbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDbGllbnRJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDbGllbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDaGFubmVsKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENoYW5uZWwoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0TWV0YWRhdGEoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0TWV0YWRhdGEoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0Qm9keSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRCb2R5KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRTdG9yZSgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0U3RvcmUoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgaW50ZXJuYWxHZXRUYWdzKCkuZXF1YWxzKA0KICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVZFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRFdmVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENMSUVOVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENsaWVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENIQU5ORUxfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2hhbm5lbCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNRVRBREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNZXRhZGF0YSgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBCT0RZX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEJvZHkoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgU1RPUkVfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRTdG9yZSgpKTsNCiAgICAgIGlmICghaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFRBR1NfRklFTERfTlVNQkVSOw0KICAgICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBpbnRlcm5hbEdldFRhZ3MoKS5oYXNoQ29kZSgpOw0KICAgICAgfQ0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCBwYXJzZUZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuRXZlbnR9DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjxCdWlsZGVyPiBpbXBsZW1lbnRzDQogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX2ltcGxlbWVudHM6a3ViZW1xLkV2ZW50KQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50T3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE1hcEZpZWxkKA0KICAgICAgICAgIGludCBudW1iZXIpIHsNCiAgICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgICBjYXNlIDc6DQogICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAgICJJbnZhbGlkIG1hcCBmaWVsZCBudW1iZXI6ICIgKyBudW1iZXIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE11dGFibGVNYXBGaWVsZCgNCiAgICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICAgIHN3aXRjaCAobnVtYmVyKSB7DQogICAgICAgICAgY2FzZSA3Og0KICAgICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIGV2ZW50SURfID0gIiI7DQoNCiAgICAgICAgY2xpZW50SURfID0gIiI7DQoNCiAgICAgICAgY2hhbm5lbF8gPSAiIjsNCg0KICAgICAgICBtZXRhZGF0YV8gPSAiIjsNCg0KICAgICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCg0KICAgICAgICBzdG9yZV8gPSBmYWxzZTsNCg0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuY2xlYXIoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgYnVpbGQoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHJlc3VsdCA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50KHRoaXMpOw0KICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsNCiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgICByZXN1bHQuZXZlbnRJRF8gPSBldmVudElEXzsNCiAgICAgICAgcmVzdWx0LmNsaWVudElEXyA9IGNsaWVudElEXzsNCiAgICAgICAgcmVzdWx0LmNoYW5uZWxfID0gY2hhbm5lbF87DQogICAgICAgIHJlc3VsdC5tZXRhZGF0YV8gPSBtZXRhZGF0YV87DQogICAgICAgIHJlc3VsdC5ib2R5XyA9IGJvZHlfOw0KICAgICAgICByZXN1bHQuc3RvcmVfID0gc3RvcmVfOw0KICAgICAgICByZXN1bHQudGFnc18gPSBpbnRlcm5hbEdldFRhZ3MoKTsNCiAgICAgICAgcmVzdWx0LnRhZ3NfLm1ha2VJbW11dGFibGUoKTsNCiAgICAgICAgcmVzdWx0LmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOw0KICAgICAgICBvbkJ1aWx0KCk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsb25lKCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0RmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhckZpZWxkKGZpZWxkKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyT25lb2YoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5PbmVvZkRlc2NyaXB0b3Igb25lb2YpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhck9uZW9mKG9uZW9mKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgaW50IGluZGV4LCBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0UmVwZWF0ZWRGaWVsZChmaWVsZCwgaW5kZXgsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmFkZFJlcGVhdGVkRmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldEV2ZW50SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBldmVudElEXyA9IG90aGVyLmV2ZW50SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0Q2xpZW50SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBjbGllbnRJRF8gPSBvdGhlci5jbGllbnRJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDaGFubmVsKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgY2hhbm5lbF8gPSBvdGhlci5jaGFubmVsXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldE1ldGFkYXRhKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgbWV0YWRhdGFfID0gb3RoZXIubWV0YWRhdGFfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRCb2R5KCkgIT0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZKSB7DQogICAgICAgICAgc2V0Qm9keShvdGhlci5nZXRCb2R5KCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRTdG9yZSgpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0U3RvcmUob3RoZXIuZ2V0U3RvcmUoKSk7DQogICAgICAgIH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLm1lcmdlRnJvbSgNCiAgICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50KSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOw0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZXZlbnRJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXZlbnRJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBldmVudElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgZXZlbnRJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRFdmVudElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXZlbnRJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgZXZlbnRJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXZlbnRJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGV2ZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFdmVudElEKCkgew0KICAgICAgICANCiAgICAgICAgZXZlbnRJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRFdmVudElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXZlbnRJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBldmVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBjbGllbnRJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENsaWVudElEKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldENsaWVudElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGNsaWVudElEXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2xpZW50SUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBjbGllbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDbGllbnRJRCgpIHsNCiAgICAgICAgDQogICAgICAgIGNsaWVudElEXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldENsaWVudElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENsaWVudElEQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGNsaWVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBjaGFubmVsXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldENoYW5uZWxCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDaGFubmVsKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgY2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNoYW5uZWwoKSB7DQogICAgICAgIA0KICAgICAgICBjaGFubmVsXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldENoYW5uZWwoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDaGFubmVsQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IG1ldGFkYXRhXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWV0YWRhdGEoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWV0YWRhdGFfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBtZXRhZGF0YV8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0TWV0YWRhdGFCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgbWV0YWRhdGFfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXRhZGF0YSgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIG1ldGFkYXRhXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1ldGFkYXRhKCkgew0KICAgICAgICANCiAgICAgICAgbWV0YWRhdGFfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0TWV0YWRhdGEoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWV0YWRhdGFCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgbWV0YWRhdGFfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIEJvZHkgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCkgew0KICAgICAgICByZXR1cm4gYm9keV87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIEJvZHkgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Qm9keShjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgYm9keV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQm9keSgpIHsNCiAgICAgICAgDQogICAgICAgIGJvZHlfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Qm9keSgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgYm9vbGVhbiBzdG9yZV8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIFN0b3JlID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldFN0b3JlKCkgew0KICAgICAgICByZXR1cm4gc3RvcmVfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIFN0b3JlID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN0b3JlKGJvb2xlYW4gdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIHN0b3JlXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgU3RvcmUgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdG9yZSgpIHsNCiAgICAgICAgDQogICAgICAgIHN0b3JlXyA9IGZhbHNlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDwNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB0YWdzXzsNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgaW50ZXJuYWxHZXRUYWdzKCkgew0KICAgICAgICBpZiAodGFnc18gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLmVtcHR5TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGFnc187DQogICAgICB9DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKSB7DQogICAgICAgIG9uQ2hhbmdlZCgpOzsNCiAgICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgICB0YWdzXyA9IGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQubmV3TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRhZ3NfLmlzTXV0YWJsZSgpKSB7DQogICAgICAgICAgdGFnc18gPSB0YWdzXy5jb3B5KCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW50IGdldFRhZ3NDb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLnNpemUoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNUYWdzKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmNvbnRhaW5zS2V5KGtleSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgICAqLw0KICAgICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzKCkgew0KICAgICAgICByZXR1cm4gZ2V0VGFnc01hcCgpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzTWFwKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgICAgcmV0dXJuIG1hcC5jb250YWluc0tleShrZXkpID8gbWFwLmdldChrZXkpIDogZGVmYXVsdFZhbHVlOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgICBpZiAoIW1hcC5jb250YWluc0tleShrZXkpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWFwLmdldChrZXkpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclRhZ3MoKSB7DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5jbGVhcigpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgcmVtb3ZlVGFncygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5yZW1vdmUoa2V5KTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIFVzZSBhbHRlcm5hdGUgbXV0YXRpb24gYWNjZXNzb3JzIGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGdldE11dGFibGVUYWdzKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHB1dFRhZ3MoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucHV0KGtleSwgdmFsdWUpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgcHV0QWxsVGFncygNCiAgICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IHZhbHVlcykgew0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucHV0QWxsKHZhbHVlcyk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5FdmVudCkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLkV2ZW50KQ0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IGdldERlZmF1bHRJbnN0YW5jZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEV2ZW50Pg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxFdmVudD4oKSB7DQogICAgICBwdWJsaWMgRXZlbnQgcGFyc2VQYXJ0aWFsRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgICAgcmV0dXJuIG5ldyBFdmVudChpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEV2ZW50PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8RXZlbnQ+IGdldFBhcnNlckZvclR5cGUoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgRXZlbnRSZWNlaXZlT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuRXZlbnRSZWNlaXZlKQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRFdmVudElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0RXZlbnRJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMjs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENoYW5uZWxCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRNZXRhZGF0YSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNDs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFRpbWVzdGFtcCA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIGxvbmcgZ2V0VGltZXN0YW1wKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBsb25nIGdldFNlcXVlbmNlKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0VGFnc0NvdW50KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBjb250YWluc1RhZ3MoDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KTsNCiAgICAvKioNCiAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICovDQogICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgIGdldFRhZ3MoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFnc01hcCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuRXZlbnRSZWNlaXZlfQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgRXZlbnRSZWNlaXZlIGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLkV2ZW50UmVjZWl2ZSkNCiAgICAgIEV2ZW50UmVjZWl2ZU9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBFdmVudFJlY2VpdmUubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIEV2ZW50UmVjZWl2ZShjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIEV2ZW50UmVjZWl2ZSgpIHsNCiAgICAgIGV2ZW50SURfID0gIiI7DQogICAgICBjaGFubmVsXyA9ICIiOw0KICAgICAgbWV0YWRhdGFfID0gIiI7DQogICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCiAgICAgIHRpbWVzdGFtcF8gPSAwTDsNCiAgICAgIHNlcXVlbmNlXyA9IDBMOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBFdmVudFJlY2VpdmUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGV2ZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE4OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI2OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIG1ldGFkYXRhXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAzNDogew0KDQogICAgICAgICAgICAgIGJvZHlfID0gaW5wdXQucmVhZEJ5dGVzKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA0MDogew0KDQogICAgICAgICAgICAgIHRpbWVzdGFtcF8gPSBpbnB1dC5yZWFkSW50NjQoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQ4OiB7DQoNCiAgICAgICAgICAgICAgc2VxdWVuY2VfID0gaW5wdXQucmVhZFVJbnQ2NCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTg6IHsNCiAgICAgICAgICAgICAgaWYgKCEoKG11dGFibGVfYml0RmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4MDAwMDAwNDApKSB7DQogICAgICAgICAgICAgICAgdGFnc18gPSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLm5ld01hcEZpZWxkKA0KICAgICAgICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgICAgICAgICAgbXV0YWJsZV9iaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICAgICAgICB0YWdzX18gPSBpbnB1dC5yZWFkTWVzc2FnZSgNCiAgICAgICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5LmdldFBhcnNlckZvclR5cGUoKSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICAgICAgICB0YWdzXy5nZXRNdXRhYmxlTWFwKCkucHV0KA0KICAgICAgICAgICAgICAgICAgdGFnc19fLmdldEtleSgpLCB0YWdzX18uZ2V0VmFsdWUoKSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudFJlY2VpdmVfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQgaW50ZXJuYWxHZXRNYXBGaWVsZCgNCiAgICAgICAgaW50IG51bWJlcikgew0KICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgY2FzZSA3Og0KICAgICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICB9DQogICAgfQ0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlLkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRVZFTlRJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBldmVudElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEV2ZW50SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGV2ZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGV2ZW50SURfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFdmVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFdmVudElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGV2ZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGV2ZW50SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENIQU5ORUxfRklFTERfTlVNQkVSID0gMjsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVRBREFUQV9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBtZXRhZGF0YV87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWV0YWRhdGEoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBtZXRhZGF0YV8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgbWV0YWRhdGFfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPRFlfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCkgew0KICAgICAgcmV0dXJuIGJvZHlfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRJTUVTVEFNUF9GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgbG9uZyB0aW1lc3RhbXBfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFRpbWVzdGFtcCA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBsb25nIGdldFRpbWVzdGFtcCgpIHsNCiAgICAgIHJldHVybiB0aW1lc3RhbXBfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNFUVVFTkNFX0ZJRUxEX05VTUJFUiA9IDY7DQogICAgcHJpdmF0ZSBsb25nIHNlcXVlbmNlXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRTZXF1ZW5jZSgpIHsNCiAgICAgIHJldHVybiBzZXF1ZW5jZV87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVEFHU19GSUVMRF9OVU1CRVIgPSA3Ow0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNsYXNzIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIgew0KICAgICAgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnk8DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZGVmYXVsdEVudHJ5ID0NCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeQ0KICAgICAgICAgICAgICAuPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+bmV3RGVmYXVsdEluc3RhbmNlKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9UYWdzRW50cnlfZGVzY3JpcHRvciwgDQogICAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLldpcmVGb3JtYXQuRmllbGRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5XaXJlRm9ybWF0LkZpZWxkVHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAiIik7DQogICAgfQ0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gdGFnc187DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgaW50ZXJuYWxHZXRUYWdzKCkgew0KICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQuZW1wdHlNYXBGaWVsZCgNCiAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0YWdzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFRhZ3NDb3VudCgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5zaXplKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNUYWdzKA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmNvbnRhaW5zS2V5KGtleSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgKi8NCiAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzKCkgew0KICAgICAgcmV0dXJuIGdldFRhZ3NNYXAoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzTWFwKCkgew0KICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGRlZmF1bHRWYWx1ZSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgcmV0dXJuIG1hcC5jb250YWluc0tleShrZXkpID8gbWFwLmdldChrZXkpIDogZGVmYXVsdFZhbHVlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgaWYgKCFtYXAuY29udGFpbnNLZXkoa2V5KSkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG1hcC5nZXQoa2V5KTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICghZ2V0RXZlbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMSwgZXZlbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAyLCBjaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldE1ldGFkYXRhQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAzLCBtZXRhZGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFib2R5Xy5pc0VtcHR5KCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNCwgYm9keV8pOw0KICAgICAgfQ0KICAgICAgaWYgKHRpbWVzdGFtcF8gIT0gMEwpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50NjQoNSwgdGltZXN0YW1wXyk7DQogICAgICB9DQogICAgICBpZiAoc2VxdWVuY2VfICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZVVJbnQ2NCg2LCBzZXF1ZW5jZV8pOw0KICAgICAgfQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgLnNlcmlhbGl6ZVN0cmluZ01hcFRvKA0KICAgICAgICAgIG91dHB1dCwNCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKSwNCiAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSwNCiAgICAgICAgICA3KTsNCiAgICAgIHVua25vd25GaWVsZHMud3JpdGVUbyhvdXRwdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7DQogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2l6ZTsNCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsNCg0KICAgICAgc2l6ZSA9IDA7DQogICAgICBpZiAoIWdldEV2ZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIGV2ZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMiwgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRNZXRhZGF0YUJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMywgbWV0YWRhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghYm9keV8uaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDQsIGJvZHlfKTsNCiAgICAgIH0NCiAgICAgIGlmICh0aW1lc3RhbXBfICE9IDBMKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDUsIHRpbWVzdGFtcF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlcXVlbmNlXyAhPSAwTCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUoNiwgc2VxdWVuY2VfKTsNCiAgICAgIH0NCiAgICAgIGZvciAoamF2YS51dGlsLk1hcC5FbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBlbnRyeQ0KICAgICAgICAgICA6IGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmVudHJ5U2V0KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICB0YWdzX18gPSBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5uZXdCdWlsZGVyRm9yVHlwZSgpDQogICAgICAgICAgICAuc2V0S2V5KGVudHJ5LmdldEtleSgpKQ0KICAgICAgICAgICAgLnNldFZhbHVlKGVudHJ5LmdldFZhbHVlKCkpDQogICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDcsIHRhZ3NfXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlKSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0RXZlbnRJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRFdmVudElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENoYW5uZWwoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0Q2hhbm5lbCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRNZXRhZGF0YSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXRhZGF0YSgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRCb2R5KCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldEJvZHkoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFRpbWVzdGFtcCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0VGltZXN0YW1wKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRTZXF1ZW5jZSgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0U2VxdWVuY2UoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgaW50ZXJuYWxHZXRUYWdzKCkuZXF1YWxzKA0KICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVZFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRFdmVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENIQU5ORUxfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2hhbm5lbCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNRVRBREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNZXRhZGF0YSgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBCT0RZX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEJvZHkoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgVElNRVNUQU1QX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0VGltZXN0YW1wKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgU0VRVUVOQ0VfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoTG9uZygNCiAgICAgICAgICBnZXRTZXF1ZW5jZSgpKTsNCiAgICAgIGlmICghaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFRBR1NfRklFTERfTlVNQkVSOw0KICAgICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBpbnRlcm5hbEdldFRhZ3MoKS5oYXNoQ29kZSgpOw0KICAgICAgfQ0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLkV2ZW50UmVjZWl2ZX0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuRXZlbnRSZWNlaXZlKQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZU9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkIGludGVybmFsR2V0TWFwRmllbGQoDQogICAgICAgICAgaW50IG51bWJlcikgew0KICAgICAgICBzd2l0Y2ggKG51bWJlcikgew0KICAgICAgICAgIGNhc2UgNzoNCiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkIGludGVybmFsR2V0TXV0YWJsZU1hcEZpZWxkKA0KICAgICAgICAgIGludCBudW1iZXIpIHsNCiAgICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgICBjYXNlIDc6DQogICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpOw0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgICAiSW52YWxpZCBtYXAgZmllbGQgbnVtYmVyOiAiICsgbnVtYmVyKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZS5CdWlsZGVyLmNsYXNzKTsNCiAgICAgIH0NCg0KICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlLm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIGV2ZW50SURfID0gIiI7DQoNCiAgICAgICAgY2hhbm5lbF8gPSAiIjsNCg0KICAgICAgICBtZXRhZGF0YV8gPSAiIjsNCg0KICAgICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCg0KICAgICAgICB0aW1lc3RhbXBfID0gMEw7DQoNCiAgICAgICAgc2VxdWVuY2VfID0gMEw7DQoNCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmNsZWFyKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlKHRoaXMpOw0KICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsNCiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgICByZXN1bHQuZXZlbnRJRF8gPSBldmVudElEXzsNCiAgICAgICAgcmVzdWx0LmNoYW5uZWxfID0gY2hhbm5lbF87DQogICAgICAgIHJlc3VsdC5tZXRhZGF0YV8gPSBtZXRhZGF0YV87DQogICAgICAgIHJlc3VsdC5ib2R5XyA9IGJvZHlfOw0KICAgICAgICByZXN1bHQudGltZXN0YW1wXyA9IHRpbWVzdGFtcF87DQogICAgICAgIHJlc3VsdC5zZXF1ZW5jZV8gPSBzZXF1ZW5jZV87DQogICAgICAgIHJlc3VsdC50YWdzXyA9IGludGVybmFsR2V0VGFncygpOw0KICAgICAgICByZXN1bHQudGFnc18ubWFrZUltbXV0YWJsZSgpOw0KICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxkMF87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlKW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldEV2ZW50SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBldmVudElEXyA9IG90aGVyLmV2ZW50SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0Q2hhbm5lbCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNoYW5uZWxfID0gb3RoZXIuY2hhbm5lbF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRNZXRhZGF0YSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIG1ldGFkYXRhXyA9IG90aGVyLm1ldGFkYXRhXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0Qm9keSgpICE9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWSkgew0KICAgICAgICAgIHNldEJvZHkob3RoZXIuZ2V0Qm9keSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0VGltZXN0YW1wKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRUaW1lc3RhbXAob3RoZXIuZ2V0VGltZXN0YW1wKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRTZXF1ZW5jZSgpICE9IDBMKSB7DQogICAgICAgICAgc2V0U2VxdWVuY2Uob3RoZXIuZ2V0U2VxdWVuY2UoKSk7DQogICAgICAgIH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLm1lcmdlRnJvbSgNCiAgICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUpIGUuZ2V0VW5maW5pc2hlZE1lc3NhZ2UoKTsNCiAgICAgICAgICB0aHJvdyBlLnVud3JhcElPRXhjZXB0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgaWYgKHBhcnNlZE1lc3NhZ2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgbWVyZ2VGcm9tKHBhcnNlZE1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBldmVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFdmVudElEKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGV2ZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBldmVudElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEV2ZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldEV2ZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBldmVudElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBldmVudElEXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFdmVudElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXZlbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckV2ZW50SUQoKSB7DQogICAgICAgIA0KICAgICAgICBldmVudElEXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEV2ZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXZlbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFdmVudElEQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGV2ZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNoYW5uZWxfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGNoYW5uZWxfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWwoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2hhbm5lbCgpIHsNCiAgICAgICAgDQogICAgICAgIGNoYW5uZWxfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2hhbm5lbCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWxCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgbWV0YWRhdGFfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRNZXRhZGF0YSgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIG1ldGFkYXRhXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBtZXRhZGF0YV8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1ldGFkYXRhKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgbWV0YWRhdGFfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWV0YWRhdGEoKSB7DQogICAgICAgIA0KICAgICAgICBtZXRhZGF0YV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRNZXRhZGF0YSgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXRhZGF0YUJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBtZXRhZGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKSB7DQogICAgICAgIHJldHVybiBib2R5XzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRCb2R5KGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBib2R5XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIEJvZHkgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb2R5KCkgew0KICAgICAgICANCiAgICAgICAgYm9keV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRCb2R5KCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHRpbWVzdGFtcF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBUaW1lc3RhbXAgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0VGltZXN0YW1wKCkgew0KICAgICAgICByZXR1cm4gdGltZXN0YW1wXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFRpbWVzdGFtcChsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB0aW1lc3RhbXBfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVGltZXN0YW1wKCkgew0KICAgICAgICANCiAgICAgICAgdGltZXN0YW1wXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBzZXF1ZW5jZV8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0U2VxdWVuY2UoKSB7DQogICAgICAgIHJldHVybiBzZXF1ZW5jZV87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBTZXF1ZW5jZSA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTZXF1ZW5jZShsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBzZXF1ZW5jZV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTZXF1ZW5jZSgpIHsNCiAgICAgICAgDQogICAgICAgIHNlcXVlbmNlXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDwNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB0YWdzXzsNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgaW50ZXJuYWxHZXRUYWdzKCkgew0KICAgICAgICBpZiAodGFnc18gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLmVtcHR5TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGFnc187DQogICAgICB9DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKSB7DQogICAgICAgIG9uQ2hhbmdlZCgpOzsNCiAgICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgICB0YWdzXyA9IGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQubmV3TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRhZ3NfLmlzTXV0YWJsZSgpKSB7DQogICAgICAgICAgdGFnc18gPSB0YWdzXy5jb3B5KCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW50IGdldFRhZ3NDb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLnNpemUoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNUYWdzKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmNvbnRhaW5zS2V5KGtleSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgICAqLw0KICAgICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzKCkgew0KICAgICAgICByZXR1cm4gZ2V0VGFnc01hcCgpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzTWFwKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDc7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgICAgcmV0dXJuIG1hcC5jb250YWluc0tleShrZXkpID8gbWFwLmdldChrZXkpIDogZGVmYXVsdFZhbHVlOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgICBpZiAoIW1hcC5jb250YWluc0tleShrZXkpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWFwLmdldChrZXkpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclRhZ3MoKSB7DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5jbGVhcigpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgcmVtb3ZlVGFncygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5yZW1vdmUoa2V5KTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIFVzZSBhbHRlcm5hdGUgbXV0YXRpb24gYWNjZXNzb3JzIGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGdldE11dGFibGVUYWdzKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHB1dFRhZ3MoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucHV0KGtleSwgdmFsdWUpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgcHV0QWxsVGFncygNCiAgICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IHZhbHVlcykgew0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucHV0QWxsKHZhbHVlcyk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5FdmVudFJlY2VpdmUpDQogICAgfQ0KDQogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOmt1YmVtcS5FdmVudFJlY2VpdmUpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmUgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8RXZlbnRSZWNlaXZlPg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxFdmVudFJlY2VpdmU+KCkgew0KICAgICAgcHVibGljIEV2ZW50UmVjZWl2ZSBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IEV2ZW50UmVjZWl2ZShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEV2ZW50UmVjZWl2ZT4gcGFyc2VyKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEV2ZW50UmVjZWl2ZT4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgU3Vic2NyaWJlT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuU3Vic2NyaWJlKQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUgU3Vic2NyaWJlVHlwZURhdGEgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0U3Vic2NyaWJlVHlwZURhdGFWYWx1ZSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUgU3Vic2NyaWJlVHlwZURhdGEgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIGdldFN1YnNjcmliZVR5cGVEYXRhKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENsaWVudElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgR3JvdXAgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldEdyb3VwKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEdyb3VwID0gNDs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEdyb3VwQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldEV2ZW50c1N0b3JlVHlwZURhdGFWYWx1ZSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlIGdldEV2ZW50c1N0b3JlVHlwZURhdGEoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IEV2ZW50c1N0b3JlVHlwZVZhbHVlID0gNjs8L2NvZGU+DQogICAgICovDQogICAgbG9uZyBnZXRFdmVudHNTdG9yZVR5cGVWYWx1ZSgpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuU3Vic2NyaWJlfQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgU3Vic2NyaWJlIGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLlN1YnNjcmliZSkNCiAgICAgIFN1YnNjcmliZU9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBTdWJzY3JpYmUubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIFN1YnNjcmliZShjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFN1YnNjcmliZSgpIHsNCiAgICAgIHN1YnNjcmliZVR5cGVEYXRhXyA9IDA7DQogICAgICBjbGllbnRJRF8gPSAiIjsNCiAgICAgIGNoYW5uZWxfID0gIiI7DQogICAgICBncm91cF8gPSAiIjsNCiAgICAgIGV2ZW50c1N0b3JlVHlwZURhdGFfID0gMDsNCiAgICAgIGV2ZW50c1N0b3JlVHlwZVZhbHVlXyA9IDBMOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBTdWJzY3JpYmUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDg6IHsNCiAgICAgICAgICAgICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0oKTsNCg0KICAgICAgICAgICAgICBzdWJzY3JpYmVUeXBlRGF0YV8gPSByYXdWYWx1ZTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE4OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAyNjogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAzNDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBncm91cF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDA6IHsNCiAgICAgICAgICAgICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0oKTsNCg0KICAgICAgICAgICAgICBldmVudHNTdG9yZVR5cGVEYXRhXyA9IHJhd1ZhbHVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDg6IHsNCg0KICAgICAgICAgICAgICBldmVudHNTdG9yZVR5cGVWYWx1ZV8gPSBpbnB1dC5yZWFkSW50NjQoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IGUuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKA0KICAgICAgICAgICAgZSkuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnVua25vd25GaWVsZHMgPSB1bmtub3duRmllbGRzLmJ1aWxkKCk7DQogICAgICAgIG1ha2VFeHRlbnNpb25zSW1tdXRhYmxlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N1YnNjcmliZV9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N1YnNjcmliZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIGVudW0ge0Bjb2RlIGt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZX0NCiAgICAgKi8NCiAgICBwdWJsaWMgZW51bSBTdWJzY3JpYmVUeXBlDQogICAgICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90b2NvbE1lc3NhZ2VFbnVtIHsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3Vic2NyaWJlVHlwZVVuZGVmaW5lZCA9IDA7PC9jb2RlPg0KICAgICAgICovDQogICAgICBTdWJzY3JpYmVUeXBlVW5kZWZpbmVkKDApLA0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5FdmVudHMgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgRXZlbnRzKDEpLA0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5FdmVudHNTdG9yZSA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBFdmVudHNTdG9yZSgyKSwNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Q29tbWFuZHMgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgQ29tbWFuZHMoMyksDQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlF1ZXJpZXMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgUXVlcmllcyg0KSwNCiAgICAgIFVOUkVDT0dOSVpFRCgtMSksDQogICAgICA7DQoNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3Vic2NyaWJlVHlwZVVuZGVmaW5lZCA9IDA7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTdWJzY3JpYmVUeXBlVW5kZWZpbmVkX1ZBTFVFID0gMDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+RXZlbnRzID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEV2ZW50c19WQUxVRSA9IDE7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPkV2ZW50c1N0b3JlID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEV2ZW50c1N0b3JlX1ZBTFVFID0gMjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Q29tbWFuZHMgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ29tbWFuZHNfVkFMVUUgPSAzOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5RdWVyaWVzID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFF1ZXJpZXNfVkFMVUUgPSA0Ow0KDQoNCiAgICAgIHB1YmxpYyBmaW5hbCBpbnQgZ2V0TnVtYmVyKCkgew0KICAgICAgICBpZiAodGhpcyA9PSBVTlJFQ09HTklaRUQpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgIkNhbid0IGdldCB0aGUgbnVtYmVyIG9mIGFuIHVua25vd24gZW51bSB2YWx1ZS4iKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICB9DQoNCiAgICAgIC8qKg0KICAgICAgICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayAjZm9yTnVtYmVyKGludCl9IGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIHN0YXRpYyBTdWJzY3JpYmVUeXBlIHZhbHVlT2YoaW50IHZhbHVlKSB7DQogICAgICAgIHJldHVybiBmb3JOdW1iZXIodmFsdWUpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgc3RhdGljIFN1YnNjcmliZVR5cGUgZm9yTnVtYmVyKGludCB2YWx1ZSkgew0KICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7DQogICAgICAgICAgY2FzZSAwOiByZXR1cm4gU3Vic2NyaWJlVHlwZVVuZGVmaW5lZDsNCiAgICAgICAgICBjYXNlIDE6IHJldHVybiBFdmVudHM7DQogICAgICAgICAgY2FzZSAyOiByZXR1cm4gRXZlbnRzU3RvcmU7DQogICAgICAgICAgY2FzZSAzOiByZXR1cm4gQ29tbWFuZHM7DQogICAgICAgICAgY2FzZSA0OiByZXR1cm4gUXVlcmllczsNCiAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3Vic2NyaWJlVHlwZT4NCiAgICAgICAgICBpbnRlcm5hbEdldFZhbHVlTWFwKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8DQogICAgICAgICAgU3Vic2NyaWJlVHlwZT4gaW50ZXJuYWxWYWx1ZU1hcCA9DQogICAgICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxTdWJzY3JpYmVUeXBlPigpIHsNCiAgICAgICAgICAgICAgcHVibGljIFN1YnNjcmliZVR5cGUgZmluZFZhbHVlQnlOdW1iZXIoaW50IG51bWJlcikgew0KICAgICAgICAgICAgICAgIHJldHVybiBTdWJzY3JpYmVUeXBlLmZvck51bWJlcihudW1iZXIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yDQogICAgICAgICAgZ2V0VmFsdWVEZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpLmdldFZhbHVlcygpLmdldChvcmRpbmFsKCkpOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDApOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdWJzY3JpYmVUeXBlW10gVkFMVUVTID0gdmFsdWVzKCk7DQoNCiAgICAgIHB1YmxpYyBzdGF0aWMgU3Vic2NyaWJlVHlwZSB2YWx1ZU9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvciBkZXNjKSB7DQogICAgICAgIGlmIChkZXNjLmdldFR5cGUoKSAhPSBnZXREZXNjcmlwdG9yKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAgICJFbnVtVmFsdWVEZXNjcmlwdG9yIGlzIG5vdCBmb3IgdGhpcyB0eXBlLiIpOw0KICAgICAgICB9DQogICAgICAgIGlmIChkZXNjLmdldEluZGV4KCkgPT0gLTEpIHsNCiAgICAgICAgICByZXR1cm4gVU5SRUNPR05JWkVEOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBWQUxVRVNbZGVzYy5nZXRJbmRleCgpXTsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgdmFsdWU7DQoNCiAgICAgIHByaXZhdGUgU3Vic2NyaWJlVHlwZShpbnQgdmFsdWUpIHsNCiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOw0KICAgICAgfQ0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoZW51bV9zY29wZTprdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUpDQogICAgfQ0KDQogICAgLyoqDQogICAgICogUHJvdG9idWYgZW51bSB7QGNvZGUga3ViZW1xLlN1YnNjcmliZS5FdmVudHNTdG9yZVR5cGV9DQogICAgICovDQogICAgcHVibGljIGVudW0gRXZlbnRzU3RvcmVUeXBlDQogICAgICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90b2NvbE1lc3NhZ2VFbnVtIHsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+RXZlbnRzU3RvcmVUeXBlVW5kZWZpbmVkID0gMDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIEV2ZW50c1N0b3JlVHlwZVVuZGVmaW5lZCgwKSwNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3RhcnROZXdPbmx5ID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIFN0YXJ0TmV3T25seSgxKSwNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3RhcnRGcm9tRmlyc3QgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgU3RhcnRGcm9tRmlyc3QoMiksDQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0RnJvbUxhc3QgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgU3RhcnRGcm9tTGFzdCgzKSwNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3RhcnRBdFNlcXVlbmNlID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIFN0YXJ0QXRTZXF1ZW5jZSg0KSwNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+U3RhcnRBdFRpbWUgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgU3RhcnRBdFRpbWUoNSksDQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0QXRUaW1lRGVsdGEgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgU3RhcnRBdFRpbWVEZWx0YSg2KSwNCiAgICAgIFVOUkVDT0dOSVpFRCgtMSksDQogICAgICA7DQoNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+RXZlbnRzU3RvcmVUeXBlVW5kZWZpbmVkID0gMDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEV2ZW50c1N0b3JlVHlwZVVuZGVmaW5lZF9WQUxVRSA9IDA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0TmV3T25seSA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTdGFydE5ld09ubHlfVkFMVUUgPSAxOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5TdGFydEZyb21GaXJzdCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTdGFydEZyb21GaXJzdF9WQUxVRSA9IDI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0RnJvbUxhc3QgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU3RhcnRGcm9tTGFzdF9WQUxVRSA9IDM7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0QXRTZXF1ZW5jZSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTdGFydEF0U2VxdWVuY2VfVkFMVUUgPSA0Ow0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5TdGFydEF0VGltZSA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTdGFydEF0VGltZV9WQUxVRSA9IDU7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlN0YXJ0QXRUaW1lRGVsdGEgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU3RhcnRBdFRpbWVEZWx0YV9WQUxVRSA9IDY7DQoNCg0KICAgICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIoKSB7DQogICAgICAgIGlmICh0aGlzID09IFVOUkVDT0dOSVpFRCkgew0KICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKA0KICAgICAgICAgICAgICAiQ2FuJ3QgZ2V0IHRoZSBudW1iZXIgb2YgYW4gdW5rbm93biBlbnVtIHZhbHVlLiIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgIH0NCg0KICAgICAgLyoqDQogICAgICAgKiBAZGVwcmVjYXRlZCBVc2Uge0BsaW5rICNmb3JOdW1iZXIoaW50KX0gaW5zdGVhZC4NCiAgICAgICAqLw0KICAgICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgICBwdWJsaWMgc3RhdGljIEV2ZW50c1N0b3JlVHlwZSB2YWx1ZU9mKGludCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gZm9yTnVtYmVyKHZhbHVlKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIHN0YXRpYyBFdmVudHNTdG9yZVR5cGUgZm9yTnVtYmVyKGludCB2YWx1ZSkgew0KICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7DQogICAgICAgICAgY2FzZSAwOiByZXR1cm4gRXZlbnRzU3RvcmVUeXBlVW5kZWZpbmVkOw0KICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFN0YXJ0TmV3T25seTsNCiAgICAgICAgICBjYXNlIDI6IHJldHVybiBTdGFydEZyb21GaXJzdDsNCiAgICAgICAgICBjYXNlIDM6IHJldHVybiBTdGFydEZyb21MYXN0Ow0KICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFN0YXJ0QXRTZXF1ZW5jZTsNCiAgICAgICAgICBjYXNlIDU6IHJldHVybiBTdGFydEF0VGltZTsNCiAgICAgICAgICBjYXNlIDY6IHJldHVybiBTdGFydEF0VGltZURlbHRhOw0KICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxFdmVudHNTdG9yZVR5cGU+DQogICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsVmFsdWVNYXA7DQogICAgICB9DQogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPA0KICAgICAgICAgIEV2ZW50c1N0b3JlVHlwZT4gaW50ZXJuYWxWYWx1ZU1hcCA9DQogICAgICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxFdmVudHNTdG9yZVR5cGU+KCkgew0KICAgICAgICAgICAgICBwdWJsaWMgRXZlbnRzU3RvcmVUeXBlIGZpbmRWYWx1ZUJ5TnVtYmVyKGludCBudW1iZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gRXZlbnRzU3RvcmVUeXBlLmZvck51bWJlcihudW1iZXIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yDQogICAgICAgICAgZ2V0VmFsdWVEZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpLmdldFZhbHVlcygpLmdldChvcmRpbmFsKCkpOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDEpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBFdmVudHNTdG9yZVR5cGVbXSBWQUxVRVMgPSB2YWx1ZXMoKTsNCg0KICAgICAgcHVibGljIHN0YXRpYyBFdmVudHNTdG9yZVR5cGUgdmFsdWVPZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IgZGVzYykgew0KICAgICAgICBpZiAoZGVzYy5nZXRUeXBlKCkgIT0gZ2V0RGVzY3JpcHRvcigpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oDQogICAgICAgICAgICAiRW51bVZhbHVlRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlwZS4iKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGVzYy5nZXRJbmRleCgpID09IC0xKSB7DQogICAgICAgICAgcmV0dXJuIFVOUkVDT0dOSVpFRDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5kZXgoKV07DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVlOw0KDQogICAgICBwcml2YXRlIEV2ZW50c1N0b3JlVHlwZShpbnQgdmFsdWUpIHsNCiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOw0KICAgICAgfQ0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoZW51bV9zY29wZTprdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSkNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJQkVUWVBFREFUQV9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgaW50IHN1YnNjcmliZVR5cGVEYXRhXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIFN1YnNjcmliZVR5cGVEYXRhID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRTdWJzY3JpYmVUeXBlRGF0YVZhbHVlKCkgew0KICAgICAgcmV0dXJuIHN1YnNjcmliZVR5cGVEYXRhXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZSBTdWJzY3JpYmVUeXBlRGF0YSA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIGdldFN1YnNjcmliZVR5cGVEYXRhKCkgew0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZSByZXN1bHQgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlLnZhbHVlT2Yoc3Vic2NyaWJlVHlwZURhdGFfKTsNCiAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUuVU5SRUNPR05JWkVEIDogcmVzdWx0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMSUVOVElEX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0hBTk5FTF9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBjaGFubmVsXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGNoYW5uZWxfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEdST1VQX0ZJRUxEX05VTUJFUiA9IDQ7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGdyb3VwXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgR3JvdXAgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRHcm91cCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZ3JvdXBfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGdyb3VwXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgR3JvdXAgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEdyb3VwQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGdyb3VwXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBncm91cF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRVZFTlRTU1RPUkVUWVBFREFUQV9GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgaW50IGV2ZW50c1N0b3JlVHlwZURhdGFfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRFdmVudHNTdG9yZVR5cGVEYXRhVmFsdWUoKSB7DQogICAgICByZXR1cm4gZXZlbnRzU3RvcmVUeXBlRGF0YV87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBnZXRFdmVudHNTdG9yZVR5cGVEYXRhKCkgew0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlIHJlc3VsdCA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZS52YWx1ZU9mKGV2ZW50c1N0b3JlVHlwZURhdGFfKTsNCiAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZS5VTlJFQ09HTklaRUQgOiByZXN1bHQ7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRVZFTlRTU1RPUkVUWVBFVkFMVUVfRklFTERfTlVNQkVSID0gNjsNCiAgICBwcml2YXRlIGxvbmcgZXZlbnRzU3RvcmVUeXBlVmFsdWVfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IEV2ZW50c1N0b3JlVHlwZVZhbHVlID0gNjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGxvbmcgZ2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUoKSB7DQogICAgICByZXR1cm4gZXZlbnRzU3RvcmVUeXBlVmFsdWVfOw0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKHN1YnNjcmliZVR5cGVEYXRhXyAhPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlLlN1YnNjcmliZVR5cGVVbmRlZmluZWQuZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlRW51bSgxLCBzdWJzY3JpYmVUeXBlRGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDbGllbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMiwgY2xpZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMywgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRHcm91cEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgNCwgZ3JvdXBfKTsNCiAgICAgIH0NCiAgICAgIGlmIChldmVudHNTdG9yZVR5cGVEYXRhXyAhPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5FdmVudHNTdG9yZVR5cGUuRXZlbnRzU3RvcmVUeXBlVW5kZWZpbmVkLmdldE51bWJlcigpKSB7DQogICAgICAgIG91dHB1dC53cml0ZUVudW0oNSwgZXZlbnRzU3RvcmVUeXBlRGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKGV2ZW50c1N0b3JlVHlwZVZhbHVlXyAhPSAwTCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQ2NCg2LCBldmVudHNTdG9yZVR5cGVWYWx1ZV8pOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmIChzdWJzY3JpYmVUeXBlRGF0YV8gIT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZS5TdWJzY3JpYmVUeXBlVW5kZWZpbmVkLmdldE51bWJlcigpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlRW51bVNpemUoMSwgc3Vic2NyaWJlVHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDIsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDMsIGNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0R3JvdXBCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDQsIGdyb3VwXyk7DQogICAgICB9DQogICAgICBpZiAoZXZlbnRzU3RvcmVUeXBlRGF0YV8gIT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlLkV2ZW50c1N0b3JlVHlwZVVuZGVmaW5lZC5nZXROdW1iZXIoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDUsIGV2ZW50c1N0b3JlVHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmIChldmVudHNTdG9yZVR5cGVWYWx1ZV8gIT0gMEwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQ2NFNpemUoNiwgZXZlbnRzU3RvcmVUeXBlVmFsdWVfKTsNCiAgICAgIH0NCiAgICAgIHNpemUgKz0gdW5rbm93bkZpZWxkcy5nZXRTZXJpYWxpemVkU2l6ZSgpOw0KICAgICAgbWVtb2l6ZWRTaXplID0gc2l6ZTsNCiAgICAgIHJldHVybiBzaXplOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoZmluYWwgamF2YS5sYW5nLk9iamVjdCBvYmopIHsNCiAgICAgIGlmIChvYmogPT0gdGhpcykgew0KICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIG90aGVyID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSBvYmo7DQoNCiAgICAgIGJvb2xlYW4gcmVzdWx0ID0gdHJ1ZTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBzdWJzY3JpYmVUeXBlRGF0YV8gPT0gb3RoZXIuc3Vic2NyaWJlVHlwZURhdGFfOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENsaWVudElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENsaWVudElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENoYW5uZWwoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0Q2hhbm5lbCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRHcm91cCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRHcm91cCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBldmVudHNTdG9yZVR5cGVEYXRhXyA9PSBvdGhlci5ldmVudHNTdG9yZVR5cGVEYXRhXzsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUoKQ0KICAgICAgICAgID09IG90aGVyLmdldEV2ZW50c1N0b3JlVHlwZVZhbHVlKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBTVUJTQ1JJQkVUWVBFREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBzdWJzY3JpYmVUeXBlRGF0YV87DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDTElFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRDbGllbnRJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDSEFOTkVMX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENoYW5uZWwoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgR1JPVVBfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0R3JvdXAoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVZFTlRTU1RPUkVUWVBFREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBldmVudHNTdG9yZVR5cGVEYXRhXzsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEVWRU5UU1NUT1JFVFlQRVZBTFVFX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUoKSk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlRnJvbShieXRlW10gZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuU3Vic2NyaWJlfQ0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8QnVpbGRlcj4gaW1wbGVtZW50cw0KICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9pbXBsZW1lbnRzOmt1YmVtcS5TdWJzY3JpYmUpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlT3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdWJzY3JpYmVfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N1YnNjcmliZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5CdWlsZGVyLmNsYXNzKTsNCiAgICAgIH0NCg0KICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHN1YnNjcmliZVR5cGVEYXRhXyA9IDA7DQoNCiAgICAgICAgY2xpZW50SURfID0gIiI7DQoNCiAgICAgICAgY2hhbm5lbF8gPSAiIjsNCg0KICAgICAgICBncm91cF8gPSAiIjsNCg0KICAgICAgICBldmVudHNTdG9yZVR5cGVEYXRhXyA9IDA7DQoNCiAgICAgICAgZXZlbnRzU3RvcmVUeXBlVmFsdWVfID0gMEw7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdWJzY3JpYmVfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUodGhpcyk7DQogICAgICAgIHJlc3VsdC5zdWJzY3JpYmVUeXBlRGF0YV8gPSBzdWJzY3JpYmVUeXBlRGF0YV87DQogICAgICAgIHJlc3VsdC5jbGllbnRJRF8gPSBjbGllbnRJRF87DQogICAgICAgIHJlc3VsdC5jaGFubmVsXyA9IGNoYW5uZWxfOw0KICAgICAgICByZXN1bHQuZ3JvdXBfID0gZ3JvdXBfOw0KICAgICAgICByZXN1bHQuZXZlbnRzU3RvcmVUeXBlRGF0YV8gPSBldmVudHNTdG9yZVR5cGVEYXRhXzsNCiAgICAgICAgcmVzdWx0LmV2ZW50c1N0b3JlVHlwZVZhbHVlXyA9IGV2ZW50c1N0b3JlVHlwZVZhbHVlXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmIChvdGhlci5zdWJzY3JpYmVUeXBlRGF0YV8gIT0gMCkgew0KICAgICAgICAgIHNldFN1YnNjcmliZVR5cGVEYXRhVmFsdWUob3RoZXIuZ2V0U3Vic2NyaWJlVHlwZURhdGFWYWx1ZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldENsaWVudElEKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgY2xpZW50SURfID0gb3RoZXIuY2xpZW50SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0Q2hhbm5lbCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNoYW5uZWxfID0gb3RoZXIuY2hhbm5lbF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRHcm91cCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGdyb3VwXyA9IG90aGVyLmdyb3VwXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZXZlbnRzU3RvcmVUeXBlRGF0YV8gIT0gMCkgew0KICAgICAgICAgIHNldEV2ZW50c1N0b3JlVHlwZURhdGFWYWx1ZShvdGhlci5nZXRFdmVudHNTdG9yZVR5cGVEYXRhVmFsdWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldEV2ZW50c1N0b3JlVHlwZVZhbHVlKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRFdmVudHNTdG9yZVR5cGVWYWx1ZShvdGhlci5nZXRFdmVudHNTdG9yZVR5cGVWYWx1ZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlIHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGludCBzdWJzY3JpYmVUeXBlRGF0YV8gPSAwOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIFN1YnNjcmliZVR5cGVEYXRhID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0U3Vic2NyaWJlVHlwZURhdGFWYWx1ZSgpIHsNCiAgICAgICAgcmV0dXJuIHN1YnNjcmliZVR5cGVEYXRhXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZSBTdWJzY3JpYmVUeXBlRGF0YSA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVUeXBlRGF0YVZhbHVlKGludCB2YWx1ZSkgew0KICAgICAgICBzdWJzY3JpYmVUeXBlRGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIFN1YnNjcmliZVR5cGVEYXRhID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIGdldFN1YnNjcmliZVR5cGVEYXRhKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIHJlc3VsdCA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUudmFsdWVPZihzdWJzY3JpYmVUeXBlRGF0YV8pOw0KICAgICAgICByZXR1cm4gcmVzdWx0ID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlLlVOUkVDT0dOSVpFRCA6IHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZSBTdWJzY3JpYmVUeXBlRGF0YSA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVUeXBlRGF0YShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHN1YnNjcmliZVR5cGVEYXRhXyA9IHZhbHVlLmdldE51bWJlcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLlN1YnNjcmliZVR5cGUgU3Vic2NyaWJlVHlwZURhdGEgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVUeXBlRGF0YSgpIHsNCiAgICAgICAgDQogICAgICAgIHN1YnNjcmliZVR5cGVEYXRhXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNsaWVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNsaWVudElEKCkgew0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2xpZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2xpZW50SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNoYW5uZWxfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGNoYW5uZWxfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWwoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2hhbm5lbCgpIHsNCiAgICAgICAgDQogICAgICAgIGNoYW5uZWxfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2hhbm5lbCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWxCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZ3JvdXBfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBHcm91cCA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRHcm91cCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBncm91cF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGdyb3VwXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEdyb3VwID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRHcm91cEJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGdyb3VwXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBncm91cF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEdyb3VwID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEdyb3VwKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZ3JvdXBfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEdyb3VwID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyR3JvdXAoKSB7DQogICAgICAgIA0KICAgICAgICBncm91cF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRHcm91cCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBHcm91cCA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRHcm91cEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBncm91cF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGludCBldmVudHNTdG9yZVR5cGVEYXRhXyA9IDA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0RXZlbnRzU3RvcmVUeXBlRGF0YVZhbHVlKCkgew0KICAgICAgICByZXR1cm4gZXZlbnRzU3RvcmVUeXBlRGF0YV87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEV2ZW50c1N0b3JlVHlwZURhdGFWYWx1ZShpbnQgdmFsdWUpIHsNCiAgICAgICAgZXZlbnRzU3RvcmVUeXBlRGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN1YnNjcmliZS5FdmVudHNTdG9yZVR5cGUgRXZlbnRzU3RvcmVUeXBlRGF0YSA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlIGdldEV2ZW50c1N0b3JlVHlwZURhdGEoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSByZXN1bHQgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5FdmVudHNTdG9yZVR5cGUudmFsdWVPZihldmVudHNTdG9yZVR5cGVEYXRhXyk7DQogICAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZS5VTlJFQ09HTklaRUQgOiByZXN1bHQ7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3Vic2NyaWJlLkV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEV2ZW50c1N0b3JlVHlwZURhdGEoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGV2ZW50c1N0b3JlVHlwZURhdGFfID0gdmFsdWUuZ2V0TnVtYmVyKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlIEV2ZW50c1N0b3JlVHlwZURhdGEgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFdmVudHNTdG9yZVR5cGVEYXRhKCkgew0KICAgICAgICANCiAgICAgICAgZXZlbnRzU3RvcmVUeXBlRGF0YV8gPSAwOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBldmVudHNTdG9yZVR5cGVWYWx1ZV8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBFdmVudHNTdG9yZVR5cGVWYWx1ZSA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgbG9uZyBnZXRFdmVudHNTdG9yZVR5cGVWYWx1ZSgpIHsNCiAgICAgICAgcmV0dXJuIGV2ZW50c1N0b3JlVHlwZVZhbHVlXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgRXZlbnRzU3RvcmVUeXBlVmFsdWUgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUobG9uZyB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgZXZlbnRzU3RvcmVUeXBlVmFsdWVfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgRXZlbnRzU3RvcmVUeXBlVmFsdWUgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFdmVudHNTdG9yZVR5cGVWYWx1ZSgpIHsNCiAgICAgICAgDQogICAgICAgIGV2ZW50c1N0b3JlVHlwZVZhbHVlXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlN1YnNjcmliZSkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlN1YnNjcmliZSkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxTdWJzY3JpYmU+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFN1YnNjcmliZT4oKSB7DQogICAgICBwdWJsaWMgU3Vic2NyaWJlIHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgU3Vic2NyaWJlKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3Vic2NyaWJlPiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3Vic2NyaWJlPiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBSZXF1ZXN0T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUmVxdWVzdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFJlcXVlc3RUeXBlRGF0YVZhbHVlKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIFJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZSBnZXRSZXF1ZXN0VHlwZURhdGEoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0TWV0YWRhdGEoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TWV0YWRhdGFCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXBseUNoYW5uZWwoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcGx5Q2hhbm5lbEJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBUaW1lb3V0ID0gODs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFRpbWVvdXQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDYWNoZUtleSA9IDk7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2FjaGVLZXkoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2FjaGVLZXlCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgQ2FjaGVUVEwgPSAxMDs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldENhY2hlVFRMKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBTcGFuID0gMTE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTcGFuKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMjs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFRhZ3NDb3VudCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDEyOzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpOw0KICAgIC8qKg0KICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgKi8NCiAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFncygpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDEyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFnc01hcCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDEyOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0VGFnc09yRGVmYXVsdCgNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgZGVmYXVsdFZhbHVlKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMjs8L2NvZGU+DQogICAgICovDQoNCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5SZXF1ZXN0fQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUmVxdWVzdCBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5SZXF1ZXN0KQ0KICAgICAgUmVxdWVzdE9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBSZXF1ZXN0KGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUmVxdWVzdCgpIHsNCiAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIHJlcXVlc3RUeXBlRGF0YV8gPSAwOw0KICAgICAgY2xpZW50SURfID0gIiI7DQogICAgICBjaGFubmVsXyA9ICIiOw0KICAgICAgbWV0YWRhdGFfID0gIiI7DQogICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCiAgICAgIHJlcGx5Q2hhbm5lbF8gPSAiIjsNCiAgICAgIHRpbWVvdXRfID0gMDsNCiAgICAgIGNhY2hlS2V5XyA9ICIiOw0KICAgICAgY2FjaGVUVExfID0gMDsNCiAgICAgIHNwYW5fID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBSZXF1ZXN0KA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE2OiB7DQogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7DQoNCiAgICAgICAgICAgICAgcmVxdWVzdFR5cGVEYXRhXyA9IHJhd1ZhbHVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMjY6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDM0OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQyOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIG1ldGFkYXRhXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA1MDogew0KDQogICAgICAgICAgICAgIGJvZHlfID0gaW5wdXQucmVhZEJ5dGVzKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA1ODogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXBseUNoYW5uZWxfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDY0OiB7DQoNCiAgICAgICAgICAgICAgdGltZW91dF8gPSBpbnB1dC5yZWFkSW50MzIoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDc0OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNhY2hlS2V5XyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA4MDogew0KDQogICAgICAgICAgICAgIGNhY2hlVFRMXyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgOTA6IHsNCg0KICAgICAgICAgICAgICBzcGFuXyA9IGlucHV0LnJlYWRCeXRlcygpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgOTg6IHsNCiAgICAgICAgICAgICAgaWYgKCEoKG11dGFibGVfYml0RmllbGQwXyAmIDB4MDAwMDA4MDApID09IDB4MDAwMDA4MDApKSB7DQogICAgICAgICAgICAgICAgdGFnc18gPSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLm5ld01hcEZpZWxkKA0KICAgICAgICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgICAgICAgICAgbXV0YWJsZV9iaXRGaWVsZDBfIHw9IDB4MDAwMDA4MDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICAgICAgICB0YWdzX18gPSBpbnB1dC5yZWFkTWVzc2FnZSgNCiAgICAgICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5LmdldFBhcnNlckZvclR5cGUoKSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICAgICAgICB0YWdzXy5nZXRNdXRhYmxlTWFwKCkucHV0KA0KICAgICAgICAgICAgICAgICAgdGFnc19fLmdldEtleSgpLCB0YWdzX18uZ2V0VmFsdWUoKSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgQFN1cHByZXNzV2FybmluZ3MoeyJyYXd0eXBlcyJ9KQ0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkIGludGVybmFsR2V0TWFwRmllbGQoDQogICAgICAgIGludCBudW1iZXIpIHsNCiAgICAgIHN3aXRjaCAobnVtYmVyKSB7DQogICAgICAgIGNhc2UgMTI6DQogICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAiSW52YWxpZCBtYXAgZmllbGQgbnVtYmVyOiAiICsgbnVtYmVyKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUHJvdG9idWYgZW51bSB7QGNvZGUga3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGV9DQogICAgICovDQogICAgcHVibGljIGVudW0gUmVxdWVzdFR5cGUNCiAgICAgICAgaW1wbGVtZW50cyBjb20uZ29vZ2xlLnByb3RvYnVmLlByb3RvY29sTWVzc2FnZUVudW0gew0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5SZXF1ZXN0VHlwZVVua25vd24gPSAwOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgUmVxdWVzdFR5cGVVbmtub3duKDApLA0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5Db21tYW5kID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIENvbW1hbmQoMSksDQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPlF1ZXJ5ID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIFF1ZXJ5KDIpLA0KICAgICAgVU5SRUNPR05JWkVEKC0xKSwNCiAgICAgIDsNCg0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5SZXF1ZXN0VHlwZVVua25vd24gPSAwOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUmVxdWVzdFR5cGVVbmtub3duX1ZBTFVFID0gMDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Q29tbWFuZCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDb21tYW5kX1ZBTFVFID0gMTsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+UXVlcnkgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUXVlcnlfVkFMVUUgPSAyOw0KDQoNCiAgICAgIHB1YmxpYyBmaW5hbCBpbnQgZ2V0TnVtYmVyKCkgew0KICAgICAgICBpZiAodGhpcyA9PSBVTlJFQ09HTklaRUQpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgIkNhbid0IGdldCB0aGUgbnVtYmVyIG9mIGFuIHVua25vd24gZW51bSB2YWx1ZS4iKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICB9DQoNCiAgICAgIC8qKg0KICAgICAgICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayAjZm9yTnVtYmVyKGludCl9IGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIHN0YXRpYyBSZXF1ZXN0VHlwZSB2YWx1ZU9mKGludCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gZm9yTnVtYmVyKHZhbHVlKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIHN0YXRpYyBSZXF1ZXN0VHlwZSBmb3JOdW1iZXIoaW50IHZhbHVlKSB7DQogICAgICAgIHN3aXRjaCAodmFsdWUpIHsNCiAgICAgICAgICBjYXNlIDA6IHJldHVybiBSZXF1ZXN0VHlwZVVua25vd247DQogICAgICAgICAgY2FzZSAxOiByZXR1cm4gQ29tbWFuZDsNCiAgICAgICAgICBjYXNlIDI6IHJldHVybiBRdWVyeTsNCiAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8UmVxdWVzdFR5cGU+DQogICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsVmFsdWVNYXA7DQogICAgICB9DQogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPA0KICAgICAgICAgIFJlcXVlc3RUeXBlPiBpbnRlcm5hbFZhbHVlTWFwID0NCiAgICAgICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPFJlcXVlc3RUeXBlPigpIHsNCiAgICAgICAgICAgICAgcHVibGljIFJlcXVlc3RUeXBlIGZpbmRWYWx1ZUJ5TnVtYmVyKGludCBudW1iZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVxdWVzdFR5cGUuZm9yTnVtYmVyKG51bWJlcik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3INCiAgICAgICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCkuZ2V0VmFsdWVzKCkuZ2V0KG9yZGluYWwoKSk7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpOw0KICAgICAgfQ0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDApOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBSZXF1ZXN0VHlwZVtdIFZBTFVFUyA9IHZhbHVlcygpOw0KDQogICAgICBwdWJsaWMgc3RhdGljIFJlcXVlc3RUeXBlIHZhbHVlT2YoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yIGRlc2MpIHsNCiAgICAgICAgaWYgKGRlc2MuZ2V0VHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkgew0KICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKA0KICAgICAgICAgICAgIkVudW1WYWx1ZURlc2NyaXB0b3IgaXMgbm90IGZvciB0aGlzIHR5cGUuIik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGRlc2MuZ2V0SW5kZXgoKSA9PSAtMSkgew0KICAgICAgICAgIHJldHVybiBVTlJFQ09HTklaRUQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIFZBTFVFU1tkZXNjLmdldEluZGV4KCldOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGZpbmFsIGludCB2YWx1ZTsNCg0KICAgICAgcHJpdmF0ZSBSZXF1ZXN0VHlwZShpbnQgdmFsdWUpIHsNCiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOw0KICAgICAgfQ0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoZW51bV9zY29wZTprdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZSkNCiAgICB9DQoNCiAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFUVVFU1RJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCByZXF1ZXN0SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFUVVFU1RUWVBFREFUQV9GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgaW50IHJlcXVlc3RUeXBlRGF0YV87DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIFJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0UmVxdWVzdFR5cGVEYXRhVmFsdWUoKSB7DQogICAgICByZXR1cm4gcmVxdWVzdFR5cGVEYXRhXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIFJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgZ2V0UmVxdWVzdFR5cGVEYXRhKCkgew0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIHJlc3VsdCA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZS52YWx1ZU9mKHJlcXVlc3RUeXBlRGF0YV8pOw0KICAgICAgcmV0dXJuIHJlc3VsdCA9PSBudWxsID8gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlLlVOUkVDT0dOSVpFRCA6IHJlc3VsdDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDTElFTlRJRF9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBjbGllbnRJRF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENIQU5ORUxfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVRBREFUQV9GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBtZXRhZGF0YV87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWV0YWRhdGEoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBtZXRhZGF0YV8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgbWV0YWRhdGFfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPRFlfRklFTERfTlVNQkVSID0gNjsNCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCkgew0KICAgICAgcmV0dXJuIGJvZHlfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFUExZQ0hBTk5FTF9GSUVMRF9OVU1CRVIgPSA3Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCByZXBseUNoYW5uZWxfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXBseUNoYW5uZWwgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXBseUNoYW5uZWwoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcGx5Q2hhbm5lbF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgcmVwbHlDaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXBseUNoYW5uZWxCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVwbHlDaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICByZXBseUNoYW5uZWxfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRJTUVPVVRfRklFTERfTlVNQkVSID0gODsNCiAgICBwcml2YXRlIGludCB0aW1lb3V0XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBUaW1lb3V0ID0gODs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRUaW1lb3V0KCkgew0KICAgICAgcmV0dXJuIHRpbWVvdXRfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENBQ0hFS0VZX0ZJRUxEX05VTUJFUiA9IDk7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNhY2hlS2V5XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDYWNoZUtleSgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2FjaGVLZXlfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNhY2hlS2V5XyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENhY2hlS2V5Qnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNhY2hlS2V5XzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjYWNoZUtleV8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0FDSEVUVExfRklFTERfTlVNQkVSID0gMTA7DQogICAgcHJpdmF0ZSBpbnQgY2FjaGVUVExfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIENhY2hlVFRMID0gMTA7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0Q2FjaGVUVEwoKSB7DQogICAgICByZXR1cm4gY2FjaGVUVExfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNQQU5fRklFTERfTlVNQkVSID0gMTE7DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Bhbl87DQogICAgLyoqDQogICAgICogPGNvZGU+Ynl0ZXMgU3BhbiA9IDExOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNwYW4oKSB7DQogICAgICByZXR1cm4gc3Bhbl87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVEFHU19GSUVMRF9OVU1CRVIgPSAxMjsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyIHsNCiAgICAgIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEVudHJ5PA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGRlZmF1bHRFbnRyeSA9DQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnkNCiAgICAgICAgICAgICAgLjxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPm5ld0RlZmF1bHRJbnN0YW5jZSgNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X1RhZ3NFbnRyeV9kZXNjcmlwdG9yLCANCiAgICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuV2lyZUZvcm1hdC5GaWVsZFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLldpcmVGb3JtYXQuRmllbGRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICIiKTsNCiAgICB9DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkPA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB0YWdzXzsNCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICBpbnRlcm5hbEdldFRhZ3MoKSB7DQogICAgICBpZiAodGFnc18gPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZC5lbXB0eU1hcEZpZWxkKA0KICAgICAgICAgICAgVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnkpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0VGFnc0NvdW50KCkgew0KICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLnNpemUoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNUYWdzKA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmNvbnRhaW5zS2V5KGtleSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgKi8NCiAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzKCkgew0KICAgICAgcmV0dXJuIGdldFRhZ3NNYXAoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFnc01hcCgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0VGFnc09yRGVmYXVsdCgNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgZGVmYXVsdFZhbHVlKSB7DQogICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICByZXR1cm4gbWFwLmNvbnRhaW5zS2V5KGtleSkgPyBtYXAuZ2V0KGtleSkgOiBkZWZhdWx0VmFsdWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDEyOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgaWYgKCFtYXAuY29udGFpbnNLZXkoa2V5KSkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG1hcC5nZXQoa2V5KTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmIChyZXF1ZXN0VHlwZURhdGFfICE9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZS5SZXF1ZXN0VHlwZVVua25vd24uZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlRW51bSgyLCByZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDMsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDQsIGNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TWV0YWRhdGFCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDUsIG1ldGFkYXRhXyk7DQogICAgICB9DQogICAgICBpZiAoIWJvZHlfLmlzRW1wdHkoKSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCeXRlcyg2LCBib2R5Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldFJlcGx5Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgNywgcmVwbHlDaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAodGltZW91dF8gIT0gMCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQzMig4LCB0aW1lb3V0Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENhY2hlS2V5Qnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCA5LCBjYWNoZUtleV8pOw0KICAgICAgfQ0KICAgICAgaWYgKGNhY2hlVFRMXyAhPSAwKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDMyKDEwLCBjYWNoZVRUTF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFzcGFuXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoMTEsIHNwYW5fKTsNCiAgICAgIH0NCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgIC5zZXJpYWxpemVTdHJpbmdNYXBUbygNCiAgICAgICAgICBvdXRwdXQsDQogICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCksDQogICAgICAgICAgVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnksDQogICAgICAgICAgMTIpOw0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmIChyZXF1ZXN0VHlwZURhdGFfICE9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZS5SZXF1ZXN0VHlwZVVua25vd24uZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgyLCByZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDMsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDQsIGNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TWV0YWRhdGFCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDUsIG1ldGFkYXRhXyk7DQogICAgICB9DQogICAgICBpZiAoIWJvZHlfLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSg2LCBib2R5Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldFJlcGx5Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoNywgcmVwbHlDaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAodGltZW91dF8gIT0gMCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSg4LCB0aW1lb3V0Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENhY2hlS2V5Qnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSg5LCBjYWNoZUtleV8pOw0KICAgICAgfQ0KICAgICAgaWYgKGNhY2hlVFRMXyAhPSAwKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50MzJTaXplKDEwLCBjYWNoZVRUTF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFzcGFuXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMTEsIHNwYW5fKTsNCiAgICAgIH0NCiAgICAgIGZvciAoamF2YS51dGlsLk1hcC5FbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBlbnRyeQ0KICAgICAgICAgICA6IGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmVudHJ5U2V0KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICB0YWdzX18gPSBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5uZXdCdWlsZGVyRm9yVHlwZSgpDQogICAgICAgICAgICAuc2V0S2V5KGVudHJ5LmdldEtleSgpKQ0KICAgICAgICAgICAgLnNldFZhbHVlKGVudHJ5LmdldFZhbHVlKCkpDQogICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDEyLCB0YWdzX18pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldFJlcXVlc3RJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRSZXF1ZXN0SUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgcmVxdWVzdFR5cGVEYXRhXyA9PSBvdGhlci5yZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENsaWVudElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENsaWVudElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENoYW5uZWwoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0Q2hhbm5lbCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRNZXRhZGF0YSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXRhZGF0YSgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRCb2R5KCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldEJvZHkoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVwbHlDaGFubmVsKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcGx5Q2hhbm5lbCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0VGltZW91dCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0VGltZW91dCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDYWNoZUtleSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDYWNoZUtleSgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0Q2FjaGVUVEwoKQ0KICAgICAgICAgID09IG90aGVyLmdldENhY2hlVFRMKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldFNwYW4oKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0U3BhbigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBpbnRlcm5hbEdldFRhZ3MoKS5lcXVhbHMoDQogICAgICAgICAgb3RoZXIuaW50ZXJuYWxHZXRUYWdzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVFVRVNUSURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVxdWVzdElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFJFUVVFU1RUWVBFREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyByZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0xJRU5USURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2xpZW50SUQoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0hBTk5FTF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRDaGFubmVsKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FVEFEQVRBX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1ldGFkYXRhKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEJPRFlfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Qm9keSgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVBMWUNIQU5ORUxfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVwbHlDaGFubmVsKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFRJTUVPVVRfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0VGltZW91dCgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0FDSEVLRVlfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2FjaGVLZXkoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0FDSEVUVExfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2FjaGVUVEwoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNQQU5fRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0U3BhbigpLmhhc2hDb2RlKCk7DQogICAgICBpZiAoIWludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmlzRW1wdHkoKSkgew0KICAgICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBUQUdTX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgaW50ZXJuYWxHZXRUYWdzKCkuaGFzaENvZGUoKTsNCiAgICAgIH0NCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUmVxdWVzdH0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuUmVxdWVzdCkNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0T3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkIGludGVybmFsR2V0TWFwRmllbGQoDQogICAgICAgICAgaW50IG51bWJlcikgew0KICAgICAgICBzd2l0Y2ggKG51bWJlcikgew0KICAgICAgICAgIGNhc2UgMTI6DQogICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAgICJJbnZhbGlkIG1hcCBmaWVsZCBudW1iZXI6ICIgKyBudW1iZXIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE11dGFibGVNYXBGaWVsZCgNCiAgICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICAgIHN3aXRjaCAobnVtYmVyKSB7DQogICAgICAgICAgY2FzZSAxMjoNCiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbEdldE11dGFibGVUYWdzKCk7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAgICJJbnZhbGlkIG1hcCBmaWVsZCBudW1iZXI6ICIgKyBudW1iZXIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOw0KICAgICAgfQ0KDQogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICByZXF1ZXN0VHlwZURhdGFfID0gMDsNCg0KICAgICAgICBjbGllbnRJRF8gPSAiIjsNCg0KICAgICAgICBjaGFubmVsXyA9ICIiOw0KDQogICAgICAgIG1ldGFkYXRhXyA9ICIiOw0KDQogICAgICAgIGJvZHlfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KDQogICAgICAgIHJlcGx5Q2hhbm5lbF8gPSAiIjsNCg0KICAgICAgICB0aW1lb3V0XyA9IDA7DQoNCiAgICAgICAgY2FjaGVLZXlfID0gIiI7DQoNCiAgICAgICAgY2FjaGVUVExfID0gMDsNCg0KICAgICAgICBzcGFuXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCg0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuY2xlYXIoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOw0KICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCh0aGlzKTsNCiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87DQogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsNCiAgICAgICAgcmVzdWx0LnJlcXVlc3RJRF8gPSByZXF1ZXN0SURfOw0KICAgICAgICByZXN1bHQucmVxdWVzdFR5cGVEYXRhXyA9IHJlcXVlc3RUeXBlRGF0YV87DQogICAgICAgIHJlc3VsdC5jbGllbnRJRF8gPSBjbGllbnRJRF87DQogICAgICAgIHJlc3VsdC5jaGFubmVsXyA9IGNoYW5uZWxfOw0KICAgICAgICByZXN1bHQubWV0YWRhdGFfID0gbWV0YWRhdGFfOw0KICAgICAgICByZXN1bHQuYm9keV8gPSBib2R5XzsNCiAgICAgICAgcmVzdWx0LnJlcGx5Q2hhbm5lbF8gPSByZXBseUNoYW5uZWxfOw0KICAgICAgICByZXN1bHQudGltZW91dF8gPSB0aW1lb3V0XzsNCiAgICAgICAgcmVzdWx0LmNhY2hlS2V5XyA9IGNhY2hlS2V5XzsNCiAgICAgICAgcmVzdWx0LmNhY2hlVFRMXyA9IGNhY2hlVFRMXzsNCiAgICAgICAgcmVzdWx0LnNwYW5fID0gc3Bhbl87DQogICAgICAgIHJlc3VsdC50YWdzXyA9IGludGVybmFsR2V0VGFncygpOw0KICAgICAgICByZXN1bHQudGFnc18ubWFrZUltbXV0YWJsZSgpOw0KICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxkMF87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QpIHsNCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3Qpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsNCiAgICAgICAgaWYgKCFvdGhlci5nZXRSZXF1ZXN0SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICByZXF1ZXN0SURfID0gb3RoZXIucmVxdWVzdElEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIucmVxdWVzdFR5cGVEYXRhXyAhPSAwKSB7DQogICAgICAgICAgc2V0UmVxdWVzdFR5cGVEYXRhVmFsdWUob3RoZXIuZ2V0UmVxdWVzdFR5cGVEYXRhVmFsdWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDbGllbnRJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNsaWVudElEXyA9IG90aGVyLmNsaWVudElEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldENoYW5uZWwoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBjaGFubmVsXyA9IG90aGVyLmNoYW5uZWxfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0TWV0YWRhdGEoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBtZXRhZGF0YV8gPSBvdGhlci5tZXRhZGF0YV87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldEJvZHkoKSAhPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFkpIHsNCiAgICAgICAgICBzZXRCb2R5KG90aGVyLmdldEJvZHkoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRSZXBseUNoYW5uZWwoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICByZXBseUNoYW5uZWxfID0gb3RoZXIucmVwbHlDaGFubmVsXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0VGltZW91dCgpICE9IDApIHsNCiAgICAgICAgICBzZXRUaW1lb3V0KG90aGVyLmdldFRpbWVvdXQoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDYWNoZUtleSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNhY2hlS2V5XyA9IG90aGVyLmNhY2hlS2V5XzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0Q2FjaGVUVEwoKSAhPSAwKSB7DQogICAgICAgICAgc2V0Q2FjaGVUVEwob3RoZXIuZ2V0Q2FjaGVUVEwoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldFNwYW4oKSAhPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFkpIHsNCiAgICAgICAgICBzZXRTcGFuKG90aGVyLmdldFNwYW4oKSk7DQogICAgICAgIH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLm1lcmdlRnJvbSgNCiAgICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVxdWVzdElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZXF1ZXN0SUQoKSB7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0UmVxdWVzdElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IHJlcXVlc3RUeXBlRGF0YV8gPSAwOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0UmVxdWVzdFR5cGVEYXRhVmFsdWUoKSB7DQogICAgICAgIHJldHVybiByZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RUeXBlRGF0YVZhbHVlKGludCB2YWx1ZSkgew0KICAgICAgICByZXF1ZXN0VHlwZURhdGFfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIFJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIGdldFJlcXVlc3RUeXBlRGF0YSgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LlJlcXVlc3RUeXBlIHJlc3VsdCA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZS52YWx1ZU9mKHJlcXVlc3RUeXBlRGF0YV8pOw0KICAgICAgICByZXR1cm4gcmVzdWx0ID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUuVU5SRUNPR05JWkVEIDogcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RUeXBlRGF0YShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuUmVxdWVzdFR5cGUgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmVxdWVzdFR5cGVEYXRhXyA9IHZhbHVlLmdldE51bWJlcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZSBSZXF1ZXN0VHlwZURhdGEgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZXF1ZXN0VHlwZURhdGEoKSB7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0VHlwZURhdGFfID0gMDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2xpZW50SURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENsaWVudElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2xpZW50SUQoKSB7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDbGllbnRJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2hhbm5lbF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDaGFubmVsKCkgew0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDaGFubmVsKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtZXRhZGF0YV8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldE1ldGFkYXRhQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWV0YWRhdGFfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIG1ldGFkYXRhXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWV0YWRhdGEoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBtZXRhZGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXRhZGF0YSgpIHsNCiAgICAgICAgDQogICAgICAgIG1ldGFkYXRhXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldE1ldGFkYXRhKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1ldGFkYXRhQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIG1ldGFkYXRhXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJvZHlfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsNCiAgICAgICAgcmV0dXJuIGJvZHlfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJvZHkoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGJvZHlfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckJvZHkoKSB7DQogICAgICAgIA0KICAgICAgICBib2R5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEJvZHkoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgcmVwbHlDaGFubmVsXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcGx5Q2hhbm5lbCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXBseUNoYW5uZWxfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICByZXBseUNoYW5uZWxfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRSZXBseUNoYW5uZWxCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXBseUNoYW5uZWxfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIHJlcGx5Q2hhbm5lbF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcGx5Q2hhbm5lbCA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBseUNoYW5uZWwoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICByZXBseUNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcGx5Q2hhbm5lbCA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlcGx5Q2hhbm5lbCgpIHsNCiAgICAgICAgDQogICAgICAgIHJlcGx5Q2hhbm5lbF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRSZXBseUNoYW5uZWwoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGx5Q2hhbm5lbEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICByZXBseUNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgdGltZW91dF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBUaW1lb3V0ID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0VGltZW91dCgpIHsNCiAgICAgICAgcmV0dXJuIHRpbWVvdXRfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBUaW1lb3V0ID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFRpbWVvdXQoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB0aW1lb3V0XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFRpbWVvdXQgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJUaW1lb3V0KCkgew0KICAgICAgICANCiAgICAgICAgdGltZW91dF8gPSAwOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBjYWNoZUtleV8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENhY2hlS2V5ID0gOTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENhY2hlS2V5KCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNhY2hlS2V5XzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2FjaGVLZXlfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldENhY2hlS2V5Qnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2FjaGVLZXlfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGNhY2hlS2V5XyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2FjaGVLZXkoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBjYWNoZUtleV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2FjaGVLZXkgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDYWNoZUtleSgpIHsNCiAgICAgICAgDQogICAgICAgIGNhY2hlS2V5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldENhY2hlS2V5KCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENhY2hlS2V5ID0gOTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENhY2hlS2V5Qnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGNhY2hlS2V5XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IGNhY2hlVFRMXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIENhY2hlVFRMID0gMTA7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldENhY2hlVFRMKCkgew0KICAgICAgICByZXR1cm4gY2FjaGVUVExfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBDYWNoZVRUTCA9IDEwOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2FjaGVUVEwoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBjYWNoZVRUTF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBDYWNoZVRUTCA9IDEwOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDYWNoZVRUTCgpIHsNCiAgICAgICAgDQogICAgICAgIGNhY2hlVFRMXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Bhbl8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIFNwYW4gPSAxMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3BhbigpIHsNCiAgICAgICAgcmV0dXJuIHNwYW5fOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBTcGFuID0gMTE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTcGFuKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBzcGFuXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIFNwYW4gPSAxMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3BhbigpIHsNCiAgICAgICAgDQogICAgICAgIHNwYW5fID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0U3BhbigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDwNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB0YWdzXzsNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgaW50ZXJuYWxHZXRUYWdzKCkgew0KICAgICAgICBpZiAodGFnc18gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLmVtcHR5TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGFnc187DQogICAgICB9DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKSB7DQogICAgICAgIG9uQ2hhbmdlZCgpOzsNCiAgICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgICB0YWdzXyA9IGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQubmV3TWFwRmllbGQoDQogICAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRhZ3NfLmlzTXV0YWJsZSgpKSB7DQogICAgICAgICAgdGFnc18gPSB0YWdzXy5jb3B5KCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW50IGdldFRhZ3NDb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLnNpemUoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5jb250YWluc0tleShrZXkpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgICAgcmV0dXJuIGdldFRhZ3NNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGdldFRhZ3NNYXAoKSB7DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgICAgcmV0dXJuIG1hcC5jb250YWluc0tleShrZXkpID8gbWFwLmdldChrZXkpIDogZGVmYXVsdFZhbHVlOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMjs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0VGFnc09yVGhyb3coDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgICAgaWYgKCFtYXAuY29udGFpbnNLZXkoa2V5KSkgew0KICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG1hcC5nZXQoa2V5KTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJUYWdzKCkgew0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAuY2xlYXIoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDEyOzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgQnVpbGRlciByZW1vdmVUYWdzKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLnJlbW92ZShrZXkpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogVXNlIGFsdGVybmF0ZSBtdXRhdGlvbiBhY2Nlc3NvcnMgaW5zdGVhZC4NCiAgICAgICAqLw0KICAgICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgZ2V0TXV0YWJsZVRhZ3MoKSB7DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHB1dFRhZ3MoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucHV0KGtleSwgdmFsdWUpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTI7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIHB1dEFsbFRhZ3MoDQogICAgICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB2YWx1ZXMpIHsNCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLnB1dEFsbCh2YWx1ZXMpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIHNldFVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIuc2V0VW5rbm93bkZpZWxkc1Byb3RvMyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgbWVyZ2VVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLm1lcmdlVW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTprdWJlbXEuUmVxdWVzdCkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlJlcXVlc3QpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IERFRkFVTFRfSU5TVEFOQ0U7DQogICAgc3RhdGljIHsNCiAgICAgIERFRkFVTFRfSU5TVEFOQ0UgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVxdWVzdD4NCiAgICAgICAgUEFSU0VSID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuQWJzdHJhY3RQYXJzZXI8UmVxdWVzdD4oKSB7DQogICAgICBwdWJsaWMgUmVxdWVzdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFJlcXVlc3QoaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgcHVibGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxSZXF1ZXN0PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVxdWVzdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogIH0NCg0KICBwdWJsaWMgaW50ZXJmYWNlIFJlc3BvbnNlT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUmVzcG9uc2UpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXBseUNoYW5uZWwoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcGx5Q2hhbm5lbEJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldE1ldGFkYXRhKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldE1ldGFkYXRhQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJ5dGVzIEJvZHkgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBDYWNoZUhpdCA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gZ2V0Q2FjaGVIaXQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFRpbWVzdGFtcCA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIGxvbmcgZ2V0VGltZXN0YW1wKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ib29sIEV4ZWN1dGVkID0gODs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBnZXRFeGVjdXRlZCgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gOTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDk7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBTcGFuID0gMTA7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTcGFuKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMTs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFRhZ3NDb3VudCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpOw0KICAgIC8qKg0KICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgKi8NCiAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFncygpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFnc01hcCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0VGFnc09yRGVmYXVsdCgNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXksDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgZGVmYXVsdFZhbHVlKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMTs8L2NvZGU+DQogICAgICovDQoNCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5SZXNwb25zZX0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFJlc3BvbnNlIGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLlJlc3BvbnNlKQ0KICAgICAgUmVzcG9uc2VPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgUmVzcG9uc2UubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIFJlc3BvbnNlKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUmVzcG9uc2UoKSB7DQogICAgICBjbGllbnRJRF8gPSAiIjsNCiAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIHJlcGx5Q2hhbm5lbF8gPSAiIjsNCiAgICAgIG1ldGFkYXRhXyA9ICIiOw0KICAgICAgYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQogICAgICBjYWNoZUhpdF8gPSBmYWxzZTsNCiAgICAgIHRpbWVzdGFtcF8gPSAwTDsNCiAgICAgIGV4ZWN1dGVkXyA9IGZhbHNlOw0KICAgICAgZXJyb3JfID0gIiI7DQogICAgICBzcGFuXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgUmVzcG9uc2UoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxODogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI2OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIHJlcGx5Q2hhbm5lbF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMzQ6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQyOiB7DQoNCiAgICAgICAgICAgICAgYm9keV8gPSBpbnB1dC5yZWFkQnl0ZXMoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQ4OiB7DQoNCiAgICAgICAgICAgICAgY2FjaGVIaXRfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDU2OiB7DQoNCiAgICAgICAgICAgICAgdGltZXN0YW1wXyA9IGlucHV0LnJlYWRJbnQ2NCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNjQ6IHsNCg0KICAgICAgICAgICAgICBleGVjdXRlZF8gPSBpbnB1dC5yZWFkQm9vbCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNzQ6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDgyOiB7DQoNCiAgICAgICAgICAgICAgc3Bhbl8gPSBpbnB1dC5yZWFkQnl0ZXMoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDkwOiB7DQogICAgICAgICAgICAgIGlmICghKChtdXRhYmxlX2JpdEZpZWxkMF8gJiAweDAwMDAwNDAwKSA9PSAweDAwMDAwNDAwKSkgew0KICAgICAgICAgICAgICAgIHRhZ3NfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZC5uZXdNYXBGaWVsZCgNCiAgICAgICAgICAgICAgICAgICAgVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnkpOw0KICAgICAgICAgICAgICAgIG11dGFibGVfYml0RmllbGQwXyB8PSAweDAwMDAwNDAwOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnk8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgICAgICAgICAgdGFnc19fID0gaW5wdXQucmVhZE1lc3NhZ2UoDQogICAgICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5nZXRQYXJzZXJGb3JUeXBlKCksIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgICAgICAgdGFnc18uZ2V0TXV0YWJsZU1hcCgpLnB1dCgNCiAgICAgICAgICAgICAgICAgIHRhZ3NfXy5nZXRLZXkoKSwgdGFnc19fLmdldFZhbHVlKCkpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgZS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gY2F0Y2ggKGphdmEuaW8uSU9FeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oDQogICAgICAgICAgICBlKS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMudW5rbm93bkZpZWxkcyA9IHVua25vd25GaWVsZHMuYnVpbGQoKTsNCiAgICAgICAgbWFrZUV4dGVuc2lvbnNJbW11dGFibGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQgaW50ZXJuYWxHZXRNYXBGaWVsZCgNCiAgICAgICAgaW50IG51bWJlcikgew0KICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgY2FzZSAxMToNCiAgICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICJJbnZhbGlkIG1hcCBmaWVsZCBudW1iZXI6ICIgKyBudW1iZXIpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMSUVOVElEX0ZJRUxEX05VTUJFUiA9IDE7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVRVUVTVElEX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IHJlcXVlc3RJRF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcXVlc3RJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIHJlcXVlc3RJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVQTFlDSEFOTkVMX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IHJlcGx5Q2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcGx5Q2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcGx5Q2hhbm5lbCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVwbHlDaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICByZXBseUNoYW5uZWxfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXBseUNoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcGx5Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXBseUNoYW5uZWxfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIHJlcGx5Q2hhbm5lbF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUVUQURBVEFfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgbWV0YWRhdGFfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TWV0YWRhdGFCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWV0YWRhdGFfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIG1ldGFkYXRhXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBCT0RZX0ZJRUxEX05VTUJFUiA9IDU7DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYm9keV87DQogICAgLyoqDQogICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsNCiAgICAgIHJldHVybiBib2R5XzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDQUNIRUhJVF9GSUVMRF9OVU1CRVIgPSA2Ow0KICAgIHByaXZhdGUgYm9vbGVhbiBjYWNoZUhpdF87DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBDYWNoZUhpdCA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldENhY2hlSGl0KCkgew0KICAgICAgcmV0dXJuIGNhY2hlSGl0XzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUSU1FU1RBTVBfRklFTERfTlVNQkVSID0gNzsNCiAgICBwcml2YXRlIGxvbmcgdGltZXN0YW1wXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBUaW1lc3RhbXAgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRUaW1lc3RhbXAoKSB7DQogICAgICByZXR1cm4gdGltZXN0YW1wXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFWEVDVVRFRF9GSUVMRF9OVU1CRVIgPSA4Ow0KICAgIHByaXZhdGUgYm9vbGVhbiBleGVjdXRlZF87DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBFeGVjdXRlZCA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldEV4ZWN1dGVkKCkgew0KICAgICAgcmV0dXJuIGV4ZWN1dGVkXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFUlJPUl9GSUVMRF9OVU1CRVIgPSA5Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBlcnJvcl87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gOTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXJyb3IoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBlcnJvcl8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gOTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgZXJyb3JfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNQQU5fRklFTERfTlVNQkVSID0gMTA7DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Bhbl87DQogICAgLyoqDQogICAgICogPGNvZGU+Ynl0ZXMgU3BhbiA9IDEwOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNwYW4oKSB7DQogICAgICByZXR1cm4gc3Bhbl87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVEFHU19GSUVMRF9OVU1CRVIgPSAxMTsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyIHsNCiAgICAgIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEVudHJ5PA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGRlZmF1bHRFbnRyeSA9DQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnkNCiAgICAgICAgICAgICAgLjxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPm5ld0RlZmF1bHRJbnN0YW5jZSgNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXNwb25zZV9UYWdzRW50cnlfZGVzY3JpcHRvciwgDQogICAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLldpcmVGb3JtYXQuRmllbGRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5XaXJlRm9ybWF0LkZpZWxkVHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAiIik7DQogICAgfQ0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gdGFnc187DQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgaW50ZXJuYWxHZXRUYWdzKCkgew0KICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQuZW1wdHlNYXBGaWVsZCgNCiAgICAgICAgICAgIFRhZ3NEZWZhdWx0RW50cnlIb2xkZXIuZGVmYXVsdEVudHJ5KTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0YWdzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFRhZ3NDb3VudCgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5zaXplKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5jb250YWluc0tleShrZXkpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICovDQogICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgIHJldHVybiBnZXRUYWdzTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGdldFRhZ3NNYXAoKSB7DQogICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGRlZmF1bHRWYWx1ZSkgew0KICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgcmV0dXJuIG1hcC5jb250YWluc0tleShrZXkpID8gbWFwLmdldChrZXkpIDogZGVmYXVsdFZhbHVlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMTs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIGlmICghbWFwLmNvbnRhaW5zS2V5KGtleSkpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBtYXAuZ2V0KGtleSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldENsaWVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCBjbGllbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDIsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRSZXBseUNoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDMsIHJlcGx5Q2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRNZXRhZGF0YUJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgNCwgbWV0YWRhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghYm9keV8uaXNFbXB0eSgpKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDUsIGJvZHlfKTsNCiAgICAgIH0NCiAgICAgIGlmIChjYWNoZUhpdF8gIT0gZmFsc2UpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlQm9vbCg2LCBjYWNoZUhpdF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHRpbWVzdGFtcF8gIT0gMEwpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50NjQoNywgdGltZXN0YW1wXyk7DQogICAgICB9DQogICAgICBpZiAoZXhlY3V0ZWRfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woOCwgZXhlY3V0ZWRfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDksIGVycm9yXyk7DQogICAgICB9DQogICAgICBpZiAoIXNwYW5fLmlzRW1wdHkoKSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygxMCwgc3Bhbl8pOw0KICAgICAgfQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgLnNlcmlhbGl6ZVN0cmluZ01hcFRvKA0KICAgICAgICAgIG91dHB1dCwNCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKSwNCiAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSwNCiAgICAgICAgICAxMSk7DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRDbGllbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgY2xpZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgyLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0UmVwbHlDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgzLCByZXBseUNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TWV0YWRhdGFCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDQsIG1ldGFkYXRhXyk7DQogICAgICB9DQogICAgICBpZiAoIWJvZHlfLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSg1LCBib2R5Xyk7DQogICAgICB9DQogICAgICBpZiAoY2FjaGVIaXRfICE9IGZhbHNlKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQm9vbFNpemUoNiwgY2FjaGVIaXRfKTsNCiAgICAgIH0NCiAgICAgIGlmICh0aW1lc3RhbXBfICE9IDBMKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDcsIHRpbWVzdGFtcF8pOw0KICAgICAgfQ0KICAgICAgaWYgKGV4ZWN1dGVkXyAhPSBmYWxzZSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDgsIGV4ZWN1dGVkXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldEVycm9yQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSg5LCBlcnJvcl8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFzcGFuXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMTAsIHNwYW5fKTsNCiAgICAgIH0NCiAgICAgIGZvciAoamF2YS51dGlsLk1hcC5FbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBlbnRyeQ0KICAgICAgICAgICA6IGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmVudHJ5U2V0KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICB0YWdzX18gPSBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5uZXdCdWlsZGVyRm9yVHlwZSgpDQogICAgICAgICAgICAuc2V0S2V5KGVudHJ5LmdldEtleSgpKQ0KICAgICAgICAgICAgLnNldFZhbHVlKGVudHJ5LmdldFZhbHVlKCkpDQogICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDExLCB0YWdzX18pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlKSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIG90aGVyID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldENsaWVudElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENsaWVudElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldFJlcXVlc3RJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRSZXF1ZXN0SUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVwbHlDaGFubmVsKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcGx5Q2hhbm5lbCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRNZXRhZGF0YSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXRhZGF0YSgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRCb2R5KCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldEJvZHkoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldENhY2hlSGl0KCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRDYWNoZUhpdCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0VGltZXN0YW1wKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRUaW1lc3RhbXAoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldEV4ZWN1dGVkKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRFeGVjdXRlZCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRFcnJvcigpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRTcGFuKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFNwYW4oKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgaW50ZXJuYWxHZXRUYWdzKCkuZXF1YWxzKA0KICAgICAgICAgIG90aGVyLmludGVybmFsR2V0VGFncygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0xJRU5USURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2xpZW50SUQoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVRVUVTVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlcXVlc3RJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVBMWUNIQU5ORUxfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVwbHlDaGFubmVsKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FVEFEQVRBX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1ldGFkYXRhKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEJPRFlfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Qm9keSgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDQUNIRUhJVF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hCb29sZWFuKA0KICAgICAgICAgIGdldENhY2hlSGl0KCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgVElNRVNUQU1QX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0VGltZXN0YW1wKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVhFQ1VURURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRFeGVjdXRlZCgpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEVSUk9SX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEVycm9yKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNQQU5fRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0U3BhbigpLmhhc2hDb2RlKCk7DQogICAgICBpZiAoIWludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmlzRW1wdHkoKSkgew0KICAgICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBUQUdTX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgaW50ZXJuYWxHZXRUYWdzKCkuaGFzaENvZGUoKTsNCiAgICAgIH0NCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHBhcnNlRnJvbShieXRlW10gZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlJlc3BvbnNlfQ0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8QnVpbGRlcj4gaW1wbGVtZW50cw0KICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9pbXBsZW1lbnRzOmt1YmVtcS5SZXNwb25zZSkNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZU9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgQFN1cHByZXNzV2FybmluZ3MoeyJyYXd0eXBlcyJ9KQ0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQgaW50ZXJuYWxHZXRNYXBGaWVsZCgNCiAgICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICAgIHN3aXRjaCAobnVtYmVyKSB7DQogICAgICAgICAgY2FzZSAxMToNCiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkIGludGVybmFsR2V0TXV0YWJsZU1hcEZpZWxkKA0KICAgICAgICAgIGludCBudW1iZXIpIHsNCiAgICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgICBjYXNlIDExOg0KICAgICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlLm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIGNsaWVudElEXyA9ICIiOw0KDQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICByZXBseUNoYW5uZWxfID0gIiI7DQoNCiAgICAgICAgbWV0YWRhdGFfID0gIiI7DQoNCiAgICAgICAgYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQoNCiAgICAgICAgY2FjaGVIaXRfID0gZmFsc2U7DQoNCiAgICAgICAgdGltZXN0YW1wXyA9IDBMOw0KDQogICAgICAgIGV4ZWN1dGVkXyA9IGZhbHNlOw0KDQogICAgICAgIGVycm9yXyA9ICIiOw0KDQogICAgICAgIHNwYW5fID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KDQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5jbGVhcigpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBidWlsZFBhcnRpYWwoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UodGhpcyk7DQogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVsZDBfOw0KICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7DQogICAgICAgIHJlc3VsdC5jbGllbnRJRF8gPSBjbGllbnRJRF87DQogICAgICAgIHJlc3VsdC5yZXF1ZXN0SURfID0gcmVxdWVzdElEXzsNCiAgICAgICAgcmVzdWx0LnJlcGx5Q2hhbm5lbF8gPSByZXBseUNoYW5uZWxfOw0KICAgICAgICByZXN1bHQubWV0YWRhdGFfID0gbWV0YWRhdGFfOw0KICAgICAgICByZXN1bHQuYm9keV8gPSBib2R5XzsNCiAgICAgICAgcmVzdWx0LmNhY2hlSGl0XyA9IGNhY2hlSGl0XzsNCiAgICAgICAgcmVzdWx0LnRpbWVzdGFtcF8gPSB0aW1lc3RhbXBfOw0KICAgICAgICByZXN1bHQuZXhlY3V0ZWRfID0gZXhlY3V0ZWRfOw0KICAgICAgICByZXN1bHQuZXJyb3JfID0gZXJyb3JfOw0KICAgICAgICByZXN1bHQuc3Bhbl8gPSBzcGFuXzsNCiAgICAgICAgcmVzdWx0LnRhZ3NfID0gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgIHJlc3VsdC50YWdzXy5tYWtlSW1tdXRhYmxlKCk7DQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UpIHsNCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlKW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsNCiAgICAgICAgaWYgKCFvdGhlci5nZXRDbGllbnRJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNsaWVudElEXyA9IG90aGVyLmNsaWVudElEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldFJlcXVlc3RJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBvdGhlci5yZXF1ZXN0SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVwbHlDaGFubmVsKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgcmVwbHlDaGFubmVsXyA9IG90aGVyLnJlcGx5Q2hhbm5lbF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRNZXRhZGF0YSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIG1ldGFkYXRhXyA9IG90aGVyLm1ldGFkYXRhXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0Qm9keSgpICE9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWSkgew0KICAgICAgICAgIHNldEJvZHkob3RoZXIuZ2V0Qm9keSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0Q2FjaGVIaXQoKSAhPSBmYWxzZSkgew0KICAgICAgICAgIHNldENhY2hlSGl0KG90aGVyLmdldENhY2hlSGl0KCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRUaW1lc3RhbXAoKSAhPSAwTCkgew0KICAgICAgICAgIHNldFRpbWVzdGFtcChvdGhlci5nZXRUaW1lc3RhbXAoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldEV4ZWN1dGVkKCkgIT0gZmFsc2UpIHsNCiAgICAgICAgICBzZXRFeGVjdXRlZChvdGhlci5nZXRFeGVjdXRlZCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldEVycm9yKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgZXJyb3JfID0gb3RoZXIuZXJyb3JfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRTcGFuKCkgIT0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZKSB7DQogICAgICAgICAgc2V0U3BhbihvdGhlci5nZXRTcGFuKCkpOw0KICAgICAgICB9DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5tZXJnZUZyb20oDQogICAgICAgICAgICBvdGhlci5pbnRlcm5hbEdldFRhZ3MoKSk7DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNsaWVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNsaWVudElEKCkgew0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2xpZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2xpZW50SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVxdWVzdElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZXF1ZXN0SUQoKSB7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0UmVxdWVzdElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCByZXBseUNoYW5uZWxfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXBseUNoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVwbHlDaGFubmVsKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcGx5Q2hhbm5lbF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIHJlcGx5Q2hhbm5lbF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXBseUNoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldFJlcGx5Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcGx5Q2hhbm5lbF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgcmVwbHlDaGFubmVsXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGx5Q2hhbm5lbCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIHJlcGx5Q2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVwbHlDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUmVwbHlDaGFubmVsKCkgew0KICAgICAgICANCiAgICAgICAgcmVwbHlDaGFubmVsXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFJlcGx5Q2hhbm5lbCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXBseUNoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwbHlDaGFubmVsQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHJlcGx5Q2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgbWV0YWRhdGFfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRNZXRhZGF0YSgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIG1ldGFkYXRhXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBtZXRhZGF0YV8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1ldGFkYXRhKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgbWV0YWRhdGFfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWV0YWRhdGEoKSB7DQogICAgICAgIA0KICAgICAgICBtZXRhZGF0YV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRNZXRhZGF0YSgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXRhZGF0YUJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBtZXRhZGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKSB7DQogICAgICAgIHJldHVybiBib2R5XzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRCb2R5KGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBib2R5XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJ5dGVzIEJvZHkgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb2R5KCkgew0KICAgICAgICANCiAgICAgICAgYm9keV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRCb2R5KCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIGNhY2hlSGl0XyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgQ2FjaGVIaXQgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gZ2V0Q2FjaGVIaXQoKSB7DQogICAgICAgIHJldHVybiBjYWNoZUhpdF87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgQ2FjaGVIaXQgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2FjaGVIaXQoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgY2FjaGVIaXRfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBDYWNoZUhpdCA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNhY2hlSGl0KCkgew0KICAgICAgICANCiAgICAgICAgY2FjaGVIaXRfID0gZmFsc2U7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHRpbWVzdGFtcF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBUaW1lc3RhbXAgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0VGltZXN0YW1wKCkgew0KICAgICAgICByZXR1cm4gdGltZXN0YW1wXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFRpbWVzdGFtcChsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB0aW1lc3RhbXBfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVGltZXN0YW1wKCkgew0KICAgICAgICANCiAgICAgICAgdGltZXN0YW1wXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgYm9vbGVhbiBleGVjdXRlZF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIEV4ZWN1dGVkID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldEV4ZWN1dGVkKCkgew0KICAgICAgICByZXR1cm4gZXhlY3V0ZWRfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIEV4ZWN1dGVkID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEV4ZWN1dGVkKGJvb2xlYW4gdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIGV4ZWN1dGVkXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgRXhlY3V0ZWQgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFeGVjdXRlZCgpIHsNCiAgICAgICAgDQogICAgICAgIGV4ZWN1dGVkXyA9IGZhbHNlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBlcnJvcl8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gOTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEVycm9yKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldEVycm9yQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXJyb3JfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGVycm9yXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXJyb3IoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA5OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFcnJvcigpIHsNCiAgICAgICAgDQogICAgICAgIGVycm9yXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEVycm9yKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gOTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGVycm9yXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHNwYW5fID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBTcGFuID0gMTA7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNwYW4oKSB7DQogICAgICAgIHJldHVybiBzcGFuXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgU3BhbiA9IDEwOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Bhbihjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgc3Bhbl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBTcGFuID0gMTA7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclNwYW4oKSB7DQogICAgICAgIA0KICAgICAgICBzcGFuXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFNwYW4oKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gdGFnc187DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGludGVybmFsR2V0VGFncygpIHsNCiAgICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZC5lbXB0eU1hcEZpZWxkKA0KICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkgew0KICAgICAgICBvbkNoYW5nZWQoKTs7DQogICAgICAgIGlmICh0YWdzXyA9PSBudWxsKSB7DQogICAgICAgICAgdGFnc18gPSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLm5ld01hcEZpZWxkKA0KICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0YWdzXy5pc011dGFibGUoKSkgew0KICAgICAgICAgIHRhZ3NfID0gdGFnc18uY29weSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0YWdzXzsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGludCBnZXRUYWdzQ291bnQoKSB7DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5zaXplKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWluc1RhZ3MoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuY29udGFpbnNLZXkoa2V5KTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogVXNlIHtAbGluayAjZ2V0VGFnc01hcCgpfSBpbnN0ZWFkLg0KICAgICAgICovDQogICAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGdldFRhZ3MoKSB7DQogICAgICAgIHJldHVybiBnZXRUYWdzTWFwKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBnZXRUYWdzTWFwKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgZGVmYXVsdFZhbHVlKSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICAgIHJldHVybiBtYXAuY29udGFpbnNLZXkoa2V5KSA/IG1hcC5nZXQoa2V5KSA6IGRlZmF1bHRWYWx1ZTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTE7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5KSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICAgIGlmICghbWFwLmNvbnRhaW5zS2V5KGtleSkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBtYXAuZ2V0KGtleSk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVGFncygpIHsNCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLmNsZWFyKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSAxMTs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgcmVtb3ZlVGFncygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5yZW1vdmUoa2V5KTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIFVzZSBhbHRlcm5hdGUgbXV0YXRpb24gYWNjZXNzb3JzIGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGdldE11dGFibGVUYWdzKCkgew0KICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gMTE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBwdXRUYWdzKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLnB1dChrZXksIHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDExOzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgQnVpbGRlciBwdXRBbGxUYWdzKA0KICAgICAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gdmFsdWVzKSB7DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCkNCiAgICAgICAgICAgIC5wdXRBbGwodmFsdWVzKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlJlc3BvbnNlKQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuUmVzcG9uc2UpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVzcG9uc2U+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFJlc3BvbnNlPigpIHsNCiAgICAgIHB1YmxpYyBSZXNwb25zZSBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVzcG9uc2U+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxSZXNwb25zZT4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBRdWV1ZU1lc3NhZ2VPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5RdWV1ZU1lc3NhZ2UpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1lc3NhZ2VJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0TWVzc2FnZUlEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1lc3NhZ2VJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXNzYWdlSURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENoYW5uZWxCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRNZXRhZGF0YSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXRhZGF0YSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGludCBnZXRUYWdzQ291bnQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpOw0KICAgIC8qKg0KICAgICAqIFVzZSB7QGxpbmsgI2dldFRhZ3NNYXAoKX0gaW5zdGVhZC4NCiAgICAgKi8NCiAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgZ2V0VGFncygpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICBnZXRUYWdzTWFwKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICovDQoNCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPckRlZmF1bHQoDQogICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGRlZmF1bHRWYWx1ZSk7DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICovDQoNCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFRhZ3NPclRocm93KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgQXR0cmlidXRlcyA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gaGFzQXR0cmlidXRlcygpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBBdHRyaWJ1dGVzID0gNzs8L2NvZGU+DQogICAgICovDQogICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIGdldEF0dHJpYnV0ZXMoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgQXR0cmlidXRlcyA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlciBnZXRBdHRyaWJ1dGVzT3JCdWlsZGVyKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGhhc1BvbGljeSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IFBvbGljeSA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IGdldFBvbGljeSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IFBvbGljeSA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5T3JCdWlsZGVyIGdldFBvbGljeU9yQnVpbGRlcigpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUXVldWVNZXNzYWdlfQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUXVldWVNZXNzYWdlIGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLlF1ZXVlTWVzc2FnZSkNCiAgICAgIFF1ZXVlTWVzc2FnZU9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBRdWV1ZU1lc3NhZ2UubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIFF1ZXVlTWVzc2FnZShjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFF1ZXVlTWVzc2FnZSgpIHsNCiAgICAgIG1lc3NhZ2VJRF8gPSAiIjsNCiAgICAgIGNsaWVudElEXyA9ICIiOw0KICAgICAgY2hhbm5lbF8gPSAiIjsNCiAgICAgIG1ldGFkYXRhXyA9ICIiOw0KICAgICAgYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldA0KICAgIGdldFVua25vd25GaWVsZHMoKSB7DQogICAgICByZXR1cm4gdGhpcy51bmtub3duRmllbGRzOw0KICAgIH0NCiAgICBwcml2YXRlIFF1ZXVlTWVzc2FnZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHRoaXMoKTsNCiAgICAgIGlmIChleHRlbnNpb25SZWdpc3RyeSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIGludCBtdXRhYmxlX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0NCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKCk7DQogICAgICB0cnkgew0KICAgICAgICBib29sZWFuIGRvbmUgPSBmYWxzZTsNCiAgICAgICAgd2hpbGUgKCFkb25lKSB7DQogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsNCiAgICAgICAgICBzd2l0Y2ggKHRhZykgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGRQcm90bzMoDQogICAgICAgICAgICAgICAgICBpbnB1dCwgdW5rbm93bkZpZWxkcywgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsNCiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTA6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgbWVzc2FnZUlEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxODogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMjY6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMzQ6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQyOiB7DQoNCiAgICAgICAgICAgICAgYm9keV8gPSBpbnB1dC5yZWFkQnl0ZXMoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDUwOiB7DQogICAgICAgICAgICAgIGlmICghKChtdXRhYmxlX2JpdEZpZWxkMF8gJiAweDAwMDAwMDIwKSA9PSAweDAwMDAwMDIwKSkgew0KICAgICAgICAgICAgICAgIHRhZ3NfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZC5uZXdNYXBGaWVsZCgNCiAgICAgICAgICAgICAgICAgICAgVGFnc0RlZmF1bHRFbnRyeUhvbGRlci5kZWZhdWx0RW50cnkpOw0KICAgICAgICAgICAgICAgIG11dGFibGVfYml0RmllbGQwXyB8PSAweDAwMDAwMDIwOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnk8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgICAgICAgICAgdGFnc19fID0gaW5wdXQucmVhZE1lc3NhZ2UoDQogICAgICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5nZXRQYXJzZXJGb3JUeXBlKCksIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgICAgICAgdGFnc18uZ2V0TXV0YWJsZU1hcCgpLnB1dCgNCiAgICAgICAgICAgICAgICAgIHRhZ3NfXy5nZXRLZXkoKSwgdGFnc19fLmdldFZhbHVlKCkpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTg6IHsNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG51bGw7DQogICAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVzXyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgc3ViQnVpbGRlciA9IGF0dHJpYnV0ZXNfLnRvQnVpbGRlcigpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGF0dHJpYnV0ZXNfID0gaW5wdXQucmVhZE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLnBhcnNlcigpLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgICAgICAgIGlmIChzdWJCdWlsZGVyICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShhdHRyaWJ1dGVzXyk7DQogICAgICAgICAgICAgICAgYXR0cmlidXRlc18gPSBzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDY2OiB7DQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG51bGw7DQogICAgICAgICAgICAgIGlmIChwb2xpY3lfICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyID0gcG9saWN5Xy50b0J1aWxkZXIoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBwb2xpY3lfID0gaW5wdXQucmVhZE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kucGFyc2VyKCksIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgICAgICAgaWYgKHN1YkJ1aWxkZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKHBvbGljeV8pOw0KICAgICAgICAgICAgICAgIHBvbGljeV8gPSBzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IGUuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKA0KICAgICAgICAgICAgZSkuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnVua25vd25GaWVsZHMgPSB1bmtub3duRmllbGRzLmJ1aWxkKCk7DQogICAgICAgIG1ha2VFeHRlbnNpb25zSW1tdXRhYmxlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIEBTdXBwcmVzc1dhcm5pbmdzKHsicmF3dHlwZXMifSkNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE1hcEZpZWxkKA0KICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICBzd2l0Y2ggKG51bWJlcikgew0KICAgICAgICBjYXNlIDY6DQogICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAiSW52YWxpZCBtYXAgZmllbGQgbnVtYmVyOiAiICsgbnVtYmVyKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlX2ZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFSURfRklFTERfTlVNQkVSID0gMTsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgbWVzc2FnZUlEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWVzc2FnZUlEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlSURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIG1lc3NhZ2VJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1lc3NhZ2VJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TWVzc2FnZUlEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgbWVzc2FnZUlEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDTElFTlRJRF9GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBjbGllbnRJRF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENIQU5ORUxfRklFTERfTlVNQkVSID0gMzsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVRBREFUQV9GSUVMRF9OVU1CRVIgPSA0Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBtZXRhZGF0YV87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWV0YWRhdGEoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBtZXRhZGF0YV8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXRhZGF0YUJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXRhZGF0YV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgbWV0YWRhdGFfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPRFlfRklFTERfTlVNQkVSID0gNTsNCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCkgew0KICAgICAgcmV0dXJuIGJvZHlfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRBR1NfRklFTERfTlVNQkVSID0gNjsNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyIHsNCiAgICAgIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEVudHJ5PA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IGRlZmF1bHRFbnRyeSA9DQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRW50cnkNCiAgICAgICAgICAgICAgLjxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPm5ld0RlZmF1bHRJbnN0YW5jZSgNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfVGFnc0VudHJ5X2Rlc2NyaXB0b3IsIA0KICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5XaXJlRm9ybWF0LkZpZWxkVHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAiIiwNCiAgICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuV2lyZUZvcm1hdC5GaWVsZFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgIiIpOw0KICAgIH0NCiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IHRhZ3NfOw0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgIGludGVybmFsR2V0VGFncygpIHsNCiAgICAgIGlmICh0YWdzXyA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLmVtcHR5TWFwRmllbGQoDQogICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICB9DQogICAgICByZXR1cm4gdGFnc187DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRUYWdzQ291bnQoKSB7DQogICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuc2l6ZSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA2OzwvY29kZT4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5jb250YWluc0tleShrZXkpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICovDQogICAgQGphdmEubGFuZy5EZXByZWNhdGVkDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgIHJldHVybiBnZXRUYWdzTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAqLw0KDQogICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFnc01hcCgpIHsNCiAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSwNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBkZWZhdWx0VmFsdWUpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIHJldHVybiBtYXAuY29udGFpbnNLZXkoa2V5KSA/IG1hcC5nZXQoa2V5KSA6IGRlZmF1bHRWYWx1ZTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICovDQoNCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JUaHJvdygNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gbWFwID0NCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgIGlmICghbWFwLmNvbnRhaW5zS2V5KGtleSkpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBtYXAuZ2V0KGtleSk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQVRUUklCVVRFU19GSUVMRF9OVU1CRVIgPSA3Ow0KICAgIHByaXZhdGUgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIGF0dHJpYnV0ZXNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBBdHRyaWJ1dGVzID0gNzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGJvb2xlYW4gaGFzQXR0cmlidXRlcygpIHsNCiAgICAgIHJldHVybiBhdHRyaWJ1dGVzXyAhPSBudWxsOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgQXR0cmlidXRlcyA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgZ2V0QXR0cmlidXRlcygpIHsNCiAgICAgIHJldHVybiBhdHRyaWJ1dGVzXyA9PSBudWxsID8gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLmdldERlZmF1bHRJbnN0YW5jZSgpIDogYXR0cmlidXRlc187DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBBdHRyaWJ1dGVzID0gNzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlciBnZXRBdHRyaWJ1dGVzT3JCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIGdldEF0dHJpYnV0ZXMoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBQT0xJQ1lfRklFTERfTlVNQkVSID0gODsNCiAgICBwcml2YXRlIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHBvbGljeV87DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgUG9saWN5ID0gODs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGJvb2xlYW4gaGFzUG9saWN5KCkgew0KICAgICAgcmV0dXJuIHBvbGljeV8gIT0gbnVsbDsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgUG9saWN5ID0gODs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IGdldFBvbGljeSgpIHsNCiAgICAgIHJldHVybiBwb2xpY3lfID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IHBvbGljeV87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IFBvbGljeSA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeU9yQnVpbGRlciBnZXRQb2xpY3lPckJ1aWxkZXIoKSB7DQogICAgICByZXR1cm4gZ2V0UG9saWN5KCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldE1lc3NhZ2VJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMSwgbWVzc2FnZUlEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENsaWVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAyLCBjbGllbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAzLCBjaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldE1ldGFkYXRhQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCA0LCBtZXRhZGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFib2R5Xy5pc0VtcHR5KCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNSwgYm9keV8pOw0KICAgICAgfQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgLnNlcmlhbGl6ZVN0cmluZ01hcFRvKA0KICAgICAgICAgIG91dHB1dCwNCiAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKSwNCiAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSwNCiAgICAgICAgICA2KTsNCiAgICAgIGlmIChhdHRyaWJ1dGVzXyAhPSBudWxsKSB7DQogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNywgZ2V0QXR0cmlidXRlcygpKTsNCiAgICAgIH0NCiAgICAgIGlmIChwb2xpY3lfICE9IG51bGwpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg4LCBnZXRQb2xpY3koKSk7DQogICAgICB9DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRNZXNzYWdlSURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIG1lc3NhZ2VJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDbGllbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMiwgY2xpZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMywgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRNZXRhZGF0YUJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoNCwgbWV0YWRhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghYm9keV8uaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDUsIGJvZHlfKTsNCiAgICAgIH0NCiAgICAgIGZvciAoamF2YS51dGlsLk1hcC5FbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBlbnRyeQ0KICAgICAgICAgICA6IGludGVybmFsR2V0VGFncygpLmdldE1hcCgpLmVudHJ5U2V0KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBFbnRyeTxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPg0KICAgICAgICB0YWdzX18gPSBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeS5uZXdCdWlsZGVyRm9yVHlwZSgpDQogICAgICAgICAgICAuc2V0S2V5KGVudHJ5LmdldEtleSgpKQ0KICAgICAgICAgICAgLnNldFZhbHVlKGVudHJ5LmdldFZhbHVlKCkpDQogICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDYsIHRhZ3NfXyk7DQogICAgICB9DQogICAgICBpZiAoYXR0cmlidXRlc18gIT0gbnVsbCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDcsIGdldEF0dHJpYnV0ZXMoKSk7DQogICAgICB9DQogICAgICBpZiAocG9saWN5XyAhPSBudWxsKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoOCwgZ2V0UG9saWN5KCkpOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSkpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLmVxdWFscyhvYmopOw0KICAgICAgfQ0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2Ugb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1lc3NhZ2VJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXNzYWdlSUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0Q2xpZW50SUQoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0Q2xpZW50SUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0Q2hhbm5lbCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDaGFubmVsKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1ldGFkYXRhKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldE1ldGFkYXRhKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldEJvZHkoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0Qm9keSgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBpbnRlcm5hbEdldFRhZ3MoKS5lcXVhbHMoDQogICAgICAgICAgb3RoZXIuaW50ZXJuYWxHZXRUYWdzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChoYXNBdHRyaWJ1dGVzKCkgPT0gb3RoZXIuaGFzQXR0cmlidXRlcygpKTsNCiAgICAgIGlmIChoYXNBdHRyaWJ1dGVzKCkpIHsNCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRBdHRyaWJ1dGVzKCkpOw0KICAgICAgfQ0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChoYXNQb2xpY3koKSA9PSBvdGhlci5oYXNQb2xpY3koKSk7DQogICAgICBpZiAoaGFzUG9saWN5KCkpIHsNCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldFBvbGljeSgpDQogICAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFBvbGljeSgpKTsNCiAgICAgIH0NCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgTUVTU0FHRUlEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1lc3NhZ2VJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDTElFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRDbGllbnRJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDSEFOTkVMX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENoYW5uZWwoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgTUVUQURBVEFfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0TWV0YWRhdGEoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQk9EWV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRCb2R5KCkuaGFzaENvZGUoKTsNCiAgICAgIGlmICghaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFRBR1NfRklFTERfTlVNQkVSOw0KICAgICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBpbnRlcm5hbEdldFRhZ3MoKS5oYXNoQ29kZSgpOw0KICAgICAgfQ0KICAgICAgaWYgKGhhc0F0dHJpYnV0ZXMoKSkgew0KICAgICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBBVFRSSUJVVEVTX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0QXR0cmlidXRlcygpLmhhc2hDb2RlKCk7DQogICAgICB9DQogICAgICBpZiAoaGFzUG9saWN5KCkpIHsNCiAgICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUE9MSUNZX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UG9saWN5KCkuaGFzaENvZGUoKTsNCiAgICAgIH0NCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5RdWV1ZU1lc3NhZ2V9DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjxCdWlsZGVyPiBpbXBsZW1lbnRzDQogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX2ltcGxlbWVudHM6a3ViZW1xLlF1ZXVlTWVzc2FnZSkNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE1hcEZpZWxkKA0KICAgICAgICAgIGludCBudW1iZXIpIHsNCiAgICAgICAgc3dpdGNoIChudW1iZXIpIHsNCiAgICAgICAgICBjYXNlIDY6DQogICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKA0KICAgICAgICAgICAgICAgICJJbnZhbGlkIG1hcCBmaWVsZCBudW1iZXI6ICIgKyBudW1iZXIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBAU3VwcHJlc3NXYXJuaW5ncyh7InJhd3R5cGVzIn0pDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZCBpbnRlcm5hbEdldE11dGFibGVNYXBGaWVsZCgNCiAgICAgICAgICBpbnQgbnVtYmVyKSB7DQogICAgICAgIHN3aXRjaCAobnVtYmVyKSB7DQogICAgICAgICAgY2FzZSA2Og0KICAgICAgICAgICAgcmV0dXJuIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKTsNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oDQogICAgICAgICAgICAgICAgIkludmFsaWQgbWFwIGZpZWxkIG51bWJlcjogIiArIG51bWJlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICBtZXNzYWdlSURfID0gIiI7DQoNCiAgICAgICAgY2xpZW50SURfID0gIiI7DQoNCiAgICAgICAgY2hhbm5lbF8gPSAiIjsNCg0KICAgICAgICBtZXRhZGF0YV8gPSAiIjsNCg0KICAgICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsNCg0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuY2xlYXIoKTsNCiAgICAgICAgaWYgKGF0dHJpYnV0ZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgYXR0cmlidXRlc18gPSBudWxsOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGF0dHJpYnV0ZXNfID0gbnVsbDsNCiAgICAgICAgICBhdHRyaWJ1dGVzQnVpbGRlcl8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmIChwb2xpY3lCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcG9saWN5XyA9IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcG9saWN5XyA9IG51bGw7DQogICAgICAgICAgcG9saWN5QnVpbGRlcl8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlKHRoaXMpOw0KICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsNCiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgICByZXN1bHQubWVzc2FnZUlEXyA9IG1lc3NhZ2VJRF87DQogICAgICAgIHJlc3VsdC5jbGllbnRJRF8gPSBjbGllbnRJRF87DQogICAgICAgIHJlc3VsdC5jaGFubmVsXyA9IGNoYW5uZWxfOw0KICAgICAgICByZXN1bHQubWV0YWRhdGFfID0gbWV0YWRhdGFfOw0KICAgICAgICByZXN1bHQuYm9keV8gPSBib2R5XzsNCiAgICAgICAgcmVzdWx0LnRhZ3NfID0gaW50ZXJuYWxHZXRUYWdzKCk7DQogICAgICAgIHJlc3VsdC50YWdzXy5tYWtlSW1tdXRhYmxlKCk7DQogICAgICAgIGlmIChhdHRyaWJ1dGVzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJlc3VsdC5hdHRyaWJ1dGVzXyA9IGF0dHJpYnV0ZXNfOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdC5hdHRyaWJ1dGVzXyA9IGF0dHJpYnV0ZXNCdWlsZGVyXy5idWlsZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwb2xpY3lCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmVzdWx0LnBvbGljeV8gPSBwb2xpY3lfOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdC5wb2xpY3lfID0gcG9saWN5QnVpbGRlcl8uYnVpbGQoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxkMF87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlKW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldE1lc3NhZ2VJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIG1lc3NhZ2VJRF8gPSBvdGhlci5tZXNzYWdlSURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0Q2xpZW50SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBjbGllbnRJRF8gPSBvdGhlci5jbGllbnRJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDaGFubmVsKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgY2hhbm5lbF8gPSBvdGhlci5jaGFubmVsXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldE1ldGFkYXRhKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgbWV0YWRhdGFfID0gb3RoZXIubWV0YWRhdGFfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRCb2R5KCkgIT0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZKSB7DQogICAgICAgICAgc2V0Qm9keShvdGhlci5nZXRCb2R5KCkpOw0KICAgICAgICB9DQogICAgICAgIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5tZXJnZUZyb20oDQogICAgICAgICAgICBvdGhlci5pbnRlcm5hbEdldFRhZ3MoKSk7DQogICAgICAgIGlmIChvdGhlci5oYXNBdHRyaWJ1dGVzKCkpIHsNCiAgICAgICAgICBtZXJnZUF0dHJpYnV0ZXMob3RoZXIuZ2V0QXR0cmlidXRlcygpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuaGFzUG9saWN5KCkpIHsNCiAgICAgICAgICBtZXJnZVBvbGljeShvdGhlci5nZXRQb2xpY3koKSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UpIGUuZ2V0VW5maW5pc2hlZE1lc3NhZ2UoKTsNCiAgICAgICAgICB0aHJvdyBlLnVud3JhcElPRXhjZXB0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgaWYgKHBhcnNlZE1lc3NhZ2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgbWVyZ2VGcm9tKHBhcnNlZE1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtZXNzYWdlSURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXNzYWdlSUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TWVzc2FnZUlEKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIG1lc3NhZ2VJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXNzYWdlSUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldE1lc3NhZ2VJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgbWVzc2FnZUlEXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIG1lc3NhZ2VJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2FnZUlEKCkgew0KICAgICAgICANCiAgICAgICAgbWVzc2FnZUlEXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldE1lc3NhZ2VJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNZXNzYWdlSUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWVzc2FnZUlEQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIG1lc3NhZ2VJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2xpZW50SURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENsaWVudElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2xpZW50SUQoKSB7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDbGllbnRJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2hhbm5lbF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDaGFubmVsKCkgew0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDaGFubmVsKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtZXRhZGF0YV8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ldGFkYXRhXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgbWV0YWRhdGFfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldE1ldGFkYXRhQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWV0YWRhdGFfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIG1ldGFkYXRhXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWV0YWRhdGEoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBtZXRhZGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWV0YWRhdGEgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXRhZGF0YSgpIHsNCiAgICAgICAgDQogICAgICAgIG1ldGFkYXRhXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldE1ldGFkYXRhKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1ldGFkYXRhID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1ldGFkYXRhQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIG1ldGFkYXRhXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJvZHlfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsNCiAgICAgICAgcmV0dXJuIGJvZHlfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ieXRlcyBCb2R5ID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJvZHkoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGJvZHlfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ynl0ZXMgQm9keSA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckJvZHkoKSB7DQogICAgICAgIA0KICAgICAgICBib2R5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEJvZHkoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gdGFnc187DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTWFwRmllbGQ8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4NCiAgICAgIGludGVybmFsR2V0VGFncygpIHsNCiAgICAgICAgaWYgKHRhZ3NfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5NYXBGaWVsZC5lbXB0eU1hcEZpZWxkKA0KICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRhZ3NfOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkgew0KICAgICAgICBvbkNoYW5nZWQoKTs7DQogICAgICAgIGlmICh0YWdzXyA9PSBudWxsKSB7DQogICAgICAgICAgdGFnc18gPSBjb20uZ29vZ2xlLnByb3RvYnVmLk1hcEZpZWxkLm5ld01hcEZpZWxkKA0KICAgICAgICAgICAgICBUYWdzRGVmYXVsdEVudHJ5SG9sZGVyLmRlZmF1bHRFbnRyeSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0YWdzXy5pc011dGFibGUoKSkgew0KICAgICAgICAgIHRhZ3NfID0gdGFnc18uY29weSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0YWdzXzsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGludCBnZXRUYWdzQ291bnQoKSB7DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5zaXplKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zVGFncygNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIGtleSkgew0KICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOyB9DQogICAgICAgIHJldHVybiBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKS5jb250YWluc0tleShrZXkpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiBVc2Uge0BsaW5rICNnZXRUYWdzTWFwKCl9IGluc3RlYWQuDQogICAgICAgKi8NCiAgICAgIEBqYXZhLmxhbmcuRGVwcmVjYXRlZA0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgICAgcmV0dXJuIGdldFRhZ3NNYXAoKTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIGphdmEudXRpbC5NYXA8amF2YS5sYW5nLlN0cmluZywgamF2YS5sYW5nLlN0cmluZz4gZ2V0VGFnc01hcCgpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0VGFncygpLmdldE1hcCgpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5tYXAmbHQ7c3RyaW5nLCBzdHJpbmcmZ3Q7IFRhZ3MgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRUYWdzT3JEZWZhdWx0KA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgZGVmYXVsdFZhbHVlKSB7DQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiBtYXAgPQ0KICAgICAgICAgICAgaW50ZXJuYWxHZXRUYWdzKCkuZ2V0TWFwKCk7DQogICAgICAgIHJldHVybiBtYXAuY29udGFpbnNLZXkoa2V5KSA/IG1hcC5nZXQoa2V5KSA6IGRlZmF1bHRWYWx1ZTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+bWFwJmx0O3N0cmluZywgc3RyaW5nJmd0OyBUYWdzID0gNjs8L2NvZGU+DQogICAgICAgKi8NCg0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0VGFnc09yVGhyb3coDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+IG1hcCA9DQogICAgICAgICAgICBpbnRlcm5hbEdldFRhZ3MoKS5nZXRNYXAoKTsNCiAgICAgICAgaWYgKCFtYXAuY29udGFpbnNLZXkoa2V5KSkgew0KICAgICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG1hcC5nZXQoa2V5KTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJUYWdzKCkgew0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAuY2xlYXIoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIHJlbW92ZVRhZ3MoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBrZXkpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpbnRlcm5hbEdldE11dGFibGVUYWdzKCkuZ2V0TXV0YWJsZU1hcCgpDQogICAgICAgICAgICAucmVtb3ZlKGtleSk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiBVc2UgYWx0ZXJuYXRlIG11dGF0aW9uIGFjY2Vzc29ycyBpbnN0ZWFkLg0KICAgICAgICovDQogICAgICBAamF2YS5sYW5nLkRlcHJlY2F0ZWQNCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTWFwPGphdmEubGFuZy5TdHJpbmcsIGphdmEubGFuZy5TdHJpbmc+DQogICAgICBnZXRNdXRhYmxlVGFncygpIHsNCiAgICAgICAgcmV0dXJuIGludGVybmFsR2V0TXV0YWJsZVRhZ3MoKS5nZXRNdXRhYmxlTWFwKCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBwdXRUYWdzKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcga2V5LA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKGtleSA9PSBudWxsKSB7IHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsgfQ0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgeyB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7IH0NCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLnB1dChrZXksIHZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPm1hcCZsdDtzdHJpbmcsIHN0cmluZyZndDsgVGFncyA9IDY7PC9jb2RlPg0KICAgICAgICovDQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIHB1dEFsbFRhZ3MoDQogICAgICAgICAgamF2YS51dGlsLk1hcDxqYXZhLmxhbmcuU3RyaW5nLCBqYXZhLmxhbmcuU3RyaW5nPiB2YWx1ZXMpIHsNCiAgICAgICAgaW50ZXJuYWxHZXRNdXRhYmxlVGFncygpLmdldE11dGFibGVNYXAoKQ0KICAgICAgICAgICAgLnB1dEFsbCh2YWx1ZXMpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgYXR0cmlidXRlc18gPSBudWxsOw0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlcj4gYXR0cmlidXRlc0J1aWxkZXJfOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgQXR0cmlidXRlcyA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNBdHRyaWJ1dGVzKCkgew0KICAgICAgICByZXR1cm4gYXR0cmlidXRlc0J1aWxkZXJfICE9IG51bGwgfHwgYXR0cmlidXRlc18gIT0gbnVsbDsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBnZXRBdHRyaWJ1dGVzKCkgew0KICAgICAgICBpZiAoYXR0cmlidXRlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gYXR0cmlidXRlc18gPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcy5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IGF0dHJpYnV0ZXNfOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVzQnVpbGRlcl8uZ2V0TWVzc2FnZSgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBBdHRyaWJ1dGVzID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEF0dHJpYnV0ZXMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHZhbHVlKSB7DQogICAgICAgIGlmIChhdHRyaWJ1dGVzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgYXR0cmlidXRlc18gPSB2YWx1ZTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhdHRyaWJ1dGVzQnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0QXR0cmlidXRlcygNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKGF0dHJpYnV0ZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgYXR0cmlidXRlc18gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhdHRyaWJ1dGVzQnVpbGRlcl8uc2V0TWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VBdHRyaWJ1dGVzKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyB2YWx1ZSkgew0KICAgICAgICBpZiAoYXR0cmlidXRlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAoYXR0cmlidXRlc18gIT0gbnVsbCkgew0KICAgICAgICAgICAgYXR0cmlidXRlc18gPQ0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMubmV3QnVpbGRlcihhdHRyaWJ1dGVzXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYXR0cmlidXRlc18gPSB2YWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXR0cmlidXRlc0J1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJBdHRyaWJ1dGVzKCkgew0KICAgICAgICBpZiAoYXR0cmlidXRlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBhdHRyaWJ1dGVzXyA9IG51bGw7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYXR0cmlidXRlc18gPSBudWxsOw0KICAgICAgICAgIGF0dHJpYnV0ZXNCdWlsZGVyXyA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcy5CdWlsZGVyIGdldEF0dHJpYnV0ZXNCdWlsZGVyKCkgew0KICAgICAgICANCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiBnZXRBdHRyaWJ1dGVzRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgQXR0cmlidXRlcyA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzT3JCdWlsZGVyIGdldEF0dHJpYnV0ZXNPckJ1aWxkZXIoKSB7DQogICAgICAgIGlmIChhdHRyaWJ1dGVzQnVpbGRlcl8gIT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBhdHRyaWJ1dGVzXyA9PSBudWxsID8NCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLmdldERlZmF1bHRJbnN0YW5jZSgpIDogYXR0cmlidXRlc187DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIEF0dHJpYnV0ZXMgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlcj4gDQogICAgICAgICAgZ2V0QXR0cmlidXRlc0ZpZWxkQnVpbGRlcigpIHsNCiAgICAgICAgaWYgKGF0dHJpYnV0ZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgYXR0cmlidXRlc0J1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyVjM8DQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlcj4oDQogICAgICAgICAgICAgICAgICBnZXRBdHRyaWJ1dGVzKCksDQogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLA0KICAgICAgICAgICAgICAgICAgaXNDbGVhbigpKTsNCiAgICAgICAgICBhdHRyaWJ1dGVzXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXNCdWlsZGVyXzsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBwb2xpY3lfID0gbnVsbDsNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXI+IHBvbGljeUJ1aWxkZXJfOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gaGFzUG9saWN5KCkgew0KICAgICAgICByZXR1cm4gcG9saWN5QnVpbGRlcl8gIT0gbnVsbCB8fCBwb2xpY3lfICE9IG51bGw7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IFBvbGljeSA9IDg7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgZ2V0UG9saWN5KCkgew0KICAgICAgICBpZiAocG9saWN5QnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBwb2xpY3lfID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IHBvbGljeV87DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIHBvbGljeUJ1aWxkZXJfLmdldE1lc3NhZ2UoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UG9saWN5KGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHZhbHVlKSB7DQogICAgICAgIGlmIChwb2xpY3lCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBwb2xpY3lfID0gdmFsdWU7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcG9saWN5QnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgUG9saWN5ID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFBvbGljeSgNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgew0KICAgICAgICBpZiAocG9saWN5QnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHBvbGljeV8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBwb2xpY3lCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VQb2xpY3koaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgdmFsdWUpIHsNCiAgICAgICAgaWYgKHBvbGljeUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAocG9saWN5XyAhPSBudWxsKSB7DQogICAgICAgICAgICBwb2xpY3lfID0NCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kubmV3QnVpbGRlcihwb2xpY3lfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwb2xpY3lfID0gdmFsdWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBvbGljeUJ1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgUG9saWN5ID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUG9saWN5KCkgew0KICAgICAgICBpZiAocG9saWN5QnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHBvbGljeV8gPSBudWxsOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBvbGljeV8gPSBudWxsOw0KICAgICAgICAgIHBvbGljeUJ1aWxkZXJfID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5LkJ1aWxkZXIgZ2V0UG9saWN5QnVpbGRlcigpIHsNCiAgICAgICAgDQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gZ2V0UG9saWN5RmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5T3JCdWlsZGVyIGdldFBvbGljeU9yQnVpbGRlcigpIHsNCiAgICAgICAgaWYgKHBvbGljeUJ1aWxkZXJfICE9IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gcG9saWN5QnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBwb2xpY3lfID09IG51bGwgPw0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IHBvbGljeV87DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgUG9saWN5ID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXI+IA0KICAgICAgICAgIGdldFBvbGljeUZpZWxkQnVpbGRlcigpIHsNCiAgICAgICAgaWYgKHBvbGljeUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBwb2xpY3lCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXI+KA0KICAgICAgICAgICAgICAgICAgZ2V0UG9saWN5KCksDQogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLA0KICAgICAgICAgICAgICAgICAgaXNDbGVhbigpKTsNCiAgICAgICAgICBwb2xpY3lfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcG9saWN5QnVpbGRlcl87DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZSkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZSkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlKCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxRdWV1ZU1lc3NhZ2U+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFF1ZXVlTWVzc2FnZT4oKSB7DQogICAgICBwdWJsaWMgUXVldWVNZXNzYWdlIHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgUXVldWVNZXNzYWdlKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlPiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlPiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQmF0Y2hJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0QmF0Y2hJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEJhdGNoSURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4gDQogICAgICAgIGdldE1lc3NhZ2VzTGlzdCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0TWVzc2FnZXMoaW50IGluZGV4KTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGludCBnZXRNZXNzYWdlc0NvdW50KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IA0KICAgICAgICBnZXRNZXNzYWdlc09yQnVpbGRlckxpc3QoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1lc3NhZ2VzT3JCdWlsZGVyKA0KICAgICAgICBpbnQgaW5kZXgpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdH0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgZXh0ZW5kcw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMgaW1wbGVtZW50cw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KG1lc3NhZ2VfaW1wbGVtZW50czprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkNCiAgICAgIFF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0Lg0KICAgIHByaXZhdGUgUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QoKSB7DQogICAgICBiYXRjaElEXyA9ICIiOw0KICAgICAgbWVzc2FnZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBiYXRjaElEXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxODogew0KICAgICAgICAgICAgICBpZiAoISgobXV0YWJsZV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlc18gPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4oKTsNCiAgICAgICAgICAgICAgICBtdXRhYmxlX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBtZXNzYWdlc18uYWRkKA0KICAgICAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UucGFyc2VyKCksIGV4dGVuc2lvblJlZ2lzdHJ5KSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgaWYgKCgobXV0YWJsZV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsNCiAgICAgICAgICBtZXNzYWdlc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChtZXNzYWdlc18pOw0KICAgICAgICB9DQogICAgICAgIHRoaXMudW5rbm93bkZpZWxkcyA9IHVua25vd25GaWVsZHMuYnVpbGQoKTsNCiAgICAgICAgbWFrZUV4dGVuc2lvbnNJbW11dGFibGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdF9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQkFUQ0hJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBiYXRjaElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQmF0Y2hJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEJhdGNoSUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGJhdGNoSURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGJhdGNoSURfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRCYXRjaElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGJhdGNoSURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGJhdGNoSURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1FU1NBR0VTX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4gbWVzc2FnZXNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEudXRpbC5MaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPiBnZXRNZXNzYWdlc0xpc3QoKSB7DQogICAgICByZXR1cm4gbWVzc2FnZXNfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IA0KICAgICAgICBnZXRNZXNzYWdlc09yQnVpbGRlckxpc3QoKSB7DQogICAgICByZXR1cm4gbWVzc2FnZXNfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZXNDb3VudCgpIHsNCiAgICAgIHJldHVybiBtZXNzYWdlc18uc2l6ZSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBnZXRNZXNzYWdlcyhpbnQgaW5kZXgpIHsNCiAgICAgIHJldHVybiBtZXNzYWdlc18uZ2V0KGluZGV4KTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXIgZ2V0TWVzc2FnZXNPckJ1aWxkZXIoDQogICAgICAgIGludCBpbmRleCkgew0KICAgICAgcmV0dXJuIG1lc3NhZ2VzXy5nZXQoaW5kZXgpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKCFnZXRCYXRjaElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCBiYXRjaElEXyk7DQogICAgICB9DQogICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1lc3NhZ2VzXy5zaXplKCk7IGkrKykgew0KICAgICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDIsIG1lc3NhZ2VzXy5nZXQoaSkpOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmICghZ2V0QmF0Y2hJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgYmF0Y2hJRF8pOw0KICAgICAgfQ0KICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXNzYWdlc18uc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgyLCBtZXNzYWdlc18uZ2V0KGkpKTsNCiAgICAgIH0NCiAgICAgIHNpemUgKz0gdW5rbm93bkZpZWxkcy5nZXRTZXJpYWxpemVkU2l6ZSgpOw0KICAgICAgbWVtb2l6ZWRTaXplID0gc2l6ZTsNCiAgICAgIHJldHVybiBzaXplOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoZmluYWwgamF2YS5sYW5nLk9iamVjdCBvYmopIHsNCiAgICAgIGlmIChvYmogPT0gdGhpcykgew0KICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3Qgb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KSBvYmo7DQoNCiAgICAgIGJvb2xlYW4gcmVzdWx0ID0gdHJ1ZTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRCYXRjaElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldEJhdGNoSUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0TWVzc2FnZXNMaXN0KCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldE1lc3NhZ2VzTGlzdCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQkFUQ0hJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRCYXRjaElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGlmIChnZXRNZXNzYWdlc0NvdW50KCkgPiAwKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FU1NBR0VTX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0TWVzc2FnZXNMaXN0KCkuaGFzaENvZGUoKTsNCiAgICAgIH0NCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdH0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0T3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QubmV3QnVpbGRlcigpDQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICAgIHN1cGVyKHBhcmVudCk7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgew0KICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAgICAgICAuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgew0KICAgICAgICAgIGdldE1lc3NhZ2VzRmllbGRCdWlsZGVyKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICBiYXRjaElEXyA9ICIiOw0KDQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtZXNzYWdlc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7DQogICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uY2xlYXIoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KHRoaXMpOw0KICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsNCiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgICByZXN1bHQuYmF0Y2hJRF8gPSBiYXRjaElEXzsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgICAgbWVzc2FnZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QobWVzc2FnZXNfKTsNCiAgICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmVzdWx0Lm1lc3NhZ2VzXyA9IG1lc3NhZ2VzXzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHQubWVzc2FnZXNfID0gbWVzc2FnZXNCdWlsZGVyXy5idWlsZCgpOw0KICAgICAgICB9DQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdClvdGhlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldEJhdGNoSUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBiYXRjaElEXyA9IG90aGVyLmJhdGNoSURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAoIW90aGVyLm1lc3NhZ2VzXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIGlmIChtZXNzYWdlc18uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzXyA9IG90aGVyLm1lc3NhZ2VzXzsNCiAgICAgICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICAgICAgbWVzc2FnZXNfLmFkZEFsbChvdGhlci5tZXNzYWdlc18pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmICghb3RoZXIubWVzc2FnZXNfLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uZGlzcG9zZSgpOw0KICAgICAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfID0gbnVsbDsNCiAgICAgICAgICAgICAgbWVzc2FnZXNfID0gb3RoZXIubWVzc2FnZXNfOw0KICAgICAgICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8gPSANCiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzID8NCiAgICAgICAgICAgICAgICAgICBnZXRNZXNzYWdlc0ZpZWxkQnVpbGRlcigpIDogbnVsbDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uYWRkQWxsTWVzc2FnZXMob3RoZXIubWVzc2FnZXNfKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGJhdGNoSURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEJhdGNoSUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gYmF0Y2hJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGJhdGNoSURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQmF0Y2hJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0QmF0Y2hJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGJhdGNoSURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGJhdGNoSURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJhdGNoSUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBiYXRjaElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQmF0Y2hJRCgpIHsNCiAgICAgICAgDQogICAgICAgIGJhdGNoSURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0QmF0Y2hJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJhdGNoSURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgYmF0Y2hJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEudXRpbC5MaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPiBtZXNzYWdlc18gPQ0KICAgICAgICBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7DQogICAgICBwcml2YXRlIHZvaWQgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKSB7DQogICAgICAgIGlmICghKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsNCiAgICAgICAgICBtZXNzYWdlc18gPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4obWVzc2FnZXNfKTsNCiAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7DQogICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlcj4gbWVzc2FnZXNCdWlsZGVyXzsNCg0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2U+IGdldE1lc3NhZ2VzTGlzdCgpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChtZXNzYWdlc18pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc0J1aWxkZXJfLmdldE1lc3NhZ2VMaXN0KCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGludCBnZXRNZXNzYWdlc0NvdW50KCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzXy5zaXplKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzQnVpbGRlcl8uZ2V0Q291bnQoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0TWVzc2FnZXMoaW50IGluZGV4KSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZXNfLmdldChpbmRleCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzQnVpbGRlcl8uZ2V0TWVzc2FnZShpbmRleCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWVzc2FnZXMoDQogICAgICAgICAgaW50IGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSB2YWx1ZSkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbnN1cmVNZXNzYWdlc0lzTXV0YWJsZSgpOw0KICAgICAgICAgIG1lc3NhZ2VzXy5zZXQoaW5kZXgsIHZhbHVlKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLnNldE1lc3NhZ2UoaW5kZXgsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWVzc2FnZXMoDQogICAgICAgICAgaW50IGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBtZXNzYWdlc18uc2V0KGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5zZXRNZXNzYWdlKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZE1lc3NhZ2VzKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHZhbHVlKSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCk7DQogICAgICAgICAgbWVzc2FnZXNfLmFkZCh2YWx1ZSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5hZGRNZXNzYWdlKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkTWVzc2FnZXMoDQogICAgICAgICAgaW50IGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSB2YWx1ZSkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbnN1cmVNZXNzYWdlc0lzTXV0YWJsZSgpOw0KICAgICAgICAgIG1lc3NhZ2VzXy5hZGQoaW5kZXgsIHZhbHVlKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLmFkZE1lc3NhZ2UoaW5kZXgsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkTWVzc2FnZXMoDQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCk7DQogICAgICAgICAgbWVzc2FnZXNfLmFkZChidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5hZGRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkTWVzc2FnZXMoDQogICAgICAgICAgaW50IGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBtZXNzYWdlc18uYWRkKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFsbE1lc3NhZ2VzKA0KICAgICAgICAgIGphdmEubGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2U+IHZhbHVlcykgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0TWVzc2FnZUxpdGUuQnVpbGRlci5hZGRBbGwoDQogICAgICAgICAgICAgIHZhbHVlcywgbWVzc2FnZXNfKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLmFkZEFsbE1lc3NhZ2VzKHZhbHVlcyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2FnZXMoKSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtZXNzYWdlc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7DQogICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uY2xlYXIoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgcmVtb3ZlTWVzc2FnZXMoaW50IGluZGV4KSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBlbnN1cmVNZXNzYWdlc0lzTXV0YWJsZSgpOw0KICAgICAgICAgIG1lc3NhZ2VzXy5yZW1vdmUoaW5kZXgpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8ucmVtb3ZlKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIgZ2V0TWVzc2FnZXNCdWlsZGVyKA0KICAgICAgICAgIGludCBpbmRleCkgew0KICAgICAgICByZXR1cm4gZ2V0TWVzc2FnZXNGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKGluZGV4KTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1lc3NhZ2VzT3JCdWlsZGVyKA0KICAgICAgICAgIGludCBpbmRleCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzXy5nZXQoaW5kZXgpOyAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZXNCdWlsZGVyXy5nZXRNZXNzYWdlT3JCdWlsZGVyKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8PyBleHRlbmRzIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPiANCiAgICAgICAgICAgZ2V0TWVzc2FnZXNPckJ1aWxkZXJMaXN0KCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyAhPSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlckxpc3QoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QobWVzc2FnZXNfKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBhZGRNZXNzYWdlc0J1aWxkZXIoKSB7DQogICAgICAgIHJldHVybiBnZXRNZXNzYWdlc0ZpZWxkQnVpbGRlcigpLmFkZEJ1aWxkZXIoDQogICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGFkZE1lc3NhZ2VzQnVpbGRlcigNCiAgICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VzRmllbGRCdWlsZGVyKCkuYWRkQnVpbGRlcigNCiAgICAgICAgICAgIGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyPiANCiAgICAgICAgICAgZ2V0TWVzc2FnZXNCdWlsZGVyTGlzdCgpIHsNCiAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VzRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlckxpc3QoKTsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlcj4gDQogICAgICAgICAgZ2V0TWVzc2FnZXNGaWVsZEJ1aWxkZXIoKSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPigNCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzXywNCiAgICAgICAgICAgICAgICAgICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpLA0KICAgICAgICAgICAgICAgICAgZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwNCiAgICAgICAgICAgICAgICAgIGlzQ2xlYW4oKSk7DQogICAgICAgICAgbWVzc2FnZXNfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWVzc2FnZXNCdWlsZGVyXzsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIHNldFVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIuc2V0VW5rbm93bkZpZWxkc1Byb3RvMyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgbWVyZ2VVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLm1lcmdlVW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzKTsNCiAgICAgIH0NCg0KDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IERFRkFVTFRfSU5TVEFOQ0U7DQogICAgc3RhdGljIHsNCiAgICAgIERFRkFVTFRfSU5TVEFOQ0UgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdD4NCiAgICAgICAgUEFSU0VSID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuQWJzdHJhY3RQYXJzZXI8UXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdD4oKSB7DQogICAgICBwdWJsaWMgUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QoaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgcHVibGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogIH0NCg0KICBwdWJsaWMgaW50ZXJmYWNlIFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEJhdGNoSUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldEJhdGNoSUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQmF0Y2hJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRCYXRjaElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiANCiAgICAgICAgZ2V0UmVzdWx0c0xpc3QoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBnZXRSZXN1bHRzKGludCBpbmRleCk7DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0UmVzdWx0c0NvdW50KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0T3JCdWlsZGVyPiANCiAgICAgICAgZ2V0UmVzdWx0c09yQnVpbGRlckxpc3QoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdE9yQnVpbGRlciBnZXRSZXN1bHRzT3JCdWlsZGVyKA0KICAgICAgICBpbnQgaW5kZXgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBIYXZlRXJyb3JzID0gMzs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBnZXRIYXZlRXJyb3JzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZX0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlKQ0KICAgICAgUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UoKSB7DQogICAgICBiYXRjaElEXyA9ICIiOw0KICAgICAgcmVzdWx0c18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7DQogICAgICBoYXZlRXJyb3JzXyA9IGZhbHNlOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHRoaXMoKTsNCiAgICAgIGlmIChleHRlbnNpb25SZWdpc3RyeSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgIH0NCiAgICAgIGludCBtdXRhYmxlX2JpdEZpZWxkMF8gPSAwOw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0NCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKCk7DQogICAgICB0cnkgew0KICAgICAgICBib29sZWFuIGRvbmUgPSBmYWxzZTsNCiAgICAgICAgd2hpbGUgKCFkb25lKSB7DQogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsNCiAgICAgICAgICBzd2l0Y2ggKHRhZykgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGRQcm90bzMoDQogICAgICAgICAgICAgICAgICBpbnB1dCwgdW5rbm93bkZpZWxkcywgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsNCiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTA6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgYmF0Y2hJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTg6IHsNCiAgICAgICAgICAgICAgaWYgKCEoKG11dGFibGVfYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7DQogICAgICAgICAgICAgICAgcmVzdWx0c18gPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+KCk7DQogICAgICAgICAgICAgICAgbXV0YWJsZV9iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmVzdWx0c18uYWRkKA0KICAgICAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LnBhcnNlcigpLCBleHRlbnNpb25SZWdpc3RyeSkpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMjQ6IHsNCg0KICAgICAgICAgICAgICBoYXZlRXJyb3JzXyA9IGlucHV0LnJlYWRCb29sKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgaWYgKCgobXV0YWJsZV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsNCiAgICAgICAgICByZXN1bHRzXyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdHNfKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnVua25vd25GaWVsZHMgPSB1bmtub3duRmllbGRzLmJ1aWxkKCk7DQogICAgICAgIG1ha2VFeHRlbnNpb25zSW1tdXRhYmxlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBCQVRDSElEX0ZJRUxEX05VTUJFUiA9IDE7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGJhdGNoSURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0QmF0Y2hJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gYmF0Y2hJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgYmF0Y2hJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEJhdGNoSUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEJhdGNoSURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gYmF0Y2hJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgYmF0Y2hJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVTVUxUU19GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiByZXN1bHRzXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IGdldFJlc3VsdHNMaXN0KCkgew0KICAgICAgcmV0dXJuIHJlc3VsdHNfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0T3JCdWlsZGVyPiANCiAgICAgICAgZ2V0UmVzdWx0c09yQnVpbGRlckxpc3QoKSB7DQogICAgICByZXR1cm4gcmVzdWx0c187DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRSZXN1bHRzQ291bnQoKSB7DQogICAgICByZXR1cm4gcmVzdWx0c18uc2l6ZSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgZ2V0UmVzdWx0cyhpbnQgaW5kZXgpIHsNCiAgICAgIHJldHVybiByZXN1bHRzXy5nZXQoaW5kZXgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRPckJ1aWxkZXIgZ2V0UmVzdWx0c09yQnVpbGRlcigNCiAgICAgICAgaW50IGluZGV4KSB7DQogICAgICByZXR1cm4gcmVzdWx0c18uZ2V0KGluZGV4KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBIQVZFRVJST1JTX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSBib29sZWFuIGhhdmVFcnJvcnNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSGF2ZUVycm9ycyA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldEhhdmVFcnJvcnMoKSB7DQogICAgICByZXR1cm4gaGF2ZUVycm9yc187DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldEJhdGNoSURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIGJhdGNoSURfKTsNCiAgICAgIH0NCiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzdWx0c18uc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSgyLCByZXN1bHRzXy5nZXQoaSkpOw0KICAgICAgfQ0KICAgICAgaWYgKGhhdmVFcnJvcnNfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woMywgaGF2ZUVycm9yc18pOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmICghZ2V0QmF0Y2hJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgYmF0Y2hJRF8pOw0KICAgICAgfQ0KICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXN1bHRzXy5zaXplKCk7IGkrKykgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDIsIHJlc3VsdHNfLmdldChpKSk7DQogICAgICB9DQogICAgICBpZiAoaGF2ZUVycm9yc18gIT0gZmFsc2UpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCb29sU2l6ZSgzLCBoYXZlRXJyb3JzXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2Ugb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0QmF0Y2hJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRCYXRjaElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldFJlc3VsdHNMaXN0KCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlc3VsdHNMaXN0KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRIYXZlRXJyb3JzKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRIYXZlRXJyb3JzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBCQVRDSElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEJhdGNoSUQoKS5oYXNoQ29kZSgpOw0KICAgICAgaWYgKGdldFJlc3VsdHNDb3VudCgpID4gMCkgew0KICAgICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVNVTFRTX0ZJRUxEX05VTUJFUjsNCiAgICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVzdWx0c0xpc3QoKS5oYXNoQ29kZSgpOw0KICAgICAgfQ0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgSEFWRUVSUk9SU19GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hCb29sZWFuKA0KICAgICAgICAgIGdldEhhdmVFcnJvcnMoKSk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZX0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgICBnZXRSZXN1bHRzRmllbGRCdWlsZGVyKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICBiYXRjaElEXyA9ICIiOw0KDQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJlc3VsdHNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHRzQnVpbGRlcl8uY2xlYXIoKTsNCiAgICAgICAgfQ0KICAgICAgICBoYXZlRXJyb3JzXyA9IGZhbHNlOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOw0KICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSh0aGlzKTsNCiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87DQogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsNCiAgICAgICAgcmVzdWx0LmJhdGNoSURfID0gYmF0Y2hJRF87DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgICAgcmVzdWx0c18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChyZXN1bHRzXyk7DQogICAgICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJlc3VsdC5yZXN1bHRzXyA9IHJlc3VsdHNfOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdC5yZXN1bHRzXyA9IHJlc3VsdHNCdWlsZGVyXy5idWlsZCgpOw0KICAgICAgICB9DQogICAgICAgIHJlc3VsdC5oYXZlRXJyb3JzXyA9IGhhdmVFcnJvcnNfOw0KICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxkMF87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlKSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSlvdGhlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0QmF0Y2hJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGJhdGNoSURfID0gb3RoZXIuYmF0Y2hJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3VsdHNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKCFvdGhlci5yZXN1bHRzXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIGlmIChyZXN1bHRzXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgcmVzdWx0c18gPSBvdGhlci5yZXN1bHRzXzsNCiAgICAgICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgICAgICByZXN1bHRzXy5hZGRBbGwob3RoZXIucmVzdWx0c18pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmICghb3RoZXIucmVzdWx0c18uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBpZiAocmVzdWx0c0J1aWxkZXJfLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICByZXN1bHRzQnVpbGRlcl8uZGlzcG9zZSgpOw0KICAgICAgICAgICAgICByZXN1bHRzQnVpbGRlcl8gPSBudWxsOw0KICAgICAgICAgICAgICByZXN1bHRzXyA9IG90aGVyLnJlc3VsdHNfOw0KICAgICAgICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7DQogICAgICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXyA9IA0KICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMgPw0KICAgICAgICAgICAgICAgICAgIGdldFJlc3VsdHNGaWVsZEJ1aWxkZXIoKSA6IG51bGw7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICByZXN1bHRzQnVpbGRlcl8uYWRkQWxsTWVzc2FnZXMob3RoZXIucmVzdWx0c18pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0SGF2ZUVycm9ycygpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0SGF2ZUVycm9ycyhvdGhlci5nZXRIYXZlRXJyb3JzKCkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGJhdGNoSURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEJhdGNoSUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gYmF0Y2hJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGJhdGNoSURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQmF0Y2hJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0QmF0Y2hJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGJhdGNoSURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGJhdGNoSURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJhdGNoSUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBiYXRjaElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQmF0Y2hJRCgpIHsNCiAgICAgICAgDQogICAgICAgIGJhdGNoSURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0QmF0Y2hJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBCYXRjaElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJhdGNoSURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgYmF0Y2hJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEudXRpbC5MaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4gcmVzdWx0c18gPQ0KICAgICAgICBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7DQogICAgICBwcml2YXRlIHZvaWQgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpIHsNCiAgICAgICAgaWYgKCEoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgIHJlc3VsdHNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PihyZXN1bHRzXyk7DQogICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOw0KICAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5CdWlsZGVyLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRPckJ1aWxkZXI+IHJlc3VsdHNCdWlsZGVyXzsNCg0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiBnZXRSZXN1bHRzTGlzdCgpIHsNCiAgICAgICAgaWYgKHJlc3VsdHNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdHNfKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gcmVzdWx0c0J1aWxkZXJfLmdldE1lc3NhZ2VMaXN0KCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGludCBnZXRSZXN1bHRzQ291bnQoKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiByZXN1bHRzXy5zaXplKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIHJlc3VsdHNCdWlsZGVyXy5nZXRDb3VudCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgZ2V0UmVzdWx0cyhpbnQgaW5kZXgpIHsNCiAgICAgICAgaWYgKHJlc3VsdHNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIHJlc3VsdHNfLmdldChpbmRleCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIHJlc3VsdHNCdWlsZGVyXy5nZXRNZXNzYWdlKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXN1bHRzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHZhbHVlKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgIHJlc3VsdHNfLnNldChpbmRleCwgdmFsdWUpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXy5zZXRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlc3VsdHMoDQogICAgICAgICAgaW50IGluZGV4LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKHJlc3VsdHNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgIHJlc3VsdHNfLnNldChpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXy5zZXRNZXNzYWdlKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlc3VsdHMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHZhbHVlKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgIHJlc3VsdHNfLmFkZCh2YWx1ZSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0c0J1aWxkZXJfLmFkZE1lc3NhZ2UodmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXN1bHRzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHZhbHVlKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgIHJlc3VsdHNfLmFkZChpbmRleCwgdmFsdWUpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlc3VsdHMoDQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZVJlc3VsdHNJc011dGFibGUoKTsNCiAgICAgICAgICByZXN1bHRzXy5hZGQoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXy5hZGRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVzdWx0cygNCiAgICAgICAgICBpbnQgaW5kZXgsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgew0KICAgICAgICBpZiAocmVzdWx0c0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBlbnN1cmVSZXN1bHRzSXNNdXRhYmxlKCk7DQogICAgICAgICAgcmVzdWx0c18uYWRkKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0c0J1aWxkZXJfLmFkZE1lc3NhZ2UoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkQWxsUmVzdWx0cygNCiAgICAgICAgICBqYXZhLmxhbmcuSXRlcmFibGU8PyBleHRlbmRzIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4gdmFsdWVzKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZVJlc3VsdHNJc011dGFibGUoKTsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0TWVzc2FnZUxpdGUuQnVpbGRlci5hZGRBbGwoDQogICAgICAgICAgICAgIHZhbHVlcywgcmVzdWx0c18pOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlc3VsdHNCdWlsZGVyXy5hZGRBbGxNZXNzYWdlcyh2YWx1ZXMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlc3VsdHMoKSB7DQogICAgICAgIGlmIChyZXN1bHRzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJlc3VsdHNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHRzQnVpbGRlcl8uY2xlYXIoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgcmVtb3ZlUmVzdWx0cyhpbnQgaW5kZXgpIHsNCiAgICAgICAgaWYgKHJlc3VsdHNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlUmVzdWx0c0lzTXV0YWJsZSgpOw0KICAgICAgICAgIHJlc3VsdHNfLnJlbW92ZShpbmRleCk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0c0J1aWxkZXJfLnJlbW92ZShpbmRleCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuQnVpbGRlciBnZXRSZXN1bHRzQnVpbGRlcigNCiAgICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGdldFJlc3VsdHNGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKGluZGV4KTsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IFJlc3VsdHMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdE9yQnVpbGRlciBnZXRSZXN1bHRzT3JCdWlsZGVyKA0KICAgICAgICAgIGludCBpbmRleCkgew0KICAgICAgICBpZiAocmVzdWx0c0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gcmVzdWx0c18uZ2V0KGluZGV4KTsgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIHJlc3VsdHNCdWlsZGVyXy5nZXRNZXNzYWdlT3JCdWlsZGVyKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8PyBleHRlbmRzIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdE9yQnVpbGRlcj4gDQogICAgICAgICAgIGdldFJlc3VsdHNPckJ1aWxkZXJMaXN0KCkgew0KICAgICAgICBpZiAocmVzdWx0c0J1aWxkZXJfICE9IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gcmVzdWx0c0J1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXJMaXN0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdHNfKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LkJ1aWxkZXIgYWRkUmVzdWx0c0J1aWxkZXIoKSB7DQogICAgICAgIHJldHVybiBnZXRSZXN1bHRzRmllbGRCdWlsZGVyKCkuYWRkQnVpbGRlcigNCiAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuQnVpbGRlciBhZGRSZXN1bHRzQnVpbGRlcigNCiAgICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGdldFJlc3VsdHNGaWVsZEJ1aWxkZXIoKS5hZGRCdWlsZGVyKA0KICAgICAgICAgICAgaW5kZXgsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBSZXN1bHRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuQnVpbGRlcj4gDQogICAgICAgICAgIGdldFJlc3VsdHNCdWlsZGVyTGlzdCgpIHsNCiAgICAgICAgcmV0dXJuIGdldFJlc3VsdHNGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyTGlzdCgpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVyVjM8DQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0T3JCdWlsZGVyPiANCiAgICAgICAgICBnZXRSZXN1bHRzRmllbGRCdWlsZGVyKCkgew0KICAgICAgICBpZiAocmVzdWx0c0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXN1bHRzQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5CdWlsZGVyLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRPckJ1aWxkZXI+KA0KICAgICAgICAgICAgICAgICAgcmVzdWx0c18sDQogICAgICAgICAgICAgICAgICAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSwNCiAgICAgICAgICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksDQogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOw0KICAgICAgICAgIHJlc3VsdHNfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0c0J1aWxkZXJfOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGJvb2xlYW4gaGF2ZUVycm9yc18gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIEhhdmVFcnJvcnMgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gZ2V0SGF2ZUVycm9ycygpIHsNCiAgICAgICAgcmV0dXJuIGhhdmVFcnJvcnNfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIEhhdmVFcnJvcnMgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0SGF2ZUVycm9ycyhib29sZWFuIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBoYXZlRXJyb3JzXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgSGF2ZUVycm9ycyA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckhhdmVFcnJvcnMoKSB7DQogICAgICAgIA0KICAgICAgICBoYXZlRXJyb3JzXyA9IGZhbHNlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlKQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPigpIHsNCiAgICAgIHB1YmxpYyBRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcykNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBUaW1lc3RhbXAgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBsb25nIGdldFRpbWVzdGFtcCgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+dWludDY0IFNlcXVlbmNlID0gMjs8L2NvZGU+DQogICAgICovDQogICAgbG9uZyBnZXRTZXF1ZW5jZSgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ENU9mQm9keSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0TUQ1T2ZCb2R5KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ENU9mQm9keSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNRDVPZkJvZHlCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgUmVjZWl2ZUNvdW50ID0gNDs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFJlY2VpdmVDb3VudCgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBSZVJvdXRlZCA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gZ2V0UmVSb3V0ZWQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZVJvdXRlZEZyb21RdWV1ZSA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVSb3V0ZWRGcm9tUXVldWUoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVSb3V0ZWRGcm9tUXVldWUgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVSb3V0ZWRGcm9tUXVldWVCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50NjQgRXhwaXJhdGlvbkF0ID0gNzs8L2NvZGU+DQogICAgICovDQogICAgbG9uZyBnZXRFeHBpcmF0aW9uQXQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IERlbGF5ZWRUbyA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIGxvbmcgZ2V0RGVsYXllZFRvKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzfQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUXVldWVNZXNzYWdlQXR0cmlidXRlcyBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKQ0KICAgICAgUXVldWVNZXNzYWdlQXR0cmlidXRlc09yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUXVldWVNZXNzYWdlQXR0cmlidXRlcygpIHsNCiAgICAgIHRpbWVzdGFtcF8gPSAwTDsNCiAgICAgIHNlcXVlbmNlXyA9IDBMOw0KICAgICAgbUQ1T2ZCb2R5XyA9ICIiOw0KICAgICAgcmVjZWl2ZUNvdW50XyA9IDA7DQogICAgICByZVJvdXRlZF8gPSBmYWxzZTsNCiAgICAgIHJlUm91dGVkRnJvbVF1ZXVlXyA9ICIiOw0KICAgICAgZXhwaXJhdGlvbkF0XyA9IDBMOw0KICAgICAgZGVsYXllZFRvXyA9IDBMOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA4OiB7DQoNCiAgICAgICAgICAgICAgdGltZXN0YW1wXyA9IGlucHV0LnJlYWRJbnQ2NCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTY6IHsNCg0KICAgICAgICAgICAgICBzZXF1ZW5jZV8gPSBpbnB1dC5yZWFkVUludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAyNjogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBtRDVPZkJvZHlfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDMyOiB7DQoNCiAgICAgICAgICAgICAgcmVjZWl2ZUNvdW50XyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDA6IHsNCg0KICAgICAgICAgICAgICByZVJvdXRlZF8gPSBpbnB1dC5yZWFkQm9vbCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTA6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgcmVSb3V0ZWRGcm9tUXVldWVfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDU2OiB7DQoNCiAgICAgICAgICAgICAgZXhwaXJhdGlvbkF0XyA9IGlucHV0LnJlYWRJbnQ2NCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNjQ6IHsNCg0KICAgICAgICAgICAgICBkZWxheWVkVG9fID0gaW5wdXQucmVhZEludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzX2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVElNRVNUQU1QX0ZJRUxEX05VTUJFUiA9IDE7DQogICAgcHJpdmF0ZSBsb25nIHRpbWVzdGFtcF87DQogICAgLyoqDQogICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGxvbmcgZ2V0VGltZXN0YW1wKCkgew0KICAgICAgcmV0dXJuIHRpbWVzdGFtcF87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU0VRVUVOQ0VfRklFTERfTlVNQkVSID0gMjsNCiAgICBwcml2YXRlIGxvbmcgc2VxdWVuY2VfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnVpbnQ2NCBTZXF1ZW5jZSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBsb25nIGdldFNlcXVlbmNlKCkgew0KICAgICAgcmV0dXJuIHNlcXVlbmNlXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRDVPRkJPRFlfRklFTERfTlVNQkVSID0gMzsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgbUQ1T2ZCb2R5XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTUQ1T2ZCb2R5ID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TUQ1T2ZCb2R5KCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtRDVPZkJvZHlfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIG1ENU9mQm9keV8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1ENU9mQm9keSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TUQ1T2ZCb2R5Qnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ENU9mQm9keV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgbUQ1T2ZCb2R5XyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRUNFSVZFQ09VTlRfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGludCByZWNlaXZlQ291bnRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIFJlY2VpdmVDb3VudCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0UmVjZWl2ZUNvdW50KCkgew0KICAgICAgcmV0dXJuIHJlY2VpdmVDb3VudF87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVST1VURURfRklFTERfTlVNQkVSID0gNTsNCiAgICBwcml2YXRlIGJvb2xlYW4gcmVSb3V0ZWRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgUmVSb3V0ZWQgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZVJvdXRlZCgpIHsNCiAgICAgIHJldHVybiByZVJvdXRlZF87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVST1VURURGUk9NUVVFVUVfRklFTERfTlVNQkVSID0gNjsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgcmVSb3V0ZWRGcm9tUXVldWVfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZVJvdXRlZEZyb21RdWV1ZSA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlUm91dGVkRnJvbVF1ZXVlKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZVJvdXRlZEZyb21RdWV1ZV87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgcmVSb3V0ZWRGcm9tUXVldWVfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZVJvdXRlZEZyb21RdWV1ZSA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVSb3V0ZWRGcm9tUXVldWVCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVSb3V0ZWRGcm9tUXVldWVfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIHJlUm91dGVkRnJvbVF1ZXVlXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFWFBJUkFUSU9OQVRfRklFTERfTlVNQkVSID0gNzsNCiAgICBwcml2YXRlIGxvbmcgZXhwaXJhdGlvbkF0XzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBFeHBpcmF0aW9uQXQgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRFeHBpcmF0aW9uQXQoKSB7DQogICAgICByZXR1cm4gZXhwaXJhdGlvbkF0XzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBERUxBWUVEVE9fRklFTERfTlVNQkVSID0gODsNCiAgICBwcml2YXRlIGxvbmcgZGVsYXllZFRvXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBEZWxheWVkVG8gPSA4OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXREZWxheWVkVG8oKSB7DQogICAgICByZXR1cm4gZGVsYXllZFRvXzsNCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICh0aW1lc3RhbXBfICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDY0KDEsIHRpbWVzdGFtcF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlcXVlbmNlXyAhPSAwTCkgew0KICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMiwgc2VxdWVuY2VfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TUQ1T2ZCb2R5Qnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAzLCBtRDVPZkJvZHlfKTsNCiAgICAgIH0NCiAgICAgIGlmIChyZWNlaXZlQ291bnRfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoNCwgcmVjZWl2ZUNvdW50Xyk7DQogICAgICB9DQogICAgICBpZiAocmVSb3V0ZWRfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woNSwgcmVSb3V0ZWRfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0UmVSb3V0ZWRGcm9tUXVldWVCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDYsIHJlUm91dGVkRnJvbVF1ZXVlXyk7DQogICAgICB9DQogICAgICBpZiAoZXhwaXJhdGlvbkF0XyAhPSAwTCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQ2NCg3LCBleHBpcmF0aW9uQXRfKTsNCiAgICAgIH0NCiAgICAgIGlmIChkZWxheWVkVG9fICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDY0KDgsIGRlbGF5ZWRUb18pOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmICh0aW1lc3RhbXBfICE9IDBMKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDEsIHRpbWVzdGFtcF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlcXVlbmNlXyAhPSAwTCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUoMiwgc2VxdWVuY2VfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0TUQ1T2ZCb2R5Qnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgzLCBtRDVPZkJvZHlfKTsNCiAgICAgIH0NCiAgICAgIGlmIChyZWNlaXZlQ291bnRfICE9IDApIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoNCwgcmVjZWl2ZUNvdW50Xyk7DQogICAgICB9DQogICAgICBpZiAocmVSb3V0ZWRfICE9IGZhbHNlKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQm9vbFNpemUoNSwgcmVSb3V0ZWRfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0UmVSb3V0ZWRGcm9tUXVldWVCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDYsIHJlUm91dGVkRnJvbVF1ZXVlXyk7DQogICAgICB9DQogICAgICBpZiAoZXhwaXJhdGlvbkF0XyAhPSAwTCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDY0U2l6ZSg3LCBleHBpcmF0aW9uQXRfKTsNCiAgICAgIH0NCiAgICAgIGlmIChkZWxheWVkVG9fICE9IDBMKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDgsIGRlbGF5ZWRUb18pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRUaW1lc3RhbXAoKQ0KICAgICAgICAgID09IG90aGVyLmdldFRpbWVzdGFtcCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0U2VxdWVuY2UoKQ0KICAgICAgICAgID09IG90aGVyLmdldFNlcXVlbmNlKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1ENU9mQm9keSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNRDVPZkJvZHkoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFJlY2VpdmVDb3VudCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0UmVjZWl2ZUNvdW50KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRSZVJvdXRlZCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0UmVSb3V0ZWQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVSb3V0ZWRGcm9tUXVldWUoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0UmVSb3V0ZWRGcm9tUXVldWUoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldEV4cGlyYXRpb25BdCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0RXhwaXJhdGlvbkF0KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXREZWxheWVkVG8oKQ0KICAgICAgICAgID09IG90aGVyLmdldERlbGF5ZWRUbygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgVElNRVNUQU1QX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0VGltZXN0YW1wKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgU0VRVUVOQ0VfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoTG9uZygNCiAgICAgICAgICBnZXRTZXF1ZW5jZSgpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1ENU9GQk9EWV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNRDVPZkJvZHkoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVDRUlWRUNPVU5UX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlY2VpdmVDb3VudCgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVST1VURURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRSZVJvdXRlZCgpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFJFUk9VVEVERlJPTVFVRVVFX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlUm91dGVkRnJvbVF1ZXVlKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEVYUElSQVRJT05BVF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hMb25nKA0KICAgICAgICAgIGdldEV4cGlyYXRpb25BdCgpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIERFTEFZRURUT19GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hMb25nKA0KICAgICAgICAgIGdldERlbGF5ZWRUbygpKTsNCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlc30NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcykNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzT3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzX2ZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMubmV3QnVpbGRlcigpDQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICAgIHN1cGVyKHBhcmVudCk7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgew0KICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAgICAgICAuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgew0KICAgICAgICB9DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsNCiAgICAgICAgc3VwZXIuY2xlYXIoKTsNCiAgICAgICAgdGltZXN0YW1wXyA9IDBMOw0KDQogICAgICAgIHNlcXVlbmNlXyA9IDBMOw0KDQogICAgICAgIG1ENU9mQm9keV8gPSAiIjsNCg0KICAgICAgICByZWNlaXZlQ291bnRfID0gMDsNCg0KICAgICAgICByZVJvdXRlZF8gPSBmYWxzZTsNCg0KICAgICAgICByZVJvdXRlZEZyb21RdWV1ZV8gPSAiIjsNCg0KICAgICAgICBleHBpcmF0aW9uQXRfID0gMEw7DQoNCiAgICAgICAgZGVsYXllZFRvXyA9IDBMOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgYnVpbGQoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHJlc3VsdCA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXModGhpcyk7DQogICAgICAgIHJlc3VsdC50aW1lc3RhbXBfID0gdGltZXN0YW1wXzsNCiAgICAgICAgcmVzdWx0LnNlcXVlbmNlXyA9IHNlcXVlbmNlXzsNCiAgICAgICAgcmVzdWx0Lm1ENU9mQm9keV8gPSBtRDVPZkJvZHlfOw0KICAgICAgICByZXN1bHQucmVjZWl2ZUNvdW50XyA9IHJlY2VpdmVDb3VudF87DQogICAgICAgIHJlc3VsdC5yZVJvdXRlZF8gPSByZVJvdXRlZF87DQogICAgICAgIHJlc3VsdC5yZVJvdXRlZEZyb21RdWV1ZV8gPSByZVJvdXRlZEZyb21RdWV1ZV87DQogICAgICAgIHJlc3VsdC5leHBpcmF0aW9uQXRfID0gZXhwaXJhdGlvbkF0XzsNCiAgICAgICAgcmVzdWx0LmRlbGF5ZWRUb18gPSBkZWxheWVkVG9fOw0KICAgICAgICBvbkJ1aWx0KCk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsb25lKCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0RmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhckZpZWxkKGZpZWxkKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyT25lb2YoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5PbmVvZkRlc2NyaXB0b3Igb25lb2YpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhck9uZW9mKG9uZW9mKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgaW50IGluZGV4LCBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0UmVwZWF0ZWRGaWVsZChmaWVsZCwgaW5kZXgsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmFkZFJlcGVhdGVkRmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcy5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmIChvdGhlci5nZXRUaW1lc3RhbXAoKSAhPSAwTCkgew0KICAgICAgICAgIHNldFRpbWVzdGFtcChvdGhlci5nZXRUaW1lc3RhbXAoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldFNlcXVlbmNlKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRTZXF1ZW5jZShvdGhlci5nZXRTZXF1ZW5jZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldE1ENU9mQm9keSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIG1ENU9mQm9keV8gPSBvdGhlci5tRDVPZkJvZHlfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRSZWNlaXZlQ291bnQoKSAhPSAwKSB7DQogICAgICAgICAgc2V0UmVjZWl2ZUNvdW50KG90aGVyLmdldFJlY2VpdmVDb3VudCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0UmVSb3V0ZWQoKSAhPSBmYWxzZSkgew0KICAgICAgICAgIHNldFJlUm91dGVkKG90aGVyLmdldFJlUm91dGVkKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVSb3V0ZWRGcm9tUXVldWUoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICByZVJvdXRlZEZyb21RdWV1ZV8gPSBvdGhlci5yZVJvdXRlZEZyb21RdWV1ZV87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldEV4cGlyYXRpb25BdCgpICE9IDBMKSB7DQogICAgICAgICAgc2V0RXhwaXJhdGlvbkF0KG90aGVyLmdldEV4cGlyYXRpb25BdCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0RGVsYXllZFRvKCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXREZWxheWVkVG8ob3RoZXIuZ2V0RGVsYXllZFRvKCkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMpIGUuZ2V0VW5maW5pc2hlZE1lc3NhZ2UoKTsNCiAgICAgICAgICB0aHJvdyBlLnVud3JhcElPRXhjZXB0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgaWYgKHBhcnNlZE1lc3NhZ2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgbWVyZ2VGcm9tKHBhcnNlZE1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHRpbWVzdGFtcF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBUaW1lc3RhbXAgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0VGltZXN0YW1wKCkgew0KICAgICAgICByZXR1cm4gdGltZXN0YW1wXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFRpbWVzdGFtcChsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB0aW1lc3RhbXBfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgVGltZXN0YW1wID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVGltZXN0YW1wKCkgew0KICAgICAgICANCiAgICAgICAgdGltZXN0YW1wXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBzZXF1ZW5jZV8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0U2VxdWVuY2UoKSB7DQogICAgICAgIHJldHVybiBzZXF1ZW5jZV87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBTZXF1ZW5jZSA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTZXF1ZW5jZShsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBzZXF1ZW5jZV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT51aW50NjQgU2VxdWVuY2UgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTZXF1ZW5jZSgpIHsNCiAgICAgICAgDQogICAgICAgIHNlcXVlbmNlXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtRDVPZkJvZHlfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNRDVPZkJvZHkgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0TUQ1T2ZCb2R5KCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ENU9mQm9keV87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIG1ENU9mQm9keV8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNRDVPZkJvZHkgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldE1ENU9mQm9keUJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1ENU9mQm9keV87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgbUQ1T2ZCb2R5XyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTUQ1T2ZCb2R5ID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1ENU9mQm9keSgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIG1ENU9mQm9keV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTUQ1T2ZCb2R5ID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTUQ1T2ZCb2R5KCkgew0KICAgICAgICANCiAgICAgICAgbUQ1T2ZCb2R5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldE1ENU9mQm9keSgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNRDVPZkJvZHkgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TUQ1T2ZCb2R5Qnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIG1ENU9mQm9keV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGludCByZWNlaXZlQ291bnRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgUmVjZWl2ZUNvdW50ID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0UmVjZWl2ZUNvdW50KCkgew0KICAgICAgICByZXR1cm4gcmVjZWl2ZUNvdW50XzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgUmVjZWl2ZUNvdW50ID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlY2VpdmVDb3VudChpbnQgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIHJlY2VpdmVDb3VudF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBSZWNlaXZlQ291bnQgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZWNlaXZlQ291bnQoKSB7DQogICAgICAgIA0KICAgICAgICByZWNlaXZlQ291bnRfID0gMDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGJvb2xlYW4gcmVSb3V0ZWRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBSZVJvdXRlZCA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZVJvdXRlZCgpIHsNCiAgICAgICAgcmV0dXJuIHJlUm91dGVkXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBSZVJvdXRlZCA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZVJvdXRlZChib29sZWFuIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICByZVJvdXRlZF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIFJlUm91dGVkID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUmVSb3V0ZWQoKSB7DQogICAgICAgIA0KICAgICAgICByZVJvdXRlZF8gPSBmYWxzZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgcmVSb3V0ZWRGcm9tUXVldWVfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZVJvdXRlZEZyb21RdWV1ZSA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZVJvdXRlZEZyb21RdWV1ZSgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZVJvdXRlZEZyb21RdWV1ZV87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIHJlUm91dGVkRnJvbVF1ZXVlXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlUm91dGVkRnJvbVF1ZXVlID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRSZVJvdXRlZEZyb21RdWV1ZUJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlUm91dGVkRnJvbVF1ZXVlXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICByZVJvdXRlZEZyb21RdWV1ZV8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlUm91dGVkRnJvbVF1ZXVlID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlUm91dGVkRnJvbVF1ZXVlKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgcmVSb3V0ZWRGcm9tUXVldWVfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlUm91dGVkRnJvbVF1ZXVlID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUmVSb3V0ZWRGcm9tUXVldWUoKSB7DQogICAgICAgIA0KICAgICAgICByZVJvdXRlZEZyb21RdWV1ZV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRSZVJvdXRlZEZyb21RdWV1ZSgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZVJvdXRlZEZyb21RdWV1ZSA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZVJvdXRlZEZyb21RdWV1ZUJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICByZVJvdXRlZEZyb21RdWV1ZV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGxvbmcgZXhwaXJhdGlvbkF0XyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDY0IEV4cGlyYXRpb25BdCA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgbG9uZyBnZXRFeHBpcmF0aW9uQXQoKSB7DQogICAgICAgIHJldHVybiBleHBpcmF0aW9uQXRfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBFeHBpcmF0aW9uQXQgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXhwaXJhdGlvbkF0KGxvbmcgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIGV4cGlyYXRpb25BdF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBFeHBpcmF0aW9uQXQgPSA3OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFeHBpcmF0aW9uQXQoKSB7DQogICAgICAgIA0KICAgICAgICBleHBpcmF0aW9uQXRfID0gMEw7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIGRlbGF5ZWRUb18gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBEZWxheWVkVG8gPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0RGVsYXllZFRvKCkgew0KICAgICAgICByZXR1cm4gZGVsYXllZFRvXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgRGVsYXllZFRvID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldERlbGF5ZWRUbyhsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBkZWxheWVkVG9fID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgRGVsYXllZFRvID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRGVsYXllZFRvKCkgew0KICAgICAgICANCiAgICAgICAgZGVsYXllZFRvXyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMpDQogICAgfQ0KDQogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOmt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKQ0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcyBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlQXR0cmlidXRlcygpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIGdldERlZmF1bHRJbnN0YW5jZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXM+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXM+KCkgew0KICAgICAgcHVibGljIFF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgcGFyc2VQYXJ0aWFsRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgICAgcmV0dXJuIG5ldyBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlQXR0cmlidXRlcz4gcGFyc2VyKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXM+IGdldFBhcnNlckZvclR5cGUoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZUF0dHJpYnV0ZXMgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBRdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgRXhwaXJhdGlvblNlY29uZHMgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0RXhwaXJhdGlvblNlY29uZHMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIERlbGF5U2Vjb25kcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGludCBnZXREZWxheVNlY29uZHMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIE1heFJlY2VpdmVDb3VudCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGludCBnZXRNYXhSZWNlaXZlQ291bnQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNYXhSZWNlaXZlUXVldWUgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldE1heFJlY2VpdmVRdWV1ZSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNYXhSZWNlaXZlUXVldWUgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0TWF4UmVjZWl2ZVF1ZXVlQnl0ZXMoKTsNCiAgfQ0KICAvKioNCiAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeX0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFF1ZXVlTWVzc2FnZVBvbGljeSBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kpDQogICAgICBRdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgUXVldWVNZXNzYWdlUG9saWN5Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VQb2xpY3koY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjw/PiBidWlsZGVyKSB7DQogICAgICBzdXBlcihidWlsZGVyKTsNCiAgICB9DQogICAgcHJpdmF0ZSBRdWV1ZU1lc3NhZ2VQb2xpY3koKSB7DQogICAgICBleHBpcmF0aW9uU2Vjb25kc18gPSAwOw0KICAgICAgZGVsYXlTZWNvbmRzXyA9IDA7DQogICAgICBtYXhSZWNlaXZlQ291bnRfID0gMDsNCiAgICAgIG1heFJlY2VpdmVRdWV1ZV8gPSAiIjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgUXVldWVNZXNzYWdlUG9saWN5KA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA4OiB7DQoNCiAgICAgICAgICAgICAgZXhwaXJhdGlvblNlY29uZHNfID0gaW5wdXQucmVhZEludDMyKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxNjogew0KDQogICAgICAgICAgICAgIGRlbGF5U2Vjb25kc18gPSBpbnB1dC5yZWFkSW50MzIoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI0OiB7DQoNCiAgICAgICAgICAgICAgbWF4UmVjZWl2ZUNvdW50XyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMzQ6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgbWF4UmVjZWl2ZVF1ZXVlXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VQb2xpY3lfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VQb2xpY3lfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFWFBJUkFUSU9OU0VDT05EU19GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgaW50IGV4cGlyYXRpb25TZWNvbmRzXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBFeHBpcmF0aW9uU2Vjb25kcyA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0RXhwaXJhdGlvblNlY29uZHMoKSB7DQogICAgICByZXR1cm4gZXhwaXJhdGlvblNlY29uZHNfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IERFTEFZU0VDT05EU19GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgaW50IGRlbGF5U2Vjb25kc187DQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgRGVsYXlTZWNvbmRzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXREZWxheVNlY29uZHMoKSB7DQogICAgICByZXR1cm4gZGVsYXlTZWNvbmRzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNQVhSRUNFSVZFQ09VTlRfRklFTERfTlVNQkVSID0gMzsNCiAgICBwcml2YXRlIGludCBtYXhSZWNlaXZlQ291bnRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIE1heFJlY2VpdmVDb3VudCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0TWF4UmVjZWl2ZUNvdW50KCkgew0KICAgICAgcmV0dXJuIG1heFJlY2VpdmVDb3VudF87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUFYUkVDRUlWRVFVRVVFX0ZJRUxEX05VTUJFUiA9IDQ7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IG1heFJlY2VpdmVRdWV1ZV87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIE1heFJlY2VpdmVRdWV1ZSA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1heFJlY2VpdmVRdWV1ZSgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWF4UmVjZWl2ZVF1ZXVlXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBtYXhSZWNlaXZlUXVldWVfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNYXhSZWNlaXZlUXVldWUgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldE1heFJlY2VpdmVRdWV1ZUJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtYXhSZWNlaXZlUXVldWVfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIG1heFJlY2VpdmVRdWV1ZV8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoZXhwaXJhdGlvblNlY29uZHNfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoMSwgZXhwaXJhdGlvblNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIGlmIChkZWxheVNlY29uZHNfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoMiwgZGVsYXlTZWNvbmRzXyk7DQogICAgICB9DQogICAgICBpZiAobWF4UmVjZWl2ZUNvdW50XyAhPSAwKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDMyKDMsIG1heFJlY2VpdmVDb3VudF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRNYXhSZWNlaXZlUXVldWVCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDQsIG1heFJlY2VpdmVRdWV1ZV8pOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmIChleHBpcmF0aW9uU2Vjb25kc18gIT0gMCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSgxLCBleHBpcmF0aW9uU2Vjb25kc18pOw0KICAgICAgfQ0KICAgICAgaWYgKGRlbGF5U2Vjb25kc18gIT0gMCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSgyLCBkZWxheVNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIGlmIChtYXhSZWNlaXZlQ291bnRfICE9IDApIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoMywgbWF4UmVjZWl2ZUNvdW50Xyk7DQogICAgICB9DQogICAgICBpZiAoIWdldE1heFJlY2VpdmVRdWV1ZUJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoNCwgbWF4UmVjZWl2ZVF1ZXVlXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5KSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldEV4cGlyYXRpb25TZWNvbmRzKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXRFeHBpcmF0aW9uU2Vjb25kcygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0RGVsYXlTZWNvbmRzKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXREZWxheVNlY29uZHMoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldE1heFJlY2VpdmVDb3VudCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0TWF4UmVjZWl2ZUNvdW50KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1heFJlY2VpdmVRdWV1ZSgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNYXhSZWNlaXZlUXVldWUoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgdW5rbm93bkZpZWxkcy5lcXVhbHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgew0KICAgICAgaWYgKG1lbW9pemVkSGFzaENvZGUgIT0gMCkgew0KICAgICAgICByZXR1cm4gbWVtb2l6ZWRIYXNoQ29kZTsNCiAgICAgIH0NCiAgICAgIGludCBoYXNoID0gNDE7DQogICAgICBoYXNoID0gKDE5ICogaGFzaCkgKyBnZXREZXNjcmlwdG9yKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIEVYUElSQVRJT05TRUNPTkRTX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldEV4cGlyYXRpb25TZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBERUxBWVNFQ09ORFNfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0RGVsYXlTZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNQVhSRUNFSVZFQ09VTlRfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0TWF4UmVjZWl2ZUNvdW50KCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNQVhSRUNFSVZFUVVFVUVfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0TWF4UmVjZWl2ZVF1ZXVlKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMjkgKiBoYXNoKSArIHVua25vd25GaWVsZHMuaGFzaENvZGUoKTsNCiAgICAgIG1lbW9pemVkSGFzaENvZGUgPSBoYXNoOw0KICAgICAgcmV0dXJuIGhhc2g7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VGcm9tKA0KICAgICAgICBieXRlW10gZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBwYXJzZUZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3l9DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjxCdWlsZGVyPiBpbXBsZW1lbnRzDQogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX2ltcGxlbWVudHM6a3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSkNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3lPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZVBvbGljeV9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlUG9saWN5X2ZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5LkJ1aWxkZXIuY2xhc3MpOw0KICAgICAgfQ0KDQogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kubmV3QnVpbGRlcigpDQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICAgIHN1cGVyKHBhcmVudCk7DQogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsNCiAgICAgIH0NCiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgew0KICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAgICAgICAuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgew0KICAgICAgICB9DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsNCiAgICAgICAgc3VwZXIuY2xlYXIoKTsNCiAgICAgICAgZXhwaXJhdGlvblNlY29uZHNfID0gMDsNCg0KICAgICAgICBkZWxheVNlY29uZHNfID0gMDsNCg0KICAgICAgICBtYXhSZWNlaXZlQ291bnRfID0gMDsNCg0KICAgICAgICBtYXhSZWNlaXZlUXVldWVfID0gIiI7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VQb2xpY3lfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeS5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kodGhpcyk7DQogICAgICAgIHJlc3VsdC5leHBpcmF0aW9uU2Vjb25kc18gPSBleHBpcmF0aW9uU2Vjb25kc187DQogICAgICAgIHJlc3VsdC5kZWxheVNlY29uZHNfID0gZGVsYXlTZWNvbmRzXzsNCiAgICAgICAgcmVzdWx0Lm1heFJlY2VpdmVDb3VudF8gPSBtYXhSZWNlaXZlQ291bnRfOw0KICAgICAgICByZXN1bHQubWF4UmVjZWl2ZVF1ZXVlXyA9IG1heFJlY2VpdmVRdWV1ZV87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5KW90aGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOw0KICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAob3RoZXIuZ2V0RXhwaXJhdGlvblNlY29uZHMoKSAhPSAwKSB7DQogICAgICAgICAgc2V0RXhwaXJhdGlvblNlY29uZHMob3RoZXIuZ2V0RXhwaXJhdGlvblNlY29uZHMoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldERlbGF5U2Vjb25kcygpICE9IDApIHsNCiAgICAgICAgICBzZXREZWxheVNlY29uZHMob3RoZXIuZ2V0RGVsYXlTZWNvbmRzKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRNYXhSZWNlaXZlQ291bnQoKSAhPSAwKSB7DQogICAgICAgICAgc2V0TWF4UmVjZWl2ZUNvdW50KG90aGVyLmdldE1heFJlY2VpdmVDb3VudCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldE1heFJlY2VpdmVRdWV1ZSgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIG1heFJlY2VpdmVRdWV1ZV8gPSBvdGhlci5tYXhSZWNlaXZlUXVldWVfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5KSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IGV4cGlyYXRpb25TZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIEV4cGlyYXRpb25TZWNvbmRzID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0RXhwaXJhdGlvblNlY29uZHMoKSB7DQogICAgICAgIHJldHVybiBleHBpcmF0aW9uU2Vjb25kc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIEV4cGlyYXRpb25TZWNvbmRzID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEV4cGlyYXRpb25TZWNvbmRzKGludCB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgZXhwaXJhdGlvblNlY29uZHNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgRXhwaXJhdGlvblNlY29uZHMgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFeHBpcmF0aW9uU2Vjb25kcygpIHsNCiAgICAgICAgDQogICAgICAgIGV4cGlyYXRpb25TZWNvbmRzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgZGVsYXlTZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIERlbGF5U2Vjb25kcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldERlbGF5U2Vjb25kcygpIHsNCiAgICAgICAgcmV0dXJuIGRlbGF5U2Vjb25kc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIERlbGF5U2Vjb25kcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXREZWxheVNlY29uZHMoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBkZWxheVNlY29uZHNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgRGVsYXlTZWNvbmRzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRGVsYXlTZWNvbmRzKCkgew0KICAgICAgICANCiAgICAgICAgZGVsYXlTZWNvbmRzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgbWF4UmVjZWl2ZUNvdW50XyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIE1heFJlY2VpdmVDb3VudCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldE1heFJlY2VpdmVDb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIG1heFJlY2VpdmVDb3VudF87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIE1heFJlY2VpdmVDb3VudCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNYXhSZWNlaXZlQ291bnQoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBtYXhSZWNlaXZlQ291bnRfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWF4UmVjZWl2ZUNvdW50ID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWF4UmVjZWl2ZUNvdW50KCkgew0KICAgICAgICANCiAgICAgICAgbWF4UmVjZWl2ZUNvdW50XyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IG1heFJlY2VpdmVRdWV1ZV8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1heFJlY2VpdmVRdWV1ZSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRNYXhSZWNlaXZlUXVldWUoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWF4UmVjZWl2ZVF1ZXVlXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgbWF4UmVjZWl2ZVF1ZXVlXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1heFJlY2VpdmVRdWV1ZSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0TWF4UmVjZWl2ZVF1ZXVlQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWF4UmVjZWl2ZVF1ZXVlXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBtYXhSZWNlaXZlUXVldWVfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNYXhSZWNlaXZlUXVldWUgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWF4UmVjZWl2ZVF1ZXVlKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgbWF4UmVjZWl2ZVF1ZXVlXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBNYXhSZWNlaXZlUXVldWUgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNYXhSZWNlaXZlUXVldWUoKSB7DQogICAgICAgIA0KICAgICAgICBtYXhSZWNlaXZlUXVldWVfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0TWF4UmVjZWl2ZVF1ZXVlKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1heFJlY2VpdmVRdWV1ZSA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNYXhSZWNlaXZlUXVldWVCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgbWF4UmVjZWl2ZVF1ZXVlXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZVBvbGljeSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxRdWV1ZU1lc3NhZ2VQb2xpY3k+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFF1ZXVlTWVzc2FnZVBvbGljeT4oKSB7DQogICAgICBwdWJsaWMgUXVldWVNZXNzYWdlUG9saWN5IHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgUXVldWVNZXNzYWdlUG9saWN5KGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlUG9saWN5PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UXVldWVNZXNzYWdlUG9saWN5PiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VQb2xpY3kgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBTZW5kUXVldWVNZXNzYWdlUmVzdWx0T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRNZXNzYWdlSUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldE1lc3NhZ2VJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQ2NCBTZW50QXQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBsb25nIGdldFNlbnRBdCgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50NjQgRXhwaXJhdGlvbkF0ID0gMzs8L2NvZGU+DQogICAgICovDQogICAgbG9uZyBnZXRFeHBpcmF0aW9uQXQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IERlbGF5ZWRUbyA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGxvbmcgZ2V0RGVsYXllZFRvKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGdldElzRXJyb3IoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0RXJyb3IoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0RXJyb3JCeXRlcygpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdH0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgZXh0ZW5kcw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMgaW1wbGVtZW50cw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KG1lc3NhZ2VfaW1wbGVtZW50czprdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCkNCiAgICAgIFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0Lg0KICAgIHByaXZhdGUgU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQoKSB7DQogICAgICBtZXNzYWdlSURfID0gIiI7DQogICAgICBzZW50QXRfID0gMEw7DQogICAgICBleHBpcmF0aW9uQXRfID0gMEw7DQogICAgICBkZWxheWVkVG9fID0gMEw7DQogICAgICBpc0Vycm9yXyA9IGZhbHNlOw0KICAgICAgZXJyb3JfID0gIiI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldA0KICAgIGdldFVua25vd25GaWVsZHMoKSB7DQogICAgICByZXR1cm4gdGhpcy51bmtub3duRmllbGRzOw0KICAgIH0NCiAgICBwcml2YXRlIFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIG1lc3NhZ2VJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTY6IHsNCg0KICAgICAgICAgICAgICBzZW50QXRfID0gaW5wdXQucmVhZEludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAyNDogew0KDQogICAgICAgICAgICAgIGV4cGlyYXRpb25BdF8gPSBpbnB1dC5yZWFkSW50NjQoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDMyOiB7DQoNCiAgICAgICAgICAgICAgZGVsYXllZFRvXyA9IGlucHV0LnJlYWRJbnQ2NCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDA6IHsNCg0KICAgICAgICAgICAgICBpc0Vycm9yXyA9IGlucHV0LnJlYWRCb29sKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA1MDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICBlcnJvcl8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgZS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gY2F0Y2ggKGphdmEuaW8uSU9FeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oDQogICAgICAgICAgICBlKS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMudW5rbm93bkZpZWxkcyA9IHVua25vd25GaWVsZHMuYnVpbGQoKTsNCiAgICAgICAgbWFrZUV4dGVuc2lvbnNJbW11dGFibGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdF9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1NlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1FU1NBR0VJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBtZXNzYWdlSURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBNZXNzYWdlSUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRNZXNzYWdlSUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgbWVzc2FnZUlEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRNZXNzYWdlSURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbWVzc2FnZUlEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBtZXNzYWdlSURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNFTlRBVF9GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgbG9uZyBzZW50QXRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IFNlbnRBdCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBsb25nIGdldFNlbnRBdCgpIHsNCiAgICAgIHJldHVybiBzZW50QXRfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVYUElSQVRJT05BVF9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgbG9uZyBleHBpcmF0aW9uQXRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IEV4cGlyYXRpb25BdCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBsb25nIGdldEV4cGlyYXRpb25BdCgpIHsNCiAgICAgIHJldHVybiBleHBpcmF0aW9uQXRfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IERFTEFZRURUT19GSUVMRF9OVU1CRVIgPSA0Ow0KICAgIHByaXZhdGUgbG9uZyBkZWxheWVkVG9fOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDY0IERlbGF5ZWRUbyA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBsb25nIGdldERlbGF5ZWRUbygpIHsNCiAgICAgIHJldHVybiBkZWxheWVkVG9fOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElTRVJST1JfRklFTERfTlVNQkVSID0gNTsNCiAgICBwcml2YXRlIGJvb2xlYW4gaXNFcnJvcl87DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGJvb2xlYW4gZ2V0SXNFcnJvcigpIHsNCiAgICAgIHJldHVybiBpc0Vycm9yXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFUlJPUl9GSUVMRF9OVU1CRVIgPSA2Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBlcnJvcl87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXJyb3IoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBlcnJvcl8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgZXJyb3JfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKCFnZXRNZXNzYWdlSURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIG1lc3NhZ2VJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHNlbnRBdF8gIT0gMEwpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50NjQoMiwgc2VudEF0Xyk7DQogICAgICB9DQogICAgICBpZiAoZXhwaXJhdGlvbkF0XyAhPSAwTCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQ2NCgzLCBleHBpcmF0aW9uQXRfKTsNCiAgICAgIH0NCiAgICAgIGlmIChkZWxheWVkVG9fICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDY0KDQsIGRlbGF5ZWRUb18pOw0KICAgICAgfQ0KICAgICAgaWYgKGlzRXJyb3JfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woNSwgaXNFcnJvcl8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRFcnJvckJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgNiwgZXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIHVua25vd25GaWVsZHMud3JpdGVUbyhvdXRwdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7DQogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2l6ZTsNCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsNCg0KICAgICAgc2l6ZSA9IDA7DQogICAgICBpZiAoIWdldE1lc3NhZ2VJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgbWVzc2FnZUlEXyk7DQogICAgICB9DQogICAgICBpZiAoc2VudEF0XyAhPSAwTCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDY0U2l6ZSgyLCBzZW50QXRfKTsNCiAgICAgIH0NCiAgICAgIGlmIChleHBpcmF0aW9uQXRfICE9IDBMKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDMsIGV4cGlyYXRpb25BdF8pOw0KICAgICAgfQ0KICAgICAgaWYgKGRlbGF5ZWRUb18gIT0gMEwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQ2NFNpemUoNCwgZGVsYXllZFRvXyk7DQogICAgICB9DQogICAgICBpZiAoaXNFcnJvcl8gIT0gZmFsc2UpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVCb29sU2l6ZSg1LCBpc0Vycm9yXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldEVycm9yQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSg2LCBlcnJvcl8pOw0KICAgICAgfQ0KICAgICAgc2l6ZSArPSB1bmtub3duRmllbGRzLmdldFNlcmlhbGl6ZWRTaXplKCk7DQogICAgICBtZW1vaXplZFNpemUgPSBzaXplOw0KICAgICAgcmV0dXJuIHNpemU7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhmaW5hbCBqYXZhLmxhbmcuT2JqZWN0IG9iaikgew0KICAgICAgaWYgKG9iaiA9PSB0aGlzKSB7DQogICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQpIG9iajsNCg0KICAgICAgYm9vbGVhbiByZXN1bHQgPSB0cnVlOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1lc3NhZ2VJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXNzYWdlSUQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFNlbnRBdCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0U2VudEF0KCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRFeHBpcmF0aW9uQXQoKQ0KICAgICAgICAgID09IG90aGVyLmdldEV4cGlyYXRpb25BdCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0RGVsYXllZFRvKCkNCiAgICAgICAgICA9PSBvdGhlci5nZXREZWxheWVkVG8oKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldElzRXJyb3IoKQ0KICAgICAgICAgID09IG90aGVyLmdldElzRXJyb3IoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0RXJyb3IoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0RXJyb3IoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgdW5rbm93bkZpZWxkcy5lcXVhbHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgew0KICAgICAgaWYgKG1lbW9pemVkSGFzaENvZGUgIT0gMCkgew0KICAgICAgICByZXR1cm4gbWVtb2l6ZWRIYXNoQ29kZTsNCiAgICAgIH0NCiAgICAgIGludCBoYXNoID0gNDE7DQogICAgICBoYXNoID0gKDE5ICogaGFzaCkgKyBnZXREZXNjcmlwdG9yKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FU1NBR0VJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNZXNzYWdlSUQoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgU0VOVEFUX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0U2VudEF0KCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVhQSVJBVElPTkFUX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0RXhwaXJhdGlvbkF0KCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgREVMQVlFRFRPX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0RGVsYXllZFRvKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgSVNFUlJPUl9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hCb29sZWFuKA0KICAgICAgICAgIGdldElzRXJyb3IoKSk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBFUlJPUl9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRFcnJvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHR9DQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjxCdWlsZGVyPiBpbXBsZW1lbnRzDQogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX2ltcGxlbWVudHM6a3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdE9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdF9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LkJ1aWxkZXIuY2xhc3MpOw0KICAgICAgfQ0KDQogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIG1lc3NhZ2VJRF8gPSAiIjsNCg0KICAgICAgICBzZW50QXRfID0gMEw7DQoNCiAgICAgICAgZXhwaXJhdGlvbkF0XyA9IDBMOw0KDQogICAgICAgIGRlbGF5ZWRUb18gPSAwTDsNCg0KICAgICAgICBpc0Vycm9yXyA9IGZhbHNlOw0KDQogICAgICAgIGVycm9yXyA9ICIiOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdF9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgYnVpbGQoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IHJlc3VsdCA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQodGhpcyk7DQogICAgICAgIHJlc3VsdC5tZXNzYWdlSURfID0gbWVzc2FnZUlEXzsNCiAgICAgICAgcmVzdWx0LnNlbnRBdF8gPSBzZW50QXRfOw0KICAgICAgICByZXN1bHQuZXhwaXJhdGlvbkF0XyA9IGV4cGlyYXRpb25BdF87DQogICAgICAgIHJlc3VsdC5kZWxheWVkVG9fID0gZGVsYXllZFRvXzsNCiAgICAgICAgcmVzdWx0LmlzRXJyb3JfID0gaXNFcnJvcl87DQogICAgICAgIHJlc3VsdC5lcnJvcl8gPSBlcnJvcl87DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQpIHsNCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsNCiAgICAgICAgaWYgKCFvdGhlci5nZXRNZXNzYWdlSUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBtZXNzYWdlSURfID0gb3RoZXIubWVzc2FnZUlEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0U2VudEF0KCkgIT0gMEwpIHsNCiAgICAgICAgICBzZXRTZW50QXQob3RoZXIuZ2V0U2VudEF0KCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRFeHBpcmF0aW9uQXQoKSAhPSAwTCkgew0KICAgICAgICAgIHNldEV4cGlyYXRpb25BdChvdGhlci5nZXRFeHBpcmF0aW9uQXQoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldERlbGF5ZWRUbygpICE9IDBMKSB7DQogICAgICAgICAgc2V0RGVsYXllZFRvKG90aGVyLmdldERlbGF5ZWRUbygpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0SXNFcnJvcigpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0SXNFcnJvcihvdGhlci5nZXRJc0Vycm9yKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0RXJyb3IoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBlcnJvcl8gPSBvdGhlci5lcnJvcl87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgcGFyc2VkTWVzc2FnZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IFBBUlNFUi5wYXJzZVBhcnRpYWxGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgbWVzc2FnZUlEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldE1lc3NhZ2VJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlSURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBtZXNzYWdlSURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRNZXNzYWdlSURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlSURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIG1lc3NhZ2VJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1lc3NhZ2VJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXNzYWdlSUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBtZXNzYWdlSURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIE1lc3NhZ2VJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1lc3NhZ2VJRCgpIHsNCiAgICAgICAgDQogICAgICAgIG1lc3NhZ2VJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRNZXNzYWdlSUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgTWVzc2FnZUlEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBtZXNzYWdlSURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHNlbnRBdF8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBTZW50QXQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGxvbmcgZ2V0U2VudEF0KCkgew0KICAgICAgICByZXR1cm4gc2VudEF0XzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgU2VudEF0ID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNlbnRBdChsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBzZW50QXRfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgU2VudEF0ID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU2VudEF0KCkgew0KICAgICAgICANCiAgICAgICAgc2VudEF0XyA9IDBMOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBleHBpcmF0aW9uQXRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50NjQgRXhwaXJhdGlvbkF0ID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBsb25nIGdldEV4cGlyYXRpb25BdCgpIHsNCiAgICAgICAgcmV0dXJuIGV4cGlyYXRpb25BdF87DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDY0IEV4cGlyYXRpb25BdCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFeHBpcmF0aW9uQXQobG9uZyB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgZXhwaXJhdGlvbkF0XyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDY0IEV4cGlyYXRpb25BdCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckV4cGlyYXRpb25BdCgpIHsNCiAgICAgICAgDQogICAgICAgIGV4cGlyYXRpb25BdF8gPSAwTDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGxvbmcgZGVsYXllZFRvXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDY0IERlbGF5ZWRUbyA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgbG9uZyBnZXREZWxheWVkVG8oKSB7DQogICAgICAgIHJldHVybiBkZWxheWVkVG9fOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBEZWxheWVkVG8gPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RGVsYXllZFRvKGxvbmcgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIGRlbGF5ZWRUb18gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQ2NCBEZWxheWVkVG8gPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJEZWxheWVkVG8oKSB7DQogICAgICAgIA0KICAgICAgICBkZWxheWVkVG9fID0gMEw7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIGlzRXJyb3JfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiBpc0Vycm9yXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldElzRXJyb3IoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJJc0Vycm9yKCkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSBmYWxzZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBlcnJvcl8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXJyb3JfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRXJyb3IoKSB7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRFcnJvcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFcnJvckJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0KQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxTZW5kUXVldWVNZXNzYWdlUmVzdWx0Pg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxTZW5kUXVldWVNZXNzYWdlUmVzdWx0PigpIHsNCiAgICAgIHB1YmxpYyBTZW5kUXVldWVNZXNzYWdlUmVzdWx0IHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdChpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxTZW5kUXVldWVNZXNzYWdlUmVzdWx0PiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0T3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KQ0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcXVlc3RJRCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIE1heE51bWJlck9mTWVzc2FnZXMgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0TWF4TnVtYmVyT2ZNZXNzYWdlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgV2FpdFRpbWVTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFdhaXRUaW1lU2Vjb25kcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBJc1BlYWsgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGdldElzUGVhaygpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0fQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICAgIFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdE9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBSZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCgpIHsNCiAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIGNsaWVudElEXyA9ICIiOw0KICAgICAgY2hhbm5lbF8gPSAiIjsNCiAgICAgIG1heE51bWJlck9mTWVzc2FnZXNfID0gMDsNCiAgICAgIHdhaXRUaW1lU2Vjb25kc18gPSAwOw0KICAgICAgaXNQZWFrXyA9IGZhbHNlOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBSZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTg6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI2OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDMyOiB7DQoNCiAgICAgICAgICAgICAgbWF4TnVtYmVyT2ZNZXNzYWdlc18gPSBpbnB1dC5yZWFkSW50MzIoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQwOiB7DQoNCiAgICAgICAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDg6IHsNCg0KICAgICAgICAgICAgICBpc1BlYWtfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IGUuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKA0KICAgICAgICAgICAgZSkuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLnVua25vd25GaWVsZHMgPSB1bmtub3duRmllbGRzLmJ1aWxkKCk7DQogICAgICAgIG1ha2VFeHRlbnNpb25zSW1tdXRhYmxlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFUVVFU1RJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCByZXF1ZXN0SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMSUVOVElEX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0hBTk5FTF9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBjaGFubmVsXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGNoYW5uZWxfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1BWE5VTUJFUk9GTUVTU0FHRVNfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGludCBtYXhOdW1iZXJPZk1lc3NhZ2VzXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBNYXhOdW1iZXJPZk1lc3NhZ2VzID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRNYXhOdW1iZXJPZk1lc3NhZ2VzKCkgew0KICAgICAgcmV0dXJuIG1heE51bWJlck9mTWVzc2FnZXNfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFdBSVRUSU1FU0VDT05EU19GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgaW50IHdhaXRUaW1lU2Vjb25kc187DQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgV2FpdFRpbWVTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRXYWl0VGltZVNlY29uZHMoKSB7DQogICAgICByZXR1cm4gd2FpdFRpbWVTZWNvbmRzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJU1BFQUtfRklFTERfTlVNQkVSID0gNjsNCiAgICBwcml2YXRlIGJvb2xlYW4gaXNQZWFrXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5ib29sIElzUGVhayA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldElzUGVhaygpIHsNCiAgICAgIHJldHVybiBpc1BlYWtfOw0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDbGllbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMiwgY2xpZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMywgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKG1heE51bWJlck9mTWVzc2FnZXNfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoNCwgbWF4TnVtYmVyT2ZNZXNzYWdlc18pOw0KICAgICAgfQ0KICAgICAgaWYgKHdhaXRUaW1lU2Vjb25kc18gIT0gMCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQzMig1LCB3YWl0VGltZVNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc1BlYWtfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woNiwgaXNQZWFrXyk7DQogICAgICB9DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDbGllbnRJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMiwgY2xpZW50SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMywgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKG1heE51bWJlck9mTWVzc2FnZXNfICE9IDApIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoNCwgbWF4TnVtYmVyT2ZNZXNzYWdlc18pOw0KICAgICAgfQ0KICAgICAgaWYgKHdhaXRUaW1lU2Vjb25kc18gIT0gMCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSg1LCB3YWl0VGltZVNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc1BlYWtfICE9IGZhbHNlKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQm9vbFNpemUoNiwgaXNQZWFrXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVxdWVzdElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcXVlc3RJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDbGllbnRJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDbGllbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDaGFubmVsKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENoYW5uZWwoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldE1heE51bWJlck9mTWVzc2FnZXMoKQ0KICAgICAgICAgID09IG90aGVyLmdldE1heE51bWJlck9mTWVzc2FnZXMoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFdhaXRUaW1lU2Vjb25kcygpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRJc1BlYWsoKQ0KICAgICAgICAgID09IG90aGVyLmdldElzUGVhaygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVRVUVTVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlcXVlc3RJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDTElFTlRJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRDbGllbnRJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBDSEFOTkVMX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENoYW5uZWwoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgTUFYTlVNQkVST0ZNRVNTQUdFU19GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNYXhOdW1iZXJPZk1lc3NhZ2VzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBXQUlUVElNRVNFQ09ORFNfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0V2FpdFRpbWVTZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBJU1BFQUtfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRJc1BlYWsoKSk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbShieXRlW10gZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwcm90b3R5cGUpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOw0KICAgIH0NCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gdGhpcyA9PSBERUZBVUxUX0lOU1RBTkNFDQogICAgICAgICAgPyBuZXcgQnVpbGRlcigpIDogbmV3IEJ1aWxkZXIoKS5tZXJnZUZyb20odGhpcyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsNCiAgICAgIHJldHVybiBidWlsZGVyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0fQ0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8QnVpbGRlcj4gaW1wbGVtZW50cw0KICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9pbXBsZW1lbnRzOmt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0T3JCdWlsZGVyIHsNCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdC5CdWlsZGVyLmNsYXNzKTsNCiAgICAgIH0NCg0KICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICBjbGllbnRJRF8gPSAiIjsNCg0KICAgICAgICBjaGFubmVsXyA9ICIiOw0KDQogICAgICAgIG1heE51bWJlck9mTWVzc2FnZXNfID0gMDsNCg0KICAgICAgICB3YWl0VGltZVNlY29uZHNfID0gMDsNCg0KICAgICAgICBpc1BlYWtfID0gZmFsc2U7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QodGhpcyk7DQogICAgICAgIHJlc3VsdC5yZXF1ZXN0SURfID0gcmVxdWVzdElEXzsNCiAgICAgICAgcmVzdWx0LmNsaWVudElEXyA9IGNsaWVudElEXzsNCiAgICAgICAgcmVzdWx0LmNoYW5uZWxfID0gY2hhbm5lbF87DQogICAgICAgIHJlc3VsdC5tYXhOdW1iZXJPZk1lc3NhZ2VzXyA9IG1heE51bWJlck9mTWVzc2FnZXNfOw0KICAgICAgICByZXN1bHQud2FpdFRpbWVTZWNvbmRzXyA9IHdhaXRUaW1lU2Vjb25kc187DQogICAgICAgIHJlc3VsdC5pc1BlYWtfID0gaXNQZWFrXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3Qpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVxdWVzdElEKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgcmVxdWVzdElEXyA9IG90aGVyLnJlcXVlc3RJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDbGllbnRJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNsaWVudElEXyA9IG90aGVyLmNsaWVudElEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW90aGVyLmdldENoYW5uZWwoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBjaGFubmVsXyA9IG90aGVyLmNoYW5uZWxfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRNYXhOdW1iZXJPZk1lc3NhZ2VzKCkgIT0gMCkgew0KICAgICAgICAgIHNldE1heE51bWJlck9mTWVzc2FnZXMob3RoZXIuZ2V0TWF4TnVtYmVyT2ZNZXNzYWdlcygpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkgIT0gMCkgew0KICAgICAgICAgIHNldFdhaXRUaW1lU2Vjb25kcyhvdGhlci5nZXRXYWl0VGltZVNlY29uZHMoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldElzUGVhaygpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0SXNQZWFrKG90aGVyLmdldElzUGVhaygpKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcXVlc3RJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlcXVlc3RJRCgpIHsNCiAgICAgICAgDQogICAgICAgIHJlcXVlc3RJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRSZXF1ZXN0SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNsaWVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNsaWVudElEKCkgew0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2xpZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2xpZW50SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNoYW5uZWxfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNoYW5uZWxfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGNoYW5uZWxfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWwoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2hhbm5lbCgpIHsNCiAgICAgICAgDQogICAgICAgIGNoYW5uZWxfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2hhbm5lbCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENoYW5uZWxCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGludCBtYXhOdW1iZXJPZk1lc3NhZ2VzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIE1heE51bWJlck9mTWVzc2FnZXMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGludCBnZXRNYXhOdW1iZXJPZk1lc3NhZ2VzKCkgew0KICAgICAgICByZXR1cm4gbWF4TnVtYmVyT2ZNZXNzYWdlc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIE1heE51bWJlck9mTWVzc2FnZXMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWF4TnVtYmVyT2ZNZXNzYWdlcyhpbnQgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIG1heE51bWJlck9mTWVzc2FnZXNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWF4TnVtYmVyT2ZNZXNzYWdlcyA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1heE51bWJlck9mTWVzc2FnZXMoKSB7DQogICAgICAgIA0KICAgICAgICBtYXhOdW1iZXJPZk1lc3NhZ2VzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgd2FpdFRpbWVTZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldFdhaXRUaW1lU2Vjb25kcygpIHsNCiAgICAgICAgcmV0dXJuIHdhaXRUaW1lU2Vjb25kc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDU7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRXYWl0VGltZVNlY29uZHMoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB3YWl0VGltZVNlY29uZHNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgV2FpdFRpbWVTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyV2FpdFRpbWVTZWNvbmRzKCkgew0KICAgICAgICANCiAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIGlzUGVha18gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzUGVhayA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgYm9vbGVhbiBnZXRJc1BlYWsoKSB7DQogICAgICAgIHJldHVybiBpc1BlYWtfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzUGVhayA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRJc1BlYWsoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgaXNQZWFrXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgSXNQZWFrID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFySXNQZWFrKCkgew0KICAgICAgICANCiAgICAgICAgaXNQZWFrXyA9IGZhbHNlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxSZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3Q+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdD4oKSB7DQogICAgICBwdWJsaWMgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0PiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8UmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0PiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlT3JCdWlsZGVyIGV4dGVuZHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChpbnRlcmZhY2VfZXh0ZW5kczprdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEudXRpbC5MaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPiANCiAgICAgICAgZ2V0TWVzc2FnZXNMaXN0KCk7DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBnZXRNZXNzYWdlcyhpbnQgaW5kZXgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldE1lc3NhZ2VzQ291bnQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5kcyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlcj4gDQogICAgICAgIGdldE1lc3NhZ2VzT3JCdWlsZGVyTGlzdCgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXIgZ2V0TWVzc2FnZXNPckJ1aWxkZXIoDQogICAgICAgIGludCBpbmRleCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBNZXNzYWdlc1JlY2VpdmVkID0gMzs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldE1lc3NhZ2VzUmVjZWl2ZWQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIE1lc3NhZ2VzRXhwaXJlZCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGludCBnZXRNZXNzYWdlc0V4cGlyZWQoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSXNQZWFrID0gNTs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBnZXRJc1BlYWsoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSXNFcnJvciA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gZ2V0SXNFcnJvcigpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlfQ0KICAgKi8NCiAgcHVibGljICBzdGF0aWMgZmluYWwgY2xhc3MgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgICAgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZU9yQnVpbGRlciB7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOw0KICAgIC8vIFVzZSBSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSgpIHsNCiAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIG1lc3NhZ2VzXyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsNCiAgICAgIG1lc3NhZ2VzUmVjZWl2ZWRfID0gMDsNCiAgICAgIG1lc3NhZ2VzRXhwaXJlZF8gPSAwOw0KICAgICAgaXNQZWFrXyA9IGZhbHNlOw0KICAgICAgaXNFcnJvcl8gPSBmYWxzZTsNCiAgICAgIGVycm9yXyA9ICIiOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQNCiAgICBnZXRVbmtub3duRmllbGRzKCkgew0KICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkZpZWxkczsNCiAgICB9DQogICAgcHJpdmF0ZSBSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE4OiB7DQogICAgICAgICAgICAgIGlmICghKChtdXRhYmxlX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgICAgICAgIG1lc3NhZ2VzXyA9IG5ldyBqYXZhLnV0aWwuQXJyYXlMaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPigpOw0KICAgICAgICAgICAgICAgIG11dGFibGVfYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIG1lc3NhZ2VzXy5hZGQoDQogICAgICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5wYXJzZXIoKSwgZXh0ZW5zaW9uUmVnaXN0cnkpKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI0OiB7DQoNCiAgICAgICAgICAgICAgbWVzc2FnZXNSZWNlaXZlZF8gPSBpbnB1dC5yZWFkSW50MzIoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDMyOiB7DQoNCiAgICAgICAgICAgICAgbWVzc2FnZXNFeHBpcmVkXyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDA6IHsNCg0KICAgICAgICAgICAgICBpc1BlYWtfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQ4OiB7DQoNCiAgICAgICAgICAgICAgaXNFcnJvcl8gPSBpbnB1dC5yZWFkQm9vbCgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTg6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IGUuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGNhdGNoIChqYXZhLmlvLklPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKA0KICAgICAgICAgICAgZSkuc2V0VW5maW5pc2hlZE1lc3NhZ2UodGhpcyk7DQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICBpZiAoKChtdXRhYmxlX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgIG1lc3NhZ2VzXyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KG1lc3NhZ2VzXyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRVFVRVNUSURfRklFTERfTlVNQkVSID0gMTsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFU19GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2U+IG1lc3NhZ2VzXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4gZ2V0TWVzc2FnZXNMaXN0KCkgew0KICAgICAgcmV0dXJuIG1lc3NhZ2VzXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8PyBleHRlbmRzIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPiANCiAgICAgICAgZ2V0TWVzc2FnZXNPckJ1aWxkZXJMaXN0KCkgew0KICAgICAgcmV0dXJuIG1lc3NhZ2VzXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW50IGdldE1lc3NhZ2VzQ291bnQoKSB7DQogICAgICByZXR1cm4gbWVzc2FnZXNfLnNpemUoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0TWVzc2FnZXMoaW50IGluZGV4KSB7DQogICAgICByZXR1cm4gbWVzc2FnZXNfLmdldChpbmRleCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1lc3NhZ2VzT3JCdWlsZGVyKA0KICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgIHJldHVybiBtZXNzYWdlc18uZ2V0KGluZGV4KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFU1JFQ0VJVkVEX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSBpbnQgbWVzc2FnZXNSZWNlaXZlZF87DQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgTWVzc2FnZXNSZWNlaXZlZCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZXNSZWNlaXZlZCgpIHsNCiAgICAgIHJldHVybiBtZXNzYWdlc1JlY2VpdmVkXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFU0VYUElSRURfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGludCBtZXNzYWdlc0V4cGlyZWRfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIE1lc3NhZ2VzRXhwaXJlZCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZXNFeHBpcmVkKCkgew0KICAgICAgcmV0dXJuIG1lc3NhZ2VzRXhwaXJlZF87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSVNQRUFLX0ZJRUxEX05VTUJFUiA9IDU7DQogICAgcHJpdmF0ZSBib29sZWFuIGlzUGVha187DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBJc1BlYWsgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJc1BlYWsoKSB7DQogICAgICByZXR1cm4gaXNQZWFrXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJU0VSUk9SX0ZJRUxEX05VTUJFUiA9IDY7DQogICAgcHJpdmF0ZSBib29sZWFuIGlzRXJyb3JfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSXNFcnJvciA9IDY7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICByZXR1cm4gaXNFcnJvcl87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRVJST1JfRklFTERfTlVNQkVSID0gNzsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEVycm9yKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDc7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0RXJyb3JCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXJyb3JfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGVycm9yXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWVzc2FnZXNfLnNpemUoKTsgaSsrKSB7DQogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMiwgbWVzc2FnZXNfLmdldChpKSk7DQogICAgICB9DQogICAgICBpZiAobWVzc2FnZXNSZWNlaXZlZF8gIT0gMCkgew0KICAgICAgICBvdXRwdXQud3JpdGVJbnQzMigzLCBtZXNzYWdlc1JlY2VpdmVkXyk7DQogICAgICB9DQogICAgICBpZiAobWVzc2FnZXNFeHBpcmVkXyAhPSAwKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDMyKDQsIG1lc3NhZ2VzRXhwaXJlZF8pOw0KICAgICAgfQ0KICAgICAgaWYgKGlzUGVha18gIT0gZmFsc2UpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlQm9vbCg1LCBpc1BlYWtfKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0Vycm9yXyAhPSBmYWxzZSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCb29sKDYsIGlzRXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDcsIGVycm9yXyk7DQogICAgICB9DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXNzYWdlc18uc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgyLCBtZXNzYWdlc18uZ2V0KGkpKTsNCiAgICAgIH0NCiAgICAgIGlmIChtZXNzYWdlc1JlY2VpdmVkXyAhPSAwKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50MzJTaXplKDMsIG1lc3NhZ2VzUmVjZWl2ZWRfKTsNCiAgICAgIH0NCiAgICAgIGlmIChtZXNzYWdlc0V4cGlyZWRfICE9IDApIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoNCwgbWVzc2FnZXNFeHBpcmVkXyk7DQogICAgICB9DQogICAgICBpZiAoaXNQZWFrXyAhPSBmYWxzZSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDUsIGlzUGVha18pOw0KICAgICAgfQ0KICAgICAgaWYgKGlzRXJyb3JfICE9IGZhbHNlKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlQm9vbFNpemUoNiwgaXNFcnJvcl8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRFcnJvckJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoNywgZXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIHNpemUgKz0gdW5rbm93bkZpZWxkcy5nZXRTZXJpYWxpemVkU2l6ZSgpOw0KICAgICAgbWVtb2l6ZWRTaXplID0gc2l6ZTsNCiAgICAgIHJldHVybiBzaXplOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoZmluYWwgamF2YS5sYW5nLk9iamVjdCBvYmopIHsNCiAgICAgIGlmIChvYmogPT0gdGhpcykgew0KICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2Ugb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSBvYmo7DQoNCiAgICAgIGJvb2xlYW4gcmVzdWx0ID0gdHJ1ZTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRSZXF1ZXN0SUQoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0UmVxdWVzdElEKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIGdldE1lc3NhZ2VzTGlzdCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRNZXNzYWdlc0xpc3QoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldE1lc3NhZ2VzUmVjZWl2ZWQoKQ0KICAgICAgICAgID09IG90aGVyLmdldE1lc3NhZ2VzUmVjZWl2ZWQoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldE1lc3NhZ2VzRXhwaXJlZCgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0TWVzc2FnZXNFeHBpcmVkKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRJc1BlYWsoKQ0KICAgICAgICAgID09IG90aGVyLmdldElzUGVhaygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0SXNFcnJvcigpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0SXNFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRFcnJvcigpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVRVUVTVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlcXVlc3RJRCgpLmhhc2hDb2RlKCk7DQogICAgICBpZiAoZ2V0TWVzc2FnZXNDb3VudCgpID4gMCkgew0KICAgICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNRVNTQUdFU19GSUVMRF9OVU1CRVI7DQogICAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1lc3NhZ2VzTGlzdCgpLmhhc2hDb2RlKCk7DQogICAgICB9DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBNRVNTQUdFU1JFQ0VJVkVEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1lc3NhZ2VzUmVjZWl2ZWQoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FU1NBR0VTRVhQSVJFRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNZXNzYWdlc0V4cGlyZWQoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIElTUEVBS19GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hCb29sZWFuKA0KICAgICAgICAgIGdldElzUGVhaygpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIElTRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRJc0Vycm9yKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0RXJyb3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbShieXRlW10gZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlfQ0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8QnVpbGRlcj4gaW1wbGVtZW50cw0KICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9pbXBsZW1lbnRzOmt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5CdWlsZGVyLmNsYXNzKTsNCiAgICAgIH0NCg0KICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgICAgZ2V0TWVzc2FnZXNGaWVsZEJ1aWxkZXIoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgbWVzc2FnZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLmNsZWFyKCk7DQogICAgICAgIH0NCiAgICAgICAgbWVzc2FnZXNSZWNlaXZlZF8gPSAwOw0KDQogICAgICAgIG1lc3NhZ2VzRXhwaXJlZF8gPSAwOw0KDQogICAgICAgIGlzUGVha18gPSBmYWxzZTsNCg0KICAgICAgICBpc0Vycm9yXyA9IGZhbHNlOw0KDQogICAgICAgIGVycm9yXyA9ICIiOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZV9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgYnVpbGQoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHJlc3VsdCA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UodGhpcyk7DQogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVsZDBfOw0KICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7DQogICAgICAgIHJlc3VsdC5yZXF1ZXN0SURfID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgew0KICAgICAgICAgICAgbWVzc2FnZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QobWVzc2FnZXNfKTsNCiAgICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmVzdWx0Lm1lc3NhZ2VzXyA9IG1lc3NhZ2VzXzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHQubWVzc2FnZXNfID0gbWVzc2FnZXNCdWlsZGVyXy5idWlsZCgpOw0KICAgICAgICB9DQogICAgICAgIHJlc3VsdC5tZXNzYWdlc1JlY2VpdmVkXyA9IG1lc3NhZ2VzUmVjZWl2ZWRfOw0KICAgICAgICByZXN1bHQubWVzc2FnZXNFeHBpcmVkXyA9IG1lc3NhZ2VzRXhwaXJlZF87DQogICAgICAgIHJlc3VsdC5pc1BlYWtfID0gaXNQZWFrXzsNCiAgICAgICAgcmVzdWx0LmlzRXJyb3JfID0gaXNFcnJvcl87DQogICAgICAgIHJlc3VsdC5lcnJvcl8gPSBlcnJvcl87DQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSlvdGhlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldFJlcXVlc3RJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBvdGhlci5yZXF1ZXN0SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAoIW90aGVyLm1lc3NhZ2VzXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIGlmIChtZXNzYWdlc18uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzXyA9IG90aGVyLm1lc3NhZ2VzXzsNCiAgICAgICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICAgICAgbWVzc2FnZXNfLmFkZEFsbChvdGhlci5tZXNzYWdlc18pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmICghb3RoZXIubWVzc2FnZXNfLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uZGlzcG9zZSgpOw0KICAgICAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfID0gbnVsbDsNCiAgICAgICAgICAgICAgbWVzc2FnZXNfID0gb3RoZXIubWVzc2FnZXNfOw0KICAgICAgICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8gPSANCiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzID8NCiAgICAgICAgICAgICAgICAgICBnZXRNZXNzYWdlc0ZpZWxkQnVpbGRlcigpIDogbnVsbDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uYWRkQWxsTWVzc2FnZXMob3RoZXIubWVzc2FnZXNfKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldE1lc3NhZ2VzUmVjZWl2ZWQoKSAhPSAwKSB7DQogICAgICAgICAgc2V0TWVzc2FnZXNSZWNlaXZlZChvdGhlci5nZXRNZXNzYWdlc1JlY2VpdmVkKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRNZXNzYWdlc0V4cGlyZWQoKSAhPSAwKSB7DQogICAgICAgICAgc2V0TWVzc2FnZXNFeHBpcmVkKG90aGVyLmdldE1lc3NhZ2VzRXhwaXJlZCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0SXNQZWFrKCkgIT0gZmFsc2UpIHsNCiAgICAgICAgICBzZXRJc1BlYWsob3RoZXIuZ2V0SXNQZWFrKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRJc0Vycm9yKCkgIT0gZmFsc2UpIHsNCiAgICAgICAgICBzZXRJc0Vycm9yKG90aGVyLmdldElzRXJyb3IoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRFcnJvcigpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGVycm9yXyA9IG90aGVyLmVycm9yXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOw0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcXVlc3RJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlcXVlc3RJRCgpIHsNCiAgICAgICAgDQogICAgICAgIHJlcXVlc3RJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRSZXF1ZXN0SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZT4gbWVzc2FnZXNfID0NCiAgICAgICAgamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgICAgcHJpdmF0ZSB2b2lkIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCkgew0KICAgICAgICBpZiAoISgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7DQogICAgICAgICAgbWVzc2FnZXNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2U+KG1lc3NhZ2VzXyk7DQogICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOw0KICAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IG1lc3NhZ2VzQnVpbGRlcl87DQoNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEudXRpbC5MaXN0PGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPiBnZXRNZXNzYWdlc0xpc3QoKSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QobWVzc2FnZXNfKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZXNCdWlsZGVyXy5nZXRNZXNzYWdlTGlzdCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZXNDb3VudCgpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc18uc2l6ZSgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc0J1aWxkZXJfLmdldENvdW50KCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIGdldE1lc3NhZ2VzKGludCBpbmRleCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzXy5nZXQoaW5kZXgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc0J1aWxkZXJfLmdldE1lc3NhZ2UoaW5kZXgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgdmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBtZXNzYWdlc18uc2V0KGluZGV4LCB2YWx1ZSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5zZXRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCk7DQogICAgICAgICAgbWVzc2FnZXNfLnNldChpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uc2V0TWVzc2FnZShpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSB2YWx1ZSkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbnN1cmVNZXNzYWdlc0lzTXV0YWJsZSgpOw0KICAgICAgICAgIG1lc3NhZ2VzXy5hZGQodmFsdWUpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uYWRkTWVzc2FnZSh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZE1lc3NhZ2VzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgdmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBtZXNzYWdlc18uYWRkKGluZGV4LCB2YWx1ZSk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZE1lc3NhZ2VzKA0KICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7DQogICAgICAgIGlmIChtZXNzYWdlc0J1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBlbnN1cmVNZXNzYWdlc0lzTXV0YWJsZSgpOw0KICAgICAgICAgIG1lc3NhZ2VzXy5hZGQoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uYWRkTWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZE1lc3NhZ2VzKA0KICAgICAgICAgIGludCBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCk7DQogICAgICAgICAgbWVzc2FnZXNfLmFkZChpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VzQnVpbGRlcl8uYWRkTWVzc2FnZShpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRBbGxNZXNzYWdlcygNCiAgICAgICAgICBqYXZhLmxhbmcuSXRlcmFibGU8PyBleHRlbmRzIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlPiB2YWx1ZXMpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIGVuc3VyZU1lc3NhZ2VzSXNNdXRhYmxlKCk7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdE1lc3NhZ2VMaXRlLkJ1aWxkZXIuYWRkQWxsKA0KICAgICAgICAgICAgICB2YWx1ZXMsIG1lc3NhZ2VzXyk7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXy5hZGRBbGxNZXNzYWdlcyh2YWx1ZXMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1lc3NhZ2VzKCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgbWVzc2FnZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOw0KICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLmNsZWFyKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHJlbW92ZU1lc3NhZ2VzKGludCBpbmRleCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgZW5zdXJlTWVzc2FnZXNJc011dGFibGUoKTsNCiAgICAgICAgICBtZXNzYWdlc18ucmVtb3ZlKGluZGV4KTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlc0J1aWxkZXJfLnJlbW92ZShpbmRleCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGdldE1lc3NhZ2VzQnVpbGRlcigNCiAgICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VzRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcihpbmRleCk7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnJlcGVhdGVkIC5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlciBnZXRNZXNzYWdlc09yQnVpbGRlcigNCiAgICAgICAgICBpbnQgaW5kZXgpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc18uZ2V0KGluZGV4KTsgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcihpbmRleCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5kcyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlcj4gDQogICAgICAgICAgIGdldE1lc3NhZ2VzT3JCdWlsZGVyTGlzdCgpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VzQnVpbGRlcl8gIT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlc0J1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXJMaXN0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KG1lc3NhZ2VzXyk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+cmVwZWF0ZWQgLmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIgYWRkTWVzc2FnZXNCdWlsZGVyKCkgew0KICAgICAgICByZXR1cm4gZ2V0TWVzc2FnZXNGaWVsZEJ1aWxkZXIoKS5hZGRCdWlsZGVyKA0KICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBhZGRNZXNzYWdlc0J1aWxkZXIoDQogICAgICAgICAgaW50IGluZGV4KSB7DQogICAgICAgIHJldHVybiBnZXRNZXNzYWdlc0ZpZWxkQnVpbGRlcigpLmFkZEJ1aWxkZXIoDQogICAgICAgICAgICBpbmRleCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5yZXBlYXRlZCAua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlcyA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlcj4gDQogICAgICAgICAgIGdldE1lc3NhZ2VzQnVpbGRlckxpc3QoKSB7DQogICAgICAgIHJldHVybiBnZXRNZXNzYWdlc0ZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXJMaXN0KCk7DQogICAgICB9DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IA0KICAgICAgICAgIGdldE1lc3NhZ2VzRmllbGRCdWlsZGVyKCkgew0KICAgICAgICBpZiAobWVzc2FnZXNCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgbWVzc2FnZXNCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVyVjM8DQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlcj4oDQogICAgICAgICAgICAgICAgICBtZXNzYWdlc18sDQogICAgICAgICAgICAgICAgICAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSwNCiAgICAgICAgICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksDQogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOw0KICAgICAgICAgIG1lc3NhZ2VzXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG1lc3NhZ2VzQnVpbGRlcl87DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IG1lc3NhZ2VzUmVjZWl2ZWRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWVzc2FnZXNSZWNlaXZlZCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldE1lc3NhZ2VzUmVjZWl2ZWQoKSB7DQogICAgICAgIHJldHVybiBtZXNzYWdlc1JlY2VpdmVkXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWVzc2FnZXNSZWNlaXZlZCA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXNzYWdlc1JlY2VpdmVkKGludCB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgbWVzc2FnZXNSZWNlaXZlZF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBNZXNzYWdlc1JlY2VpdmVkID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2FnZXNSZWNlaXZlZCgpIHsNCiAgICAgICAgDQogICAgICAgIG1lc3NhZ2VzUmVjZWl2ZWRfID0gMDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGludCBtZXNzYWdlc0V4cGlyZWRfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWVzc2FnZXNFeHBpcmVkID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZXNFeHBpcmVkKCkgew0KICAgICAgICByZXR1cm4gbWVzc2FnZXNFeHBpcmVkXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgTWVzc2FnZXNFeHBpcmVkID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VzRXhwaXJlZChpbnQgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIG1lc3NhZ2VzRXhwaXJlZF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBNZXNzYWdlc0V4cGlyZWQgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXNzYWdlc0V4cGlyZWQoKSB7DQogICAgICAgIA0KICAgICAgICBtZXNzYWdlc0V4cGlyZWRfID0gMDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGJvb2xlYW4gaXNQZWFrXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgSXNQZWFrID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldElzUGVhaygpIHsNCiAgICAgICAgcmV0dXJuIGlzUGVha187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgSXNQZWFrID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldElzUGVhayhib29sZWFuIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBpc1BlYWtfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc1BlYWsgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJJc1BlYWsoKSB7DQogICAgICAgIA0KICAgICAgICBpc1BlYWtfID0gZmFsc2U7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIGlzRXJyb3JfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiBpc0Vycm9yXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldElzRXJyb3IoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSA2OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJJc0Vycm9yKCkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSBmYWxzZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBlcnJvcl8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXJyb3JfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRXJyb3IoKSB7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRFcnJvcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFcnJvckJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPigpIHsNCiAgICAgIHB1YmxpYyBSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENsaWVudElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBXYWl0VGltZVNlY29uZHMgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0V2FpdFRpbWVTZWNvbmRzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdH0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIEFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGV4dGVuZHMNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzIGltcGxlbWVudHMNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChtZXNzYWdlX2ltcGxlbWVudHM6a3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KQ0KICAgICAgQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4NCiAgICBwcml2YXRlIEFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QoKSB7DQogICAgICByZXF1ZXN0SURfID0gIiI7DQogICAgICBjbGllbnRJRF8gPSAiIjsNCiAgICAgIGNoYW5uZWxfID0gIiI7DQogICAgICB3YWl0VGltZVNlY29uZHNfID0gMDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTg6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI2OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGNoYW5uZWxfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDMyOiB7DQoNCiAgICAgICAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgdGhyb3cgZS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gY2F0Y2ggKGphdmEuaW8uSU9FeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oDQogICAgICAgICAgICBlKS5zZXRVbmZpbmlzaGVkTWVzc2FnZSh0aGlzKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHRoaXMudW5rbm93bkZpZWxkcyA9IHVua25vd25GaWVsZHMuYnVpbGQoKTsNCiAgICAgICAgbWFrZUV4dGVuc2lvbnNJbW11dGFibGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdC5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdC5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRVFVRVNUSURfRklFTERfTlVNQkVSID0gMTsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDTElFTlRJRF9GSUVMRF9OVU1CRVIgPSAyOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBjbGllbnRJRF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENIQU5ORUxfRklFTERfTlVNQkVSID0gMzsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBXQUlUVElNRVNFQ09ORFNfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGludCB3YWl0VGltZVNlY29uZHNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0V2FpdFRpbWVTZWNvbmRzKCkgew0KICAgICAgcmV0dXJuIHdhaXRUaW1lU2Vjb25kc187DQogICAgfQ0KDQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOw0KICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAxKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDApIHJldHVybiBmYWxzZTsNCg0KICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICBpZiAoIWdldFJlcXVlc3RJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgMSwgcmVxdWVzdElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENsaWVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAyLCBjbGllbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAzLCBjaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAod2FpdFRpbWVTZWNvbmRzXyAhPSAwKSB7DQogICAgICAgIG91dHB1dC53cml0ZUludDMyKDQsIHdhaXRUaW1lU2Vjb25kc18pOw0KICAgICAgfQ0KICAgICAgdW5rbm93bkZpZWxkcy53cml0ZVRvKG91dHB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsNCiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTaXplOw0KICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOw0KDQogICAgICBzaXplID0gMDsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDIsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENoYW5uZWxCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDMsIGNoYW5uZWxfKTsNCiAgICAgIH0NCiAgICAgIGlmICh3YWl0VGltZVNlY29uZHNfICE9IDApIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoNCwgd2FpdFRpbWVTZWNvbmRzXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3Qgb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVxdWVzdElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcXVlc3RJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDbGllbnRJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDbGllbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDaGFubmVsKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldENoYW5uZWwoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFdhaXRUaW1lU2Vjb25kcygpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVFVRVNUSURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVxdWVzdElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENMSUVOVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENsaWVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENIQU5ORUxfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0Q2hhbm5lbCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBXQUlUVElNRVNFQ09ORFNfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0V2FpdFRpbWVTZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdH0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0Fja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICBjbGllbnRJRF8gPSAiIjsNCg0KICAgICAgICBjaGFubmVsXyA9ICIiOw0KDQogICAgICAgIHdhaXRUaW1lU2Vjb25kc18gPSAwOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOw0KICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCh0aGlzKTsNCiAgICAgICAgcmVzdWx0LnJlcXVlc3RJRF8gPSByZXF1ZXN0SURfOw0KICAgICAgICByZXN1bHQuY2xpZW50SURfID0gY2xpZW50SURfOw0KICAgICAgICByZXN1bHQuY2hhbm5lbF8gPSBjaGFubmVsXzsNCiAgICAgICAgcmVzdWx0LndhaXRUaW1lU2Vjb25kc18gPSB3YWl0VGltZVNlY29uZHNfOw0KICAgICAgICBvbkJ1aWx0KCk7DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsb25lKCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0RmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhckZpZWxkKGZpZWxkKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyT25lb2YoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5PbmVvZkRlc2NyaXB0b3Igb25lb2YpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbGVhck9uZW9mKG9uZW9mKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgaW50IGluZGV4LCBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuc2V0UmVwZWF0ZWRGaWVsZChmaWVsZCwgaW5kZXgsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlcGVhdGVkRmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmFkZFJlcGVhdGVkRmllbGQoZmllbGQsIHZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgew0KICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3Qpb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3Qgb3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOw0KICAgICAgICBpZiAoIW90aGVyLmdldFJlcXVlc3RJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBvdGhlci5yZXF1ZXN0SURfOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0Q2xpZW50SUQoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBjbGllbnRJRF8gPSBvdGhlci5jbGllbnRJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDaGFubmVsKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgY2hhbm5lbF8gPSBvdGhlci5jaGFubmVsXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkgIT0gMCkgew0KICAgICAgICAgIHNldFdhaXRUaW1lU2Vjb25kcyhvdGhlci5nZXRXYWl0VGltZVNlY29uZHMoKSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlZE1lc3NhZ2UgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSBQQVJTRVIucGFyc2VQYXJ0aWFsRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICB9IGNhdGNoIChjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgcGFyc2VkTWVzc2FnZSA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSBlLmdldFVuZmluaXNoZWRNZXNzYWdlKCk7DQogICAgICAgICAgdGhyb3cgZS51bndyYXBJT0V4Y2VwdGlvbigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgIGlmIChwYXJzZWRNZXNzYWdlICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lcmdlRnJvbShwYXJzZWRNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCByZXF1ZXN0SURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgcmVxdWVzdElEXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIHJlcXVlc3RJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUmVxdWVzdElEKCkgew0KICAgICAgICANCiAgICAgICAgcmVxdWVzdElEXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFJlcXVlc3RJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVxdWVzdElEQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIHJlcXVlc3RJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2xpZW50SURfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDbGllbnRJREJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENsaWVudElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ2xpZW50SUQoKSB7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDbGllbnRJRCgpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjbGllbnRJRF8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2hhbm5lbF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDaGFubmVsKCkgew0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDaGFubmVsKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IHdhaXRUaW1lU2Vjb25kc18gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBXYWl0VGltZVNlY29uZHMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGludCBnZXRXYWl0VGltZVNlY29uZHMoKSB7DQogICAgICAgIHJldHVybiB3YWl0VGltZVNlY29uZHNfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5pbnQzMiBXYWl0VGltZVNlY29uZHMgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0V2FpdFRpbWVTZWNvbmRzKGludCB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcldhaXRUaW1lU2Vjb25kcygpIHsNCiAgICAgICAgDQogICAgICAgIHdhaXRUaW1lU2Vjb25kc18gPSAwOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8QWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3Q+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPEFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0PigpIHsNCiAgICAgIHB1YmxpYyBBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IEFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8QWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3Q+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+dWludDY0IEFmZmVjdGVkTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBsb25nIGdldEFmZmVjdGVkTWVzc2FnZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSXNFcnJvciA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGJvb2xlYW4gZ2V0SXNFcnJvcigpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNDs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCk7DQogIH0NCiAgLyoqDQogICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2V9DQogICAqLw0KICBwdWJsaWMgIHN0YXRpYyBmaW5hbCBjbGFzcyBBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgZXh0ZW5kcw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMgaW1wbGVtZW50cw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KG1lc3NhZ2VfaW1wbGVtZW50czprdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgICAgQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlT3JCdWlsZGVyIHsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7DQogICAgLy8gVXNlIEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0Lg0KICAgIHByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXI8Pz4gYnVpbGRlcikgew0KICAgICAgc3VwZXIoYnVpbGRlcik7DQogICAgfQ0KICAgIHByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKCkgew0KICAgICAgcmVxdWVzdElEXyA9ICIiOw0KICAgICAgYWZmZWN0ZWRNZXNzYWdlc18gPSAwTDsNCiAgICAgIGlzRXJyb3JfID0gZmFsc2U7DQogICAgICBlcnJvcl8gPSAiIjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE2OiB7DQoNCiAgICAgICAgICAgICAgYWZmZWN0ZWRNZXNzYWdlc18gPSBpbnB1dC5yZWFkVUludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAyNDogew0KDQogICAgICAgICAgICAgIGlzRXJyb3JfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDM0OiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRVFVRVNUSURfRklFTERfTlVNQkVSID0gMTsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBRkZFQ1RFRE1FU1NBR0VTX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSBsb25nIGFmZmVjdGVkTWVzc2FnZXNfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnVpbnQ2NCBBZmZlY3RlZE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGxvbmcgZ2V0QWZmZWN0ZWRNZXNzYWdlcygpIHsNCiAgICAgIHJldHVybiBhZmZlY3RlZE1lc3NhZ2VzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJU0VSUk9SX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSBib29sZWFuIGlzRXJyb3JfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPmJvb2wgSXNFcnJvciA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICByZXR1cm4gaXNFcnJvcl87DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRVJST1JfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEVycm9yKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgcmV0dXJuIHM7DQogICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0RXJyb3JCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXJyb3JfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgIGVycm9yXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmIChhZmZlY3RlZE1lc3NhZ2VzXyAhPSAwTCkgew0KICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMiwgYWZmZWN0ZWRNZXNzYWdlc18pOw0KICAgICAgfQ0KICAgICAgaWYgKGlzRXJyb3JfICE9IGZhbHNlKSB7DQogICAgICAgIG91dHB1dC53cml0ZUJvb2woMywgaXNFcnJvcl8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRFcnJvckJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLndyaXRlU3RyaW5nKG91dHB1dCwgNCwgZXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIHVua25vd25GaWVsZHMud3JpdGVUbyhvdXRwdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7DQogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2l6ZTsNCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsNCg0KICAgICAgc2l6ZSA9IDA7DQogICAgICBpZiAoIWdldFJlcXVlc3RJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgcmVxdWVzdElEXyk7DQogICAgICB9DQogICAgICBpZiAoYWZmZWN0ZWRNZXNzYWdlc18gIT0gMEwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDIsIGFmZmVjdGVkTWVzc2FnZXNfKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0Vycm9yXyAhPSBmYWxzZSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDMsIGlzRXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDQsIGVycm9yXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVxdWVzdElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcXVlc3RJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0QWZmZWN0ZWRNZXNzYWdlcygpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0QWZmZWN0ZWRNZXNzYWdlcygpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoZ2V0SXNFcnJvcigpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0SXNFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRFcnJvcigpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRFcnJvcigpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiB1bmtub3duRmllbGRzLmVxdWFscyhvdGhlci51bmtub3duRmllbGRzKTsNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7DQogICAgICBpZiAobWVtb2l6ZWRIYXNoQ29kZSAhPSAwKSB7DQogICAgICAgIHJldHVybiBtZW1vaXplZEhhc2hDb2RlOw0KICAgICAgfQ0KICAgICAgaW50IGhhc2ggPSA0MTsNCiAgICAgIGhhc2ggPSAoMTkgKiBoYXNoKSArIGdldERlc2NyaXB0b3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgUkVRVUVTVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFJlcXVlc3RJRCgpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBBRkZFQ1RFRE1FU1NBR0VTX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaGFzaExvbmcoDQogICAgICAgICAgZ2V0QWZmZWN0ZWRNZXNzYWdlcygpKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIElTRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRJc0Vycm9yKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0RXJyb3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZX0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZU9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICByZXF1ZXN0SURfID0gIiI7DQoNCiAgICAgICAgYWZmZWN0ZWRNZXNzYWdlc18gPSAwTDsNCg0KICAgICAgICBpc0Vycm9yXyA9IGZhbHNlOw0KDQogICAgICAgIGVycm9yXyA9ICIiOw0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBidWlsZCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGJ1aWxkUGFydGlhbCgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzdWx0ID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKHRoaXMpOw0KICAgICAgICByZXN1bHQucmVxdWVzdElEXyA9IHJlcXVlc3RJRF87DQogICAgICAgIHJlc3VsdC5hZmZlY3RlZE1lc3NhZ2VzXyA9IGFmZmVjdGVkTWVzc2FnZXNfOw0KICAgICAgICByZXN1bHQuaXNFcnJvcl8gPSBpc0Vycm9yXzsNCiAgICAgICAgcmVzdWx0LmVycm9yXyA9IGVycm9yXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2Upb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVxdWVzdElEKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgcmVxdWVzdElEXyA9IG90aGVyLnJlcXVlc3RJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldEFmZmVjdGVkTWVzc2FnZXMoKSAhPSAwTCkgew0KICAgICAgICAgIHNldEFmZmVjdGVkTWVzc2FnZXMob3RoZXIuZ2V0QWZmZWN0ZWRNZXNzYWdlcygpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0SXNFcnJvcigpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0SXNFcnJvcihvdGhlci5nZXRJc0Vycm9yKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0RXJyb3IoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBlcnJvcl8gPSBvdGhlci5lcnJvcl87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpIGUuZ2V0VW5maW5pc2hlZE1lc3NhZ2UoKTsNCiAgICAgICAgICB0aHJvdyBlLnVud3JhcElPRXhjZXB0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgaWYgKHBhcnNlZE1lc3NhZ2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgbWVyZ2VGcm9tKHBhcnNlZE1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVxdWVzdElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZXF1ZXN0SUQoKSB7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0UmVxdWVzdElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgbG9uZyBhZmZlY3RlZE1lc3NhZ2VzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBBZmZlY3RlZE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBsb25nIGdldEFmZmVjdGVkTWVzc2FnZXMoKSB7DQogICAgICAgIHJldHVybiBhZmZlY3RlZE1lc3NhZ2VzXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+dWludDY0IEFmZmVjdGVkTWVzc2FnZXMgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0QWZmZWN0ZWRNZXNzYWdlcyhsb25nIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBhZmZlY3RlZE1lc3NhZ2VzXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBBZmZlY3RlZE1lc3NhZ2VzID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQWZmZWN0ZWRNZXNzYWdlcygpIHsNCiAgICAgICAgDQogICAgICAgIGFmZmVjdGVkTWVzc2FnZXNfID0gMEw7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBib29sZWFuIGlzRXJyb3JfIDsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBib29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiBpc0Vycm9yXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldElzRXJyb3IoYm9vbGVhbiB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJJc0Vycm9yKCkgew0KICAgICAgICANCiAgICAgICAgaXNFcnJvcl8gPSBmYWxzZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgZXJyb3JfID0gIiI7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRFcnJvcigpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0NCiAgICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICBlcnJvcl8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgZXJyb3JfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRXJyb3IoKSB7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRFcnJvcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFcnJvckJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgcHVibGljIGZpbmFsIEJ1aWxkZXIgc2V0VW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5zZXRVbmtub3duRmllbGRzUHJvdG8zKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBtZXJnZVVua25vd25GaWVsZHMoDQogICAgICAgICAgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQgdW5rbm93bkZpZWxkcykgew0KICAgICAgICByZXR1cm4gc3VwZXIubWVyZ2VVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMpOw0KICAgICAgfQ0KDQoNCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOmt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpDQogICAgfQ0KDQogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOmt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgREVGQVVMVF9JTlNUQU5DRTsNCiAgICBzdGF0aWMgew0KICAgICAgREVGQVVMVF9JTlNUQU5DRSA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8QWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPg0KICAgICAgICBQQVJTRVIgPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5BYnN0cmFjdFBhcnNlcjxBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KCkgew0KICAgICAgcHVibGljIEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcGFyc2VyKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuUGFyc2VyPEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgfQ0KDQogIHB1YmxpYyBpbnRlcmZhY2UgU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3RPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldFJlcXVlc3RJREJ5dGVzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENsaWVudElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENsaWVudElEID0gMjs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhID0gMzs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YVZhbHVlKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIGdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YSgpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldENoYW5uZWwoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKTsNCg0KICAgIC8qKg0KICAgICAqIDxjb2RlPmludDMyIFZpc2liaWxpdHlTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICovDQogICAgaW50IGdldFZpc2liaWxpdHlTZWNvbmRzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBXYWl0VGltZVNlY29uZHMgPSA2OzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0V2FpdFRpbWVTZWNvbmRzKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT51aW50NjQgUmVmU2VxdWVuY2UgPSA3OzwvY29kZT4NCiAgICAgKi8NCiAgICBsb25nIGdldFJlZlNlcXVlbmNlKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgKi8NCiAgICBib29sZWFuIGhhc01vZGlmaWVkTWVzc2FnZSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlIE1vZGlmaWVkTWVzc2FnZSA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIGdldE1vZGlmaWVkTWVzc2FnZSgpOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlIE1vZGlmaWVkTWVzc2FnZSA9IDg7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1vZGlmaWVkTWVzc2FnZU9yQnVpbGRlcigpOw0KICB9DQogIC8qKg0KICAgKiBQcm90b2J1ZiB0eXBlIHtAY29kZSBrdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3R9DQogICAqLw0KICBwdWJsaWMgIHN0YXRpYyBmaW5hbCBjbGFzcyBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCkNCiAgICAgIFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0T3JCdWlsZGVyIHsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7DQogICAgLy8gVXNlIFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPD8+IGJ1aWxkZXIpIHsNCiAgICAgIHN1cGVyKGJ1aWxkZXIpOw0KICAgIH0NCiAgICBwcml2YXRlIFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KCkgew0KICAgICAgcmVxdWVzdElEXyA9ICIiOw0KICAgICAgY2xpZW50SURfID0gIiI7DQogICAgICBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gMDsNCiAgICAgIGNoYW5uZWxfID0gIiI7DQogICAgICB2aXNpYmlsaXR5U2Vjb25kc18gPSAwOw0KICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IDA7DQogICAgICByZWZTZXF1ZW5jZV8gPSAwTDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICB0aGlzKCk7DQogICAgICBpZiAoZXh0ZW5zaW9uUmVnaXN0cnkgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLk51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogICAgICB9DQogICAgICBpbnQgbXV0YWJsZV9iaXRGaWVsZDBfID0gMDsNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgYm9vbGVhbiBkb25lID0gZmFsc2U7DQogICAgICAgIHdoaWxlICghZG9uZSkgew0KICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7DQogICAgICAgICAgc3dpdGNoICh0YWcpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkUHJvdG8zKA0KICAgICAgICAgICAgICAgICAgaW5wdXQsIHVua25vd25GaWVsZHMsIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7DQogICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMTg6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2xpZW50SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDI0OiB7DQogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7DQoNCiAgICAgICAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IHJhd1ZhbHVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMzQ6IHsNCiAgICAgICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gaW5wdXQucmVhZFN0cmluZ1JlcXVpcmVVdGY4KCk7DQoNCiAgICAgICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNDA6IHsNCg0KICAgICAgICAgICAgICB2aXNpYmlsaXR5U2Vjb25kc18gPSBpbnB1dC5yZWFkSW50MzIoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQ4OiB7DQoNCiAgICAgICAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IGlucHV0LnJlYWRJbnQzMigpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNTY6IHsNCg0KICAgICAgICAgICAgICByZWZTZXF1ZW5jZV8gPSBpbnB1dC5yZWFkVUludDY0KCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA2Njogew0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBudWxsOw0KICAgICAgICAgICAgICBpZiAobW9kaWZpZWRNZXNzYWdlXyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgc3ViQnVpbGRlciA9IG1vZGlmaWVkTWVzc2FnZV8udG9CdWlsZGVyKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbW9kaWZpZWRNZXNzYWdlXyA9IGlucHV0LnJlYWRNZXNzYWdlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLnBhcnNlcigpLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICAgICAgICAgIGlmIChzdWJCdWlsZGVyICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShtb2RpZmllZE1lc3NhZ2VfKTsNCiAgICAgICAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKTsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICAgIH0NCg0KICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7DQogICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFUVVFU1RJRF9GSUVMRF9OVU1CRVIgPSAxOw0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCByZXF1ZXN0SURfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IA0KICAgICAgICAgICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMSUVOVElEX0ZJRUxEX05VTUJFUiA9IDI7DQogICAgcHJpdmF0ZSB2b2xhdGlsZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIGNsaWVudElEXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldENsaWVudElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGNsaWVudElEXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjbGllbnRJRF8gPSBiOw0KICAgICAgICByZXR1cm4gYjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RSRUFNUkVRVUVTVFRZUEVEQVRBX0ZJRUxEX05VTUJFUiA9IDM7DQogICAgcHJpdmF0ZSBpbnQgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUoKSB7DQogICAgICByZXR1cm4gc3RyZWFtUmVxdWVzdFR5cGVEYXRhXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAzOzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBnZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoKSB7DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIHJlc3VsdCA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUudmFsdWVPZihzdHJlYW1SZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuVU5SRUNPR05JWkVEIDogcmVzdWx0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENIQU5ORUxfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBjaGFubmVsXyA9IHM7DQogICAgICAgIHJldHVybiBzOw0KICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgQ2hhbm5lbCA9IDQ7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0Q2hhbm5lbEJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICBjaGFubmVsXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWSVNJQklMSVRZU0VDT05EU19GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgaW50IHZpc2liaWxpdHlTZWNvbmRzXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5pbnQzMiBWaXNpYmlsaXR5U2Vjb25kcyA9IDU7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpbnQgZ2V0VmlzaWJpbGl0eVNlY29uZHMoKSB7DQogICAgICByZXR1cm4gdmlzaWJpbGl0eVNlY29uZHNfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFdBSVRUSU1FU0VDT05EU19GSUVMRF9OVU1CRVIgPSA2Ow0KICAgIHByaXZhdGUgaW50IHdhaXRUaW1lU2Vjb25kc187DQogICAgLyoqDQogICAgICogPGNvZGU+aW50MzIgV2FpdFRpbWVTZWNvbmRzID0gNjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRXYWl0VGltZVNlY29uZHMoKSB7DQogICAgICByZXR1cm4gd2FpdFRpbWVTZWNvbmRzXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRUZTRVFVRU5DRV9GSUVMRF9OVU1CRVIgPSA3Ow0KICAgIHByaXZhdGUgbG9uZyByZWZTZXF1ZW5jZV87DQogICAgLyoqDQogICAgICogPGNvZGU+dWludDY0IFJlZlNlcXVlbmNlID0gNzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGxvbmcgZ2V0UmVmU2VxdWVuY2UoKSB7DQogICAgICByZXR1cm4gcmVmU2VxdWVuY2VfOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1PRElGSUVETUVTU0FHRV9GSUVMRF9OVU1CRVIgPSA4Ow0KICAgIHByaXZhdGUgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgbW9kaWZpZWRNZXNzYWdlXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNNb2RpZmllZE1lc3NhZ2UoKSB7DQogICAgICByZXR1cm4gbW9kaWZpZWRNZXNzYWdlXyAhPSBudWxsOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0TW9kaWZpZWRNZXNzYWdlKCkgew0KICAgICAgcmV0dXJuIG1vZGlmaWVkTWVzc2FnZV8gPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpIDogbW9kaWZpZWRNZXNzYWdlXzsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTW9kaWZpZWRNZXNzYWdlID0gODs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1vZGlmaWVkTWVzc2FnZU9yQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBnZXRNb2RpZmllZE1lc3NhZ2UoKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7DQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsNCiAgICAgIGlmIChpc0luaXRpYWxpemVkID09IDEpIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMCkgcmV0dXJuIGZhbHNlOw0KDQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIGlmICghZ2V0UmVxdWVzdElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCAxLCByZXF1ZXN0SURfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2xpZW50SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDIsIGNsaWVudElEXyk7DQogICAgICB9DQogICAgICBpZiAoc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyAhPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLlN0cmVhbVJlcXVlc3RUeXBlVW5rbm93bi5nZXROdW1iZXIoKSkgew0KICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDMsIHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8pOw0KICAgICAgfQ0KICAgICAgaWYgKCFnZXRDaGFubmVsQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMud3JpdGVTdHJpbmcob3V0cHV0LCA0LCBjaGFubmVsXyk7DQogICAgICB9DQogICAgICBpZiAodmlzaWJpbGl0eVNlY29uZHNfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoNSwgdmlzaWJpbGl0eVNlY29uZHNfKTsNCiAgICAgIH0NCiAgICAgIGlmICh3YWl0VGltZVNlY29uZHNfICE9IDApIHsNCiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoNiwgd2FpdFRpbWVTZWNvbmRzXyk7DQogICAgICB9DQogICAgICBpZiAocmVmU2VxdWVuY2VfICE9IDBMKSB7DQogICAgICAgIG91dHB1dC53cml0ZVVJbnQ2NCg3LCByZWZTZXF1ZW5jZV8pOw0KICAgICAgfQ0KICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZV8gIT0gbnVsbCkgew0KICAgICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDgsIGdldE1vZGlmaWVkTWVzc2FnZSgpKTsNCiAgICAgIH0NCiAgICAgIHVua25vd25GaWVsZHMud3JpdGVUbyhvdXRwdXQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7DQogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2l6ZTsNCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsNCg0KICAgICAgc2l6ZSA9IDA7DQogICAgICBpZiAoIWdldFJlcXVlc3RJREJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoMSwgcmVxdWVzdElEXyk7DQogICAgICB9DQogICAgICBpZiAoIWdldENsaWVudElEQnl0ZXMoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5jb21wdXRlU3RyaW5nU2l6ZSgyLCBjbGllbnRJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gIT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5TdHJlYW1SZXF1ZXN0VHlwZVVua25vd24uZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgzLCBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0Q2hhbm5lbEJ5dGVzKCkuaXNFbXB0eSgpKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuY29tcHV0ZVN0cmluZ1NpemUoNCwgY2hhbm5lbF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHZpc2liaWxpdHlTZWNvbmRzXyAhPSAwKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50MzJTaXplKDUsIHZpc2liaWxpdHlTZWNvbmRzXyk7DQogICAgICB9DQogICAgICBpZiAod2FpdFRpbWVTZWNvbmRzXyAhPSAwKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlSW50MzJTaXplKDYsIHdhaXRUaW1lU2Vjb25kc18pOw0KICAgICAgfQ0KICAgICAgaWYgKHJlZlNlcXVlbmNlXyAhPSAwTCkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUoNywgcmVmU2VxdWVuY2VfKTsNCiAgICAgIH0NCiAgICAgIGlmIChtb2RpZmllZE1lc3NhZ2VfICE9IG51bGwpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg4LCBnZXRNb2RpZmllZE1lc3NhZ2UoKSk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QpKSB7DQogICAgICAgIHJldHVybiBzdXBlci5lcXVhbHMob2JqKTsNCiAgICAgIH0NCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3Qgb3RoZXIgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVxdWVzdElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcXVlc3RJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBnZXRDbGllbnRJRCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDbGllbnRJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID09IG90aGVyLnN0cmVhbVJlcXVlc3RUeXBlRGF0YV87DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0Q2hhbm5lbCgpDQogICAgICAgICAgLmVxdWFscyhvdGhlci5nZXRDaGFubmVsKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRWaXNpYmlsaXR5U2Vjb25kcygpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0VmlzaWJpbGl0eVNlY29uZHMoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldFdhaXRUaW1lU2Vjb25kcygpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkpOw0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChnZXRSZWZTZXF1ZW5jZSgpDQogICAgICAgICAgPT0gb3RoZXIuZ2V0UmVmU2VxdWVuY2UoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGhhc01vZGlmaWVkTWVzc2FnZSgpID09IG90aGVyLmhhc01vZGlmaWVkTWVzc2FnZSgpKTsNCiAgICAgIGlmIChoYXNNb2RpZmllZE1lc3NhZ2UoKSkgew0KICAgICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0TW9kaWZpZWRNZXNzYWdlKCkNCiAgICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0TW9kaWZpZWRNZXNzYWdlKCkpOw0KICAgICAgfQ0KICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHVua25vd25GaWVsZHMuZXF1YWxzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsNCiAgICAgIGlmIChtZW1vaXplZEhhc2hDb2RlICE9IDApIHsNCiAgICAgICAgcmV0dXJuIG1lbW9pemVkSGFzaENvZGU7DQogICAgICB9DQogICAgICBpbnQgaGFzaCA9IDQxOw0KICAgICAgaGFzaCA9ICgxOSAqIGhhc2gpICsgZ2V0RGVzY3JpcHRvcigpLmhhc2hDb2RlKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRVFVRVNUSURfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0UmVxdWVzdElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIENMSUVOVElEX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldENsaWVudElEKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFNUUkVBTVJFUVVFU1RUWVBFREFUQV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgQ0hBTk5FTF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRDaGFubmVsKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFZJU0lCSUxJVFlTRUNPTkRTX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldFZpc2liaWxpdHlTZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBXQUlUVElNRVNFQ09ORFNfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0V2FpdFRpbWVTZWNvbmRzKCk7DQogICAgICBoYXNoID0gKDM3ICogaGFzaCkgKyBSRUZTRVFVRU5DRV9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLmhhc2hMb25nKA0KICAgICAgICAgIGdldFJlZlNlcXVlbmNlKCkpOw0KICAgICAgaWYgKGhhc01vZGlmaWVkTWVzc2FnZSgpKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1PRElGSUVETUVTU0FHRV9GSUVMRF9OVU1CRVI7DQogICAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIGdldE1vZGlmaWVkTWVzc2FnZSgpLmhhc2hDb2RlKCk7DQogICAgICB9DQogICAgICBoYXNoID0gKDI5ICogaGFzaCkgKyB1bmtub3duRmllbGRzLmhhc2hDb2RlKCk7DQogICAgICBtZW1vaXplZEhhc2hDb2RlID0gaGFzaDsNCiAgICAgIHJldHVybiBoYXNoOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGphdmEubmlvLkJ5dGVCdWZmZXIgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgYnl0ZVtdIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKA0KICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlRGVsaW1pdGVkV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KDQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFLnRvQnVpbGRlcigpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHByb3RvdHlwZSkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0UudG9CdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7DQogICAgfQ0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzID09IERFRkFVTFRfSU5TVEFOQ0UNCiAgICAgICAgICA/IG5ldyBCdWlsZGVyKCkgOiBuZXcgQnVpbGRlcigpLm1lcmdlRnJvbSh0aGlzKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7DQogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOw0KICAgICAgcmV0dXJuIGJ1aWxkZXI7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb3RvYnVmIHR5cGUge0Bjb2RlIGt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdH0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QpDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3RPckJ1aWxkZXIgew0KICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5pbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICAgIC5lbnN1cmVGaWVsZEFjY2Vzc29yc0luaXRpYWxpemVkKA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKQ0KICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgew0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgQnVpbGRlcigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyUGFyZW50IHBhcmVudCkgew0KICAgICAgICBzdXBlcihwYXJlbnQpOw0KICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7DQogICAgICB9DQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsNCiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgICAgICAgLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7DQogICAgICAgIHN1cGVyLmNsZWFyKCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSAiIjsNCg0KICAgICAgICBjbGllbnRJRF8gPSAiIjsNCg0KICAgICAgICBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gMDsNCg0KICAgICAgICBjaGFubmVsXyA9ICIiOw0KDQogICAgICAgIHZpc2liaWxpdHlTZWNvbmRzXyA9IDA7DQoNCiAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IDA7DQoNCiAgICAgICAgcmVmU2VxdWVuY2VfID0gMEw7DQoNCiAgICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VCdWlsZGVyXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgew0KICAgICAgICByZXR1cm4gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgYnVpbGQoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7DQogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgew0KICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlc3VsdCA9IG5ldyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KHRoaXMpOw0KICAgICAgICByZXN1bHQucmVxdWVzdElEXyA9IHJlcXVlc3RJRF87DQogICAgICAgIHJlc3VsdC5jbGllbnRJRF8gPSBjbGllbnRJRF87DQogICAgICAgIHJlc3VsdC5zdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gc3RyZWFtUmVxdWVzdFR5cGVEYXRhXzsNCiAgICAgICAgcmVzdWx0LmNoYW5uZWxfID0gY2hhbm5lbF87DQogICAgICAgIHJlc3VsdC52aXNpYmlsaXR5U2Vjb25kc18gPSB2aXNpYmlsaXR5U2Vjb25kc187DQogICAgICAgIHJlc3VsdC53YWl0VGltZVNlY29uZHNfID0gd2FpdFRpbWVTZWNvbmRzXzsNCiAgICAgICAgcmVzdWx0LnJlZlNlcXVlbmNlXyA9IHJlZlNlcXVlbmNlXzsNCiAgICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXN1bHQubW9kaWZpZWRNZXNzYWdlXyA9IG1vZGlmaWVkTWVzc2FnZV87DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmVzdWx0Lm1vZGlmaWVkTWVzc2FnZV8gPSBtb2RpZmllZE1lc3NhZ2VCdWlsZGVyXy5idWlsZCgpOw0KICAgICAgICB9DQogICAgICAgIG9uQnVpbHQoKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xvbmUoKTsNCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyRmllbGQoZmllbGQpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJPbmVvZigNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLk9uZW9mRGVzY3JpcHRvciBvbmVvZikgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLmNsZWFyT25lb2Yob25lb2YpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBpbnQgaW5kZXgsIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5zZXRSZXBlYXRlZEZpZWxkKGZpZWxkLCBpbmRleCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVwZWF0ZWRGaWVsZCgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpZWxkRGVzY3JpcHRvciBmaWVsZCwNCiAgICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHZhbHVlKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuYWRkUmVwZWF0ZWRGaWVsZChmaWVsZCwgdmFsdWUpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdClvdGhlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgPT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVxdWVzdElEKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgcmVxdWVzdElEXyA9IG90aGVyLnJlcXVlc3RJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDbGllbnRJRCgpLmlzRW1wdHkoKSkgew0KICAgICAgICAgIGNsaWVudElEXyA9IG90aGVyLmNsaWVudElEXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyAhPSAwKSB7DQogICAgICAgICAgc2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUob3RoZXIuZ2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvdGhlci5nZXRDaGFubmVsKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgY2hhbm5lbF8gPSBvdGhlci5jaGFubmVsXzsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0VmlzaWJpbGl0eVNlY29uZHMoKSAhPSAwKSB7DQogICAgICAgICAgc2V0VmlzaWJpbGl0eVNlY29uZHMob3RoZXIuZ2V0VmlzaWJpbGl0eVNlY29uZHMoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmdldFdhaXRUaW1lU2Vjb25kcygpICE9IDApIHsNCiAgICAgICAgICBzZXRXYWl0VGltZVNlY29uZHMob3RoZXIuZ2V0V2FpdFRpbWVTZWNvbmRzKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5nZXRSZWZTZXF1ZW5jZSgpICE9IDBMKSB7DQogICAgICAgICAgc2V0UmVmU2VxdWVuY2Uob3RoZXIuZ2V0UmVmU2VxdWVuY2UoKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLmhhc01vZGlmaWVkTWVzc2FnZSgpKSB7DQogICAgICAgICAgbWVyZ2VNb2RpZmllZE1lc3NhZ2Uob3RoZXIuZ2V0TW9kaWZpZWRNZXNzYWdlKCkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLnVua25vd25GaWVsZHMpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgZS5nZXRVbmZpbmlzaGVkTWVzc2FnZSgpOw0KICAgICAgICAgIHRocm93IGUudW53cmFwSU9FeGNlcHRpb24oKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICBpZiAocGFyc2VkTWVzc2FnZSAhPSBudWxsKSB7DQogICAgICAgICAgICBtZXJnZUZyb20ocGFyc2VkTWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldFJlcXVlc3RJRCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIHJlcXVlc3RJRF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SUQoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlcXVlc3RJRCgpIHsNCiAgICAgICAgDQogICAgICAgIHJlcXVlc3RJRF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRSZXF1ZXN0SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlcXVlc3RJREJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGNsaWVudElEXyA9ICIiOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2xpZW50SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2xpZW50SURfOw0KICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSkgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9DQogICAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsNCiAgICAgICAgICBjbGllbnRJRF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0Q2xpZW50SURCeXRlcygpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjbGllbnRJRF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2xpZW50SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRDbGllbnRJRCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNsaWVudElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDbGllbnRJRCA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNsaWVudElEKCkgew0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Q2xpZW50SUQoKTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgQ2xpZW50SUQgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2xpZW50SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgY2xpZW50SURfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IDA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUoKSB7DQogICAgICAgIHJldHVybiBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGFWYWx1ZShpbnQgdmFsdWUpIHsNCiAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIGdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YSgpIHsNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSByZXN1bHQgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLnZhbHVlT2Yoc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyk7DQogICAgICAgIHJldHVybiByZXN1bHQgPT0gbnVsbCA/IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuVU5SRUNPR05JWkVEIDogcmVzdWx0Ow0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gdmFsdWUuZ2V0TnVtYmVyKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdHJlYW1SZXF1ZXN0VHlwZURhdGEoKSB7DQogICAgICAgIA0KICAgICAgICBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gMDsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgY2hhbm5lbF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBjaGFubmVsXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgY2hhbm5lbF8gPSBzOw0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBDaGFubmVsID0gNDs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgICBnZXRDaGFubmVsQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gY2hhbm5lbF87DQogICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KA0KICAgICAgICAgICAgICAgICAgKGphdmEubGFuZy5TdHJpbmcpIHJlZik7DQogICAgICAgICAgY2hhbm5lbF8gPSBiOw0KICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbCgNCiAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgDQogICAgICAgIGNoYW5uZWxfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDaGFubmVsKCkgew0KICAgICAgICANCiAgICAgICAgY2hhbm5lbF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRDaGFubmVsKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIENoYW5uZWwgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q2hhbm5lbEJ5dGVzKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIGNoZWNrQnl0ZVN0cmluZ0lzVXRmOCh2YWx1ZSk7DQogICAgICAgIA0KICAgICAgICBjaGFubmVsXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IHZpc2liaWxpdHlTZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFZpc2liaWxpdHlTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpbnQgZ2V0VmlzaWJpbGl0eVNlY29uZHMoKSB7DQogICAgICAgIHJldHVybiB2aXNpYmlsaXR5U2Vjb25kc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFZpc2liaWxpdHlTZWNvbmRzID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFZpc2liaWxpdHlTZWNvbmRzKGludCB2YWx1ZSkgew0KICAgICAgICANCiAgICAgICAgdmlzaWJpbGl0eVNlY29uZHNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgVmlzaWJpbGl0eVNlY29uZHMgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJWaXNpYmlsaXR5U2Vjb25kcygpIHsNCiAgICAgICAgDQogICAgICAgIHZpc2liaWxpdHlTZWNvbmRzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpbnQgd2FpdFRpbWVTZWNvbmRzXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldFdhaXRUaW1lU2Vjb25kcygpIHsNCiAgICAgICAgcmV0dXJuIHdhaXRUaW1lU2Vjb25kc187DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmludDMyIFdhaXRUaW1lU2Vjb25kcyA9IDY7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRXYWl0VGltZVNlY29uZHMoaW50IHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICB3YWl0VGltZVNlY29uZHNfID0gdmFsdWU7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+aW50MzIgV2FpdFRpbWVTZWNvbmRzID0gNjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyV2FpdFRpbWVTZWNvbmRzKCkgew0KICAgICAgICANCiAgICAgICAgd2FpdFRpbWVTZWNvbmRzXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBsb25nIHJlZlNlcXVlbmNlXyA7DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBSZWZTZXF1ZW5jZSA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgbG9uZyBnZXRSZWZTZXF1ZW5jZSgpIHsNCiAgICAgICAgcmV0dXJuIHJlZlNlcXVlbmNlXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+dWludDY0IFJlZlNlcXVlbmNlID0gNzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlZlNlcXVlbmNlKGxvbmcgdmFsdWUpIHsNCiAgICAgICAgDQogICAgICAgIHJlZlNlcXVlbmNlXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnVpbnQ2NCBSZWZTZXF1ZW5jZSA9IDc7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlZlNlcXVlbmNlKCkgew0KICAgICAgICANCiAgICAgICAgcmVmU2VxdWVuY2VfID0gMEw7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBtb2RpZmllZE1lc3NhZ2VfID0gbnVsbDsNCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gaGFzTW9kaWZpZWRNZXNzYWdlKCkgew0KICAgICAgICByZXR1cm4gbW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8gIT0gbnVsbCB8fCBtb2RpZmllZE1lc3NhZ2VfICE9IG51bGw7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlIE1vZGlmaWVkTWVzc2FnZSA9IDg7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgZ2V0TW9kaWZpZWRNZXNzYWdlKCkgew0KICAgICAgICBpZiAobW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBtb2RpZmllZE1lc3NhZ2VfID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IG1vZGlmaWVkTWVzc2FnZV87DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfLmdldE1lc3NhZ2UoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TW9kaWZpZWRNZXNzYWdlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHZhbHVlKSB7DQogICAgICAgIGlmIChtb2RpZmllZE1lc3NhZ2VCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gdmFsdWU7DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTW9kaWZpZWRNZXNzYWdlID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1vZGlmaWVkTWVzc2FnZSgNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgew0KICAgICAgICBpZiAobW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIG1vZGlmaWVkTWVzc2FnZV8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNb2RpZmllZE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgdmFsdWUpIHsNCiAgICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBpZiAobW9kaWZpZWRNZXNzYWdlXyAhPSBudWxsKSB7DQogICAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0NCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UubmV3QnVpbGRlcihtb2RpZmllZE1lc3NhZ2VfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gdmFsdWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTW9kaWZpZWRNZXNzYWdlID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTW9kaWZpZWRNZXNzYWdlKCkgew0KICAgICAgICBpZiAobW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIG1vZGlmaWVkTWVzc2FnZV8gPSBudWxsOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1vZGlmaWVkTWVzc2FnZV8gPSBudWxsOw0KICAgICAgICAgIG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIgZ2V0TW9kaWZpZWRNZXNzYWdlQnVpbGRlcigpIHsNCiAgICAgICAgDQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gZ2V0TW9kaWZpZWRNZXNzYWdlRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgPSA4OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1vZGlmaWVkTWVzc2FnZU9yQnVpbGRlcigpIHsNCiAgICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfICE9IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gbW9kaWZpZWRNZXNzYWdlQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBtb2RpZmllZE1lc3NhZ2VfID09IG51bGwgPw0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IG1vZGlmaWVkTWVzc2FnZV87DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTW9kaWZpZWRNZXNzYWdlID0gODs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+IA0KICAgICAgICAgIGdldE1vZGlmaWVkTWVzc2FnZUZpZWxkQnVpbGRlcigpIHsNCiAgICAgICAgaWYgKG1vZGlmaWVkTWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlclYzPA0KICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXI+KA0KICAgICAgICAgICAgICAgICAgZ2V0TW9kaWZpZWRNZXNzYWdlKCksDQogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLA0KICAgICAgICAgICAgICAgICAgaXNDbGVhbigpKTsNCiAgICAgICAgICBtb2RpZmllZE1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbW9kaWZpZWRNZXNzYWdlQnVpbGRlcl87DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KQ0KICAgIH0NCg0KICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTprdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QpDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgew0KICAgICAgcmV0dXJuIERFRkFVTFRfSU5TVEFOQ0U7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3Q+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0PigpIHsNCiAgICAgIHB1YmxpYyBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCBwYXJzZVBhcnRpYWxGcm9tKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gbmV3IFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3Q+IHBhcnNlcigpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdD4gZ2V0UGFyc2VyRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBQQVJTRVI7DQogICAgfQ0KDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHVibGljIGludGVyZmFjZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VPckJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGludGVyZmFjZV9leHRlbmRzOmt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgew0KDQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRSZXF1ZXN0SURCeXRlcygpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAyOzwvY29kZT4NCiAgICAgKi8NCiAgICBpbnQgZ2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgZ2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBoYXNNZXNzYWdlKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIGdldE1lc3NhZ2UoKTsNCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICovDQogICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VPckJ1aWxkZXIgZ2V0TWVzc2FnZU9yQnVpbGRlcigpOw0KDQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNDs8L2NvZGU+DQogICAgICovDQogICAgYm9vbGVhbiBnZXRJc0Vycm9yKCk7DQoNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgKi8NCiAgICBqYXZhLmxhbmcuU3RyaW5nIGdldEVycm9yKCk7DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNTs8L2NvZGU+DQogICAgICovDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgIGdldEVycm9yQnl0ZXMoKTsNCiAgfQ0KICAvKioNCiAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZX0NCiAgICovDQogIHB1YmxpYyAgc3RhdGljIGZpbmFsIGNsYXNzIFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBleHRlbmRzDQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMyBpbXBsZW1lbnRzDQogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQobWVzc2FnZV9pbXBsZW1lbnRzOmt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpDQogICAgICBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VPckJ1aWxkZXIgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsNCiAgICAvLyBVc2UgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuDQogICAgcHJpdmF0ZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlcjw/PiBidWlsZGVyKSB7DQogICAgICBzdXBlcihidWlsZGVyKTsNCiAgICB9DQogICAgcHJpdmF0ZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UoKSB7DQogICAgICByZXF1ZXN0SURfID0gIiI7DQogICAgICBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID0gMDsNCiAgICAgIGlzRXJyb3JfID0gZmFsc2U7DQogICAgICBlcnJvcl8gPSAiIjsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0DQogICAgZ2V0VW5rbm93bkZpZWxkcygpIHsNCiAgICAgIHJldHVybiB0aGlzLnVua25vd25GaWVsZHM7DQogICAgfQ0KICAgIHByaXZhdGUgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgdGhpcygpOw0KICAgICAgaWYgKGV4dGVuc2lvblJlZ2lzdHJ5ID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgfQ0KICAgICAgaW50IG11dGFibGVfYml0RmllbGQwXyA9IDA7DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQ0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJvb2xlYW4gZG9uZSA9IGZhbHNlOw0KICAgICAgICB3aGlsZSAoIWRvbmUpIHsNCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOw0KICAgICAgICAgIHN3aXRjaCAodGFnKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZFByb3RvMygNCiAgICAgICAgICAgICAgICAgIGlucHV0LCB1bmtub3duRmllbGRzLCBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgew0KICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAxMDogew0KICAgICAgICAgICAgICBqYXZhLmxhbmcuU3RyaW5nIHMgPSBpbnB1dC5yZWFkU3RyaW5nUmVxdWlyZVV0ZjgoKTsNCg0KICAgICAgICAgICAgICByZXF1ZXN0SURfID0gczsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDE2OiB7DQogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7DQoNCiAgICAgICAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IHJhd1ZhbHVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgMjY6IHsNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBzdWJCdWlsZGVyID0gbnVsbDsNCiAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VfICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyID0gbWVzc2FnZV8udG9CdWlsZGVyKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbWVzc2FnZV8gPSBpbnB1dC5yZWFkTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5wYXJzZXIoKSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgICAgICAgICAgICBpZiAoc3ViQnVpbGRlciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20obWVzc2FnZV8pOw0KICAgICAgICAgICAgICAgIG1lc3NhZ2VfID0gc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKTsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAzMjogew0KDQogICAgICAgICAgICAgIGlzRXJyb3JfID0gaW5wdXQucmVhZEJvb2woKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDQyOiB7DQogICAgICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGlucHV0LnJlYWRTdHJpbmdSZXF1aXJlVXRmOCgpOw0KDQogICAgICAgICAgICAgIGVycm9yXyA9IHM7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICB0aHJvdyBlLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBjYXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7DQogICAgICAgIHRocm93IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigNCiAgICAgICAgICAgIGUpLnNldFVuZmluaXNoZWRNZXNzYWdlKHRoaXMpOw0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgdGhpcy51bmtub3duRmllbGRzID0gdW5rbm93bkZpZWxkcy5idWlsZCgpOw0KICAgICAgICBtYWtlRXh0ZW5zaW9uc0ltbXV0YWJsZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICBnZXREZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgLmVuc3VyZUZpZWxkQWNjZXNzb3JzSW5pdGlhbGl6ZWQoDQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmNsYXNzLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5CdWlsZGVyLmNsYXNzKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRVFVRVNUSURfRklFTERfTlVNQkVSID0gMTsNCiAgICBwcml2YXRlIHZvbGF0aWxlIGphdmEubGFuZy5PYmplY3QgcmVxdWVzdElEXzsNCiAgICAvKioNCiAgICAgKiA8Y29kZT5zdHJpbmcgUmVxdWVzdElEID0gMTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSByZXF1ZXN0SURfOw0KICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIGphdmEubGFuZy5TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSANCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgIHJlcXVlc3RJRF8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcNCiAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IHJlcXVlc3RJRF87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgcmVxdWVzdElEXyA9IGI7DQogICAgICAgIHJldHVybiBiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVFJFQU1SRVFVRVNUVFlQRURBVEFfRklFTERfTlVNQkVSID0gMjsNCiAgICBwcml2YXRlIGludCBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfOw0KICAgIC8qKg0KICAgICAqIDxjb2RlPi5rdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGludCBnZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGFWYWx1ZSgpIHsNCiAgICAgIHJldHVybiBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIGdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YSgpIHsNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgcmVzdWx0ID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS52YWx1ZU9mKHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8pOw0KICAgICAgcmV0dXJuIHJlc3VsdCA9PSBudWxsID8gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5VTlJFQ09HTklaRUQgOiByZXN1bHQ7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUVTU0FHRV9GSUVMRF9OVU1CRVIgPSAzOw0KICAgIHByaXZhdGUgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgbWVzc2FnZV87DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2UoKSB7DQogICAgICByZXR1cm4gbWVzc2FnZV8gIT0gbnVsbDsNCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBnZXRNZXNzYWdlKCkgew0KICAgICAgcmV0dXJuIG1lc3NhZ2VfID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSA6IG1lc3NhZ2VfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyIGdldE1lc3NhZ2VPckJ1aWxkZXIoKSB7DQogICAgICByZXR1cm4gZ2V0TWVzc2FnZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElTRVJST1JfRklFTERfTlVNQkVSID0gNDsNCiAgICBwcml2YXRlIGJvb2xlYW4gaXNFcnJvcl87DQogICAgLyoqDQogICAgICogPGNvZGU+Ym9vbCBJc0Vycm9yID0gNDs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGJvb2xlYW4gZ2V0SXNFcnJvcigpIHsNCiAgICAgIHJldHVybiBpc0Vycm9yXzsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFUlJPUl9GSUVMRF9OVU1CRVIgPSA1Ow0KICAgIHByaXZhdGUgdm9sYXRpbGUgamF2YS5sYW5nLk9iamVjdCBlcnJvcl87DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0RXJyb3IoKSB7DQogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBqYXZhLmxhbmcuU3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoamF2YS5sYW5nLlN0cmluZykgcmVmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gDQogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgIGphdmEubGFuZy5TdHJpbmcgcyA9IGJzLnRvU3RyaW5nVXRmOCgpOw0KICAgICAgICBlcnJvcl8gPSBzOw0KICAgICAgICByZXR1cm4gczsNCiAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNTs8L2NvZGU+DQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICBnZXRFcnJvckJ5dGVzKCkgew0KICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBlcnJvcl87DQogICAgICBpZiAocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IA0KICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgZXJyb3JfID0gYjsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsNCiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgew0KICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOw0KICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgPT0gMSkgcmV0dXJuIHRydWU7DQogICAgICBpZiAoaXNJbml0aWFsaXplZCA9PSAwKSByZXR1cm4gZmFsc2U7DQoNCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDEsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gIT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5TdHJlYW1SZXF1ZXN0VHlwZVVua25vd24uZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgb3V0cHV0LndyaXRlRW51bSgyLCBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmIChtZXNzYWdlXyAhPSBudWxsKSB7DQogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMywgZ2V0TWVzc2FnZSgpKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0Vycm9yXyAhPSBmYWxzZSkgew0KICAgICAgICBvdXRwdXQud3JpdGVCb29sKDQsIGlzRXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy53cml0ZVN0cmluZyhvdXRwdXQsIDUsIGVycm9yXyk7DQogICAgICB9DQogICAgICB1bmtub3duRmllbGRzLndyaXRlVG8ob3V0cHV0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgew0KICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNpemU7DQogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7DQoNCiAgICAgIHNpemUgPSAwOw0KICAgICAgaWYgKCFnZXRSZXF1ZXN0SURCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDEsIHJlcXVlc3RJRF8pOw0KICAgICAgfQ0KICAgICAgaWYgKHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gIT0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5TdHJlYW1SZXF1ZXN0VHlwZVVua25vd24uZ2V0TnVtYmVyKCkpIHsNCiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtDQogICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgyLCBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfKTsNCiAgICAgIH0NCiAgICAgIGlmIChtZXNzYWdlXyAhPSBudWxsKSB7DQogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQ0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoMywgZ2V0TWVzc2FnZSgpKTsNCiAgICAgIH0NCiAgICAgIGlmIChpc0Vycm9yXyAhPSBmYWxzZSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0NCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDQsIGlzRXJyb3JfKTsNCiAgICAgIH0NCiAgICAgIGlmICghZ2V0RXJyb3JCeXRlcygpLmlzRW1wdHkoKSkgew0KICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLmNvbXB1dGVTdHJpbmdTaXplKDUsIGVycm9yXyk7DQogICAgICB9DQogICAgICBzaXplICs9IHVua25vd25GaWVsZHMuZ2V0U2VyaWFsaXplZFNpemUoKTsNCiAgICAgIG1lbW9pemVkU2l6ZSA9IHNpemU7DQogICAgICByZXR1cm4gc2l6ZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKGZpbmFsIGphdmEubGFuZy5PYmplY3Qgb2JqKSB7DQogICAgICBpZiAob2JqID09IHRoaXMpIHsNCiAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSkgew0KICAgICAgICByZXR1cm4gc3VwZXIuZXF1YWxzKG9iaik7DQogICAgICB9DQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBvdGhlciA9IChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkgb2JqOw0KDQogICAgICBib29sZWFuIHJlc3VsdCA9IHRydWU7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0UmVxdWVzdElEKCkNCiAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldFJlcXVlc3RJRCgpKTsNCiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfID09IG90aGVyLnN0cmVhbVJlcXVlc3RUeXBlRGF0YV87DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGhhc01lc3NhZ2UoKSA9PSBvdGhlci5oYXNNZXNzYWdlKCkpOw0KICAgICAgaWYgKGhhc01lc3NhZ2UoKSkgew0KICAgICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0TWVzc2FnZSgpDQogICAgICAgICAgICAuZXF1YWxzKG90aGVyLmdldE1lc3NhZ2UoKSk7DQogICAgICB9DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgKGdldElzRXJyb3IoKQ0KICAgICAgICAgID09IG90aGVyLmdldElzRXJyb3IoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgZ2V0RXJyb3IoKQ0KICAgICAgICAgIC5lcXVhbHMob3RoZXIuZ2V0RXJyb3IoKSk7DQogICAgICByZXN1bHQgPSByZXN1bHQgJiYgdW5rbm93bkZpZWxkcy5lcXVhbHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgew0KICAgICAgaWYgKG1lbW9pemVkSGFzaENvZGUgIT0gMCkgew0KICAgICAgICByZXR1cm4gbWVtb2l6ZWRIYXNoQ29kZTsNCiAgICAgIH0NCiAgICAgIGludCBoYXNoID0gNDE7DQogICAgICBoYXNoID0gKDE5ICogaGFzaCkgKyBnZXREZXNjcmlwdG9yKCkuaGFzaENvZGUoKTsNCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIFJFUVVFU1RJRF9GSUVMRF9OVU1CRVI7DQogICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRSZXF1ZXN0SUQoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgU1RSRUFNUkVRVUVTVFRZUEVEQVRBX0ZJRUxEX05VTUJFUjsNCiAgICAgIGhhc2ggPSAoNTMgKiBoYXNoKSArIHN0cmVhbVJlcXVlc3RUeXBlRGF0YV87DQogICAgICBpZiAoaGFzTWVzc2FnZSgpKSB7DQogICAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIE1FU1NBR0VfRklFTERfTlVNQkVSOw0KICAgICAgICBoYXNoID0gKDUzICogaGFzaCkgKyBnZXRNZXNzYWdlKCkuaGFzaENvZGUoKTsNCiAgICAgIH0NCiAgICAgIGhhc2ggPSAoMzcgKiBoYXNoKSArIElTRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5oYXNoQm9vbGVhbigNCiAgICAgICAgICBnZXRJc0Vycm9yKCkpOw0KICAgICAgaGFzaCA9ICgzNyAqIGhhc2gpICsgRVJST1JfRklFTERfTlVNQkVSOw0KICAgICAgaGFzaCA9ICg1MyAqIGhhc2gpICsgZ2V0RXJyb3IoKS5oYXNoQ29kZSgpOw0KICAgICAgaGFzaCA9ICgyOSAqIGhhc2gpICsgdW5rbm93bkZpZWxkcy5oYXNoQ29kZSgpOw0KICAgICAgbWVtb2l6ZWRIYXNoQ29kZSA9IGhhc2g7DQogICAgICByZXR1cm4gaGFzaDsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5uaW8uQnl0ZUJ1ZmZlciBkYXRhKQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBqYXZhLm5pby5CeXRlQnVmZmVyIGRhdGEsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gew0KICAgICAgcmV0dXJuIFBBUlNFUi5wYXJzZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpDQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gUEFSU0VSLnBhcnNlRnJvbShkYXRhKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oDQogICAgICAgIGJ5dGVbXSBkYXRhLA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkNCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBQQVJTRVIucGFyc2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkNCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgcmV0dXJuIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzDQogICAgICAgICAgLnBhcnNlV2l0aElPRXhjZXB0aW9uKFBBUlNFUiwgaW5wdXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZVdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpDQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsNCiAgICAgIHJldHVybiBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgIC5wYXJzZURlbGltaXRlZFdpdGhJT0V4Y2VwdGlvbihQQVJTRVIsIGlucHV0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZURlbGltaXRlZEZyb20oDQogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VEZWxpbWl0ZWRXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlRnJvbSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcGFyc2VGcm9tKA0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7DQogICAgICByZXR1cm4gY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMNCiAgICAgICAgICAucGFyc2VXaXRoSU9FeGNlcHRpb24oUEFSU0VSLCBpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcHJvdG90eXBlKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRS50b0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsNCiAgICB9DQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgew0KICAgICAgcmV0dXJuIHRoaXMgPT0gREVGQVVMVF9JTlNUQU5DRQ0KICAgICAgICAgID8gbmV3IEJ1aWxkZXIoKSA6IG5ldyBCdWlsZGVyKCkubWVyZ2VGcm9tKHRoaXMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgNCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7DQogICAgICByZXR1cm4gYnVpbGRlcjsNCiAgICB9DQogICAgLyoqDQogICAgICogUHJvdG9idWYgdHlwZSB7QGNvZGUga3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZX0NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcw0KICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5CdWlsZGVyPEJ1aWxkZXI+IGltcGxlbWVudHMNCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfaW1wbGVtZW50czprdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKQ0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZU9yQnVpbGRlciB7DQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLmludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogICAgICB9DQoNCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlDQogICAgICAgICAgICAuZW5zdXJlRmllbGRBY2Nlc3NvcnNJbml0aWFsaXplZCgNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5jbGFzcywgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7DQogICAgICB9DQoNCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5uZXdCdWlsZGVyKCkNCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIEJ1aWxkZXIoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsNCiAgICAgICAgc3VwZXIocGFyZW50KTsNCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOw0KICAgICAgfQ0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMw0KICAgICAgICAgICAgICAgIC5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgew0KICAgICAgICBzdXBlci5jbGVhcigpOw0KICAgICAgICByZXF1ZXN0SURfID0gIiI7DQoNCiAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IDA7DQoNCiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgbWVzc2FnZV8gPSBudWxsOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlzRXJyb3JfID0gZmFsc2U7DQoNCiAgICAgICAgZXJyb3JfID0gIiI7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7DQogICAgICAgIHJldHVybiBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGJ1aWxkKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsNCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgYnVpbGRQYXJ0aWFsKCkgew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXN1bHQgPSBuZXcgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UodGhpcyk7DQogICAgICAgIHJlc3VsdC5yZXF1ZXN0SURfID0gcmVxdWVzdElEXzsNCiAgICAgICAgcmVzdWx0LnN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gPSBzdHJlYW1SZXF1ZXN0VHlwZURhdGFfOw0KICAgICAgICBpZiAobWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICByZXN1bHQubWVzc2FnZV8gPSBtZXNzYWdlXzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXN1bHQubWVzc2FnZV8gPSBtZXNzYWdlQnVpbGRlcl8uYnVpbGQoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXN1bHQuaXNFcnJvcl8gPSBpc0Vycm9yXzsNCiAgICAgICAgcmVzdWx0LmVycm9yXyA9IGVycm9yXzsNCiAgICAgICAgb25CdWlsdCgpOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgfQ0KDQogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5jbG9uZSgpOw0KICAgICAgfQ0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RmllbGQoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWVsZERlc2NyaXB0b3IgZmllbGQsDQogICAgICAgICAgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJGaWVsZChmaWVsZCk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9uZW9mKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuT25lb2ZEZXNjcmlwdG9yIG9uZW9mKSB7DQogICAgICAgIHJldHVybiAoQnVpbGRlcikgc3VwZXIuY2xlYXJPbmVvZihvbmVvZik7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGludCBpbmRleCwgamF2YS5sYW5nLk9iamVjdCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gKEJ1aWxkZXIpIHN1cGVyLnNldFJlcGVhdGVkRmllbGQoZmllbGQsIGluZGV4LCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBlYXRlZEZpZWxkKA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmllbGREZXNjcmlwdG9yIGZpZWxkLA0KICAgICAgICAgIGphdmEubGFuZy5PYmplY3QgdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIChCdWlsZGVyKSBzdXBlci5hZGRSZXBlYXRlZEZpZWxkKGZpZWxkLCB2YWx1ZSk7DQogICAgICB9DQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSB7DQogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2Upb3RoZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmICghb3RoZXIuZ2V0UmVxdWVzdElEKCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgcmVxdWVzdElEXyA9IG90aGVyLnJlcXVlc3RJRF87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG90aGVyLnN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gIT0gMCkgew0KICAgICAgICAgIHNldFN0cmVhbVJlcXVlc3RUeXBlRGF0YVZhbHVlKG90aGVyLmdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YVZhbHVlKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvdGhlci5oYXNNZXNzYWdlKCkpIHsNCiAgICAgICAgICBtZXJnZU1lc3NhZ2Uob3RoZXIuZ2V0TWVzc2FnZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3RoZXIuZ2V0SXNFcnJvcigpICE9IGZhbHNlKSB7DQogICAgICAgICAgc2V0SXNFcnJvcihvdGhlci5nZXRJc0Vycm9yKCkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghb3RoZXIuZ2V0RXJyb3IoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICBlcnJvcl8gPSBvdGhlci5lcnJvcl87DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIudW5rbm93bkZpZWxkcyk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpDQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gew0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBwYXJzZWRNZXNzYWdlID0gbnVsbDsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBwYXJzZWRNZXNzYWdlID0gUEFSU0VSLnBhcnNlUGFydGlhbEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KTsNCiAgICAgICAgfSBjYXRjaCAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgew0KICAgICAgICAgIHBhcnNlZE1lc3NhZ2UgPSAoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpIGUuZ2V0VW5maW5pc2hlZE1lc3NhZ2UoKTsNCiAgICAgICAgICB0aHJvdyBlLnVud3JhcElPRXhjZXB0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgaWYgKHBhcnNlZE1lc3NhZ2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgbWVyZ2VGcm9tKHBhcnNlZE1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IHJlcXVlc3RJRF8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRSZXF1ZXN0SUQoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgcmVxdWVzdElEXyA9IHM7DQogICAgICAgICAgcmV0dXJuIHM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChqYXZhLmxhbmcuU3RyaW5nKSByZWY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nDQogICAgICAgICAgZ2V0UmVxdWVzdElEQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gcmVxdWVzdElEXzsNCiAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgew0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoDQogICAgICAgICAgICAgICAgICAoamF2YS5sYW5nLlN0cmluZykgcmVmKTsNCiAgICAgICAgICByZXF1ZXN0SURfID0gYjsNCiAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmVxdWVzdElEKA0KICAgICAgICAgIGphdmEubGFuZy5TdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPnN0cmluZyBSZXF1ZXN0SUQgPSAxOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZXF1ZXN0SUQoKSB7DQogICAgICAgIA0KICAgICAgICByZXF1ZXN0SURfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0UmVxdWVzdElEKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIFJlcXVlc3RJRCA9IDE7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXF1ZXN0SURCeXRlcygNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgfQ0KICBjaGVja0J5dGVTdHJpbmdJc1V0ZjgodmFsdWUpOw0KICAgICAgICANCiAgICAgICAgcmVxdWVzdElEXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgaW50IHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gPSAwOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW50IGdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YVZhbHVlKCkgew0KICAgICAgICByZXR1cm4gc3RyZWFtUmVxdWVzdFR5cGVEYXRhXzsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhVmFsdWUoaW50IHZhbHVlKSB7DQogICAgICAgIHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSA9IDI7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBnZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoKSB7DQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgcmVzdWx0ID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS52YWx1ZU9mKHN0cmVhbVJlcXVlc3RUeXBlRGF0YV8pOw0KICAgICAgICByZXR1cm4gcmVzdWx0ID09IG51bGwgPyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLlVOUkVDT0dOSVpFRCA6IHJlc3VsdDsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZSBTdHJlYW1SZXF1ZXN0VHlwZURhdGEgPSAyOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IHZhbHVlLmdldE51bWJlcigpOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhID0gMjs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3RyZWFtUmVxdWVzdFR5cGVEYXRhKCkgew0KICAgICAgICANCiAgICAgICAgc3RyZWFtUmVxdWVzdFR5cGVEYXRhXyA9IDA7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcHJpdmF0ZSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSBtZXNzYWdlXyA9IG51bGw7DQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyVjM8DQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPiBtZXNzYWdlQnVpbGRlcl87DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2UgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gaGFzTWVzc2FnZSgpIHsNCiAgICAgICAgcmV0dXJuIG1lc3NhZ2VCdWlsZGVyXyAhPSBudWxsIHx8IG1lc3NhZ2VfICE9IG51bGw7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPi5rdWJlbXEuUXVldWVNZXNzYWdlIE1lc3NhZ2UgPSAzOzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIGdldE1lc3NhZ2UoKSB7DQogICAgICAgIGlmIChtZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIHJldHVybiBtZXNzYWdlXyA9PSBudWxsID8gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkgOiBtZXNzYWdlXzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZUJ1aWxkZXJfLmdldE1lc3NhZ2UoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgdmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBtZXNzYWdlXyA9IHZhbHVlOw0KICAgICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2VCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2UoDQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgbWVzc2FnZV8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8uc2V0TWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZU1lc3NhZ2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UgdmFsdWUpIHsNCiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBudWxsKSB7DQogICAgICAgICAgaWYgKG1lc3NhZ2VfICE9IG51bGwpIHsNCiAgICAgICAgICAgIG1lc3NhZ2VfID0NCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UubmV3QnVpbGRlcihtZXNzYWdlXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbWVzc2FnZV8gPSB2YWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWVzc2FnZUJ1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1lc3NhZ2UoKSB7DQogICAgICAgIGlmIChtZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgew0KICAgICAgICAgIG1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlXyA9IG51bGw7DQogICAgICAgICAgbWVzc2FnZUJ1aWxkZXJfID0gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5CdWlsZGVyIGdldE1lc3NhZ2VCdWlsZGVyKCkgew0KICAgICAgICANCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiBnZXRNZXNzYWdlRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT4ua3ViZW1xLlF1ZXVlTWVzc2FnZSBNZXNzYWdlID0gMzs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZU9yQnVpbGRlciBnZXRNZXNzYWdlT3JCdWlsZGVyKCkgew0KICAgICAgICBpZiAobWVzc2FnZUJ1aWxkZXJfICE9IG51bGwpIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZUJ1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gbWVzc2FnZV8gPT0gbnVsbCA/DQogICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpIDogbWVzc2FnZV87DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UgTWVzc2FnZSA9IDM7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyVjM8DQogICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPiANCiAgICAgICAgICBnZXRNZXNzYWdlRmllbGRCdWlsZGVyKCkgew0KICAgICAgICBpZiAobWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsNCiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXJWMzwNCiAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLkJ1aWxkZXIsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlT3JCdWlsZGVyPigNCiAgICAgICAgICAgICAgICAgIGdldE1lc3NhZ2UoKSwNCiAgICAgICAgICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksDQogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOw0KICAgICAgICAgIG1lc3NhZ2VfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWVzc2FnZUJ1aWxkZXJfOw0KICAgICAgfQ0KDQogICAgICBwcml2YXRlIGJvb2xlYW4gaXNFcnJvcl8gOw0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGJvb2xlYW4gZ2V0SXNFcnJvcigpIHsNCiAgICAgICAgcmV0dXJuIGlzRXJyb3JfOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5ib29sIElzRXJyb3IgPSA0OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0SXNFcnJvcihib29sZWFuIHZhbHVlKSB7DQogICAgICAgIA0KICAgICAgICBpc0Vycm9yXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICAvKioNCiAgICAgICAqIDxjb2RlPmJvb2wgSXNFcnJvciA9IDQ7PC9jb2RlPg0KICAgICAgICovDQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcklzRXJyb3IoKSB7DQogICAgICAgIA0KICAgICAgICBpc0Vycm9yXyA9IGZhbHNlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBlcnJvcl8gPSAiIjsNCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBqYXZhLmxhbmcuU3RyaW5nIGdldEVycm9yKCkgew0KICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGVycm9yXzsNCiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgamF2YS5sYW5nLlN0cmluZykpIHsNCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPQ0KICAgICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7DQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7DQogICAgICAgICAgZXJyb3JfID0gczsNCiAgICAgICAgICByZXR1cm4gczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gKGphdmEubGFuZy5TdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZw0KICAgICAgICAgIGdldEVycm9yQnl0ZXMoKSB7DQogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gZXJyb3JfOw0KICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7DQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGIgPSANCiAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgNCiAgICAgICAgICAgICAgICAgIChqYXZhLmxhbmcuU3RyaW5nKSByZWYpOw0KICAgICAgICAgIGVycm9yXyA9IGI7DQogICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RXJyb3IoDQogICAgICAgICAgamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgew0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOw0KICB9DQogIA0KICAgICAgICBlcnJvcl8gPSB2YWx1ZTsNCiAgICAgICAgb25DaGFuZ2VkKCk7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgLyoqDQogICAgICAgKiA8Y29kZT5zdHJpbmcgRXJyb3IgPSA1OzwvY29kZT4NCiAgICAgICAqLw0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFcnJvcigpIHsNCiAgICAgICAgDQogICAgICAgIGVycm9yXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEVycm9yKCk7DQogICAgICAgIG9uQ2hhbmdlZCgpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCiAgICAgIC8qKg0KICAgICAgICogPGNvZGU+c3RyaW5nIEVycm9yID0gNTs8L2NvZGU+DQogICAgICAgKi8NCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVycm9yQnl0ZXMoDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7DQogIH0NCiAgY2hlY2tCeXRlU3RyaW5nSXNVdGY4KHZhbHVlKTsNCiAgICAgICAgDQogICAgICAgIGVycm9yXyA9IHZhbHVlOw0KICAgICAgICBvbkNoYW5nZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQogICAgICBwdWJsaWMgZmluYWwgQnVpbGRlciBzZXRVbmtub3duRmllbGRzKA0KICAgICAgICAgIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0IHVua25vd25GaWVsZHMpIHsNCiAgICAgICAgcmV0dXJuIHN1cGVyLnNldFVua25vd25GaWVsZHNQcm90bzModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCiAgICAgIHB1YmxpYyBmaW5hbCBCdWlsZGVyIG1lcmdlVW5rbm93bkZpZWxkcygNCiAgICAgICAgICBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldCB1bmtub3duRmllbGRzKSB7DQogICAgICAgIHJldHVybiBzdXBlci5tZXJnZVVua25vd25GaWVsZHModW5rbm93bkZpZWxkcyk7DQogICAgICB9DQoNCg0KICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6a3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkNCiAgICB9DQoNCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6a3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSkNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBERUZBVUxUX0lOU1RBTkNFOw0KICAgIHN0YXRpYyB7DQogICAgICBERUZBVUxUX0lOU1RBTkNFID0gbmV3IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0YXRpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7DQogICAgICByZXR1cm4gREVGQVVMVF9JTlNUQU5DRTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLlBhcnNlcjxTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+DQogICAgICAgIFBBUlNFUiA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkFic3RyYWN0UGFyc2VyPFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4oKSB7DQogICAgICBwdWJsaWMgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHBhcnNlUGFydGlhbEZyb20oDQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LA0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQ0KICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBuZXcgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBwYXJzZXIoKSB7DQogICAgICByZXR1cm4gUEFSU0VSOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5QYXJzZXI8U3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRQYXJzZXJGb3JUeXBlKCkgew0KICAgICAgcmV0dXJuIFBBUlNFUjsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsNCiAgICAgIHJldHVybiBERUZBVUxUX0lOU1RBTkNFOw0KICAgIH0NCg0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9QaW5nUmVzdWx0X2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9QaW5nUmVzdWx0X2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FbXB0eV9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRW1wdHlfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3VsdF9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzdWx0X2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50X1RhZ3NFbnRyeV9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfVGFnc0VudHJ5X2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudFJlY2VpdmVfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX1RhZ3NFbnRyeV9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX1RhZ3NFbnRyeV9maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3Vic2NyaWJlX2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdWJzY3JpYmVfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlcXVlc3RfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlcXVlc3RfVGFnc0VudHJ5X2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X1RhZ3NFbnRyeV9maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzcG9uc2VfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXNwb25zZV9UYWdzRW50cnlfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX1RhZ3NFbnRyeV9maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlX2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9UYWdzRW50cnlfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9UYWdzRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlX2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19maWVsZEFjY2Vzc29yVGFibGU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcg0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlUG9saWN5X2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VQb2xpY3lfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1NlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRfZGVzY3JpcHRvcjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgDQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlDQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1NlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3I7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIA0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0Fja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZV9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yDQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3INCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZV9kZXNjcmlwdG9yOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCANCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUNCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsNCg0KICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3INCiAgICAgIGdldERlc2NyaXB0b3IoKSB7DQogICAgcmV0dXJuIGRlc2NyaXB0b3I7DQogIH0NCiAgcHJpdmF0ZSBzdGF0aWMgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3INCiAgICAgIGRlc2NyaXB0b3I7DQogIHN0YXRpYyB7DQogICAgamF2YS5sYW5nLlN0cmluZ1tdIGRlc2NyaXB0b3JEYXRhID0gew0KICAgICAgIlxuXDAxNGt1YmVtcS5wcm90b1wwMjJcMDA2a3ViZW1xXCJhXG5cblBpbmdSZXN1bHRcMDIyXDAxNFxuXDAwNCIgKw0KICAgICAgIkhvc3RcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMTdcblwwMDdWZXJzaW9uXDAzMFwwMDIgXDAwMShcdFwwMjJcMDI3XG5cMDE3U2VydmVyU3RhIiArDQogICAgICAicnRUaW1lXDAzMFwwMDMgXDAwMShcMDAzXDAyMlwwMzNcblwwMjNTZXJ2ZXJVcFRpbWVTZWNvbmRzXDAzMFwwMDQgXDAwMSgiICsNCiAgICAgICJcMDAzXCJcMDA3XG5cMDA1RW1wdHlcIjZcblwwMDZSZXN1bHRcMDIyXDAxN1xuXDAwN0V2ZW50SURcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMTRcbiIgKw0KICAgICAgIlwwMDRTZW50XDAzMFwwMDIgXDAwMShcMDEwXDAyMlxyXG5cMDA1RXJyb3JcMDMwXDAwMyBcMDAxKFx0XCJcMjc2XDAwMVxuXDAwNUV2ZW50XDAyMlwwMTdcblwwMDciICsNCiAgICAgICJFdmVudElEXDAzMFwwMDEgXDAwMShcdFwwMjJcMDIwXG5cMDEwQ2xpZW50SURcMDMwXDAwMiBcMDAxKFx0XDAyMlwwMTdcblwwMDdDaGFubiIgKw0KICAgICAgImVsXDAzMFwwMDMgXDAwMShcdFwwMjJcMDIwXG5cMDEwTWV0YWRhdGFcMDMwXDAwNCBcMDAxKFx0XDAyMlwwMTRcblwwMDRCb2R5XDAzMFwwMDUgXDAwMShcMDE0IiArDQogICAgICAiXDAyMlxyXG5cMDA1U3RvcmVcMDMwXDAwNiBcMDAxKFwwMTBcMDIyJVxuXDAwNFRhZ3NcMDMwXDAwNyBcMDAzKFwwMTMyXDAyNy5rdWJlbXEuRSIgKw0KICAgICAgInZlbnQuVGFnc0VudHJ5XDAzMitcblx0VGFnc0VudHJ5XDAyMlwwMTNcblwwMDNrZXlcMDMwXDAwMSBcMDAxKFx0IiArDQogICAgICAiXDAyMlxyXG5cMDA1dmFsdWVcMDMwXDAwMiBcMDAxKFx0OlwwMDI4XDAwMVwiXDMyMFwwMDFcblwwMTRFdmVudFJlY2VpdmVcMDIyXDAxN1xuXDAwNyIgKw0KICAgICAgIkV2ZW50SURcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMTdcblwwMDdDaGFubmVsXDAzMFwwMDIgXDAwMShcdFwwMjJcMDIwXG5cMDEwTWV0YWRhIiArDQogICAgICAidGFcMDMwXDAwMyBcMDAxKFx0XDAyMlwwMTRcblwwMDRCb2R5XDAzMFwwMDQgXDAwMShcMDE0XDAyMlwwMjFcblx0VGltZXN0YW1wXDAzMFwwMDUgXDAwMSgiICsNCiAgICAgICJcMDAzXDAyMlwwMjBcblwwMTBTZXF1ZW5jZVwwMzBcMDA2IFwwMDEoXDAwNFwwMjIsXG5cMDA0VGFnc1wwMzBcMDA3IFwwMDMoXDAxMzJcMDM2Lmt1YmUiICsNCiAgICAgICJtcS5FdmVudFJlY2VpdmUuVGFnc0VudHJ5XDAzMitcblx0VGFnc0VudHJ5XDAyMlwwMTMiICsNCiAgICAgICJcblwwMDNrZXlcMDMwXDAwMSBcMDAxKFx0XDAyMlxyXG5cMDA1dmFsdWVcMDMwXDAwMiBcMDAxKFx0OlwwMDI4XDAwMVwiXDM0M1wwMDNcblx0U3Vic2MiICsNCiAgICAgICJyaWJlXDAyMjpcblwwMjFTdWJzY3JpYmVUeXBlRGF0YVwwMzBcMDAxIFwwMDEoXDAxNjJcMDM3Lmt1YmVtcSIgKw0KICAgICAgIi5TdWJzY3JpYmUuU3Vic2NyaWJlVHlwZVwwMjJcMDIwXG5cMDEwQ2xpZW50SURcMDMwXDAwMiBcMDAxIiArDQogICAgICAiKFx0XDAyMlwwMTdcblwwMDdDaGFubmVsXDAzMFwwMDMgXDAwMShcdFwwMjJcclxuXDAwNUdyb3VwXDAzMFwwMDQgXDAwMShcdFwwMjI+XG5cMDIzRXYiICsNCiAgICAgICJlbnRzU3RvcmVUeXBlRGF0YVwwMzBcMDA1IFwwMDEoXDAxNjIhLmt1YmVtcS5TdWJzY3JpIiArDQogICAgICAiYmUuRXZlbnRzU3RvcmVUeXBlXDAyMlwwMzRcblwwMjRFdmVudHNTdG9yZVR5cGVWYWwiICsNCiAgICAgICJ1ZVwwMzBcMDA2IFwwMDEoXDAwM1wiY1xuXHJTdWJzY3JpYmVUeXBlXDAyMlwwMzJcblwwMjZTdWJzY3JpYmVUeSIgKw0KICAgICAgInBlVW5kZWZpbmVkXDAyMFwwMDBcMDIyXG5cblwwMDZFdmVudHNcMDIwXDAwMVwwMjJcMDE3XG5cMDEzRXZlbnRzU3RvcmUiICsNCiAgICAgICJcMDIwXDAwMlwwMjJcMDE0XG5cMDEwQ29tbWFuZHNcMDIwXDAwM1wwMjJcMDEzXG5cMDA3UXVlcmllc1wwMjBcMDA0XCJcMjQ0XDAwMVxuXDAxN0V2ZW50cyIgKw0KICAgICAgIlN0b3JlVHlwZVwwMjJcMDM0XG5cMDMwRXZlbnRzU3RvcmVUeXBlVW5kZWZpbmVkXDAyMFwwMDBcMDIyIiArDQogICAgICAiXDAyMFxuXDAxNFN0YXJ0TmV3T25seVwwMjBcMDAxXDAyMlwwMjJcblwwMTZTdGFydEZyb21GaXJzdFwwMjBcMDAyXDAyMlwwMjFcbiIgKw0KICAgICAgIlxyU3RhcnRGcm9tTGFzdFwwMjBcMDAzXDAyMlwwMjNcblwwMTdTdGFydEF0U2VxdWVuY2VcMDIwXDAwNFwwMjJcMDE3XG4iICsNCiAgICAgICJcMDEzU3RhcnRBdFRpbWVcMDIwXDAwNVwwMjJcMDI0XG5cMDIwU3RhcnRBdFRpbWVEZWx0YVwwMjBcMDA2XCJcMjAzXDAwM1xuIiArDQogICAgICAiXDAwN1JlcXVlc3RcMDIyXDAyMVxuXHRSZXF1ZXN0SURcMDMwXDAwMSBcMDAxKFx0XDAyMjRcblwwMTdSZXF1ZXN0VHkiICsNCiAgICAgICJwZURhdGFcMDMwXDAwMiBcMDAxKFwwMTYyXDAzMy5rdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwIiArDQogICAgICAiZVwwMjJcMDIwXG5cMDEwQ2xpZW50SURcMDMwXDAwMyBcMDAxKFx0XDAyMlwwMTdcblwwMDdDaGFubmVsXDAzMFwwMDQgXDAwMShcdFwwMjJcMDIwXG5cMDEwIiArDQogICAgICAiTWV0YWRhdGFcMDMwXDAwNSBcMDAxKFx0XDAyMlwwMTRcblwwMDRCb2R5XDAzMFwwMDYgXDAwMShcMDE0XDAyMlwwMjRcblwwMTRSZXBseUNoYSIgKw0KICAgICAgIm5uZWxcMDMwXDAwNyBcMDAxKFx0XDAyMlwwMTdcblwwMDdUaW1lb3V0XDAzMFwwMTAgXDAwMShcMDA1XDAyMlwwMjBcblwwMTBDYWNoZUtleVwwMzAiICsNCiAgICAgICJcdCBcMDAxKFx0XDAyMlwwMjBcblwwMTBDYWNoZVRUTFwwMzBcbiBcMDAxKFwwMDVcMDIyXDAxNFxuXDAwNFNwYW5cMDMwXDAxMyBcMDAxKFwwMTRcMDIyXCdcbiIgKw0KICAgICAgIlwwMDRUYWdzXDAzMFwwMTQgXDAwMyhcMDEzMlwwMzEua3ViZW1xLlJlcXVlc3QuVGFnc0VudHJ5XDAzMisiICsNCiAgICAgICJcblx0VGFnc0VudHJ5XDAyMlwwMTNcblwwMDNrZXlcMDMwXDAwMSBcMDAxKFx0XDAyMlxyXG5cMDA1dmFsdWVcMDMwXDAwMiBcMDAxKFx0OiIgKw0KICAgICAgIlwwMDI4XDAwMVwiPVxuXDAxM1JlcXVlc3RUeXBlXDAyMlwwMjZcblwwMjJSZXF1ZXN0VHlwZVVua25vd24iICsNCiAgICAgICJcMDIwXDAwMFwwMjJcMDEzXG5cMDA3Q29tbWFuZFwwMjBcMDAxXDAyMlx0XG5cMDA1UXVlcnlcMDIwXDAwMlwiXDIyMFwwMDJcblwwMTBSZXNwb25zZVwwMjIiICsNCiAgICAgICJcMDIwXG5cMDEwQ2xpZW50SURcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMjFcblx0UmVxdWVzdElEXDAzMFwwMDIgXDAwMShcdFwwMjJcMDI0XG5cMDE0IiArDQogICAgICAiUmVwbHlDaGFubmVsXDAzMFwwMDMgXDAwMShcdFwwMjJcMDIwXG5cMDEwTWV0YWRhdGFcMDMwXDAwNCBcMDAxKFx0XDAyMlwwMTRcblwwMDQiICsNCiAgICAgICJCb2R5XDAzMFwwMDUgXDAwMShcMDE0XDAyMlwwMjBcblwwMTBDYWNoZUhpdFwwMzBcMDA2IFwwMDEoXDAxMFwwMjJcMDIxXG5cdFRpbWVzdGFtIiArDQogICAgICAicFwwMzBcMDA3IFwwMDEoXDAwM1wwMjJcMDIwXG5cMDEwRXhlY3V0ZWRcMDMwXDAxMCBcMDAxKFwwMTBcMDIyXHJcblwwMDVFcnJvclwwMzBcdCBcMDAxKFx0IiArDQogICAgICAiXDAyMlwwMTRcblwwMDRTcGFuXDAzMFxuIFwwMDEoXDAxNFwwMjIoXG5cMDA0VGFnc1wwMzBcMDEzIFwwMDMoXDAxMzJcMDMyLmt1YmVtcS5SZSIgKw0KICAgICAgInNwb25zZS5UYWdzRW50cnlcMDMyK1xuXHRUYWdzRW50cnlcMDIyXDAxM1xuXDAwM2tleVwwMzBcMDAxIFwwMDEiICsNCiAgICAgICIoXHRcMDIyXHJcblwwMDV2YWx1ZVwwMzBcMDAyIFwwMDEoXHQ6XDAwMjhcMDAxXCJcMjM3XDAwMlxuXDAxNFF1ZXVlTWVzc2FnZVwwMjJcMDIxIiArDQogICAgICAiXG5cdE1lc3NhZ2VJRFwwMzBcMDAxIFwwMDEoXHRcMDIyXDAyMFxuXDAxMENsaWVudElEXDAzMFwwMDIgXDAwMShcdFwwMjJcMDE3XG5cMDA3QyIgKw0KICAgICAgImhhbm5lbFwwMzBcMDAzIFwwMDEoXHRcMDIyXDAyMFxuXDAxME1ldGFkYXRhXDAzMFwwMDQgXDAwMShcdFwwMjJcMDE0XG5cMDA0Qm9keVwwMzBcMDA1IiArDQogICAgICAiIFwwMDEoXDAxNFwwMjIsXG5cMDA0VGFnc1wwMzBcMDA2IFwwMDMoXDAxMzJcMDM2Lmt1YmVtcS5RdWV1ZU1lc3NhZ2UiICsNCiAgICAgICIuVGFnc0VudHJ5XDAyMjJcblxuQXR0cmlidXRlc1wwMzBcMDA3IFwwMDEoXDAxMzJcMDM2Lmt1YmVtcS4iICsNCiAgICAgICJRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzXDAyMipcblwwMDZQb2xpY3lcMDMwXDAxMCBcMDAxKFwwMTMyXDAzMiIgKw0KICAgICAgIi5rdWJlbXEuUXVldWVNZXNzYWdlUG9saWN5XDAzMitcblx0VGFnc0VudHJ5XDAyMiIgKw0KICAgICAgIlwwMTNcblwwMDNrZXlcMDMwXDAwMSBcMDAxKFx0XDAyMlxyXG5cMDA1dmFsdWVcMDMwXDAwMiBcMDAxKFx0OlwwMDI4XDAwMVwiVFxuXDAzMVF1ZXVlIiArDQogICAgICAiTWVzc2FnZXNCYXRjaFJlcXVlc3RcMDIyXDAxN1xuXDAwN0JhdGNoSURcMDMwXDAwMSBcMDAxKFx0XDAyMiZcbiIgKw0KICAgICAgIlwwMTBNZXNzYWdlc1wwMzBcMDAyIFwwMDMoXDAxMzJcMDI0Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VcInJcbiIgKw0KICAgICAgIlwwMzJRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZVwwMjJcMDE3XG5cMDA3QmF0Y2hJRFwwMzBcMDAxIiArDQogICAgICAiIFwwMDEoXHRcMDIyL1xuXDAwN1Jlc3VsdHNcMDMwXDAwMiBcMDAzKFwwMTMyXDAzNi5rdWJlbXEuU2VuZFF1ZXVlIiArDQogICAgICAiTWVzc2FnZVJlc3VsdFwwMjJcMDIyXG5cbkhhdmVFcnJvcnNcMDMwXDAwMyBcMDAxKFwwMTBcIlwyNzRcMDAxXG5cMDI2UXUiICsNCiAgICAgICJldWVNZXNzYWdlQXR0cmlidXRlc1wwMjJcMDIxXG5cdFRpbWVzdGFtcFwwMzBcMDAxIFwwMDEoXDAwM1wwMjIiICsNCiAgICAgICJcMDIwXG5cMDEwU2VxdWVuY2VcMDMwXDAwMiBcMDAxKFwwMDRcMDIyXDAyMVxuXHRNRDVPZkJvZHlcMDMwXDAwMyBcMDAxKFx0XDAyMlwwMjRcblwwMTQiICsNCiAgICAgICJSZWNlaXZlQ291bnRcMDMwXDAwNCBcMDAxKFwwMDVcMDIyXDAyMFxuXDAxMFJlUm91dGVkXDAzMFwwMDUgXDAwMShcMDEwXDAyMlwwMzFcblwwMjEiICsNCiAgICAgICJSZVJvdXRlZEZyb21RdWV1ZVwwMzBcMDA2IFwwMDEoXHRcMDIyXDAyNFxuXDAxNEV4cGlyYXRpb25BdFwwMzAiICsNCiAgICAgICJcMDA3IFwwMDEoXDAwM1wwMjJcMDIxXG5cdERlbGF5ZWRUb1wwMzBcMDEwIFwwMDEoXDAwM1wid1xuXDAyMlF1ZXVlTWVzc2FnZSIgKw0KICAgICAgIlBvbGljeVwwMjJcMDMxXG5cMDIxRXhwaXJhdGlvblNlY29uZHNcMDMwXDAwMSBcMDAxKFwwMDVcMDIyXDAyNFxuXDAxNERlbCIgKw0KICAgICAgImF5U2Vjb25kc1wwMzBcMDAyIFwwMDEoXDAwNVwwMjJcMDI3XG5cMDE3TWF4UmVjZWl2ZUNvdW50XDAzMFwwMDMgXDAwMShcMDA1IiArDQogICAgICAiXDAyMlwwMjdcblwwMTdNYXhSZWNlaXZlUXVldWVcMDMwXDAwNCBcMDAxKFx0XCJcMjA0XDAwMVxuXDAyNlNlbmRRdWV1ZU0iICsNCiAgICAgICJlc3NhZ2VSZXN1bHRcMDIyXDAyMVxuXHRNZXNzYWdlSURcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMTZcblwwMDZTZW50QSIgKw0KICAgICAgInRcMDMwXDAwMiBcMDAxKFwwMDNcMDIyXDAyNFxuXDAxNEV4cGlyYXRpb25BdFwwMzBcMDAzIFwwMDEoXDAwM1wwMjJcMDIxXG5cdERlbGF5ZWQiICsNCiAgICAgICJUb1wwMzBcMDA0IFwwMDEoXDAwM1wwMjJcMDE3XG5cMDA3SXNFcnJvclwwMzBcMDA1IFwwMDEoXDAxMFwwMjJcclxuXDAwNUVycm9yXDAzMFwwMDYgXDAwMShcdCIgKw0KICAgICAgIlwiXDIzMVwwMDFcblwwMzNSZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3RcMDIyXDAyMVxuXHRSZXF1IiArDQogICAgICAiZXN0SURcMDMwXDAwMSBcMDAxKFx0XDAyMlwwMjBcblwwMTBDbGllbnRJRFwwMzBcMDAyIFwwMDEoXHRcMDIyXDAxN1xuXDAwN0NoYW5uZWwiICsNCiAgICAgICJcMDMwXDAwMyBcMDAxKFx0XDAyMlwwMzNcblwwMjNNYXhOdW1iZXJPZk1lc3NhZ2VzXDAzMFwwMDQgXDAwMShcMDA1XDAyMlwwMjdcblwwMTdXIiArDQogICAgICAiYWl0VGltZVNlY29uZHNcMDMwXDAwNSBcMDAxKFwwMDVcMDIyXDAxNlxuXDAwNklzUGVha1wwMzBcMDA2IFwwMDEoXDAxMFwiXDI3NFwwMDFcbiIgKw0KICAgICAgIlwwMzRSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlXDAyMlwwMjFcblx0UmVxdWVzdCIgKw0KICAgICAgIklEXDAzMFwwMDEgXDAwMShcdFwwMjImXG5cMDEwTWVzc2FnZXNcMDMwXDAwMiBcMDAzKFwwMTMyXDAyNC5rdWJlbXEuUXVldSIgKw0KICAgICAgImVNZXNzYWdlXDAyMlwwMzBcblwwMjBNZXNzYWdlc1JlY2VpdmVkXDAzMFwwMDMgXDAwMShcMDA1XDAyMlwwMjdcblwwMTdNZSIgKw0KICAgICAgInNzYWdlc0V4cGlyZWRcMDMwXDAwNCBcMDAxKFwwMDVcMDIyXDAxNlxuXDAwNklzUGVha1wwMzBcMDA1IFwwMDEoXDAxMFwwMjJcMDE3XG5cMDA3SSIgKw0KICAgICAgInNFcnJvclwwMzBcMDA2IFwwMDEoXDAxMFwwMjJcclxuXDAwNUVycm9yXDAzMFwwMDcgXDAwMShcdFwia1xuXDAzMkFja0FsbFF1ZSIgKw0KICAgICAgInVlTWVzc2FnZXNSZXF1ZXN0XDAyMlwwMjFcblx0UmVxdWVzdElEXDAzMFwwMDEgXDAwMShcdFwwMjJcMDIwXG5cMDEwIiArDQogICAgICAiQ2xpZW50SURcMDMwXDAwMiBcMDAxKFx0XDAyMlwwMTdcblwwMDdDaGFubmVsXDAzMFwwMDMgXDAwMShcdFwwMjJcMDI3XG5cMDE3V2FpdFQiICsNCiAgICAgICJpbWVTZWNvbmRzXDAzMFwwMDQgXDAwMShcMDA1XCJqXG5cMDMzQWNrQWxsUXVldWVNZXNzYWdlc1IiICsNCiAgICAgICJlc3BvbnNlXDAyMlwwMjFcblx0UmVxdWVzdElEXDAzMFwwMDEgXDAwMShcdFwwMjJcMDMwXG5cMDIwQWZmZWN0ZWRNZSIgKw0KICAgICAgInNzYWdlc1wwMzBcMDAyIFwwMDEoXDAwNFwwMjJcMDE3XG5cMDA3SXNFcnJvclwwMzBcMDAzIFwwMDEoXDAxMFwwMjJcclxuXDAwNUVycm9yXDAzMFwwMDQiICsNCiAgICAgICIgXDAwMShcdFwiXDIwNFwwMDJcblwwMzJTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdFwwMjJcMDIxXG5cdFIiICsNCiAgICAgICJlcXVlc3RJRFwwMzBcMDAxIFwwMDEoXHRcMDIyXDAyMFxuXDAxMENsaWVudElEXDAzMFwwMDIgXDAwMShcdFwwMjI4XG5cMDI1U3RyZSIgKw0KICAgICAgImFtUmVxdWVzdFR5cGVEYXRhXDAzMFwwMDMgXDAwMShcMDE2MlwwMzEua3ViZW1xLlN0cmVhbVIiICsNCiAgICAgICJlcXVlc3RUeXBlXDAyMlwwMTdcblwwMDdDaGFubmVsXDAzMFwwMDQgXDAwMShcdFwwMjJcMDMxXG5cMDIxVmlzaWJpbGl0IiArDQogICAgICAieVNlY29uZHNcMDMwXDAwNSBcMDAxKFwwMDVcMDIyXDAyN1xuXDAxN1dhaXRUaW1lU2Vjb25kc1wwMzBcMDA2IFwwMDEoXDAwNVwwMjIiICsNCiAgICAgICJcMDIzXG5cMDEzUmVmU2VxdWVuY2VcMDMwXDAwNyBcMDAxKFwwMDRcMDIyLVxuXDAxN01vZGlmaWVkTWVzc2FnZVwwMzAiICsNCiAgICAgICJcMDEwIFwwMDEoXDAxMzJcMDI0Lmt1YmVtcS5RdWV1ZU1lc3NhZ2VcIlwyNjFcMDAxXG5cMDMzU3RyZWFtUXUiICsNCiAgICAgICJldWVNZXNzYWdlc1Jlc3BvbnNlXDAyMlwwMjFcblx0UmVxdWVzdElEXDAzMFwwMDEgXDAwMShcdFwwMjI4IiArDQogICAgICAiXG5cMDI1U3RyZWFtUmVxdWVzdFR5cGVEYXRhXDAzMFwwMDIgXDAwMShcMDE2MlwwMzEua3ViZW1xLlMiICsNCiAgICAgICJ0cmVhbVJlcXVlc3RUeXBlXDAyMiVcblwwMDdNZXNzYWdlXDAzMFwwMDMgXDAwMShcMDEzMlwwMjQua3ViZSIgKw0KICAgICAgIm1xLlF1ZXVlTWVzc2FnZVwwMjJcMDE3XG5cMDA3SXNFcnJvclwwMzBcMDA0IFwwMDEoXDAxMFwwMjJcclxuXDAwNUVycm8iICsNCiAgICAgICJyXDAzMFwwMDUgXDAwMShcdCpcMjUyXDAwMVxuXDAyMVN0cmVhbVJlcXVlc3RUeXBlXDAyMlwwMzRcblwwMzBTdHJlYW1SIiArDQogICAgICAiZXF1ZXN0VHlwZVVua25vd25cMDIwXDAwMFwwMjJcMDIyXG5cMDE2UmVjZWl2ZU1lc3NhZ2VcMDIwXDAwMVwwMjIiICsNCiAgICAgICJcMDE2XG5cbkFja01lc3NhZ2VcMDIwXDAwMlwwMjJcMDIxXG5cclJlamVjdE1lc3NhZ2VcMDIwXDAwM1wwMjJcMDI0XG5cMDIwTW8iICsNCiAgICAgICJkaWZ5VmlzaWJpbGl0eVwwMjBcMDA0XDAyMlwwMjFcblxyUmVzZW5kTWVzc2FnZVwwMjBcMDA1XDAyMlwwMjdcblwwMjNTIiArDQogICAgICAiZW5kTW9kaWZpZWRNZXNzYWdlXDAyMFwwMDYyXDMzN1wwMDZcblwwMDZrdWJlbXFcMDIyLFxuXHRTZW5kRSIgKw0KICAgICAgInZlbnRcMDIyXHIua3ViZW1xLkV2ZW50XDAzMlwwMTYua3ViZW1xLlJlc3VsdFwiXDAwMFwwMjI3XG4iICsNCiAgICAgICJcMDIwU2VuZEV2ZW50c1N0cmVhbVwwMjJcci5rdWJlbXEuRXZlbnRcMDMyXDAxNi5rdWJlbSIgKw0KICAgICAgInEuUmVzdWx0XCJcMDAwKFwwMDEwXDAwMVwwMjJAXG5cMDIxU3Vic2NyaWJlVG9FdmVudHNcMDIyXDAyMS5rdSIgKw0KICAgICAgImJlbXEuU3Vic2NyaWJlXDAzMlwwMjQua3ViZW1xLkV2ZW50UmVjZWl2ZVwiXDAwMDBcMDAxIiArDQogICAgICAiXDAyMj1cblwwMjNTdWJzY3JpYmVUb1JlcXVlc3RzXDAyMlwwMjEua3ViZW1xLlN1YnNjcmkiICsNCiAgICAgICJiZVwwMzJcMDE3Lmt1YmVtcS5SZXF1ZXN0XCJcMDAwMFwwMDFcMDIyMlxuXDAxM1NlbmRSZXF1ZXN0XDAyMlwwMTciICsNCiAgICAgICIua3ViZW1xLlJlcXVlc3RcMDMyXDAyMC5rdWJlbXEuUmVzcG9uc2VcIlwwMDBcMDIyMVxuXDAxNFMiICsNCiAgICAgICJlbmRSZXNwb25zZVwwMjJcMDIwLmt1YmVtcS5SZXNwb25zZVwwMzJcci5rdWJlbXEuRSIgKw0KICAgICAgIm1wdHlcIlwwMDBcMDIySlxuXDAyMFNlbmRRdWV1ZU1lc3NhZ2VcMDIyXDAyNC5rdWJlbXEuUXVldSIgKw0KICAgICAgImVNZXNzYWdlXDAzMlwwMzYua3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQiICsNCiAgICAgICJcIlwwMDBcMDIyYVxuXDAyNlNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hcMDIyIS5rdWJlbXEuUXUiICsNCiAgICAgICJldWVNZXNzYWdlc0JhdGNoUmVxdWVzdFwwMzJcIi5rdWJlbXEuUXVldWVNZSIgKw0KICAgICAgInNzYWdlc0JhdGNoUmVzcG9uc2VcIlwwMDBcMDIyY1xuXDAyNFJlY2VpdmVRdWV1ZU1lcyIgKw0KICAgICAgInNhZ2VzXDAyMiMua3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWUiICsNCiAgICAgICJzdFwwMzIkLmt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlIiArDQogICAgICAiXCJcMDAwXDAyMmNcblwwMjJTdHJlYW1RdWV1ZU1lc3NhZ2VcMDIyXCIua3ViZW1xLlN0cmVhbSIgKw0KICAgICAgIlF1ZXVlTWVzc2FnZXNSZXF1ZXN0XDAzMiMua3ViZW1xLlN0cmVhbVF1ZXUiICsNCiAgICAgICJlTWVzc2FnZXNSZXNwb25zZVwiXDAwMChcMDAxMFwwMDFcMDIyYFxuXDAyM0Fja0FsbFF1ZXVlTWUiICsNCiAgICAgICJzc2FnZXNcMDIyXCIua3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZSIgKw0KICAgICAgInN0XDAzMiMua3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZVwiIiArDQogICAgICAiXDAwMFwwMjIrXG5cMDA0UGluZ1wwMjJcci5rdWJlbXEuRW1wdHlcMDMyXDAyMi5rdWJlbXEuUGluZ1JlIiArDQogICAgICAic3VsdFwiXDAwMEJcMDM0XG5cMDIyaW8ua3ViZW1xLnNkay5ncnBjQlwwMDZLdWJlbXFiXDAwNnByIiArDQogICAgICAib3RvMyINCiAgICB9Ow0KICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3IuSW50ZXJuYWxEZXNjcmlwdG9yQXNzaWduZXIgYXNzaWduZXIgPQ0KICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvci4gICAgSW50ZXJuYWxEZXNjcmlwdG9yQXNzaWduZXIoKSB7DQogICAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnkgYXNzaWduRGVzY3JpcHRvcnMoDQogICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3Igcm9vdCkgew0KICAgICAgICAgICAgZGVzY3JpcHRvciA9IHJvb3Q7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvcg0KICAgICAgLmludGVybmFsQnVpbGRHZW5lcmF0ZWRGaWxlRnJvbShkZXNjcmlwdG9yRGF0YSwNCiAgICAgICAgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3JbXSB7DQogICAgICAgIH0sIGFzc2lnbmVyKTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1BpbmdSZXN1bHRfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDApOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUGluZ1Jlc3VsdF9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9QaW5nUmVzdWx0X2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiSG9zdCIsICJWZXJzaW9uIiwgIlNlcnZlclN0YXJ0VGltZSIsICJTZXJ2ZXJVcFRpbWVTZWNvbmRzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FbXB0eV9kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FbXB0eV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FbXB0eV9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXN1bHRfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDIpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzdWx0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlKA0KICAgICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3VsdF9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIkV2ZW50SUQiLCAiU2VudCIsICJFcnJvciIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDMpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJFdmVudElEIiwgIkNsaWVudElEIiwgIkNoYW5uZWwiLCAiTWV0YWRhdGEiLCAiQm9keSIsICJTdG9yZSIsICJUYWdzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9UYWdzRW50cnlfZGVzY3JpcHRvciA9DQogICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50X2Rlc2NyaXB0b3IuZ2V0TmVzdGVkVHlwZXMoKS5nZXQoMCk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudF9UYWdzRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRfVGFnc0VudHJ5X2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiS2V5IiwgIlZhbHVlIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudFJlY2VpdmVfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDQpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlKA0KICAgICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIkV2ZW50SUQiLCAiQ2hhbm5lbCIsICJNZXRhZGF0YSIsICJCb2R5IiwgIlRpbWVzdGFtcCIsICJTZXF1ZW5jZSIsICJUYWdzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudFJlY2VpdmVfVGFnc0VudHJ5X2Rlc2NyaXB0b3IgPQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9FdmVudFJlY2VpdmVfZGVzY3JpcHRvci5nZXROZXN0ZWRUeXBlcygpLmdldCgwKTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0V2ZW50UmVjZWl2ZV9UYWdzRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfRXZlbnRSZWNlaXZlX1RhZ3NFbnRyeV9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIktleSIsICJWYWx1ZSIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3Vic2NyaWJlX2Rlc2NyaXB0b3IgPQ0KICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg1KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1N1YnNjcmliZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdWJzY3JpYmVfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJTdWJzY3JpYmVUeXBlRGF0YSIsICJDbGllbnRJRCIsICJDaGFubmVsIiwgIkdyb3VwIiwgIkV2ZW50c1N0b3JlVHlwZURhdGEiLCAiRXZlbnRzU3RvcmVUeXBlVmFsdWUiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlcXVlc3RfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDYpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUmVxdWVzdElEIiwgIlJlcXVlc3RUeXBlRGF0YSIsICJDbGllbnRJRCIsICJDaGFubmVsIiwgIk1ldGFkYXRhIiwgIkJvZHkiLCAiUmVwbHlDaGFubmVsIiwgIlRpbWVvdXQiLCAiQ2FjaGVLZXkiLCAiQ2FjaGVUVEwiLCAiU3BhbiIsICJUYWdzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXF1ZXN0X1RhZ3NFbnRyeV9kZXNjcmlwdG9yID0NCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9kZXNjcmlwdG9yLmdldE5lc3RlZFR5cGVzKCkuZ2V0KDApOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9UYWdzRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVxdWVzdF9UYWdzRW50cnlfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJLZXkiLCAiVmFsdWUiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX2Rlc2NyaXB0b3IgPQ0KICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg3KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlKA0KICAgICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiQ2xpZW50SUQiLCAiUmVxdWVzdElEIiwgIlJlcGx5Q2hhbm5lbCIsICJNZXRhZGF0YSIsICJCb2R5IiwgIkNhY2hlSGl0IiwgIlRpbWVzdGFtcCIsICJFeGVjdXRlZCIsICJFcnJvciIsICJTcGFuIiwgIlRhZ3MiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX1RhZ3NFbnRyeV9kZXNjcmlwdG9yID0NCiAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVzcG9uc2VfZGVzY3JpcHRvci5nZXROZXN0ZWRUeXBlcygpLmdldCgwKTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1Jlc3BvbnNlX1RhZ3NFbnRyeV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZXNwb25zZV9UYWdzRW50cnlfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJLZXkiLCAiVmFsdWUiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoOCk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlX2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiTWVzc2FnZUlEIiwgIkNsaWVudElEIiwgIkNoYW5uZWwiLCAiTWV0YWRhdGEiLCAiQm9keSIsICJUYWdzIiwgIkF0dHJpYnV0ZXMiLCAiUG9saWN5IiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfVGFnc0VudHJ5X2Rlc2NyaXB0b3IgPQ0KICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VfZGVzY3JpcHRvci5nZXROZXN0ZWRUeXBlcygpLmdldCgwKTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZV9UYWdzRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlX1RhZ3NFbnRyeV9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIktleSIsICJWYWx1ZSIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdF9kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoOSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlKA0KICAgICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1F1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3RfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJCYXRjaElEIiwgIk1lc3NhZ2VzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZV9kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTApOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2VfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJCYXRjaElEIiwgIlJlc3VsdHMiLCAiSGF2ZUVycm9ycyIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTEpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlQXR0cmlidXRlc19maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzX2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiVGltZXN0YW1wIiwgIlNlcXVlbmNlIiwgIk1ENU9mQm9keSIsICJSZWNlaXZlQ291bnQiLCAiUmVSb3V0ZWQiLCAiUmVSb3V0ZWRGcm9tUXVldWUiLCAiRXhwaXJhdGlvbkF0IiwgIkRlbGF5ZWRUbyIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlUG9saWN5X2Rlc2NyaXB0b3IgPQ0KICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgxMik7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9RdWV1ZU1lc3NhZ2VQb2xpY3lfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUXVldWVNZXNzYWdlUG9saWN5X2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiRXhwaXJhdGlvblNlY29uZHMiLCAiRGVsYXlTZWNvbmRzIiwgIk1heFJlY2VpdmVDb3VudCIsICJNYXhSZWNlaXZlUXVldWUiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1NlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDEzKTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1NlbmRRdWV1ZU1lc3NhZ2VSZXN1bHRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdF9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIk1lc3NhZ2VJRCIsICJTZW50QXQiLCAiRXhwaXJhdGlvbkF0IiwgIkRlbGF5ZWRUbyIsICJJc0Vycm9yIiwgIkVycm9yIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDE0KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJSZXF1ZXN0SUQiLCAiQ2xpZW50SUQiLCAiQ2hhbm5lbCIsICJNYXhOdW1iZXJPZk1lc3NhZ2VzIiwgIldhaXRUaW1lU2Vjb25kcyIsICJJc1BlYWsiLCB9KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDE1KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX1JlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZV9kZXNjcmlwdG9yLA0KICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIlJlcXVlc3RJRCIsICJNZXNzYWdlcyIsICJNZXNzYWdlc1JlY2VpdmVkIiwgIk1lc3NhZ2VzRXhwaXJlZCIsICJJc1BlYWsiLCAiSXNFcnJvciIsICJFcnJvciIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDE2KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0Fja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldw0KICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlVjMuRmllbGRBY2Nlc3NvclRhYmxlKA0KICAgICAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0Fja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0X2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUmVxdWVzdElEIiwgIkNsaWVudElEIiwgIkNoYW5uZWwiLCAiV2FpdFRpbWVTZWNvbmRzIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvciA9DQogICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDE3KTsNCiAgICBpbnRlcm5hbF9zdGF0aWNfa3ViZW1xX0Fja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcNCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZVYzLkZpZWxkQWNjZXNzb3JUYWJsZSgNCiAgICAgICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJSZXF1ZXN0SUQiLCAiQWZmZWN0ZWRNZXNzYWdlcyIsICJJc0Vycm9yIiwgIkVycm9yIiwgfSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdF9kZXNjcmlwdG9yID0NCiAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTgpOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3RfZGVzY3JpcHRvciwNCiAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJSZXF1ZXN0SUQiLCAiQ2xpZW50SUQiLCAiU3RyZWFtUmVxdWVzdFR5cGVEYXRhIiwgIkNoYW5uZWwiLCAiVmlzaWJpbGl0eVNlY29uZHMiLCAiV2FpdFRpbWVTZWNvbmRzIiwgIlJlZlNlcXVlbmNlIiwgIk1vZGlmaWVkTWVzc2FnZSIsIH0pOw0KICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3IgPQ0KICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgxOSk7DQogICAgaW50ZXJuYWxfc3RhdGljX2t1YmVtcV9TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3DQogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2VWMy5GaWVsZEFjY2Vzc29yVGFibGUoDQogICAgICAgIGludGVybmFsX3N0YXRpY19rdWJlbXFfU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlX2Rlc2NyaXB0b3IsDQogICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUmVxdWVzdElEIiwgIlN0cmVhbVJlcXVlc3RUeXBlRGF0YSIsICJNZXNzYWdlIiwgIklzRXJyb3IiLCAiRXJyb3IiLCB9KTsNCiAgfQ0KDQogIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChvdXRlcl9jbGFzc19zY29wZSkNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":"eyJMb2NhdGlvbiI6Imh0dHBzOi8va3ViZW1xLXRhcmdldHMuczMuYW1hem9uYXdzLmNvbS9qYXZhL2t1YmVtcS1qYXZhL2t1YmVtcS1qYXZhLXNkay9zcmMvbWFpbi9qYXZhL2lvL2t1YmVtcS9zZGsvZ3JwYy9LdWJlbXEuamF2YXgiLCJWZXJzaW9uSUQiOm51bGwsIlVwbG9hZElEIjoiIiwiRVRhZyI6IlwiN2E3ODdjY2U2OWQ3ZTMzZTU3MzBhMWZmZTc4Njk0YzFcIiJ9","is_error":false,"error":""}, error:<nil>	{"source": "sync.up"}
2021-06-26T13:14:08.571+0300	INFO	request: {"metadata":{"filename":"gradle.xml","method":"save","path":"java/kubemq-java/.idea"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0IHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9IkdyYWRsZU1pZ3JhdGlvblNldHRpbmdzIiBtaWdyYXRpb25WZXJzaW9uPSIxIiAvPg0KICA8Y29tcG9uZW50IG5hbWU9IkdyYWRsZVNldHRpbmdzIj4NCiAgICA8b3B0aW9uIG5hbWU9ImxpbmtlZEV4dGVybmFsUHJvamVjdHNTZXR0aW5ncyI+DQogICAgICA8R3JhZGxlUHJvamVjdFNldHRpbmdzPg0KICAgICAgICA8b3B0aW9uIG5hbWU9ImRpc3RyaWJ1dGlvblR5cGUiIHZhbHVlPSJERUZBVUxUX1dSQVBQRUQiIC8+DQogICAgICAgIDxvcHRpb24gbmFtZT0iZXh0ZXJuYWxQcm9qZWN0UGF0aCIgdmFsdWU9IiRQUk9KRUNUX0RJUiQiIC8+DQogICAgICAgIDxvcHRpb24gbmFtZT0iZ3JhZGxlSnZtIiB2YWx1ZT0iY29ycmV0dG8tMS44IiAvPg0KICAgICAgICA8b3B0aW9uIG5hbWU9Im1vZHVsZXMiPg0KICAgICAgICAgIDxzZXQ+DQogICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIkUFJPSkVDVF9ESVIkIiAvPg0KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iJFBST0pFQ1RfRElSJC9leGFtcGxlcyIgLz4NCiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiRQUk9KRUNUX0RJUiQva3ViZW1xLWphdmEtc2RrIiAvPg0KICAgICAgICAgIDwvc2V0Pg0KICAgICAgICA8L29wdGlvbj4NCiAgICAgIDwvR3JhZGxlUHJvamVjdFNldHRpbmdzPg0KICAgIDwvb3B0aW9uPg0KICA8L2NvbXBvbmVudD4NCjwvcHJvamVjdD4="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:08.696+0300	INFO	request: {"metadata":{"filename":"buildOutputCleanup.lock","method":"save","path":"java/kubemq-java/.gradle/buildOutputCleanup"},"data":"Ayo2eCAalwSnAAAAAAAAAAE="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:08.723+0300	INFO	request: {"metadata":{"filename":"Main.class","method":"save","path":"java/poc/test/out/production/test/com/company"},"data":"yv66vgAAADwAIgoAAgADBwAEDAAFAAYBABBqYXZhL2xhbmcvT2JqZWN0AQAGPGluaXQ+AQADKClWCQAIAAkHAAoMAAsADAEAEGphdmEvbGFuZy9TeXN0ZW0BAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsIAA4BAANoaXQKABAAEQcAEgwAEwAUAQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYHABYBABBjb20vY29tcGFueS9NYWluAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABJMY29tL2NvbXBhbnkvTWFpbjsBAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEACU1haW4uamF2YQAhABUAAgAAAAAAAgABAAUABgABABcAAAAvAAEAAQAAAAUqtwABsQAAAAIAGAAAAAYAAQAAAAQAGQAAAAwAAQAAAAUAGgAbAAAACQAcAB0AAQAXAAAANwACAAEAAAAJsgAHEg22AA+xAAAAAgAYAAAACgACAAAABwAIAAgAGQAAAAwAAQAAAAkAHgAfAAAAAQAgAAAAAgAh"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:08.850+0300	INFO	request: {"metadata":{"filename":"ChannelParameters.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/event"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV2ZW50Ow0KDQpwdWJsaWMgY2xhc3MgQ2hhbm5lbFBhcmFtZXRlcnMgew0KDQogICAgLyoqDQogICAgICogUmVwcmVzZW50cyBUaGUgY2hhbm5lbCBuYW1lIHRvIHNlbmQgdG8gdXNpbmcgdGhlIEt1YmVNUS4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBjaGFubmVsTmFtZTsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIHNlbmRlciBJRCB0aGF0IHRoZSBtZXNzYWdlcyB3aWxsIGJlIHNlbmQgdW5kZXIuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgY2xpZW50SUQ7DQoNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIGlmIHRoZSBtZXNzYWdlcyBzaG91bGQgYmUgc2VuZCB0byBwZXJzaXN0ZW5jZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gc3RvcmU7DQoNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIGlmIHRoZSBlbmQgdXNlciBkb2VzIG5vdCBuZWVkIHRoZSBSZXN1bHQuDQogICAgICovDQogICAgcHJpdmF0ZSBib29sZWFuIHJldHVyblJlc3VsdDsNCg0KICAgIC8qKg0KICAgICAqIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcy4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBrdWJlTVFBZGRyZXNzOw0KDQogICAgLyoqDQogICAgICogS3ViZU1RIEpXVCBBdXRoIHRva2VuIHRvIGJlIHVzZWQgZm9yIEt1YmVNUSBjb25uZWN0aW9uLg0KICAgICAqLw0KICAgIHByaXZhdGUgU3RyaW5nIGF1dGhUb2tlbjsNCg0KDQogICAgcHVibGljIENoYW5uZWxQYXJhbWV0ZXJzKCkgew0KICAgIH0NCg0KICAgIHB1YmxpYyBDaGFubmVsUGFyYW1ldGVycyhTdHJpbmcgY2hhbm5lbE5hbWUsIFN0cmluZyBjbGllbnRJRCwgYm9vbGVhbiBzdG9yZSwgU3RyaW5nIGt1YmVNUUFkZHJlc3MsIFN0cmluZyBhdXRoVG9rZW4pIHsNCiAgICAgICAgdGhpcy5jaGFubmVsTmFtZSA9IGNoYW5uZWxOYW1lOw0KICAgICAgICB0aGlzLmNsaWVudElEID0gY2xpZW50SUQ7DQogICAgICAgIHRoaXMuc3RvcmUgPSBzdG9yZTsNCiAgICAgICAgdGhpcy5rdWJlTVFBZGRyZXNzID0ga3ViZU1RQWRkcmVzczsNCiAgICAgICAgdGhpcy5hdXRoVG9rZW4gPWF1dGhUb2tlbjsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENoYW5uZWxOYW1lKCkgew0KICAgICAgICByZXR1cm4gY2hhbm5lbE5hbWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2hhbm5lbE5hbWUoU3RyaW5nIGNoYW5uZWxOYW1lKSB7DQogICAgICAgIHRoaXMuY2hhbm5lbE5hbWUgPSBjaGFubmVsTmFtZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENsaWVudElEKCkgew0KICAgICAgICByZXR1cm4gY2xpZW50SUQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2xpZW50SUQoU3RyaW5nIGNsaWVudElEKSB7DQogICAgICAgIHRoaXMuY2xpZW50SUQgPSBjbGllbnRJRDsNCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N0b3JlKCkgew0KICAgICAgICByZXR1cm4gc3RvcmU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0U3RvcmUoYm9vbGVhbiBzdG9yZSkgew0KICAgICAgICB0aGlzLnN0b3JlID0gc3RvcmU7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNSZXR1cm5SZXN1bHQoKSB7DQogICAgICAgIHJldHVybiByZXR1cm5SZXN1bHQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UmV0dXJuUmVzdWx0KGJvb2xlYW4gcmV0dXJuUmVzdWx0KSB7DQogICAgICAgIHRoaXMucmV0dXJuUmVzdWx0ID0gcmV0dXJuUmVzdWx0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0S3ViZU1RQWRkcmVzcygpIHsNCiAgICAgICAgcmV0dXJuIGt1YmVNUUFkZHJlc3M7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0S3ViZU1RQWRkcmVzcyhTdHJpbmcga3ViZU1RQWRkcmVzcykgew0KICAgICAgICB0aGlzLmt1YmVNUUFkZHJlc3MgPSBrdWJlTVFBZGRyZXNzOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0QXV0aFRva2VuKCl7DQogICAgICAgIHJldHVybiB0aGlzLmF1dGhUb2tlbjsNCiAgICB9DQogICAgDQogICAgcHVibGljIHZvaWQgc2V0QXV0aFRva2VuKFN0cmluZyBhdXRoVG9rZW4pew0KICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IGF1dGhUb2tlbjsNCiAgICB9DQoNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:08.867+0300	INFO	request: {"metadata":{"filename":"last-build.bin","method":"save","path":"java/kubemq-java/.gradle/4.8/fileChanges"},"data":"AA=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.318+0300	INFO	request: {"metadata":{"filename":"project-template.xml","method":"save","path":"java/poc/test/.idea"},"data":"PHRlbXBsYXRlPg0KICA8aW5wdXQtZmllbGQgZGVmYXVsdD0iY29tLmNvbXBhbnkiPklKX0JBU0VfUEFDS0FHRTwvaW5wdXQtZmllbGQ+DQo8L3RlbXBsYXRlPg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.320+0300	INFO	request: {"metadata":{"filename":"logback-test.xml","method":"save","path":"java/kubemq-java/examples/bin/test"},"data":"PGNvbmZpZ3VyYXRpb24+DQogICAgPGFwcGVuZGVyIG5hbWU9IlNURE9VVCIgY2xhc3M9ImNoLnFvcy5sb2diYWNrLmNvcmUuQ29uc29sZUFwcGVuZGVyIj4NCiAgICAgICAgPGVuY29kZXIgY2xhc3M9ImNoLnFvcy5sb2diYWNrLmNsYXNzaWMuZW5jb2Rlci5QYXR0ZXJuTGF5b3V0RW5jb2RlciI+DQogICAgICAgICAgICA8cGF0dGVybj4lZHtISDptbTpzcy5TU1N9IFsldGhyZWFkXSAlLTVsZXZlbCAlbG9nZ2VyezM2fSAtICVtc2clbjwvcGF0dGVybj4NCiAgICAgICAgPC9lbmNvZGVyPg0KICAgIDwvYXBwZW5kZXI+DQogICAgPHJvb3QgbGV2ZWw9ImRlYnVnIj4NCiAgICAgICAgPGFwcGVuZGVyLXJlZiByZWY9IlNURE9VVCIvPg0KICAgIDwvcm9vdD4NCjwvY29uZmlndXJhdGlvbj4="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.332+0300	INFO	request: {"metadata":{"filename":"AckAllMessagesResponse.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/queue"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnF1ZXVlOw0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U7DQoNCi8qKg0KICogUXVldWUgcHVyZ2UgbWVzc2FnZXMgcmVxdWVzdCBleGVjdXRpb24gcmVzdWx0ICh3aWxsIG5vdCBkZWxldGUgZGF0YSkuDQogKi8NCnB1YmxpYyBjbGFzcyBBY2tBbGxNZXNzYWdlc1Jlc3BvbnNlIHsNCg0KCXByaXZhdGUgQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZTsNCg0KICAgIHByb3RlY3RlZCBBY2tBbGxNZXNzYWdlc1Jlc3BvbnNlKEFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZWMpIHsNCiAgICAgICAgYWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlID1yZWM7ICAgICAgICANCiAgICB9DQogICAgDQogICAgLyoqDQogICAgICogVW5pcXVlIGZvciBSZXF1ZXN0Lg0KICAgICAqIEByZXR1cm4gUmVxdWVzdCBJRC4NCiAgICAgKi8NCiAgICBwdWJsaWMgU3RyaW5nIGdldFJlcXVlc3RJRCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldFJlcXVlc3RJRCgpOw0KICAgIH0NCiAgIC8qKg0KICAgICAqIFJldHVybmVkIGZyb20gS3ViZU1RLCBmYWxzZSBpZiBubyBlcnJvci4NCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIEZhbHNlIGlmIG5vIGVycm9yLg0KICAgICAqLw0KICAgIHB1YmxpYyBCb29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXRJc0Vycm9yKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRXJyb3IgbWVzc2FnZSwgdmFsaWQgb25seSBpZiBJc0Vycm9yIHRydWUuDQogICAgICogDQogICAgICogQHJldHVybiBFcnJvciBtZXNzYWdlLg0KICAgICAqLw0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RXJyb3IoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXRFcnJvcigpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIE51bWJlciBvZiBhZmZlY3RlZCBtZXNzYWdlcy4NCiAgICAgKiBAcmV0dXJuIE51bWJlciBvZiBhZmZlY3RlZCBtZXNzYWdlcy4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRBZmZlY3RlZE1lc3NhZ2VzKCl7DQogICAgICAgIHJldHVybiB0aGlzLmFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXRBZmZlY3RlZE1lc3NhZ2VzKCk7DQogICAgfQ0KDQp9"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.360+0300	INFO	request: {"metadata":{"filename":".project","method":"save","path":"java/kubemq-java/examples"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0RGVzY3JpcHRpb24+DQoJPG5hbWU+ZXhhbXBsZXM8L25hbWU+DQoJPGNvbW1lbnQ+UHJvamVjdCBleGFtcGxlcyBjcmVhdGVkIGJ5IEJ1aWxkc2hpcC48L2NvbW1lbnQ+DQoJPHByb2plY3RzPg0KCTwvcHJvamVjdHM+DQoJPGJ1aWxkU3BlYz4NCgkJPGJ1aWxkQ29tbWFuZD4NCgkJCTxuYW1lPm9yZy5lY2xpcHNlLmpkdC5jb3JlLmphdmFidWlsZGVyPC9uYW1lPg0KCQkJPGFyZ3VtZW50cz4NCgkJCTwvYXJndW1lbnRzPg0KCQk8L2J1aWxkQ29tbWFuZD4NCgkJPGJ1aWxkQ29tbWFuZD4NCgkJCTxuYW1lPm9yZy5lY2xpcHNlLmJ1aWxkc2hpcC5jb3JlLmdyYWRsZXByb2plY3RidWlsZGVyPC9uYW1lPg0KCQkJPGFyZ3VtZW50cz4NCgkJCTwvYXJndW1lbnRzPg0KCQk8L2J1aWxkQ29tbWFuZD4NCgk8L2J1aWxkU3BlYz4NCgk8bmF0dXJlcz4NCgkJPG5hdHVyZT5vcmcuZWNsaXBzZS5qZHQuY29yZS5qYXZhbmF0dXJlPC9uYXR1cmU+DQoJCTxuYXR1cmU+b3JnLmVjbGlwc2UuYnVpbGRzaGlwLmNvcmUuZ3JhZGxlcHJvamVjdG5hdHVyZTwvbmF0dXJlPg0KCTwvbmF0dXJlcz4NCjwvcHJvamVjdERlc2NyaXB0aW9uPg0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.360+0300	INFO	request: {"metadata":{"filename":".classpath","method":"save","path":"java/kubemq-java/examples"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxjbGFzc3BhdGg+DQoJPGNsYXNzcGF0aGVudHJ5IGtpbmQ9InNyYyIgb3V0cHV0PSJiaW4vbWFpbiIgcGF0aD0ic3JjL21haW4vamF2YSI+DQoJCTxhdHRyaWJ1dGVzPg0KCQkJPGF0dHJpYnV0ZSBuYW1lPSJncmFkbGVfc2NvcGUiIHZhbHVlPSJtYWluIi8+DQoJCQk8YXR0cmlidXRlIG5hbWU9ImdyYWRsZV91c2VkX2J5X3Njb3BlIiB2YWx1ZT0ibWFpbix0ZXN0Ii8+DQoJCTwvYXR0cmlidXRlcz4NCgk8L2NsYXNzcGF0aGVudHJ5Pg0KCTxjbGFzc3BhdGhlbnRyeSBraW5kPSJzcmMiIG91dHB1dD0iYmluL21haW4iIHBhdGg9InNyYy9tYWluL3Jlc291cmNlcyI+DQoJCTxhdHRyaWJ1dGVzPg0KCQkJPGF0dHJpYnV0ZSBuYW1lPSJncmFkbGVfc2NvcGUiIHZhbHVlPSJtYWluIi8+DQoJCQk8YXR0cmlidXRlIG5hbWU9ImdyYWRsZV91c2VkX2J5X3Njb3BlIiB2YWx1ZT0ibWFpbix0ZXN0Ii8+DQoJCTwvYXR0cmlidXRlcz4NCgk8L2NsYXNzcGF0aGVudHJ5Pg0KCTxjbGFzc3BhdGhlbnRyeSBraW5kPSJzcmMiIG91dHB1dD0iYmluL3Rlc3QiIHBhdGg9InNyYy90ZXN0L2phdmEiPg0KCQk8YXR0cmlidXRlcz4NCgkJCTxhdHRyaWJ1dGUgbmFtZT0iZ3JhZGxlX3Njb3BlIiB2YWx1ZT0idGVzdCIvPg0KCQkJPGF0dHJpYnV0ZSBuYW1lPSJncmFkbGVfdXNlZF9ieV9zY29wZSIgdmFsdWU9InRlc3QiLz4NCgkJPC9hdHRyaWJ1dGVzPg0KCTwvY2xhc3NwYXRoZW50cnk+DQoJPGNsYXNzcGF0aGVudHJ5IGtpbmQ9ImNvbiIgcGF0aD0ib3JnLmVjbGlwc2UuamR0LmxhdW5jaGluZy5KUkVfQ09OVEFJTkVSL29yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5kZWJ1Zy51aS5sYXVuY2hlci5TdGFuZGFyZFZNVHlwZS9KYXZhU0UtMS44LyIvPg0KCTxjbGFzc3BhdGhlbnRyeSBraW5kPSJjb24iIHBhdGg9Im9yZy5lY2xpcHNlLmJ1aWxkc2hpcC5jb3JlLmdyYWRsZWNsYXNzcGF0aGNvbnRhaW5lciIvPg0KCTxjbGFzc3BhdGhlbnRyeSBraW5kPSJvdXRwdXQiIHBhdGg9ImJpbi9kZWZhdWx0Ii8+DQo8L2NsYXNzcGF0aD4NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.787+0300	INFO	request: {"metadata":{"filename":"TransactionTest.javax","method":"save","path":"java/kubemq-java/examples/src/test/java/io/kubemq/sdk/transaction"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KDQpwYWNrYWdlIGlvLmt1YmVtcS5zZGsudGVzdHM7DQoNCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRBcnJheUVxdWFsczsNCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRFcXVhbHM7DQppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFsc2U7DQppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0VHJ1ZTsNCg0KaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247DQoNCmltcG9ydCBqYXZheC5uZXQuc3NsLlNTTEV4Y2VwdGlvbjsNCg0KaW1wb3J0IG9yZy5qdW5pdC5UZXN0Ow0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5NZXNzYWdlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsucXVldWUuUXVldWU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5SZWNlaXZlTWVzc2FnZXNSZXNwb25zZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnF1ZXVlLlRyYW5zYWN0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsucXVldWUuVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsudG9vbHMuQ29udmVydGVyOw0KDQpwdWJsaWMgY2xhc3MgVHJhbnNhY3Rpb25UZXN0IHsNCg0KICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9Ob01lc3NhZ2VzX1Rlc3QoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoInJlYyIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgxMCwgMSk7DQoNCiAgICAgICAgYXNzZXJ0RXF1YWxzKHRydWUsIChyZXNwLmdldElzRXJyb3IoKSkpOw0KICAgICAgICBhc3NlcnRFcXVhbHModHJ1ZSwgcmVzcC5nZXRFcnJvcigpLmNvbnRhaW5zKCJFcnJvciAxMzgiKSk7DQoNCiAgICB9DQoNCiAgQFRlc3QNCiAgICBwdWJsaWMgdm9pZCBSZWNpdmVfMU1lc3NhZ2VzX0Fja19UZXN0KCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gew0KICAgICAgICBRdWV1ZSBxdWV1ZSA9IGNyZWF0ZVF1ZXVlKCIxTWVzc2FnZXMiKTsNCiAgICAgICAgYWNrUXVldWUocXVldWUpOw0KICAgICAgICBxdWV1ZS5TZW5kUXVldWVNZXNzYWdlKG5ldyBNZXNzYWdlKENvbnZlcnRlci5Ub0J5dGVBcnJheSgiaGkiKSwgIiIsICIxIiwgbnVsbCkpOw0KICAgICAgICBUcmFuc2FjdGlvbiB0cmFuID0gcXVldWUuQ3JlYXRlVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlIHJlc3AgPSB0cmFuLlJlY2VpdmUoMTAsIDEpOw0KDQogICAgICAgIGFzc2VydEVxdWFscygiMSIsIHJlc3AuZ2V0TWVzc2FnZSgpLmdldE1lc3NhZ2VJRCgpKTsNCg0KICAgICAgICByZXNwID0gdHJhbi5BY2tNZXNzYWdlKCk7DQoNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRJc0Vycm9yKCkpOw0KICAgIH0NCg0KICAgIEBUZXN0DQogICAgcHVibGljIHZvaWQgUmVjaXZlX1Zpc2FiaWxpdHlFeHBpcmVfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIlZpc2FiaWxpdHkiKTsNCiAgICAgICAgYWNrUXVldWUocXVldWUpOw0KICAgICAgICBxdWV1ZS5TZW5kUXVldWVNZXNzYWdlKG5ldyBNZXNzYWdlKENvbnZlcnRlci5Ub0J5dGVBcnJheSgiaGkiKSwgIiIsICIxIiwgbnVsbCkpOw0KICAgICAgICBUcmFuc2FjdGlvbiB0cmFuID0gcXVldWUuQ3JlYXRlVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlIHJlc3AgPSB0cmFuLlJlY2VpdmUoMiwgMSk7DQoNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICBUaHJlYWQuc2xlZXAoMjAwMCk7ICANCiAgICAgICAgcmVzcCA9IHRyYW4uQWNrTWVzc2FnZSgpOw0KICAgICAgICBhc3NlcnRUcnVlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9WaXNhYmlsaXR5RXh0ZW5kX1Rlc3QoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gew0KICAgICAgICBRdWV1ZSBxdWV1ZSA9IGNyZWF0ZVF1ZXVlKCJWaXNhYmlsaXR5RXh0Iik7DQogICAgICAgIGFja1F1ZXVlKHF1ZXVlKTsNCiAgICAgICAgcXVldWUuU2VuZFF1ZXVlTWVzc2FnZShuZXcgTWVzc2FnZShDb252ZXJ0ZXIuVG9CeXRlQXJyYXkoImhpIiksICIiLCAiMSIsIG51bGwpKTsNCiAgICAgICAgVHJhbnNhY3Rpb24gdHJhbiA9IHF1ZXVlLkNyZWF0ZVRyYW5zYWN0aW9uKCk7DQogICAgICAgIFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSByZXNwID0gdHJhbi5SZWNlaXZlKDEsIDEpOw0KICAgICAgICBhc3NlcnRFcXVhbHMoIjEiLCByZXNwLmdldE1lc3NhZ2UoKS5nZXRNZXNzYWdlSUQoKSk7DQogICAgICAgIHJlc3AgPSB0cmFuLkV4dGVuZFZpc2liaWxpdHkoMik7DQogICAgICAgIGFzc2VydEZhbHNlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOw0KICAgICAgICByZXNwID0gdHJhbi5BY2tNZXNzYWdlKCk7DQogICAgICAgIGFzc2VydEZhbHNlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9SZXNlbmRfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIlJlc2VuZCIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIHF1ZXVlLlNlbmRRdWV1ZU1lc3NhZ2UobmV3IE1lc3NhZ2UoQ29udmVydGVyLlRvQnl0ZUFycmF5KCJoaSIpLCAiIiwgIjEiLCBudWxsKSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgzLCAxKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICByZXNwID0gdHJhbi5SZVNlbmQoIlJlc2VuZDIiKTsNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRJc0Vycm9yKCkpOw0KICAgICAgDQogICAgICAgIFF1ZXVlICBxdWV1ZTIgPSBjcmVhdGVRdWV1ZSgiUmVzZW5kMiIpOw0KICAgICAgICAgDQogICAgICAgIFJlY2VpdmVNZXNzYWdlc1Jlc3BvbnNlIHJlc3BlID0gcXVldWUyLlBlZWtRdWV1ZU1lc3NhZ2UoMSwgMSk7DQogICAgICAgICBhc3NlcnRFcXVhbHMoMSwgcmVzcGUuZ2V0TWVzc2FnZXNSZWNlaXZlZCgpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9Nb2RpZnlfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIk1vZGlmeSIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIHF1ZXVlLlNlbmRRdWV1ZU1lc3NhZ2UobmV3IE1lc3NhZ2UoQ29udmVydGVyLlRvQnl0ZUFycmF5KCJoaSIpLCAiIiwgIjEiLCBudWxsKSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgzLCAxKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICBNZXNzYWdlIG1zZyA9IHJlc3AuZ2V0TWVzc2FnZSgpOw0KICAgICAgICBtc2cuc2V0Qm9keShDb252ZXJ0ZXIuVG9CeXRlQXJyYXkoIndlbGwgaGVsbG8iKSkNCiAgICAgICAgLnNldFF1ZXVlKHF1ZXVlLmdldFF1ZXVlTmFtZSgpKTsNCg0KICAgICAgICByZXNwID0gdHJhbi5Nb2RpZnkobXNnKTsNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRFcnJvcigpLCAgcmVzcC5nZXRJc0Vycm9yKCkpOw0KICANCiAgICAgICAgUmVjZWl2ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzcGUgPSBxdWV1ZS5QZWVrUXVldWVNZXNzYWdlKDMsIDEpOyAgDQogICAgICAgIGJ5dGVbXSBiID0gcmVzcGUuZ2V0TWVzc2FnZXMoKS5pdGVyYXRvcigpLm5leHQoKS5nZXRCb2R5KCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBTdHJpbmcgeFN0cmluZyA9IENvbnZlcnRlci5Gcm9tQnl0ZUFycmF5KGIpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oeFN0cmluZyk7DQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oQ29udmVydGVyLkZyb21CeXRlQXJyYXkobXNnLmdldEJvZHkoKSkpOw0KDQogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICANCiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgIH0NCiAgICAgICAgYXNzZXJ0QXJyYXlFcXVhbHMobXNnLmdldEJvZHkoKSwgYik7DQogICAgfQ0KDQoNCiAgICBwcml2YXRlIHZvaWQgYWNrUXVldWUoUXVldWUgcXVldWUpIHRocm93cyBTU0xFeGNlcHRpb24sIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiB7DQogICAgICAgIHF1ZXVlLkFja0FsbFF1ZXVlTWVzc2FnZXMoKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIFF1ZXVlIGNyZWF0ZVF1ZXVlKFN0cmluZyBxdWV1ZU5hbWUpIHRocm93cyBTU0xFeGNlcHRpb24sIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChxdWV1ZU5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcXVldWVOYW1lID0gInRlc3RRdWV1ZSI7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5ldyBRdWV1ZShxdWV1ZU5hbWUsICJKYXZhVGVzdGVyIiwgMSwgMSwgImxvY2FsaG9zdDo1MDAwMCIpOw0KDQogICAgfQ0KfQ=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.800+0300	INFO	request: {"metadata":{"filename":".project","method":"save","path":"java/kubemq-java/kubemq-java-sdk"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0RGVzY3JpcHRpb24+DQoJPG5hbWU+a3ViZW1xLWphdmEtc2RrPC9uYW1lPg0KCTxjb21tZW50PlByb2plY3Qga3ViZW1xLWphdmEtc2RrIGNyZWF0ZWQgYnkgQnVpbGRzaGlwLjwvY29tbWVudD4NCgk8cHJvamVjdHM+DQoJPC9wcm9qZWN0cz4NCgk8YnVpbGRTcGVjPg0KCQk8YnVpbGRDb21tYW5kPg0KCQkJPG5hbWU+b3JnLmVjbGlwc2UuamR0LmNvcmUuamF2YWJ1aWxkZXI8L25hbWU+DQoJCQk8YXJndW1lbnRzPg0KCQkJPC9hcmd1bWVudHM+DQoJCTwvYnVpbGRDb21tYW5kPg0KCQk8YnVpbGRDb21tYW5kPg0KCQkJPG5hbWU+b3JnLmVjbGlwc2UuYnVpbGRzaGlwLmNvcmUuZ3JhZGxlcHJvamVjdGJ1aWxkZXI8L25hbWU+DQoJCQk8YXJndW1lbnRzPg0KCQkJPC9hcmd1bWVudHM+DQoJCTwvYnVpbGRDb21tYW5kPg0KCTwvYnVpbGRTcGVjPg0KCTxuYXR1cmVzPg0KCQk8bmF0dXJlPm9yZy5lY2xpcHNlLmpkdC5jb3JlLmphdmFuYXR1cmU8L25hdHVyZT4NCgkJPG5hdHVyZT5vcmcuZWNsaXBzZS5idWlsZHNoaXAuY29yZS5ncmFkbGVwcm9qZWN0bmF0dXJlPC9uYXR1cmU+DQoJPC9uYXR1cmVzPg0KPC9wcm9qZWN0RGVzY3JpcHRpb24+DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.834+0300	INFO	request: {"metadata":{"filename":"CommandQueryResponder.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/commandqueryresponder"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1hbmRxdWVyeXJlc3BvbmRlcjsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlc3BvbmRlcjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXNwb25zZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1vbmV4YW1wbGUuQmFzZUV4YW1wbGU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5zdWJzY3JpcHRpb24uU3Vic2NyaWJlUmVxdWVzdDsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnN1YnNjcmlwdGlvbi5TdWJzY3JpYmVUeXBlOw0KDQppbXBvcnQgamF2YXgubmV0LnNzbC5TU0xFeGNlcHRpb247DQppbXBvcnQgamF2YS50ZXh0Lk1lc3NhZ2VGb3JtYXQ7DQppbXBvcnQgamF2YS50aW1lLkxvY2FsRGF0ZVRpbWU7DQoNCmNsYXNzIENvbW1hbmRRdWVyeVJlc3BvbmRlciBleHRlbmRzIEJhc2VFeGFtcGxlIHsNCg0KICAgIHByaXZhdGUgUmVzcG9uZGVyLlJlcXVlc3RSZXNwb25zZU9ic2VydmVyIEhhbmRsZUluY29taW5nUmVxdWVzdHM7DQogICAgcHJpdmF0ZSBSZXNwb25kZXIgcmVzcG9uZGVyOw0KDQogICAgQ29tbWFuZFF1ZXJ5UmVzcG9uZGVyKCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgc3VwZXIoIkNvbW1hbmRRdWVyeVJlc3BvbmRlciIpOw0KICAgICAgICByZXNwb25kZXIgPSBuZXcgUmVzcG9uZGVyKCk7DQogICAgICAgIEhhbmRsZUluY29taW5nUmVxdWVzdHMgPSByZXF1ZXN0IC0+IHsNCiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oTWVzc2FnZUZvcm1hdC5mb3JtYXQoIlN1YnNjcmliZXIgUmVjZWl2ZWQgRXZlbnQ6IE1ldGFkYXRhOicnezB9JycsIENoYW5uZWw6Jyd7MX0nJyIsDQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuZ2V0TWV0YWRhdGEoKSwgcmVxdWVzdC5nZXRDaGFubmVsKCkpKTsNCg0KICAgICAgICAgICAgUmVzcG9uc2UgcmVzcG9uc2UgPSBuZXcgUmVzcG9uc2UocmVxdWVzdCk7DQogICAgICAgICAgICByZXNwb25zZS5zZXRDYWNoZUhpdChmYWxzZSk7DQogICAgICAgICAgICByZXNwb25zZS5zZXRFcnJvcigiTm9uZSIpOw0KICAgICAgICAgICAgcmVzcG9uc2Uuc2V0Q2xpZW50SUQodGhpcy5nZXRDbGllbnRJRCgpKTsNCiAgICAgICAgICAgIHJlc3BvbnNlLnNldEJvZHkoIk9LIi5nZXRCeXRlcygpKTsNCiAgICAgICAgICAgIHJlc3BvbnNlLnNldEV4ZWN1dGVkKHRydWUpOw0KICAgICAgICAgICAgcmVzcG9uc2Uuc2V0TWV0YWRhdGEoIk9LIik7DQogICAgICAgICAgICByZXNwb25zZS5zZXRUaW1lc3RhbXAoTG9jYWxEYXRlVGltZS5ub3coKSk7DQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7DQogICAgICAgIH07DQogICAgICAgIENyZWF0ZVN1YnNjcmliZVRvUXVlcmllcygpOw0KICAgICAgICBDcmVhdGVTdWJzY3JpYmVUb0NvbW1hbmRzKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIENyZWF0ZVN1YnNjcmliZVRvQ29tbWFuZHMoKQ0KICAgICAgICAgICAgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgU3Vic2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0gQ3JlYXRlU3Vic2NyaWJlUmVxdWVzdChTdWJzY3JpYmVUeXBlLlF1ZXJpZXMpOw0KICAgICAgICByZXNwb25kZXIuU3Vic2NyaWJlVG9SZXF1ZXN0cyhzdWJzY3JpYmVSZXF1ZXN0LCBIYW5kbGVJbmNvbWluZ1JlcXVlc3RzKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgQ3JlYXRlU3Vic2NyaWJlVG9RdWVyaWVzKCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgU3Vic2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0gQ3JlYXRlU3Vic2NyaWJlUmVxdWVzdChTdWJzY3JpYmVUeXBlLkNvbW1hbmRzKTsNCiAgICAgICAgcmVzcG9uZGVyLlN1YnNjcmliZVRvUmVxdWVzdHMoc3Vic2NyaWJlUmVxdWVzdCwgSGFuZGxlSW5jb21pbmdSZXF1ZXN0cyk7DQogICAgfQ0KDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.841+0300	INFO	request: {"metadata":{"filename":"org.eclipse.jdt.core.prefs","method":"save","path":"java/kubemq-java/examples/.settings"},"data":"ZWNsaXBzZS5wcmVmZXJlbmNlcy52ZXJzaW9uPTENCm9yZy5lY2xpcHNlLmpkdC5jb3JlLmNvbXBpbGVyLmNvZGVnZW4udGFyZ2V0UGxhdGZvcm09MS44DQpvcmcuZWNsaXBzZS5qZHQuY29yZS5jb21waWxlci5jb21wbGlhbmNlPTEuOA0Kb3JnLmVjbGlwc2UuamR0LmNvcmUuY29tcGlsZXIuc291cmNlPTEuOA0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:09.857+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/eventsender"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmV2ZW50c2VuZGVyOw0KDQoNCmltcG9ydCBpby5rdWJlbXEuc2RrLmJhc2ljLlNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbjsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247DQoNCnB1YmxpYyBjbGFzcyBQcm9ncmFtIHsNCg0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsNCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCk7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiU3RhcnRpbmcgUHViU3ViU2VuZGVyLi4uIik7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOw0KICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlByZXNzICdFbnRlcicgdG8gc3RvcCB0aGUgYXBwbGljYXRpb24uLi4iKTsNCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCk7DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIG5ldyBFdmVudFNlbmRlcigpOw0KICAgICAgICB9IGNhdGNoIChTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogQ2FuIG5vdCBkZXRlcm1pbmUgS3ViZU1RIHNlcnZlciBhZGRyZXNzLiIpOw0KICAgICAgICB9ICBjYXRjaCAoU1NMRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3I6IGVycm9yIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0iKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpbnQgcmVhZCA9IFN5c3RlbS5pbi5yZWFkKCk7DQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3I6ICBJL08gZXJyb3Igb2NjdXJyZWQuIik7DQogICAgICAgIH0NCiAgICB9DQoNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.243+0300	INFO	request: {"metadata":{"filename":"misc.xml","method":"save","path":"java/kubemq-java/.idea"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0IHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9IkV4dGVybmFsU3RvcmFnZUNvbmZpZ3VyYXRpb25NYW5hZ2VyIiBlbmFibGVkPSJ0cnVlIiAvPg0KICA8Y29tcG9uZW50IG5hbWU9IlByb2plY3RSb290TWFuYWdlciIgdmVyc2lvbj0iMiIgbGFuZ3VhZ2VMZXZlbD0iSkRLXzFfOCIgcHJvamVjdC1qZGstbmFtZT0iMS44IiBwcm9qZWN0LWpkay10eXBlPSJKYXZhU0RLIiAvPg0KPC9wcm9qZWN0Pg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.270+0300	INFO	request: {"metadata":{"filename":"lombok.config","method":"save","path":"java/kubemq-java/kubemq-java-sdk"},"data":"IyBUaGlzIGZpbGUgaXMgZ2VuZXJhdGVkIGJ5IHRoZSAnaW8uZnJlZWZhaXIubG9tYm9rJyBHcmFkbGUgcGx1Z2luDQpjb25maWcuc3RvcEJ1YmJsaW5nID0gdHJ1ZQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.335+0300	INFO	request: {"metadata":{"filename":"commit-msg.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCiMKIyBBbiBleGFtcGxlIGhvb2sgc2NyaXB0IHRvIGNoZWNrIHRoZSBjb21taXQgbG9nIG1lc3NhZ2UuCiMgQ2FsbGVkIGJ5ICJnaXQgY29tbWl0IiB3aXRoIG9uZSBhcmd1bWVudCwgdGhlIG5hbWUgb2YgdGhlIGZpbGUKIyB0aGF0IGhhcyB0aGUgY29tbWl0IG1lc3NhZ2UuICBUaGUgaG9vayBzaG91bGQgZXhpdCB3aXRoIG5vbi16ZXJvCiMgc3RhdHVzIGFmdGVyIGlzc3VpbmcgYW4gYXBwcm9wcmlhdGUgbWVzc2FnZSBpZiBpdCB3YW50cyB0byBzdG9wIHRoZQojIGNvbW1pdC4gIFRoZSBob29rIGlzIGFsbG93ZWQgdG8gZWRpdCB0aGUgY29tbWl0IG1lc3NhZ2UgZmlsZS4KIwojIFRvIGVuYWJsZSB0aGlzIGhvb2ssIHJlbmFtZSB0aGlzIGZpbGUgdG8gImNvbW1pdC1tc2ciLgoKIyBVbmNvbW1lbnQgdGhlIGJlbG93IHRvIGFkZCBhIFNpZ25lZC1vZmYtYnkgbGluZSB0byB0aGUgbWVzc2FnZS4KIyBEb2luZyB0aGlzIGluIGEgaG9vayBpcyBhIGJhZCBpZGVhIGluIGdlbmVyYWwsIGJ1dCB0aGUgcHJlcGFyZS1jb21taXQtbXNnCiMgaG9vayBpcyBtb3JlIHN1aXRlZCB0byBpdC4KIwojIFNPQj0kKGdpdCB2YXIgR0lUX0FVVEhPUl9JREVOVCB8IHNlZCAtbiAncy9eXCguKj5cKS4qJC9TaWduZWQtb2ZmLWJ5OiBcMS9wJykKIyBncmVwIC1xcyAiXiRTT0IiICIkMSIgfHwgZWNobyAiJFNPQiIgPj4gIiQxIgoKIyBUaGlzIGV4YW1wbGUgY2F0Y2hlcyBkdXBsaWNhdGUgU2lnbmVkLW9mZi1ieSBsaW5lcy4KCnRlc3QgIiIgPSAiJChncmVwICdeU2lnbmVkLW9mZi1ieTogJyAiJDEiIHwKCSBzb3J0IHwgdW5pcSAtYyB8IHNlZCAtZSAnL15bIAldKjFbIAldL2QnKSIgfHwgewoJZWNobyA+JjIgRHVwbGljYXRlIFNpZ25lZC1vZmYtYnkgbGluZXMuCglleGl0IDEKfQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.335+0300	INFO	request: {"metadata":{"filename":"Initiator.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/commandquery/lowlevel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5sb3dsZXZlbDsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuR3JwY0NsaWVudDsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmJhc2ljLlNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXNwb25zZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdDsNCmltcG9ydCBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI7DQppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsNCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KDQovKioNCiAqIFJlcHJlc2VudHMgdGhlIGluc3RhbmNlIHRoYXQgaXMgcmVzcG9uc2libGUgdG8gc2VuZCByZXF1ZXN0cyB0byB0aGUga3ViZW1xLg0KICovDQpwdWJsaWMgY2xhc3MgSW5pdGlhdG9yIGV4dGVuZHMgR3JwY0NsaWVudCB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSW5pdGlhdG9yLmNsYXNzKTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXcgSW5pdGlhdG9yIHRvIHNlbmQgcmVxdWVzdHMgYW5kIGhhbmRsZSByZXNwb25zZS4NCiAgICAgKiBLdWJlTVFBZGRyZXNzIHdpbGwgYmUgcGFyc2VkIGZyb20gQ29uZmlnIG9yIGVudmlyb25tZW50IHBhcmFtZXRlci4NCiAgICAgKi8NCiAgICBwdWJsaWMgSW5pdGlhdG9yKCkgew0KICAgICAgICB0aGlzKG51bGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXcgSW5pdGlhdG9yIHRvIHNlbmQgcmVxdWVzdHMgYW5kIGhhbmRsZSByZXNwb25zZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBLdWJlTVFBZGRyZXNzIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcy4NCiAgICAgKi8NCiAgICBwdWJsaWMgSW5pdGlhdG9yKFN0cmluZyBLdWJlTVFBZGRyZXNzKSB7DQogICAgICAgIHRoaXMuX2t1YmVtcUFkZHJlc3MgPSBLdWJlTVFBZGRyZXNzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXcgSW5pdGlhdG9yIHRvIHNlbmQgcmVxdWVzdHMgYW5kIGhhbmRsZSByZXNwb25zZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBLdWJlTVFBZGRyZXNzIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcy4NCiAgICAgKiBAcGFyYW0gYXV0aFRva2VuICAgICBTZXQgS3ViZU1RIEpXVCBBdXRoIHRva2VuIHRvIGJlIHVzZWQgZm9yIEt1YmVNUQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uDQogICAgICovDQogICAgcHVibGljIEluaXRpYXRvcihTdHJpbmcgS3ViZU1RQWRkcmVzcywgU3RyaW5nIGF1dGhUb2tlbikgew0KICAgICAgICB0aGlzLl9rdWJlbXFBZGRyZXNzID0gS3ViZU1RQWRkcmVzczsNCiAgICAgICAgdGhpcy5hZGRBdXRoVG9rZW4oYXV0aFRva2VuKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBc3luYyBwdWJsaXNoIGEgc2luZ2xlIHJlcXVlc3QgdXNpbmcgdGhlIEt1YmVNUSwgcmVzcG9uc2Ugd2lsbCByZXR1cm4gaW4gdGhlDQogICAgICogcGFzc2VkIG9ic2VydmVyLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3QgICAgICAgICAgICAgICAgVGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLnJlcXVlc3QNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0IHdpbGwgYmUgc2VudCB0byB0aGUga3ViZU1RDQogICAgICogQHBhcmFtIHJlc3BvbnNlU3RyZWFtT2JzZXJ2ZXIgU3RyZWFtIE9ic2VydmVyIGZvciBnZXR0aW5nIHRoZSByZXNwb25zZSBvbmNlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nIHJlc3BvbnNlLg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBTZW5kUmVxdWVzdChSZXF1ZXN0IHJlcXVlc3QsIGZpbmFsIFN0cmVhbU9ic2VydmVyPFJlc3BvbnNlPiByZXNwb25zZVN0cmVhbU9ic2VydmVyKQ0KICAgICAgICAgICAgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgS3ViZW1xLlJlcXVlc3QgaW5uZXJSZXF1ZXN0ID0gcmVxdWVzdC5Db252ZXJ0KCk7DQogICAgICAgIEdldEt1YmVNUUFzeW5jQ2xpZW50KCkuc2VuZFJlcXVlc3QoaW5uZXJSZXF1ZXN0LCBuZXcgU3RyZWFtT2JzZXJ2ZXI8S3ViZW1xLlJlc3BvbnNlPigpIHsNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIHZvaWQgb25OZXh0KEt1YmVtcS5SZXNwb25zZSB2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlU3RyZWFtT2JzZXJ2ZXIub25OZXh0KG5ldyBSZXNwb25zZSh2YWx1ZSkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBAT3ZlcnJpZGUNCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uRXJyb3IoVGhyb3dhYmxlIHQpIHsNCiAgICAgICAgICAgICAgICByZXNwb25zZVN0cmVhbU9ic2VydmVyLm9uRXJyb3IodCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIHZvaWQgb25Db21wbGV0ZWQoKSB7DQogICAgICAgICAgICAgICAgcmVzcG9uc2VTdHJlYW1PYnNlcnZlci5vbkNvbXBsZXRlZCgpOw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIHNodXRkb3duKCk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIEF1dG8tZ2VuZXJhdGVkIGNhdGNoIGJsb2NrDQogICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgICAgICAgICAgICAgIHNodXRkb3duTm93KCk7DQogICAgICAgICAgICAgICAgICAgIC8vIFByZXNlcnZlIGludGVycnVwdCBzdGF0dXMNCiAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFB1Ymxpc2ggYSBzaW5nbGUgcmVxdWVzdCB1c2luZyB0aGUgS3ViZU1RLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3QgVGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLnJlcXVlc3QgdGhhdCB3aWxsIGJlDQogICAgICogICAgICAgICAgICAgICAgc2VudCB0byB0aGUga3ViZU1RLg0KICAgICAqIEByZXR1cm4gdGhlIHJlc3BvbnNlIHRoYXQgcmVjZWl2ZWQgZnJvbSB0aGUgS3ViZU1RIHNlcnZlciBmb3IgdGhlIHJlcXVlc3QNCiAgICAgKiAgICAgICAgIHRoYXQgd2FzIHNlbnQuDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24NCiAgICAgKi8NCiAgICBwdWJsaWMgUmVzcG9uc2UgU2VuZFJlcXVlc3QoUmVxdWVzdCByZXF1ZXN0KSB0aHJvd3MgU1NMRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gew0KDQogICAgICAgIEt1YmVtcS5SZXF1ZXN0IGlubmVyUmVxdWVzdCA9IHJlcXVlc3QuQ29udmVydCgpOw0KDQogICAgICAgIC8vIFNlbmQgcmVxdWVzdCBhbmQgd2FpdCBmb3IgcmVzcG9uc2UNCiAgICAgICAgS3ViZW1xLlJlc3BvbnNlIGlubmVyUmVzcG9uc2UgPSBHZXRLdWJlTVFDbGllbnQoKS5zZW5kUmVxdWVzdChpbm5lclJlcXVlc3QpOw0KICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGlubmVyUmVzcG9uc2UpOw0KDQogICAgfQ0KICAgIC8vIGNvbnZlcnQgSW5uZXJSZXNwb25zZSB0byBSZXNwb25zZSBhbmQgcmV0dXJuIHJlc3BvbnNlIHRvIGVuZCB1c2VyDQoNCiAgICBwcml2YXRlIHZvaWQgTG9nUmVxdWVzdChSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgICAgbG9nZ2VyLnRyYWNlKCJJbml0aWF0b3ItPlNlbmRSZXF1ZXN0LiBJRDone30nLCBDaGFubmVsOid7fScsIFJlcGx5Q2hhbm5lbDone30nIiwgcmVxdWVzdC5nZXRSZXF1ZXN0SWQoKSwNCiAgICAgICAgICAgICAgICByZXF1ZXN0LmdldENoYW5uZWwoKSwgcmVxdWVzdC5nZXRSZXBseUNoYW5uZWwoKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGluZyBjaGVjayBLdWJlbXEgcmVzcG9uc2UuDQogICAgICogDQogICAgICogQHJldHVybiBQaW5nUmVzdWx0DQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqLw0KICAgIHB1YmxpYyBQaW5nUmVzdWx0IFBpbmcoKSB0aHJvd3MgU1NMRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gR2V0S3ViZU1RQ2xpZW50KCkucGluZyhudWxsKTsNCiAgICB9DQoNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.361+0300	INFO	request: {"metadata":{"filename":"CommandQueryInitiator.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/commandqueryinitiator"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1hbmRxdWVyeWluaXRpYXRvcjsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlcXVlc3RUeXBlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5Lmxvd2xldmVsLkluaXRpYXRvcjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1vbmV4YW1wbGUuQmFzZUV4YW1wbGU7DQoNCmltcG9ydCBqYXZheC5uZXQuc3NsLlNTTEV4Y2VwdGlvbjsNCg0KY2xhc3MgQ29tbWFuZFF1ZXJ5SW5pdGlhdG9yIGV4dGVuZHMgQmFzZUV4YW1wbGUgew0KDQogICAgQ29tbWFuZFF1ZXJ5SW5pdGlhdG9yKCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgc3VwZXIoIkNvbW1hbmRRdWVyeUluaXRpYXRvciIpOw0KICAgICAgICBTZW5kTG93TGV2ZWxSZXF1ZXN0KCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSB2b2lkIFNlbmRMb3dMZXZlbFJlcXVlc3QoKSB0aHJvd3MgU1NMRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gew0KICAgICAgICBJbml0aWF0b3IgaW5pdGlhdG9yID0gbmV3IEluaXRpYXRvcigpOw0KICAgICAgICBSZXNwb25zZSByZXNwb25zZSA9IGluaXRpYXRvci5TZW5kUmVxdWVzdChDcmVhdGVMb3dMZXZlbFJlcXVlc3QoUmVxdWVzdFR5cGUuUXVlcnkpKTsNCiAgICAgICAgaW5pdGlhdG9yLlNlbmRSZXF1ZXN0KENyZWF0ZUxvd0xldmVsUmVxdWVzdChSZXF1ZXN0VHlwZS5Db21tYW5kKSk7DQogICAgfQ0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.737+0300	INFO	request: {"metadata":{"filename":".gitignore","method":"save","path":"java/poc/test/.idea"},"data":"IyBEZWZhdWx0IGlnbm9yZWQgZmlsZXMNCi9zaGVsZi8NCi93b3Jrc3BhY2UueG1sDQojIERhdGFzb3VyY2UgbG9jYWwgc3RvcmFnZSBpZ25vcmVkIGZpbGVzDQovLi4vLi4vLi4vLi4vLi4vLi4vLi4vOlxEZXZlbG9wbWVudFxiaXRidWNrZXRcamF2YVxwb2NcdGVzdFwuaWRlYS9kYXRhU291cmNlcy8NCi9kYXRhU291cmNlcy5sb2NhbC54bWwNCiMgRWRpdG9yLWJhc2VkIEhUVFAgQ2xpZW50IHJlcXVlc3RzDQovaHR0cFJlcXVlc3RzLw0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.806+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/commandqueryresponderasync"},"data":"cGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1hbmRxdWVyeXJlc3BvbmRlcmFzeW5jOw0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQoNCmltcG9ydCBqYXZheC5uZXQuc3NsLlNTTEV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOw0KDQpwdWJsaWMgY2xhc3MgUHJvZ3JhbSB7DQogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgew0KICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oKTsNCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJTdGFydGluZyBSZXFSZXBSZXNwb25kZXJBc3luYy4uLiIpOw0KICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oKTsNCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQcmVzcyAnRW50ZXInIHRvIHN0b3AgdGhlIGFwcGxpY2F0aW9uLi4uIik7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBuZXcgQ29tbWFuZFF1ZXJ5UmVzcG9uZGVyQXN5bmMoKTsNCiAgICAgICAgfSBjYXRjaCAoU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3I6IENhbiBub3QgZGV0ZXJtaW5lIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcy4iKTsNCiAgICAgICAgfSBjYXRjaCAoU1NMRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3I6IGVycm9yIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0iKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpbnQgcmVhZCA9IFN5c3RlbS5pbi5yZWFkKCk7DQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3I6ICBJL08gZXJyb3Igb2NjdXJyZWQuIik7DQogICAgICAgIH0NCiAgICB9DQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.807+0300	INFO	request: {"metadata":{"filename":"misc.xml","method":"save","path":"java/poc/test/.idea"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0IHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9IlByb2plY3RLZXkiPg0KICAgIDxvcHRpb24gbmFtZT0ic3RhdGUiIHZhbHVlPSJwcm9qZWN0Oi8vZTI4MDRmMDUtNTMxNS00ZmM2LWExMjEtYzUyMmE2YzI2NDcwIiAvPg0KICA8L2NvbXBvbmVudD4NCiAgPGNvbXBvbmVudCBuYW1lPSJQcm9qZWN0Um9vdE1hbmFnZXIiIHZlcnNpb249IjIiIGxhbmd1YWdlTGV2ZWw9IkpES18xNiIgZGVmYXVsdD0idHJ1ZSIgcHJvamVjdC1qZGstbmFtZT0iMTYiIHByb2plY3QtamRrLXR5cGU9IkphdmFTREsiPg0KICAgIDxvdXRwdXQgdXJsPSJmaWxlOi8vJFBST0pFQ1RfRElSJC9vdXQiIC8+DQogIDwvY29tcG9uZW50Pg0KPC9wcm9qZWN0Pg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:10.870+0300	INFO	request: {"metadata":{"filename":"org.eclipse.buildship.core.prefs","method":"save","path":"java/kubemq-java/.settings"},"data":"Y29ubmVjdGlvbi5wcm9qZWN0LmRpcj0NCmVjbGlwc2UucHJlZmVyZW5jZXMudmVyc2lvbj0xDQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.037+0300	INFO	request: {"metadata":{"filename":"Transaction.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/queue"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnF1ZXVlOw0KDQppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2VtYXBob3JlOw0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KDQppbXBvcnQgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuRXhjZXB0aW9ucy5UcmFuc2FjdGlvbkV4Y2VwdGlvbjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmJhc2ljLkdycGNDbGllbnQ7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQppbXBvcnQgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Ow0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsudG9vbHMuSURHZW5lcmF0b3I7DQoNCi8qKg0KICogQWR2YW5jZSBtYW5pcHVsYXRpb24gb2YgbWVzc2FnZXMgdXNpbmcgc3RyZWFtDQogKi8NCnB1YmxpYyBjbGFzcyBUcmFuc2FjdGlvbiBleHRlbmRzIEdycGNDbGllbnQgew0KDQogICAgc3RhdGljIFNlbWFwaG9yZSBzZW1hcGhvcmUgPSBuZXcgU2VtYXBob3JlKDEpOw0KDQogICAgcHJpdmF0ZSBRdWV1ZSBxdWV1ZTsNCiAgICBwcm90ZWN0ZWQgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIG1zZzsNCiAgICBwcm90ZWN0ZWQgU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIGxhdGVzdE1zZzsNCiAgICBwcml2YXRlIFN0cmVhbU9ic2VydmVyPFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcFN0cmVhbU9ic2VydmVyOw0KICAgIHByaXZhdGUgU3RyZWFtT2JzZXJ2ZXI8U3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3Q+IHJlcVN0cmVhbU9ic2VydmVyOw0KICAgIEVycm9yT2JzZXJ2ZXIgZXJyb3JPYnNlcnZlcjsNCg0KICAgIHByaXZhdGUgZmluYWwgT2JqZWN0IGxvY2sgPSBuZXcgT2JqZWN0KCk7DQogICAgYm9vbGVhbiB2aXNpYmlsaXR5RXhwOw0KDQogICAgVHJhblN0YXRlIHN0YXRlID0gVHJhblN0YXRlLlJlYWR5Ow0KDQogICAgcHJpdmF0ZSBlbnVtIFRyYW5TdGF0ZSB7DQogICAgICAgIFJlYWR5LCBTdHJlYW1SZWdpc3RlcmVkLCBTdHJlYW1PcGVuZWQsIFN0cmVhbUNsb3NpbmcsIFN0cmVhbUNsb3NlZCwgSW5UcmFuc2FjdGlvbiwgVU5BVVRIRU5USUNBVEVEDQoNCiAgICB9DQoNCiAgICBwdWJsaWMgUXVldWVNZXNzYWdlIGdldEN1cnJlbnRIYW5kbGVkTWVzc2FnZSgpIHsNCiAgICAgICAgaWYgKG1zZyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLm1zZy5nZXRNZXNzYWdlKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgaW50ZXJmYWNlIEVycm9yT2JzZXJ2ZXIgew0KICAgICAgICB2b2lkIG9uTmV4dChFcnJvciBlcnJvcik7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIFRyYW5zYWN0aW9uKFF1ZXVlIHF1ZXVlKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIHsNCiAgICAgICAgdGhpcy5xdWV1ZSA9IHF1ZXVlOw0KICAgICAgICB0aGlzLl9rdWJlbXFBZGRyZXNzID0gcXVldWUuZ2V0U2VydmVyQWRkcmVzcygpOw0KICAgICAgICB0aGlzLl9tZXRhZGF0YSA9IHF1ZXVlLmdldE1ldGFkYXRhKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVjZWl2ZSBxdWV1ZSBtZXNzYWdlcyByZXF1ZXN0ICwgd2FpdGluZyBmb3IgcmVzcG9uc2Ugb3IgdGltZW91dC4NCiAgICAgKiANCiAgICAgKiBAcGFyYW0gdmlzaWJpbGl0eVNlY29uZHMgbWVzc2FnZSBhY2Nlc3MgbG9jayBieSByZWNlaXZlci4NCiAgICAgKiBAcGFyYW0gd2FpdFRpbWVTZWNvbmRzICAgV2FpdCB0aW1lIG9mIHJlcXVlc3QuLCBkZWZhdWx0IGlzIGZyb20gcXVldWUNCiAgICAgKiBAcGFyYW0gbXNnRXhwaXJlZCAgICAgICAgQXN5bmMgU3RyZWFtT2JzZXJ2ZXIgdG8gaGFuZGxlIHRyYW5zYWN0aW9uDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb24uDQogICAgICogQHJldHVybiBUcmFuc2FjdGlvbiByZXNwb25zZQ0KICAgICAqIEB0aHJvd3MgVHJhbnNhY3Rpb25FeGNlcHRpb24gICAgICAgICAgICAgIFRyYW5zYWN0aW9uIHJldHVybiBtZXNzYWdlIGlzDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlzc2luZy4NCiAgICAgKiBAdGhyb3dzIEF1dGhvcml6YXRpb25FeGNlcHRpb24gICAgICAgICAgICBBdXRob3JpemF0aW9uIEt1YmVNUSB0b2tlbiB0byBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZWQgZm9yIEt1YmVNUSBjb25uZWN0aW9uLg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCg0KICAgIHB1YmxpYyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgUmVjZWl2ZShJbnRlZ2VyIHZpc2liaWxpdHlTZWNvbmRzLCBJbnRlZ2VyIHdhaXRUaW1lU2Vjb25kcywNCiAgICAgICAgICAgIEVycm9yT2JzZXJ2ZXIgbXNnRXhwaXJlZCkNCiAgICAgICAgICAgIHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiwgIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgZXJyb3JPYnNlcnZlciA9IG1zZ0V4cGlyZWQ7DQogICAgICAgIGlmIChzdGF0ZSAhPSBUcmFuU3RhdGUuUmVhZHkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlKCJObyBBY3RpdmUgcXVldWUgbWVzc2FnZSwgdmlzaWJpbGl0eSBleHBpcmVkOiIgKyB2aXNpYmlsaXR5RXhwLCBudWxsLA0KICAgICAgICAgICAgICAgICAgICBudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHJlc3A7DQogICAgICAgIENyZWF0ZU5ld09ic2VydmVyKCk7DQoNCiAgICAgICAgcmVzcCA9IFN0cmVhbVF1ZXVlTWVzc2FnZShLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QubmV3QnVpbGRlcigpLnNldENsaWVudElEKHRoaXMucXVldWUuZ2V0Q2xpZW50SUQoKSkNCiAgICAgICAgICAgICAgICAuc2V0Q2hhbm5lbCh0aGlzLnF1ZXVlLmdldFF1ZXVlTmFtZSgpKS5zZXRSZXF1ZXN0SUQoSURHZW5lcmF0b3IuR2V0aWQoKSkNCiAgICAgICAgICAgICAgICAuc2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhKEt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5SZWNlaXZlTWVzc2FnZSkNCiAgICAgICAgICAgICAgICAuc2V0VmlzaWJpbGl0eVNlY29uZHModmlzaWJpbGl0eVNlY29uZHMpLnNldFdhaXRUaW1lU2Vjb25kcyh3YWl0VGltZVNlY29uZHMpLmJ1aWxkKCkpOw0KDQogICAgICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlKHJlc3ApOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVjZWl2ZSBxdWV1ZSBtZXNzYWdlcyByZXF1ZXN0ICwgd2FpdGluZyBmb3IgcmVzcG9uc2Ugb3IgdGltZW91dC4NCiAgICAgKiANCiAgICAgKiBAcGFyYW0gdmlzaWJpbGl0eVNlY29uZHMgbWVzc2FnZSBhY2Nlc3MgbG9jayBieSByZWNlaXZlci4NCiAgICAgKiBAcGFyYW0gd2FpdFRpbWVTZWNvbmRzICAgV2FpdCB0aW1lIG9mIHJlcXVlc3QuLCBkZWZhdWx0IGlzIGZyb20gcXVldWUNCiAgICAgKiBAcmV0dXJuIFRyYW5zYWN0aW9uIHJlc3BvbnNlDQogICAgICogQHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgICAgVHJhbnNhY3Rpb24gcmV0dXJuIG1lc3NhZ2UgaXMNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaXNzaW5nLg0KICAgICAqIEB0aHJvd3MgQXV0aG9yaXphdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgIEF1dGhvcml6YXRpb24gS3ViZU1RIHRva2VuIHRvIGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCBmb3IgS3ViZU1RIGNvbm5lY3Rpb24uDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqLw0KICAgIHB1YmxpYyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgUmVjZWl2ZShJbnRlZ2VyIHZpc2liaWxpdHlTZWNvbmRzLCBJbnRlZ2VyIHdhaXRUaW1lU2Vjb25kcykNCiAgICAgICAgICAgIHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiwgIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCg0KICAgICAgICBpZiAoc3RhdGUgIT0gVHJhblN0YXRlLlJlYWR5KSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSgiTm8gQWN0aXZlIHF1ZXVlIG1lc3NhZ2UsIHZpc2liaWxpdHkgZXhwaXJlZDoiICsgdmlzaWJpbGl0eUV4cCwgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXNwOw0KICAgICAgICBDcmVhdGVOZXdPYnNlcnZlcigpOw0KDQogICAgICAgIHJlc3AgPSBTdHJlYW1RdWV1ZU1lc3NhZ2UoS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKS5zZXRDbGllbnRJRCh0aGlzLnF1ZXVlLmdldENsaWVudElEKCkpDQogICAgICAgICAgICAgICAgLnNldENoYW5uZWwodGhpcy5xdWV1ZS5nZXRRdWV1ZU5hbWUoKSkuc2V0UmVxdWVzdElEKElER2VuZXJhdG9yLkdldGlkKCkpDQogICAgICAgICAgICAgICAgLnNldFN0cmVhbVJlcXVlc3RUeXBlRGF0YShLdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuUmVjZWl2ZU1lc3NhZ2UpDQogICAgICAgICAgICAgICAgLnNldFZpc2liaWxpdHlTZWNvbmRzKHZpc2liaWxpdHlTZWNvbmRzKS5zZXRXYWl0VGltZVNlY29uZHMod2FpdFRpbWVTZWNvbmRzKS5idWlsZCgpKTsNCg0KICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZShyZXNwKTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFdpbGwgbWFyayBNZXNzYWdlIGRlcXVldWVkIG9uIHF1ZXVlLg0KICAgICAqIA0KICAgICAqIEByZXR1cm4gVHJhbnNhY3Rpb24gcmVzcG9uc2UuDQogICAgICogQHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgICAgVHJhbnNhY3Rpb24gcmV0dXJuIG1lc3NhZ2UgaXMNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaXNzaW5nLg0KICAgICAqIEB0aHJvd3MgQXV0aG9yaXphdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgIEF1dGhvcml6YXRpb24gS3ViZU1RIHRva2VuIHRvIGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCBmb3IgS3ViZU1RIGNvbm5lY3Rpb24uDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqLw0KICAgIHB1YmxpYyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgQWNrTWVzc2FnZSgpDQogICAgICAgICAgICB0aHJvd3MgVHJhbnNhY3Rpb25FeGNlcHRpb24sICBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChtc2cgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UoIk5vIEFjdGl2ZSBxdWV1ZSBtZXNzYWdlLCB2aXNpYmlsaXR5IGV4cGlyZWQ6IiArIHZpc2liaWxpdHlFeHAsIG51bGwsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICB9DQogICAgICAgIEt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzcDsNCg0KICAgICAgICByZXNwID0gU3RyZWFtUXVldWVNZXNzYWdlKEt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5uZXdCdWlsZGVyKCkuc2V0Q2xpZW50SUQodGhpcy5xdWV1ZS5nZXRDbGllbnRJRCgpKQ0KICAgICAgICAgICAgICAgIC5zZXRDaGFubmVsKHRoaXMucXVldWUuZ2V0UXVldWVOYW1lKCkpLnNldFJlcXVlc3RJRChJREdlbmVyYXRvci5HZXRpZCgpKQ0KICAgICAgICAgICAgICAgIC5zZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLkFja01lc3NhZ2UpDQogICAgICAgICAgICAgICAgLnNldFJlZlNlcXVlbmNlKG1zZy5nZXRNZXNzYWdlKCkuZ2V0QXR0cmlidXRlcygpLmdldFNlcXVlbmNlKCkpLmJ1aWxkKCkpOw0KDQogICAgICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlKHJlc3ApOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFdpbGwgcmV0dXJuIG1lc3NhZ2UgdG8gcXVldWUuDQogICAgICogDQogICAgICogQHJldHVybiBUcmFuc2FjdGlvbiByZXNwb25zZS4NCiAgICAgKiBAdGhyb3dzIFRyYW5zYWN0aW9uRXhjZXB0aW9uICAgICAgICAgICAgICBUcmFuc2FjdGlvbiByZXR1cm4gbWVzc2FnZSBpcw0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pc3NpbmcuDQogICAgICogQHRocm93cyBBdXRob3JpemF0aW9uRXhjZXB0aW9uICAgICAgICAgICAgQXV0aG9yaXphdGlvbiBLdWJlTVEgdG9rZW4gdG8gYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VkIGZvciBLdWJlTVEgY29ubmVjdGlvbi4NCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVybWluZWQuDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24gICAgICAgICAgICAgICAgICAgICAgSW5kaWNhdGVzIHNvbWUga2luZCBvZiBlcnJvcg0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0uDQogICAgICovDQogICAgcHVibGljIFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSBSZWplY3RNZXNzYWdlKCkNCiAgICAgICAgICAgIHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiwgIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgaWYgKG1zZyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSgiTm8gQWN0aXZlIHF1ZXVlIG1lc3NhZ2UsIHZpc2liaWxpdHkgZXhwaXJlZDoiICsgdmlzaWJpbGl0eUV4cCwgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXNwOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXNwID0gU3RyZWFtUXVldWVNZXNzYWdlKEt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgICAgICAgLnNldENsaWVudElEKHRoaXMucXVldWUuZ2V0Q2xpZW50SUQoKSkuc2V0Q2hhbm5lbCh0aGlzLnF1ZXVlLmdldFF1ZXVlTmFtZSgpKQ0KICAgICAgICAgICAgICAgICAgICAuc2V0UmVxdWVzdElEKElER2VuZXJhdG9yLkdldGlkKCkpLnNldFN0cmVhbVJlcXVlc3RUeXBlRGF0YShLdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuUmVqZWN0TWVzc2FnZSkNCiAgICAgICAgICAgICAgICAgICAgLnNldFJlZlNlcXVlbmNlKG1zZy5nZXRNZXNzYWdlKCkuZ2V0QXR0cmlidXRlcygpLmdldFNlcXVlbmNlKCkpLmJ1aWxkKCkpOw0KDQogICAgICAgIH0gY2F0Y2ggKE51bGxQb2ludGVyRXhjZXB0aW9uIGV4KSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSgiTm8gQWN0aXZlIHF1ZXVlIG1lc3NhZ2UsIHZpc2liaWxpdHkgZXhwaXJlZDoiICsgdmlzaWJpbGl0eUV4cCwgbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgbnVsbCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZShyZXNwKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFeHRlbmQgdGhlIHZpc2liaWxpdHkgdGltZSBmb3IgdGhlIGN1cnJlbnQgcmVjZWl2ZSBtZXNzYWdlDQogICAgICogDQogICAgICogQHBhcmFtIHZpc2liaWxpdHlTZWNvbmRzIE5ldyB2aWFiaWxpdHkgdGltZS4NCiAgICAgKiBAcmV0dXJuIFRyYW5zYWN0aW9uIHJlc3BvbnNlLg0KICAgICAqIA0KICAgICAqIEByZXR1cm4gVHJhbnNhY3Rpb24gcmVzcG9uc2UuDQogICAgICogQHRocm93cyBUcmFuc2FjdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgICAgVHJhbnNhY3Rpb24gcmV0dXJuIG1lc3NhZ2UgaXMNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaXNzaW5nLg0KICAgICAqIEB0aHJvd3MgQXV0aG9yaXphdGlvbkV4Y2VwdGlvbiAgICAgICAgICAgIEF1dGhvcml6YXRpb24gS3ViZU1RIHRva2VuIHRvIGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCBmb3IgS3ViZU1RIGNvbm5lY3Rpb24uDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqLw0KICAgIHB1YmxpYyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgRXh0ZW5kVmlzaWJpbGl0eShpbnQgdmlzaWJpbGl0eVNlY29uZHMpDQogICAgICAgICAgICB0aHJvd3MgVHJhbnNhY3Rpb25FeGNlcHRpb24sICBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChtc2cgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UoIk5vIEFjdGl2ZSBxdWV1ZSBtZXNzYWdlLCB2aXNpYmlsaXR5IGV4cGlyZWQ6IiArIHZpc2liaWxpdHlFeHAsIG51bGwsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICB9DQogICAgICAgIEt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzcDsNCg0KICAgICAgICByZXNwID0gU3RyZWFtUXVldWVNZXNzYWdlKEt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5uZXdCdWlsZGVyKCkuc2V0Q2xpZW50SUQodGhpcy5xdWV1ZS5nZXRDbGllbnRJRCgpKQ0KICAgICAgICAgICAgICAgIC5zZXRDaGFubmVsKHRoaXMucXVldWUuZ2V0UXVldWVOYW1lKCkpLnNldFJlcXVlc3RJRChJREdlbmVyYXRvci5HZXRpZCgpKQ0KICAgICAgICAgICAgICAgIC5zZXRWaXNpYmlsaXR5U2Vjb25kcyh2aXNpYmlsaXR5U2Vjb25kcykNCiAgICAgICAgICAgICAgICAuc2V0U3RyZWFtUmVxdWVzdFR5cGVEYXRhKEt1YmVtcS5TdHJlYW1SZXF1ZXN0VHlwZS5Nb2RpZnlWaXNpYmlsaXR5KS5idWlsZCgpKTsNCg0KICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZShyZXNwKTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2VuZCB0aGUgY3VycmVudCByZWNlaXZlZCBtZXNzYWdlIHRvIGEgbmV3IGNoYW5uZWwgYW5kIGFjayB0aGUgY3VycmVudA0KICAgICAqIG1lc3NhZ2UuDQogICAgICogDQogICAgICogQHBhcmFtIHF1ZXVlTmFtZSBSZXNlbmQgcXVldWUgbmFtZS4NCiAgICAgKiBAcmV0dXJuIFRyYW5zYWN0aW9uIHJlc3BvbnNlLg0KICAgICAqIA0KICAgICAqIEB0aHJvd3MgVHJhbnNhY3Rpb25FeGNlcHRpb24gICAgICAgICAgICAgIFRyYW5zYWN0aW9uIHJldHVybiBtZXNzYWdlIGlzDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlzc2luZy4NCiAgICAgKiBAdGhyb3dzIEF1dGhvcml6YXRpb25FeGNlcHRpb24gICAgICAgICAgICBBdXRob3JpemF0aW9uIEt1YmVNUSB0b2tlbiB0byBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZWQgZm9yIEt1YmVNUSBjb25uZWN0aW9uLg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCiAgICBwdWJsaWMgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlIFJlU2VuZChTdHJpbmcgcXVldWVOYW1lKQ0KICAgICAgICAgICAgdGhyb3dzIFRyYW5zYWN0aW9uRXhjZXB0aW9uLCAgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICBpZiAobXNnID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlKCJObyBBY3RpdmUgcXVldWUgbWVzc2FnZSwgdmlzaWJpbGl0eSBleHBpcmVkOiIgKyB2aXNpYmlsaXR5RXhwLCBudWxsLA0KICAgICAgICAgICAgICAgICAgICBudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHJlc3A7DQoNCiAgICAgICAgcmVzcCA9IFN0cmVhbVF1ZXVlTWVzc2FnZShLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QubmV3QnVpbGRlcigpLnNldENsaWVudElEKHRoaXMucXVldWUuZ2V0Q2xpZW50SUQoKSkNCiAgICAgICAgICAgICAgICAuc2V0Q2hhbm5lbChxdWV1ZU5hbWUpLnNldFJlcXVlc3RJRChJREdlbmVyYXRvci5HZXRpZCgpKQ0KDQogICAgICAgICAgICAgICAgLnNldFN0cmVhbVJlcXVlc3RUeXBlRGF0YShLdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuUmVzZW5kTWVzc2FnZSkuYnVpbGQoKSk7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UocmVzcCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVzZW5kIHRoZSBjdXJyZW50IHJlY2VpdmVkIG1lc3NhZ2UgbWVzc2FnZSB0byBhIG5ldyBjaGFubmVsLg0KICAgICAqIA0KICAgICAqIEBwYXJhbSBtZXNzYWdlIE5ldyBtZXNzYWdlDQogICAgICogQHJldHVybiBUcmFuc2FjdGlvbiByZXNwb25zZS4NCiAgICAgKiBAdGhyb3dzIFRyYW5zYWN0aW9uRXhjZXB0aW9uICAgICAgICAgICAgICBUcmFuc2FjdGlvbiByZXR1cm4gbWVzc2FnZSBpcw0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pc3NpbmcuDQogICAgICogQHRocm93cyBBdXRob3JpemF0aW9uRXhjZXB0aW9uICAgICAgICAgICAgQXV0aG9yaXphdGlvbiBLdWJlTVEgdG9rZW4gdG8gYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VkIGZvciBLdWJlTVEgY29ubmVjdGlvbi4NCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVybWluZWQuDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24gICAgICAgICAgICAgICAgICAgICAgSW5kaWNhdGVzIHNvbWUga2luZCBvZiBlcnJvcg0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0uDQogICAgICovDQogICAgcHVibGljIFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSBNb2RpZnkoTWVzc2FnZSBtZXNzYWdlKQ0KICAgICAgICAgICAgdGhyb3dzIFRyYW5zYWN0aW9uRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChtc2cgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UoIk5vIEFjdGl2ZSBxdWV1ZSBtZXNzYWdlLCB2aXNpYmlsaXR5IGV4cGlyZWQ6IiArIHZpc2liaWxpdHlFeHAsIG51bGwsDQogICAgICAgICAgICAgICAgICAgIG51bGwpOw0KICAgICAgICB9DQoNCiAgICAgICAgS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZXNwOw0KDQogICAgICAgIHJlc3AgPSBTdHJlYW1RdWV1ZU1lc3NhZ2UoS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0Lm5ld0J1aWxkZXIoKS5zZXRDbGllbnRJRCh0aGlzLnF1ZXVlLmdldENsaWVudElEKCkpDQogICAgICAgICAgICAgICAgLnNldFJlcXVlc3RJRChJREdlbmVyYXRvci5HZXRpZCgpKQ0KICAgICAgICAgICAgICAgIC5zZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLlNlbmRNb2RpZmllZE1lc3NhZ2UpDQogICAgICAgICAgICAgICAgLnNldE1vZGlmaWVkTWVzc2FnZShtZXNzYWdlLnRvUXVldWVNZXNzYWdlKCkpLmJ1aWxkKCkpOw0KDQogICAgICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlKHJlc3ApOw0KICAgIH0NCg0KICAgIHByaXZhdGUgYm9vbGVhbiBDcmVhdGVOZXdPYnNlcnZlcigpIHsNCiAgICAgICAgc3RhdGUgPSBUcmFuU3RhdGUuU3RyZWFtT3BlbmVkOw0KICAgICAgICB2aXNpYmlsaXR5RXhwID0gZmFsc2U7DQogICAgICAgIHJlc3BTdHJlYW1PYnNlcnZlciA9IG5ldyBTdHJlYW1PYnNlcnZlcjxLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPigpIHsNCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbk5leHQoU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChsb2NrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5nZXRJc0Vycm9yKCkpDQogICAgICAgICAgICAgICAgICAgIC8vIEVycm9yIGNhc2UNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmlzYWJpbGl0eUV4cGlyZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5nZXRFcnJvcigpLmNvbnRhaW5zKCJFcnJvciAxMjkiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gVHJhblN0YXRlLlN0cmVhbUNsb3Npbmc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0ZXN0TXNnID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eUV4cCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZWQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck9ic2VydmVyLm9uTmV4dChuZXcgRXJyb3IodmFsdWUuZ2V0RXJyb3IoKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgZXJyb3INCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVycm9yIGluIGluaXRpYWwgcmVjZWl2ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldFN0cmVhbVJlcXVlc3RUeXBlRGF0YSgpID09IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUmVxdWVzdFR5cGUuUmVjZWl2ZU1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBUcmFuU3RhdGUuU3RyZWFtQ2xvc2luZzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0ZXN0TXNnID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGVkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXIgZXJyb3JzIHdpbGwgbm90IGNsb3NlIHRoZSBzdHJlYW0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgaW5pdGlhbCBtc2cgcmVjZWl2ZWQNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTdHJlYW1SZXF1ZXN0VHlwZURhdGEoKSA9PSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVJlcXVlc3RUeXBlLlJlY2VpdmVNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gdmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBUcmFuU3RhdGUuSW5UcmFuc2FjdGlvbjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBsYXRlc3RNc2cgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgbG9jay5ub3RpZnkoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvcihUaHJvd2FibGUgdCkgew0KICAgICAgICAgICAgICAgIGlmICh0LmdldE1lc3NhZ2UoKS5jb250YWlucygiVU5BVVRIRU5USUNBVEVEIikpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBUcmFuU3RhdGUuVU5BVVRIRU5USUNBVEVEOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gVHJhblN0YXRlLlN0cmVhbUNsb3Npbmc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9uQ29tcGxldGVkKCk7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkNvbXBsZXRlZCgpIHsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgIT0gVHJhblN0YXRlLlN0cmVhbUNsb3NlZCkgew0KICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2spIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSAhPSBUcmFuU3RhdGUuVU5BVVRIRU5USUNBVEVEKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBUcmFuU3RhdGUuU3RyZWFtQ2xvc2VkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1zZyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgc2h1dGRvd25Ob3coKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2subm90aWZ5KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlIFN0cmVhbVF1ZXVlTWVzc2FnZShLdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3Qgc3IpDQogICAgICAgICAgICB0aHJvd3MgU1NMRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFRyYW5zYWN0aW9uRXhjZXB0aW9uDQoNCiAgICB7DQoNCiAgICAgICAgaWYgKHJlcVN0cmVhbU9ic2VydmVyID09IG51bGwpIHsNCiAgICAgICAgICAgIHN0YXRlID0gVHJhblN0YXRlLlN0cmVhbVJlZ2lzdGVyZWQ7DQogICAgICAgICAgICByZXFTdHJlYW1PYnNlcnZlciA9IEdldEt1YmVNUUFzeW5jQ2xpZW50KCkuc3RyZWFtUXVldWVNZXNzYWdlKHJlc3BTdHJlYW1PYnNlcnZlcik7DQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJlcVN0cmVhbU9ic2VydmVyLm9uTmV4dChzcik7DQoNCiAgICAgICAgc3luY2hyb25pemVkIChsb2NrKSB7DQogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGxvY2sud2FpdCgpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUgIT0gVHJhblN0YXRlLkluVHJhbnNhY3Rpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBUcmFuU3RhdGUuVU5BVVRIRU5USUNBVEVEKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHJhbnNhY3Rpb25FeGNlcHRpb24oIlVOQVVUSEVOVElDQVRFRCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxhdGVzdE1zZzsNCg0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gQXV0by1nZW5lcmF0ZWQgY2F0Y2ggYmxvY2sNCiAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAvLyBjYXRjaCAoQXV0aG9yaXphdGlvbkV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICAgICAgLy8gICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgICAgICAgICAgLy8gICAgIHRocm93IGU7DQogICAgICAgICAgICAgICAgLy8gfQ0KDQogICAgICAgICAgICAgICAgZmluYWxseSB7DQoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGxhdGVzdE1zZzsNCiAgICB9DQoNCn0="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.288+0300	INFO	request: {"metadata":{"filename":"CommandQueryResponderAsync.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/commandqueryresponderasync"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1hbmRxdWVyeXJlc3BvbmRlcmFzeW5jOw0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQppbXBvcnQgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuUmVxdWVzdFJlY2VpdmU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuUmVzcG9uZGVyOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZXhhbXBsZXMuY29tbW9uZXhhbXBsZS5CYXNlRXhhbXBsZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnN1YnNjcmlwdGlvbi5TdWJzY3JpYmVSZXF1ZXN0Ow0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuc3Vic2NyaXB0aW9uLlN1YnNjcmliZVR5cGU7DQppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEudGV4dC5NZXNzYWdlRm9ybWF0Ow0KaW1wb3J0IGphdmEudGltZS5Mb2NhbERhdGVUaW1lOw0KDQpjbGFzcyBDb21tYW5kUXVlcnlSZXNwb25kZXJBc3luYyBleHRlbmRzIEJhc2VFeGFtcGxlIHsNCg0KICAgIHByaXZhdGUgUmVzcG9uZGVyLlJlcXVlc3RSZXNwb25zZUFzeW5jT2JzZXJ2ZXIgSGFuZGxlSW5jb21pbmdSZXF1ZXN0czsNCiAgICBwcml2YXRlIFJlc3BvbmRlciByZXNwb25kZXI7DQoNCiAgICBDb21tYW5kUXVlcnlSZXNwb25kZXJBc3luYygpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIHN1cGVyKCJDb21tYW5kUXVlcnlSZXNwb25kZXIiKTsNCiAgICAgICAgU3RyaW5nIGNsaWVudElkID0gdGhpcy5nZXRDbGllbnRJRCgpOw0KICAgICAgICBMb2dnZXIgbG9nID0gdGhpcy5sb2dnZXI7DQogICAgICAgIHJlc3BvbmRlciA9IG5ldyBSZXNwb25kZXIoKTsNCiAgICAgICAgSGFuZGxlSW5jb21pbmdSZXF1ZXN0cyA9IG5ldyBSZXNwb25kZXIuUmVxdWVzdFJlc3BvbnNlQXN5bmNPYnNlcnZlcigpIHsNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIFJlc3BvbnNlIG9uTmV4dChSZXF1ZXN0UmVjZWl2ZSByZXF1ZXN0KSB7DQogICAgICAgICAgICAgICAgbG9nLndhcm4oTWVzc2FnZUZvcm1hdC5mb3JtYXQoDQogICAgICAgICAgICAgICAgICAgICAgICAiU3Vic2NyaWJlciBSZWNlaXZlZCBFdmVudDogTWV0YWRhdGE6Jyd7MH0nJywgQ2hhbm5lbDonJ3sxfScnIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuZ2V0TWV0YWRhdGEoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuZ2V0Q2hhbm5lbCgpDQogICAgICAgICAgICAgICAgKSk7DQoNCiAgICAgICAgICAgICAgICBSZXNwb25zZSByZXNwb25zZSA9IG5ldyBSZXNwb25zZShyZXF1ZXN0KTsNCiAgICAgICAgICAgICAgICByZXNwb25zZS5zZXRDYWNoZUhpdChmYWxzZSk7DQogICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0RXJyb3IoIk5vbmUiKTsNCiAgICAgICAgICAgICAgICByZXNwb25zZS5zZXRDbGllbnRJRChjbGllbnRJZCk7DQogICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2V0Qm9keSgiT0siLmdldEJ5dGVzKCkpOw0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLnNldEV4ZWN1dGVkKHRydWUpOw0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLnNldE1ldGFkYXRhKCJPSyIpOw0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLnNldFRpbWVzdGFtcChMb2NhbERhdGVUaW1lLm5vdygpKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIHZvaWQgb25FcnJvcihUaHJvd2FibGUgdCkgew0KICAgICAgICAgICAgICAgIGxvZy53YXJuKE1lc3NhZ2VGb3JtYXQuZm9ybWF0KCJFcnJvcjogezF9IiwgdC5nZXRNZXNzYWdlKCkpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkNvbXBsZXRlZCgpIHsNCiAgICAgICAgICAgICAgICBsb2cuaW5mbygiU3Vic2NyaWJlciBzdWJzY3JpcHRpb24gY29tcGxldGVkLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBDcmVhdGVTdWJzY3JpYmVUb1F1ZXJpZXMoKTsNCiAgICAgICAgQ3JlYXRlU3Vic2NyaWJlVG9Db21tYW5kcygpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBDcmVhdGVTdWJzY3JpYmVUb0NvbW1hbmRzKCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgU3Vic2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0gQ3JlYXRlU3Vic2NyaWJlUmVxdWVzdChTdWJzY3JpYmVUeXBlLlF1ZXJpZXMpOw0KICAgICAgICByZXNwb25kZXIuU3Vic2NyaWJlVG9SZXF1ZXN0c0FzeW5jKHN1YnNjcmliZVJlcXVlc3QsIEhhbmRsZUluY29taW5nUmVxdWVzdHMpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBDcmVhdGVTdWJzY3JpYmVUb1F1ZXJpZXMoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICBTdWJzY3JpYmVSZXF1ZXN0IHN1YnNjcmliZVJlcXVlc3QgPSBDcmVhdGVTdWJzY3JpYmVSZXF1ZXN0KFN1YnNjcmliZVR5cGUuQ29tbWFuZHMpOw0KICAgICAgICByZXNwb25kZXIuU3Vic2NyaWJlVG9SZXF1ZXN0c0FzeW5jKHN1YnNjcmliZVJlcXVlc3QsIEhhbmRsZUluY29taW5nUmVxdWVzdHMpOw0KICAgIH0NCg0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.289+0300	INFO	request: {"metadata":{"filename":"gradle-wrapper.properties","method":"save","path":"java/kubemq-java/gradle/wrapper"},"data":"I1dlZCBPY3QgMzEgMDI6NDI6NTYgSVNUIDIwMTgNCmRpc3RyaWJ1dGlvbkJhc2U9R1JBRExFX1VTRVJfSE9NRQ0KZGlzdHJpYnV0aW9uUGF0aD13cmFwcGVyL2Rpc3RzDQp6aXBTdG9yZUJhc2U9R1JBRExFX1VTRVJfSE9NRQ0KemlwU3RvcmVQYXRoPXdyYXBwZXIvZGlzdHMNCmRpc3RyaWJ1dGlvblVybD1odHRwc1w6Ly9zZXJ2aWNlcy5ncmFkbGUub3JnL2Rpc3RyaWJ1dGlvbnMvZ3JhZGxlLTQuOC1hbGwuemlwDQpncm91cElkPWt1YmVtcS1zZGstamF2YQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.344+0300	INFO	request: {"metadata":{"filename":"build.gradle","method":"save","path":"java/kubemq-java/kubemq-java-sdk"},"data":"YnVpbGRzY3JpcHQgew0KICAgIHJlcG9zaXRvcmllcyB7DQogICAgICAgIG1hdmVuQ2VudHJhbCgpDQogICAgfQ0KICAgIGRlcGVuZGVuY2llcyB7DQogICAgICAgIGNsYXNzcGF0aCAnY29tLmdvb2dsZS5wcm90b2J1Zjpwcm90b2J1Zi1ncmFkbGUtcGx1Z2luOjAuOC42JyAgICAgDQogICAgICAgIGNsYXNzcGF0aCAnY29tLnZhbm5pa3RlY2g6Z3JhZGxlLW1hdmVuLXB1Ymxpc2gtcGx1Z2luOjAuOC4wJw0KICAgIH0NCn0NCg0KcGx1Z2lucyB7DQogICAgaWQgJ2lvLmZyYW56YmVja2VyLmdyYWRsZS1sb21ib2snIHZlcnNpb24gJzEuMTQnDQogICAgaWQgImNvbS5nb29nbGUucHJvdG9idWYiIHZlcnNpb24gIjAuOC42Ig0KICAgIGlkICdqYXZhJw0KfQ0KDQoNCg0KYXBwbHkgcGx1Z2luOiAnaWRlYScNCmFwcGx5IHBsdWdpbjogImNvbS52YW5uaWt0ZWNoLm1hdmVuLnB1Ymxpc2giDQoNCg0KDQoNCnNvdXJjZUNvbXBhdGliaWxpdHkgPSAxLjgNCg0KcmVwb3NpdG9yaWVzIHsNCiAgICBtYXZlbkNlbnRyYWwoKQ0KfQ0KDQpkZWYgZ3JwY1ZlcnNpb24gPSAnMS4xNi4xJw0KDQpkZXBlbmRlbmNpZXMgew0KICAgIHRlc3RDb21waWxlIGdyb3VwOiAnanVuaXQnLCBuYW1lOiAnanVuaXQnLCB2ZXJzaW9uOiAnNC4xMicNCiAgICBjb21waWxlIGdyb3VwOiAnY29tLmdvb2dsZS5wcm90b2J1ZicsIG5hbWU6ICdwcm90b2J1Zi1qYXZhJywgdmVyc2lvbjogJzMuNS4xJw0KICAgIGNvbXBpbGUgZ3JvdXA6ICdvcmcuYXBhY2hlLmNvbW1vbnMnLCBuYW1lOiAnY29tbW9ucy1sYW5nMycsIHZlcnNpb246ICczLjguMScNCiAgICBjb21waWxlICJpby5ncnBjOmdycGMtYWx0czoke2dycGNWZXJzaW9ufSINCiAgICBjb21waWxlICJpby5ncnBjOmdycGMtbmV0dHktc2hhZGVkOiR7Z3JwY1ZlcnNpb259Ig0KICAgIGNvbXBpbGUgImlvLmdycGM6Z3JwYy1wcm90b2J1Zjoke2dycGNWZXJzaW9ufSINCiAgICBjb21waWxlICJpby5ncnBjOmdycGMtc3R1Yjoke2dycGNWZXJzaW9ufSINCiAgICBjb21waWxlT25seSAiamF2YXguYW5ub3RhdGlvbjpqYXZheC5hbm5vdGF0aW9uLWFwaToxLjMuMiINCg0KICAgIGNvbXBpbGUgZ3JvdXA6ICdvcmcuc2xmNGonLCBuYW1lOiAnc2xmNGotYXBpJywgdmVyc2lvbjogJzEuNy4yNScNCn0NCg0KcHJvdG9idWYgew0KICAgIHByb3RvYyB7DQogICAgICAgIGFydGlmYWN0ID0gJ2NvbS5nb29nbGUucHJvdG9idWY6cHJvdG9jOjMuNS4xLTEnDQogICAgfQ0KICAgIHBsdWdpbnMgew0KICAgICAgICBncnBjIHsNCiAgICAgICAgICAgIGFydGlmYWN0ID0gJ2lvLmdycGM6cHJvdG9jLWdlbi1ncnBjLWphdmE6MS4xNi4xJw0KICAgICAgICB9DQogICAgfQ0KICAgIGdlbmVyYXRlUHJvdG9UYXNrcyB7DQogICAgICAgIGFsbCgpKi5wbHVnaW5zIHsNCiAgICAgICAgICAgIGdycGMge30NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KbG9tYm9rIHsNCiAgICB2ZXJzaW9uID0gJzEuMTguNCcNCiAgICBzaGEyNTYgPSAiIg0KfQ=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.506+0300	INFO	request: {"metadata":{"filename":"EventChannel.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/eventchannel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmV2ZW50Y2hhbm5lbDsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZXZlbnQuQ2hhbm5lbDsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmV2ZW50LkNoYW5uZWxQYXJhbWV0ZXJzOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZXZlbnQuRXZlbnQ7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5leGFtcGxlcy5jb21tb25leGFtcGxlLkJhc2VFeGFtcGxlOw0KDQppbXBvcnQgamF2YXgubmV0LnNzbC5TU0xFeGNlcHRpb247DQoNCmNsYXNzIEV2ZW50Q2hhbm5lbCBleHRlbmRzIEJhc2VFeGFtcGxlIHsNCg0KICAgIEV2ZW50Q2hhbm5lbCgpIHRocm93cyBTU0xFeGNlcHRpb24sIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiB7DQogICAgICAgIHN1cGVyKCJFdmVudENoYW5uZWwiKTsNCiAgICAgICAgQ2hhbm5lbFBhcmFtZXRlcnMgY2hhbm5lbFBhcmFtZXRlcnMgPSBDcmVhdGVNZXNzYWdlQ2hhbm5lbFBhcmFtKCk7DQogICAgICAgIENoYW5uZWwgY2hhbm5lbCA9IG5ldyBDaGFubmVsKGNoYW5uZWxQYXJhbWV0ZXJzKTsNCiAgICAgICAgY2hhbm5lbC5TZW5kRXZlbnQoQ3JlYXRlQ2hhbm5lbE1lc3NhZ2UoKSk7DQoNCiAgICB9DQoNCiAgICBwcml2YXRlIEV2ZW50IENyZWF0ZUNoYW5uZWxNZXNzYWdlKCkgew0KICAgICAgICBFdmVudCBldmVudCA9IG5ldyBFdmVudCgpOw0KICAgICAgICBldmVudC5zZXRNZXRhZGF0YSgiRXZlbnRDaGFubmVsIik7DQogICAgICAgIGV2ZW50LnNldEJvZHkoIkV2ZW50Ii5nZXRCeXRlcygpKTsNCiAgICAgICAgcmV0dXJuIGV2ZW50Ow0KICAgIH0NCg0KICAgIHByaXZhdGUgQ2hhbm5lbFBhcmFtZXRlcnMgQ3JlYXRlTWVzc2FnZUNoYW5uZWxQYXJhbSgpIHsNCiAgICAgICAgQ2hhbm5lbFBhcmFtZXRlcnMgcGFyYW1ldGVycyA9IG5ldyBDaGFubmVsUGFyYW1ldGVycygpOw0KICAgICAgICBwYXJhbWV0ZXJzLnNldENoYW5uZWxOYW1lKHRoaXMuZ2V0Q2hhbm5lbE5hbWUoKSk7DQogICAgICAgIHBhcmFtZXRlcnMuc2V0Q2xpZW50SUQoIkV2ZW50Q2hhbm5lbElEIik7DQogICAgICAgIHBhcmFtZXRlcnMuc2V0U3RvcmUodHJ1ZSk7DQogICAgICAgIHBhcmFtZXRlcnMuc2V0UmV0dXJuUmVzdWx0KGZhbHNlKTsNCiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnM7DQogICAgfQ0KDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.537+0300	INFO	request: {"metadata":{"filename":"Channel.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/commandquery"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeTsNCg0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQppbXBvcnQgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkubG93bGV2ZWwuSW5pdGlhdG9yOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5Lmxvd2xldmVsLlJlcXVlc3Q7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0Ow0KaW1wb3J0IGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjsNCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZzMuU3RyaW5nVXRpbHM7DQoNCmltcG9ydCBqYXZheC5uZXQuc3NsLlNTTEV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLnRleHQuTWVzc2FnZUZvcm1hdDsNCg0KLyoqDQogKiBSZXByZXNlbnRzIGEgSW5pdGlhdG9yIHdpdGggcHJlZGVmaW5lZCBwYXJhbWV0ZXJzLg0KICovDQpwdWJsaWMgY2xhc3MgQ2hhbm5lbCB7DQoNCiAgICBwcml2YXRlIEluaXRpYXRvciBfaW5pdGlhdG9yOw0KDQogICAgcHJpdmF0ZSBSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZTsNCg0KICAgIHByaXZhdGUgU3RyaW5nIGNoYW5uZWxOYW1lOw0KICAgIHByaXZhdGUgU3RyaW5nIGNsaWVudElkOw0KICAgIHByaXZhdGUgaW50IHRpbWVvdXQ7DQogICAgcHJpdmF0ZSBTdHJpbmcgY2FjaGVLZXk7DQogICAgcHJpdmF0ZSBpbnQgY2FjaGVUVEw7DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgUmVxdWVzdENoYW5uZWwgY2xhc3MgdXNpbmcNCiAgICAgKiBSZXF1ZXN0Q2hhbm5lbFBhcmFtZXRlcnMuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcGFyYW1ldGVycyBDaGFubmVsIFBhcmFtZXRlcnMNCiAgICAgKi8NCiAgICBwdWJsaWMgQ2hhbm5lbChDaGFubmVsUGFyYW1ldGVycyBwYXJhbWV0ZXJzKSB7DQogICAgICAgIHRoaXMocGFyYW1ldGVycy5nZXRSZXF1ZXN0VHlwZSgpLCBwYXJhbWV0ZXJzLmdldENoYW5uZWxOYW1lKCksIHBhcmFtZXRlcnMuZ2V0Q2xpZW50SUQoKSwNCiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzLmdldFRpbWVvdXQoKSwgcGFyYW1ldGVycy5nZXRDYWNoZUtleSgpLCBwYXJhbWV0ZXJzLmdldENhY2hlVFRMKCksDQogICAgICAgICAgICAgICAgcGFyYW1ldGVycy5nZXRLdWJlTVFBZGRyZXNzKCkscGFyYW1ldGVycy5nZXRBdXRoVG9rZW4oKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFJlcXVlc3RDaGFubmVsIGNsYXNzIHVzaW5nIGEgc2V0IG9mDQogICAgICogcGFyYW1ldGVycy4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBjaGFubmVsTmFtZSAgIFJlcHJlc2VudHMgVGhlIGNoYW5uZWwgbmFtZSB0byBzZW5kIHRvIHVzaW5nIHRoZSBLdWJlTVEuDQogICAgICogQHBhcmFtIGNsaWVudElkICAgICAgUmVwcmVzZW50cyB0aGUgc2VuZGVyIElEIHRoYXQgdGhlIFJlcXVlc3Qgd2lsbCBiZSBzZW5kDQogICAgICogICAgICAgICAgICAgICAgICAgICAgdW5kZXIuDQogICAgICogQHBhcmFtIHRpbWVvdXQgICAgICAgUmVwcmVzZW50cyB0aGUgbGltaXQgZm9yIHdhaXRpbmcgZm9yIHJlc3BvbnNlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgKE1pbGxpc2Vjb25kcykuDQogICAgICogQHBhcmFtIGNhY2hlS2V5ICAgICAgUmVwcmVzZW50cyBpZiB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2F2ZWQgZnJvbSBDYWNoZSBhbmQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICB1bmRlciB3aGF0ICJLZXkiKGphdmEubGFuZy5TdHJpbmcpIHRvIHNhdmUgaXQuDQogICAgICogQHBhcmFtIGNhY2hlVFRMICAgICAgQ2FjaGUgdGltZSB0byBsaXZlIDogZm9yIGhvdyBsb25nIGRvZXMgdGhlIHJlcXVlc3QNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICBzaG91bGQgYmUgc2F2ZWQgaW4gQ2FjaGUNCiAgICAgKiBAcGFyYW0ga3ViZU1RQWRkcmVzcyBLdWJlTVEgc2VydmVyIGFkZHJlc3MuDQogICAgICogQHBhcmFtIGF1dGhUb2tlbiBSZXByZXNlbnRzIEpXVCB0b2tlbiB0byBiZSB1c2VkIGZvciBLdWJlTVEgYXV0aGVudGljYXRpb24uDQogICAgICovDQogICAgcHVibGljIENoYW5uZWwoUmVxdWVzdFR5cGUgcmVxdWVzdHNUeXBlLCBTdHJpbmcgY2hhbm5lbE5hbWUsIFN0cmluZyBjbGllbnRJZCwgaW50IHRpbWVvdXQsIFN0cmluZyBjYWNoZUtleSwNCiAgICAgICAgICAgIGludCBjYWNoZVRUTCwgU3RyaW5nIGt1YmVNUUFkZHJlc3MsIFN0cmluZyBhdXRoVG9rZW4pIHsNCiAgICAgICAgdGhpcy5yZXF1ZXN0VHlwZSA9IHJlcXVlc3RzVHlwZTsNCiAgICAgICAgdGhpcy5jaGFubmVsTmFtZSA9IGNoYW5uZWxOYW1lOw0KICAgICAgICB0aGlzLmNsaWVudElkID0gY2xpZW50SWQ7DQogICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7DQogICAgICAgIHRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsNCiAgICAgICAgdGhpcy5jYWNoZVRUTCA9IGNhY2hlVFRMOw0KICAgICAgICANCiAgICAgICAgaXNWYWxpZCgpOw0KDQogICAgICAgIF9pbml0aWF0b3IgPSBuZXcgSW5pdGlhdG9yKGt1YmVNUUFkZHJlc3MsIGF1dGhUb2tlbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBhIHNpbmdsZSBibG9ja2luZyByZXF1ZXN0IHVzaW5nIHRoZSBLdWJlTVEuXCByZXNwb25zZSB3aWxsIHJldHVybiBhcw0KICAgICAqIFN0cmVhbU9ic2VydmVyLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3QgIFRoZSBpby5rdWJlbXEuc2RrLnJlcXVlc3RyZXBseS5sb3dsZXZlbC5yZXF1ZXN0IHRoYXQgd2lsbCBiZQ0KICAgICAqICAgICAgICAgICAgICAgICBzZW50IHRvIHRoZSBrdWJlTVEuDQogICAgICogQHBhcmFtIHJlc3BvbnNlIFN0cmVhbU9ic2VydmVyIGZvciB0aGUgcmVzcG9uc2UgZm9yIHRoZSByZXF1ZXN0IHRoYXQgd2FzDQogICAgICogICAgICAgICAgICAgICAgIHNlbnQuDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIFNlbmRSZXF1ZXN0KGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlcXVlc3QgcmVxdWVzdCwgZmluYWwgU3RyZWFtT2JzZXJ2ZXI8UmVzcG9uc2U+IHJlc3BvbnNlKQ0KICAgICAgICAgICAgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uIHsNCiAgICAgICAgcmVzcG9uc2Uub25OZXh0KF9pbml0aWF0b3IuU2VuZFJlcXVlc3QoQ3JlYXRlTG93TGV2ZWxSZXF1ZXN0KHJlcXVlc3QpKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBhIHNpbmdsZSBibG9ja2luZyByZXF1ZXN0IHVzaW5nIHRoZSBLdWJlTVEgd2l0aCBvdmVycmlkZSBwYXJhbWV0ZXJzLg0KICAgICAqIHJlc3BvbnNlIHdpbGwgcmV0dXJuIGFzIFN0cmVhbU9ic2VydmVyLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3QgICAgICAgIFRoZSBpby5rdWJlbXEuc2RrLnJlcXVlc3RyZXBseS5sb3dsZXZlbC5yZXF1ZXN0IHRoYXQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBzZW50IHRvIHRoZSBrdWJlTVEuDQogICAgICogQHBhcmFtIG92ZXJyaWRlUGFyYW1zIEFsbG93IG92ZXJ3cml0aW5nICJUaW1lb3V0IiAiQ2FjaGVLZXkiIGFuZCAiQ2FjaGVUVEwiDQogICAgICogICAgICAgICAgICAgICAgICAgICAgIGZvciBhIHNpbmdsZSBSZXF1ZXN0Lg0KICAgICAqIEBwYXJhbSByZXNwb25zZSAgICAgICBTdHJlYW1PYnNlcnZlciBmb3IgdGhlIHJlc3BvbnNlIGZvciB0aGUgcmVxdWVzdCB0aGF0DQogICAgICogICAgICAgICAgICAgICAgICAgICAgIHdhcyBzZW50Lg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBTZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0IHJlcXVlc3QsIFJlcXVlc3RQYXJhbWV0ZXJzIG92ZXJyaWRlUGFyYW1zLA0KICAgICAgICAgICAgZmluYWwgU3RyZWFtT2JzZXJ2ZXI8UmVzcG9uc2U+IHJlc3BvbnNlKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICByZXNwb25zZS5vbk5leHQoX2luaXRpYXRvci5TZW5kUmVxdWVzdChDcmVhdGVMb3dMZXZlbFJlcXVlc3QocmVxdWVzdCwgb3ZlcnJpZGVQYXJhbXMpKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBhIHNpbmdsZSBhc3luYyByZXF1ZXN0IHVzaW5nIHRoZSBLdWJlTVEuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVxdWVzdCAgVGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLnJlcXVlc3QgdGhhdCB3aWxsIGJlDQogICAgICogICAgICAgICAgICAgICAgIHNlbnQgdG8gdGhlIGt1YmVNUS4NCiAgICAgKiBAcGFyYW0gcmVzcG9uc2UgU3RyZWFtT2JzZXJ2ZXIgZm9yIHRoZSByZXNwb25zZSBmb3IgdGhlIHJlcXVlc3QgdGhhdCB3YXMNCiAgICAgKiAgICAgICAgICAgICAgICAgc2VudC4NCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVybWluZWQuDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24gICAgICAgICAgICAgICAgICAgICAgSW5kaWNhdGVzIHNvbWUga2luZCBvZiBlcnJvcg0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0uDQogICAgICovDQogICAgcHVibGljIHZvaWQgU2VuZFJlcXVlc3RBc3luYyhpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0IHJlcXVlc3QsIGZpbmFsIFN0cmVhbU9ic2VydmVyPFJlc3BvbnNlPiByZXNwb25zZSkNCiAgICAgICAgICAgIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIF9pbml0aWF0b3IuU2VuZFJlcXVlc3QoQ3JlYXRlTG93TGV2ZWxSZXF1ZXN0KHJlcXVlc3QpLCByZXNwb25zZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2VuZCBhIHNpbmdsZSBhc3luYyByZXF1ZXN0IHVzaW5nIHRoZSBLdWJlTVEgd2l0aCBvdmVycmlkZSBwYXJhbWV0ZXJzLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3QgICAgICAgIFRoZSBpby5rdWJlbXEuc2RrLnJlcXVlc3RyZXBseS5sb3dsZXZlbC5yZXF1ZXN0IHRoYXQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBzZW50IHRvIHRoZSBrdWJlTVEuDQogICAgICogQHBhcmFtIG92ZXJyaWRlUGFyYW1zIEFsbG93IG92ZXJ3cml0aW5nICJUaW1lb3V0IiAiQ2FjaGVLZXkiIGFuZCAiQ2FjaGVUVEwiDQogICAgICogICAgICAgICAgICAgICAgICAgICAgIGZvciBhIHNpbmdsZSBSZXF1ZXN0Lg0KICAgICAqIEBwYXJhbSByZXNwb25zZSAgICAgICBTdHJlYW1PYnNlcnZlciBmb3IgdGhlIHJlc3BvbnNlIGZvciB0aGUgcmVxdWVzdCB0aGF0DQogICAgICogICAgICAgICAgICAgICAgICAgICAgIHdhcyBzZW50Lg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4gICANCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBTZW5kUmVxdWVzdEFzeW5jKGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlcXVlc3QgcmVxdWVzdCwgUmVxdWVzdFBhcmFtZXRlcnMgb3ZlcnJpZGVQYXJhbXMsDQogICAgICAgICAgICBmaW5hbCBTdHJlYW1PYnNlcnZlcjxSZXNwb25zZT4gcmVzcG9uc2UpDQogICAgICAgICAgICB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICBfaW5pdGlhdG9yLlNlbmRSZXF1ZXN0KENyZWF0ZUxvd0xldmVsUmVxdWVzdChyZXF1ZXN0LCBvdmVycmlkZVBhcmFtcyksIHJlc3BvbnNlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZW5kIGEgc2luZ2xlIHJlcXVlc3QgdXNpbmcgdGhlIEt1YmVNUS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXF1ZXN0IFRoZSBpby5rdWJlbXEuc2RrLnJlcXVlc3RyZXBseS5sb3dsZXZlbC5yZXF1ZXN0IHRoYXQgd2lsbCBiZQ0KICAgICAqICAgICAgICAgICAgICAgIHNlbnQgdG8gdGhlIGt1YmVNUS4NCiAgICAgKiBAcmV0dXJuIHJlc3BvbnNlIGZvciB0aGUgcmVxdWVzdCB0aGF0IHdhcyBzZW50Lg0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKiBAdGhyb3dzIEF1dGhvcml6YXRpb25FeGNlcHRpb24gICAgICAgICAgICBBdXRob3JpemF0aW9uIEt1YmVNUSB0b2tlbiB0byBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZWQgZm9yIEt1YmVNUSBjb25uZWN0aW9uLiAgIA0KICAgICAqLw0KICAgIHB1YmxpYyBSZXNwb25zZSBTZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0IHJlcXVlc3QpDQogICAgICAgICAgICB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICAgICAgcmV0dXJuIF9pbml0aWF0b3IuU2VuZFJlcXVlc3QoQ3JlYXRlTG93TGV2ZWxSZXF1ZXN0KHJlcXVlc3QpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZW5kIGEgc2luZ2xlIHJlcXVlc3QgdXNpbmcgdGhlIEt1YmVNUSB3aXRoIG92ZXJyaWRlIHBhcmFtZXRlcnMuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVxdWVzdCAgICAgICAgVGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLnJlcXVlc3QgdGhhdA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIHNlbnQgdG8gdGhlIGt1YmVNUS4NCiAgICAgKiBAcGFyYW0gb3ZlcnJpZGVQYXJhbXMgQWxsb3cgb3ZlcndyaXRpbmcgIlRpbWVvdXQiICJDYWNoZUtleSIgYW5kICJDYWNoZVRUTCINCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgZm9yIGEgc2luZ2xlIFJlcXVlc3QuDQogICAgICogQHJldHVybiByZXNwb25zZSBmb3IgdGhlIHJlcXVlc3QgdGhhdCB3YXMgc2VudC4NCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZQ0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVybWluZWQuDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24gICAgICAgICAgICAgICAgICAgICAgSW5kaWNhdGVzIHNvbWUga2luZCBvZiBlcnJvcg0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0uDQogICAgICogQHRocm93cyBBdXRob3JpemF0aW9uRXhjZXB0aW9uICAgICAgICAgICAgQXV0aG9yaXphdGlvbiBLdWJlTVEgdG9rZW4gdG8gYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VkIGZvciBLdWJlTVEgY29ubmVjdGlvbi4NCiAgICAgKi8NCiAgICBwdWJsaWMgUmVzcG9uc2UgU2VuZFJlcXVlc3QoaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuUmVxdWVzdCByZXF1ZXN0LCBSZXF1ZXN0UGFyYW1ldGVycyBvdmVycmlkZVBhcmFtcykNCiAgICAgICAgICAgIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7ICAgICANCiAgICAgICAgICAgIHJldHVybiBfaW5pdGlhdG9yLlNlbmRSZXF1ZXN0KENyZWF0ZUxvd0xldmVsUmVxdWVzdChyZXF1ZXN0LCBvdmVycmlkZVBhcmFtcykpOyAgICAgICANCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQaW5nIGNoZWNrIEt1YmVtcSByZXNwb25zZSB1c2luZyBDaGFubmVsLg0KICAgICAqIA0KICAgICAqIEByZXR1cm4gUGluZ1Jlc3VsdA0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yDQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCiAgICBwdWJsaWMgUGluZ1Jlc3VsdCBQaW5nKCkgdGhyb3dzIFNTTEV4Y2VwdGlvbiwgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIHsNCiAgICAgICAgcmV0dXJuIF9pbml0aWF0b3IuUGluZygpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBpc1ZhbGlkKCkgew0KICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjaGFubmVsTmFtZSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIlBhcmFtZXRlciBjaGFubmVsTmFtZSBpcyBtYW5kYXRvcnkiKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVxdWVzdFR5cGUgPT0gUmVxdWVzdFR5cGUuUmVxdWVzdFR5cGVVbmtub3duKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJJbnZhbGlkIFJlcXVlc3QgVHlwZSIpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aW1lb3V0IDwgMCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigNCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZUZvcm1hdC5mb3JtYXQoIlBhcmFtZXRlciB0aW1lb3V0IG11c3QgYmUgYmV0d2VlbiAxIGFuZCB7MH0iLCBJbnRlZ2VyLk1BWF9WQUxVRSkpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHJpdmF0ZSBSZXF1ZXN0IENyZWF0ZUxvd0xldmVsUmVxdWVzdChpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgICAgUmVxdWVzdCBpbm5lclJlcXVlc3QgPSBuZXcgUmVxdWVzdCgpOw0KDQogICAgICAgIGlubmVyUmVxdWVzdC5zZXRSZXF1ZXN0VHlwZSh0aGlzLnJlcXVlc3RUeXBlKTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldENoYW5uZWwoY2hhbm5lbE5hbWUpOw0KICAgICAgICBpbm5lclJlcXVlc3Quc2V0Q2xpZW50SWQoY2xpZW50SWQpOw0KICAgICAgICBpbm5lclJlcXVlc3Quc2V0VGltZW91dCh0aW1lb3V0KTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldENhY2hlS2V5KGNhY2hlS2V5KTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldENhY2hlVFRMKGNhY2hlVFRMKTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldFJlcXVlc3RJZChyZXF1ZXN0LmdldFJlcXVlc3RJZCgpKTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldEJvZHkocmVxdWVzdC5nZXRCb2R5KCkpOw0KICAgICAgICBpbm5lclJlcXVlc3Quc2V0TWV0YWRhdGEocmVxdWVzdC5nZXRNZXRhZGF0YSgpKTsNCiAgICAgICAgaW5uZXJSZXF1ZXN0LnNldFRhZ3MocmVxdWVzdC5nZXRUYWdzKCkpOw0KDQogICAgICAgIHJldHVybiBpbm5lclJlcXVlc3Q7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBSZXF1ZXN0IENyZWF0ZUxvd0xldmVsUmVxdWVzdChpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgICAgICBSZXF1ZXN0UGFyYW1ldGVycyBvdmVycmlkZVBhcmFtcykgew0KICAgICAgICBSZXF1ZXN0IHJlcSA9IENyZWF0ZUxvd0xldmVsUmVxdWVzdChyZXF1ZXN0KTsNCg0KICAgICAgICBpZiAob3ZlcnJpZGVQYXJhbXMuZ2V0VGltZW91dCgpICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJlcS5zZXRUaW1lb3V0KG92ZXJyaWRlUGFyYW1zLmdldFRpbWVvdXQoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAob3ZlcnJpZGVQYXJhbXMuZ2V0Q2FjaGVLZXkoKSAhPSBudWxsKSB7DQogICAgICAgICAgICByZXEuc2V0Q2FjaGVLZXkob3ZlcnJpZGVQYXJhbXMuZ2V0Q2FjaGVLZXkoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAob3ZlcnJpZGVQYXJhbXMuZ2V0Q2FjaGVUVEwoKSAhPSBudWxsKSB7DQogICAgICAgICAgICByZXEuc2V0Q2FjaGVUVEwob3ZlcnJpZGVQYXJhbXMuZ2V0Q2FjaGVUVEwoKSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVxOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2hhbm5lbE5hbWUoKSB7DQogICAgICAgIHJldHVybiBjaGFubmVsTmFtZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFubmVsTmFtZShTdHJpbmcgY2hhbm5lbE5hbWUpIHsNCiAgICAgICAgdGhpcy5jaGFubmVsTmFtZSA9IGNoYW5uZWxOYW1lOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xpZW50SWQoKSB7DQogICAgICAgIHJldHVybiBjbGllbnRJZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDbGllbnRJZChTdHJpbmcgY2xpZW50SWQpIHsNCiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOw0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0VGltZW91dCgpIHsNCiAgICAgICAgcmV0dXJuIHRpbWVvdXQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0VGltZW91dChpbnQgdGltZW91dCkgew0KICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2FjaGVLZXkoKSB7DQogICAgICAgIHJldHVybiBjYWNoZUtleTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDYWNoZUtleShTdHJpbmcgY2FjaGVLZXkpIHsNCiAgICAgICAgdGhpcy5jYWNoZUtleSA9IGNhY2hlS2V5Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0Q2FjaGVUVEwoKSB7DQogICAgICAgIHJldHVybiBjYWNoZVRUTDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDYWNoZVRUTChpbnQgY2FjaGVUVEwpIHsNCiAgICAgICAgdGhpcy5jYWNoZVRUTCA9IGNhY2hlVFRMOw0KICAgIH0NCg0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.764+0300	INFO	request: {"metadata":{"filename":"build.gradle","method":"save","path":"java/kubemq-java"},"data":"cGx1Z2lucyB7DQogICAgaWQgJ2phdmEnDQp9DQoNCg0KDQpncm91cCAnaW8ua3ViZW1xLnNkaycNCnZlcnNpb24gJzEuMC4zJw0KDQpzb3VyY2VDb21wYXRpYmlsaXR5ID0gMS44DQoNCnJlcG9zaXRvcmllcyB7DQogICAgbWF2ZW5DZW50cmFsKCkNCn0NCg0KZGVwZW5kZW5jaWVzIHsNCiAgICB0ZXN0Q29tcGlsZSBncm91cDogJ2p1bml0JywgbmFtZTogJ2p1bml0JywgdmVyc2lvbjogJzQuMTInDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.767+0300	INFO	request: {"metadata":{"filename":"master","method":"save","path":"java/kubemq-java/.git/logs/refs/heads"},"data":"MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCA0MjllNWUyODMzNDg0MzkwMDJkZjAxNTRmNDIxZDExZjVlMTk0YzBkIGt1YmVtcSA8bGlvci5uYWJhdEBrdWJlbXEuaW8+IDE2MTgzODUyNjkgKzAzMDAJY2xvbmU6IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2t1YmVtcS1pby9rdWJlbXEtSmF2YS5naXQK"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.823+0300	INFO	request: {"metadata":{"filename":"ConfigurationLoader.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/basic"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmJhc2ljOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmczLlN0cmluZ1V0aWxzOw0KaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7DQppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7DQoNCmltcG9ydCBqYXZhLnRleHQuTWVzc2FnZUZvcm1hdDsNCg0KY2xhc3MgQ29uZmlndXJhdGlvbkxvYWRlciB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQ29uZmlndXJhdGlvbkxvYWRlci5jbGFzcyk7DQoNCiAgICAvKioNCiAgICAgKiBzdGF0aWMgY2FjaGUgdmFyaWFibGUgdG8gc3RvcmUgdGhlIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcw0KICAgICAqIG9uY2UgZGV0ZXJtaW5lZCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIEphdmEgcHJvcGVydHkNCiAgICAgKg0KICAgICAqIEBzaW5jZSAxLjANCiAgICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgX3BhdGggPSBudWxsOw0KDQogICAgLyoqDQogICAgICogc3RhdGljIGNhY2hlIHZhcmlhYmxlIHRvIHN0b3JlIHRoZSBLdWJlTVEgcmVnaXN0cmF0aW9uIGtleQ0KICAgICAqDQogICAgICogQHNpbmNlIDEuMA0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyBfa2V5ID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIHN0YXRpYyBjYWNoZSB2YXJpYWJsZSB0byBzdG9yZSB0aGUgS3ViZU1RIGNlcnRpZmljYXRlIGZpbGUNCiAgICAgKg0KICAgICAqIEBzaW5jZSAxLjANCiAgICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgX2NlcnQgPSBudWxsOw0KDQogICAgLyoqDQogICAgICogR2V0IEt1YmVNUSBTZXJ2ZXIgQWRkcmVzcyBieSBwcmlvcml0eToNCiAgICAgKiAxLiBFbnZpcm9ubWVudCBWYXJpYWJsZSAoS3ViZU1RU2VydmVyQWRkcmVzcykNCiAgICAgKiAyLiBKYXZhIFByb3BlcnR5IChieSBwYXNzaW5nIHRoZSAtREt1YmVNUVNlcnZlckFkZHJlc3M9IG9wdGlvbiB0byB0aGUgSlZNKQ0KICAgICAqDQogICAgICogQHJldHVybiBLdWJlTVEgc2VydmVyIGNvbm5lY3Rpb24gc3RyaW5nIG9yIG51bGwgaWYgY2FuJ3QgYmUgZGV0ZXJtaW5lZA0KICAgICAqIEBhcGlOb3RlIFRoZSByZXN1bHQgaXMgY2FjaGVkIGFmdGVyIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgb25jZQ0KICAgICAqIEBzaW5jZSAxLjANCiAgICAgKi8NCiAgICBzdGF0aWMgU3RyaW5nIEdldFNlcnZlckFkZHJlc3MoKSB7DQogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc05vdEJsYW5rKF9wYXRoKSkgcmV0dXJuIF9wYXRoOw0KDQogICAgICAgIF9wYXRoID0gR2V0RnJvbUVudmlyb25tZW50VmFyaWFibGUoIkt1YmVNUVNlcnZlckFkZHJlc3MiKTsNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzTm90QmxhbmsoX3BhdGgpKSB7DQogICAgICAgICAgICBsb2dnZXIuaW5mbyhNZXNzYWdlRm9ybWF0LmZvcm1hdCgiS3ViZU1RIFNlcnZlciBhZGRyZXNzIGZvdW5kIGluIEVudmlyb25tZW50OiB7MH0iLCBfcGF0aCkpOw0KICAgICAgICAgICAgcmV0dXJuIF9wYXRoOw0KICAgICAgICB9DQoNCiAgICAgICAgX3BhdGggPSBHZXRGcm9tUHJvcGVydHkoInNlcnZlckFkZHJlc3MiKTsNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzTm90QmxhbmsoX3BhdGgpKSB7DQogICAgICAgICAgICBsb2dnZXIuaW5mbyhNZXNzYWdlRm9ybWF0LmZvcm1hdCgiS3ViZU1RIFNlcnZlciBhZGRyZXNzIHNldCBmcm9tIHByb3BlcnR5OiB7MH0iLCBfcGF0aCkpOw0KICAgICAgICAgICAgcmV0dXJuIF9wYXRoOw0KICAgICAgICB9DQoNCiAgICAgICAgbG9nZ2VyLmluZm8oTWVzc2FnZUZvcm1hdC5mb3JtYXQoIkt1YmVNUSBTZXJ2ZXIgYWRkcmVzcyBub3QgZm91bmQuIHVzaW5nIHswfSIsIF9wYXRoKSk7DQogICAgICAgIHJldHVybiBfcGF0aDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgdGhlIEt1YmVNUSBsaWNlbnNlIGtleSBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIGZyb20gSmF2YSBwcm9wZXJ0eQ0KICAgICAqDQogICAgICogQHJldHVybiBLdWJlTVEgTGljZW5zZSBLZXkgb3IgZW1wdHkgc3RyaW5nIGlmIGNhbid0IGJlIGRldGVybWluZWQNCiAgICAgKiBAYXBpTm90ZSBUaGUgcmVzdWx0IGlzIGNhY2hlZCBhZnRlciB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkIG9uY2UNCiAgICAgKiBAc2luY2UgMS4wDQogICAgICovDQogICAgc3RhdGljIFN0cmluZyBHZXRSZWdpc3RyYXRpb25LZXkoKSB7DQogICAgICAgIGlmIChfa2V5ICE9IG51bGwpIHJldHVybiBfa2V5Ow0KDQogICAgICAgIF9rZXkgPSBHZXRGcm9tRW52aXJvbm1lbnRWYXJpYWJsZSgiS3ViZU1RUmVnaXN0cmF0aW9uS2V5Iik7DQoNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzTm90QmxhbmsoX2tleSkpIHJldHVybiBfa2V5Ow0KDQogICAgICAgIF9rZXkgPSBHZXRGcm9tUHJvcGVydHkoInJlZ2lzdHJhdGlvbktleSIpOw0KDQogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0JsYW5rKF9rZXkpKSB7DQogICAgICAgICAgICBfa2V5ID0gIiI7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gX2tleTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgdGhlIEt1YmVNUSBjZXJ0aWZpY2F0aW9uIGZpbGUgcGF0aCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIGZyb20gSmF2YSBwcm9wZXJ0eQ0KICAgICAqDQogICAgICogQHJldHVybiBLdWJlTVEgQ2VydGlmaWNhdGlvbiBmaWxlIHBhdGggb3IgZW1wdHkgc3RyaW5nIGlmIGNhbid0IGJlIGRldGVybWluZWQNCiAgICAgKiBAYXBpTm90ZSBUaGUgcmVzdWx0IGlzIGNhY2hlZCBhZnRlciB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkIG9uY2UNCiAgICAgKiBAc2luY2UgMS4wDQogICAgICovDQogICAgc3RhdGljIFN0cmluZyBHZXRDZXJpZmljYXRlRmlsZSgpIHsNCiAgICAgICAgaWYgKF9jZXJ0ICE9IG51bGwpIHJldHVybiBfY2VydDsNCg0KICAgICAgICBfY2VydCA9IEdldEZyb21FbnZpcm9ubWVudFZhcmlhYmxlKCJLdWJlTVFDZXJ0aWZpY2F0ZUZpbGUiKTsNCg0KICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNOb3RCbGFuayhfY2VydCkpIHJldHVybiBfY2VydDsNCg0KICAgICAgICBfY2VydCA9IEdldEZyb21Qcm9wZXJ0eSgiY2VydGlmaWNhdGVGaWxlIik7DQoNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzQmxhbmsoX2NlcnQpKSB7DQogICAgICAgICAgICBfY2VydCA9ICIiOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIF9jZXJ0Ow0KICAgIH0NCg0KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyBHZXRGcm9tRW52aXJvbm1lbnRWYXJpYWJsZShTdHJpbmcga2V5KSB7DQogICAgICAgIHJldHVybiBTeXN0ZW0uZ2V0ZW52KGtleSk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIEdldEZyb21Qcm9wZXJ0eShTdHJpbmcga2V5KSB7DQogICAgICAgIHJldHVybiBTeXN0ZW0uZ2V0UHJvcGVydHkoa2V5KTsNCiAgICB9DQoNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:11.976+0300	INFO	request: {"metadata":{"filename":"pre-push.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCgojIEFuIGV4YW1wbGUgaG9vayBzY3JpcHQgdG8gdmVyaWZ5IHdoYXQgaXMgYWJvdXQgdG8gYmUgcHVzaGVkLiAgQ2FsbGVkIGJ5ICJnaXQKIyBwdXNoIiBhZnRlciBpdCBoYXMgY2hlY2tlZCB0aGUgcmVtb3RlIHN0YXR1cywgYnV0IGJlZm9yZSBhbnl0aGluZyBoYXMgYmVlbgojIHB1c2hlZC4gIElmIHRoaXMgc2NyaXB0IGV4aXRzIHdpdGggYSBub24temVybyBzdGF0dXMgbm90aGluZyB3aWxsIGJlIHB1c2hlZC4KIwojIFRoaXMgaG9vayBpcyBjYWxsZWQgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiMKIyAkMSAtLSBOYW1lIG9mIHRoZSByZW1vdGUgdG8gd2hpY2ggdGhlIHB1c2ggaXMgYmVpbmcgZG9uZQojICQyIC0tIFVSTCB0byB3aGljaCB0aGUgcHVzaCBpcyBiZWluZyBkb25lCiMKIyBJZiBwdXNoaW5nIHdpdGhvdXQgdXNpbmcgYSBuYW1lZCByZW1vdGUgdGhvc2UgYXJndW1lbnRzIHdpbGwgYmUgZXF1YWwuCiMKIyBJbmZvcm1hdGlvbiBhYm91dCB0aGUgY29tbWl0cyB3aGljaCBhcmUgYmVpbmcgcHVzaGVkIGlzIHN1cHBsaWVkIGFzIGxpbmVzIHRvCiMgdGhlIHN0YW5kYXJkIGlucHV0IGluIHRoZSBmb3JtOgojCiMgICA8bG9jYWwgcmVmPiA8bG9jYWwgc2hhMT4gPHJlbW90ZSByZWY+IDxyZW1vdGUgc2hhMT4KIwojIFRoaXMgc2FtcGxlIHNob3dzIGhvdyB0byBwcmV2ZW50IHB1c2ggb2YgY29tbWl0cyB3aGVyZSB0aGUgbG9nIG1lc3NhZ2Ugc3RhcnRzCiMgd2l0aCAiV0lQIiAod29yayBpbiBwcm9ncmVzcykuCgpyZW1vdGU9IiQxIgp1cmw9IiQyIgoKejQwPTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAKCndoaWxlIHJlYWQgbG9jYWxfcmVmIGxvY2FsX3NoYSByZW1vdGVfcmVmIHJlbW90ZV9zaGEKZG8KCWlmIFsgIiRsb2NhbF9zaGEiID0gJHo0MCBdCgl0aGVuCgkJIyBIYW5kbGUgZGVsZXRlCgkJOgoJZWxzZQoJCWlmIFsgIiRyZW1vdGVfc2hhIiA9ICR6NDAgXQoJCXRoZW4KCQkJIyBOZXcgYnJhbmNoLCBleGFtaW5lIGFsbCBjb21taXRzCgkJCXJhbmdlPSIkbG9jYWxfc2hhIgoJCWVsc2UKCQkJIyBVcGRhdGUgdG8gZXhpc3RpbmcgYnJhbmNoLCBleGFtaW5lIG5ldyBjb21taXRzCgkJCXJhbmdlPSIkcmVtb3RlX3NoYS4uJGxvY2FsX3NoYSIKCQlmaQoKCQkjIENoZWNrIGZvciBXSVAgY29tbWl0CgkJY29tbWl0PWBnaXQgcmV2LWxpc3QgLW4gMSAtLWdyZXAgJ15XSVAnICIkcmFuZ2UiYAoJCWlmIFsgLW4gIiRjb21taXQiIF0KCQl0aGVuCgkJCWVjaG8gPiYyICJGb3VuZCBXSVAgY29tbWl0IGluICRsb2NhbF9yZWYsIG5vdCBwdXNoaW5nIgoJCQlleGl0IDEKCQlmaQoJZmkKZG9uZQoKZXhpdCAwCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.045+0300	INFO	request: {"metadata":{"filename":".classpath","method":"save","path":"java/kubemq-java/kubemq-java-sdk"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxjbGFzc3BhdGg+DQoJPGNsYXNzcGF0aGVudHJ5IGtpbmQ9InNyYyIgb3V0cHV0PSJiaW4vbWFpbiIgcGF0aD0ic3JjL21haW4vamF2YSI+DQoJCTxhdHRyaWJ1dGVzPg0KCQkJPGF0dHJpYnV0ZSBuYW1lPSJncmFkbGVfc2NvcGUiIHZhbHVlPSJtYWluIi8+DQoJCQk8YXR0cmlidXRlIG5hbWU9ImdyYWRsZV91c2VkX2J5X3Njb3BlIiB2YWx1ZT0ibWFpbix0ZXN0Ii8+DQoJCTwvYXR0cmlidXRlcz4NCgk8L2NsYXNzcGF0aGVudHJ5Pg0KCTxjbGFzc3BhdGhlbnRyeSBraW5kPSJjb24iIHBhdGg9Im9yZy5lY2xpcHNlLmpkdC5sYXVuY2hpbmcuSlJFX0NPTlRBSU5FUi9vcmcuZWNsaXBzZS5qZHQuaW50ZXJuYWwuZGVidWcudWkubGF1bmNoZXIuU3RhbmRhcmRWTVR5cGUvSmF2YVNFLTEuOC8iLz4NCgk8Y2xhc3NwYXRoZW50cnkga2luZD0iY29uIiBwYXRoPSJvcmcuZWNsaXBzZS5idWlsZHNoaXAuY29yZS5ncmFkbGVjbGFzc3BhdGhjb250YWluZXIiLz4NCgk8Y2xhc3NwYXRoZW50cnkga2luZD0ib3V0cHV0IiBwYXRoPSJiaW4vZGVmYXVsdCIvPg0KPC9jbGFzc3BhdGg+DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.224+0300	INFO	request: {"metadata":{"filename":"gradlew.bat","method":"save","path":"java/kubemq-java"},"data":"QGlmICIlREVCVUclIiA9PSAiIiBAZWNobyBvZmYNCkByZW0gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMNCkByZW0NCkByZW0gIEdyYWRsZSBzdGFydHVwIHNjcmlwdCBmb3IgV2luZG93cw0KQHJlbQ0KQHJlbSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQpAcmVtIFNldCBsb2NhbCBzY29wZSBmb3IgdGhlIHZhcmlhYmxlcyB3aXRoIHdpbmRvd3MgTlQgc2hlbGwNCmlmICIlT1MlIj09IldpbmRvd3NfTlQiIHNldGxvY2FsDQoNCnNldCBESVJOQU1FPSV+ZHAwDQppZiAiJURJUk5BTUUlIiA9PSAiIiBzZXQgRElSTkFNRT0uDQpzZXQgQVBQX0JBU0VfTkFNRT0lfm4wDQpzZXQgQVBQX0hPTUU9JURJUk5BTUUlDQoNCkByZW0gQWRkIGRlZmF1bHQgSlZNIG9wdGlvbnMgaGVyZS4gWW91IGNhbiBhbHNvIHVzZSBKQVZBX09QVFMgYW5kIEdSQURMRV9PUFRTIHRvIHBhc3MgSlZNIG9wdGlvbnMgdG8gdGhpcyBzY3JpcHQuDQpzZXQgREVGQVVMVF9KVk1fT1BUUz0NCg0KQHJlbSBGaW5kIGphdmEuZXhlDQppZiBkZWZpbmVkIEpBVkFfSE9NRSBnb3RvIGZpbmRKYXZhRnJvbUphdmFIb21lDQoNCnNldCBKQVZBX0VYRT1qYXZhLmV4ZQ0KJUpBVkFfRVhFJSAtdmVyc2lvbiA+TlVMIDI+JjENCmlmICIlRVJST1JMRVZFTCUiID09ICIwIiBnb3RvIGluaXQNCg0KZWNoby4NCmVjaG8gRVJST1I6IEpBVkFfSE9NRSBpcyBub3Qgc2V0IGFuZCBubyAnamF2YScgY29tbWFuZCBjb3VsZCBiZSBmb3VuZCBpbiB5b3VyIFBBVEguDQplY2hvLg0KZWNobyBQbGVhc2Ugc2V0IHRoZSBKQVZBX0hPTUUgdmFyaWFibGUgaW4geW91ciBlbnZpcm9ubWVudCB0byBtYXRjaCB0aGUNCmVjaG8gbG9jYXRpb24gb2YgeW91ciBKYXZhIGluc3RhbGxhdGlvbi4NCg0KZ290byBmYWlsDQoNCjpmaW5kSmF2YUZyb21KYXZhSG9tZQ0Kc2V0IEpBVkFfSE9NRT0lSkFWQV9IT01FOiI9JQ0Kc2V0IEpBVkFfRVhFPSVKQVZBX0hPTUUlL2Jpbi9qYXZhLmV4ZQ0KDQppZiBleGlzdCAiJUpBVkFfRVhFJSIgZ290byBpbml0DQoNCmVjaG8uDQplY2hvIEVSUk9SOiBKQVZBX0hPTUUgaXMgc2V0IHRvIGFuIGludmFsaWQgZGlyZWN0b3J5OiAlSkFWQV9IT01FJQ0KZWNoby4NCmVjaG8gUGxlYXNlIHNldCB0aGUgSkFWQV9IT01FIHZhcmlhYmxlIGluIHlvdXIgZW52aXJvbm1lbnQgdG8gbWF0Y2ggdGhlDQplY2hvIGxvY2F0aW9uIG9mIHlvdXIgSmF2YSBpbnN0YWxsYXRpb24uDQoNCmdvdG8gZmFpbA0KDQo6aW5pdA0KQHJlbSBHZXQgY29tbWFuZC1saW5lIGFyZ3VtZW50cywgaGFuZGxpbmcgV2luZG93cyB2YXJpYW50cw0KDQppZiBub3QgIiVPUyUiID09ICJXaW5kb3dzX05UIiBnb3RvIHdpbjl4TUVfYXJncw0KDQo6d2luOXhNRV9hcmdzDQpAcmVtIFNsdXJwIHRoZSBjb21tYW5kIGxpbmUgYXJndW1lbnRzLg0Kc2V0IENNRF9MSU5FX0FSR1M9DQpzZXQgX1NLSVA9Mg0KDQo6d2luOXhNRV9hcmdzX3NsdXJwDQppZiAieCV+MSIgPT0gIngiIGdvdG8gZXhlY3V0ZQ0KDQpzZXQgQ01EX0xJTkVfQVJHUz0lKg0KDQo6ZXhlY3V0ZQ0KQHJlbSBTZXR1cCB0aGUgY29tbWFuZCBsaW5lDQoNCnNldCBDTEFTU1BBVEg9JUFQUF9IT01FJVxncmFkbGVcd3JhcHBlclxncmFkbGUtd3JhcHBlci5qYXINCg0KQHJlbSBFeGVjdXRlIEdyYWRsZQ0KIiVKQVZBX0VYRSUiICVERUZBVUxUX0pWTV9PUFRTJSAlSkFWQV9PUFRTJSAlR1JBRExFX09QVFMlICItRG9yZy5ncmFkbGUuYXBwbmFtZT0lQVBQX0JBU0VfTkFNRSUiIC1jbGFzc3BhdGggIiVDTEFTU1BBVEglIiBvcmcuZ3JhZGxlLndyYXBwZXIuR3JhZGxlV3JhcHBlck1haW4gJUNNRF9MSU5FX0FSR1MlDQoNCjplbmQNCkByZW0gRW5kIGxvY2FsIHNjb3BlIGZvciB0aGUgdmFyaWFibGVzIHdpdGggd2luZG93cyBOVCBzaGVsbA0KaWYgIiVFUlJPUkxFVkVMJSI9PSIwIiBnb3RvIG1haW5FbmQNCg0KOmZhaWwNCnJlbSBTZXQgdmFyaWFibGUgR1JBRExFX0VYSVRfQ09OU09MRSBpZiB5b3UgbmVlZCB0aGUgX3NjcmlwdF8gcmV0dXJuIGNvZGUgaW5zdGVhZCBvZg0KcmVtIHRoZSBfY21kLmV4ZSAvY18gcmV0dXJuIGNvZGUhDQppZiAgbm90ICIiID09ICIlR1JBRExFX0VYSVRfQ09OU09MRSUiIGV4aXQgMQ0KZXhpdCAvYiAxDQoNCjptYWluRW5kDQppZiAiJU9TJSI9PSJXaW5kb3dzX05UIiBlbmRsb2NhbA0KDQo6b21lZ2ENCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.299+0300	INFO	request: {"metadata":{"filename":"TransactionTest.javax","method":"save","path":"java/kubemq-java/examples/bin/test/io/kubemq/sdk/transaction"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KDQpwYWNrYWdlIGlvLmt1YmVtcS5zZGsudGVzdHM7DQoNCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRBcnJheUVxdWFsczsNCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRFcXVhbHM7DQppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFsc2U7DQppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0VHJ1ZTsNCg0KaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247DQoNCmltcG9ydCBqYXZheC5uZXQuc3NsLlNTTEV4Y2VwdGlvbjsNCg0KaW1wb3J0IG9yZy5qdW5pdC5UZXN0Ow0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5NZXNzYWdlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsucXVldWUuUXVldWU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5SZWNlaXZlTWVzc2FnZXNSZXNwb25zZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnF1ZXVlLlRyYW5zYWN0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsucXVldWUuVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsudG9vbHMuQ29udmVydGVyOw0KDQpwdWJsaWMgY2xhc3MgVHJhbnNhY3Rpb25UZXN0IHsNCg0KICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9Ob01lc3NhZ2VzX1Rlc3QoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoInJlYyIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgxMCwgMSk7DQoNCiAgICAgICAgYXNzZXJ0RXF1YWxzKHRydWUsIChyZXNwLmdldElzRXJyb3IoKSkpOw0KICAgICAgICBhc3NlcnRFcXVhbHModHJ1ZSwgcmVzcC5nZXRFcnJvcigpLmNvbnRhaW5zKCJFcnJvciAxMzgiKSk7DQoNCiAgICB9DQoNCiAgQFRlc3QNCiAgICBwdWJsaWMgdm9pZCBSZWNpdmVfMU1lc3NhZ2VzX0Fja19UZXN0KCkgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gew0KICAgICAgICBRdWV1ZSBxdWV1ZSA9IGNyZWF0ZVF1ZXVlKCIxTWVzc2FnZXMiKTsNCiAgICAgICAgYWNrUXVldWUocXVldWUpOw0KICAgICAgICBxdWV1ZS5TZW5kUXVldWVNZXNzYWdlKG5ldyBNZXNzYWdlKENvbnZlcnRlci5Ub0J5dGVBcnJheSgiaGkiKSwgIiIsICIxIiwgbnVsbCkpOw0KICAgICAgICBUcmFuc2FjdGlvbiB0cmFuID0gcXVldWUuQ3JlYXRlVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlIHJlc3AgPSB0cmFuLlJlY2VpdmUoMTAsIDEpOw0KDQogICAgICAgIGFzc2VydEVxdWFscygiMSIsIHJlc3AuZ2V0TWVzc2FnZSgpLmdldE1lc3NhZ2VJRCgpKTsNCg0KICAgICAgICByZXNwID0gdHJhbi5BY2tNZXNzYWdlKCk7DQoNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRJc0Vycm9yKCkpOw0KICAgIH0NCg0KICAgIEBUZXN0DQogICAgcHVibGljIHZvaWQgUmVjaXZlX1Zpc2FiaWxpdHlFeHBpcmVfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIlZpc2FiaWxpdHkiKTsNCiAgICAgICAgYWNrUXVldWUocXVldWUpOw0KICAgICAgICBxdWV1ZS5TZW5kUXVldWVNZXNzYWdlKG5ldyBNZXNzYWdlKENvbnZlcnRlci5Ub0J5dGVBcnJheSgiaGkiKSwgIiIsICIxIiwgbnVsbCkpOw0KICAgICAgICBUcmFuc2FjdGlvbiB0cmFuID0gcXVldWUuQ3JlYXRlVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgVHJhbnNhY3Rpb25NZXNzYWdlc1Jlc3BvbnNlIHJlc3AgPSB0cmFuLlJlY2VpdmUoMiwgMSk7DQoNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICBUaHJlYWQuc2xlZXAoMjAwMCk7ICANCiAgICAgICAgcmVzcCA9IHRyYW4uQWNrTWVzc2FnZSgpOw0KICAgICAgICBhc3NlcnRUcnVlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9WaXNhYmlsaXR5RXh0ZW5kX1Rlc3QoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gew0KICAgICAgICBRdWV1ZSBxdWV1ZSA9IGNyZWF0ZVF1ZXVlKCJWaXNhYmlsaXR5RXh0Iik7DQogICAgICAgIGFja1F1ZXVlKHF1ZXVlKTsNCiAgICAgICAgcXVldWUuU2VuZFF1ZXVlTWVzc2FnZShuZXcgTWVzc2FnZShDb252ZXJ0ZXIuVG9CeXRlQXJyYXkoImhpIiksICIiLCAiMSIsIG51bGwpKTsNCiAgICAgICAgVHJhbnNhY3Rpb24gdHJhbiA9IHF1ZXVlLkNyZWF0ZVRyYW5zYWN0aW9uKCk7DQogICAgICAgIFRyYW5zYWN0aW9uTWVzc2FnZXNSZXNwb25zZSByZXNwID0gdHJhbi5SZWNlaXZlKDEsIDEpOw0KICAgICAgICBhc3NlcnRFcXVhbHMoIjEiLCByZXNwLmdldE1lc3NhZ2UoKS5nZXRNZXNzYWdlSUQoKSk7DQogICAgICAgIHJlc3AgPSB0cmFuLkV4dGVuZFZpc2liaWxpdHkoMik7DQogICAgICAgIGFzc2VydEZhbHNlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOw0KICAgICAgICByZXNwID0gdHJhbi5BY2tNZXNzYWdlKCk7DQogICAgICAgIGFzc2VydEZhbHNlKHJlc3AuZ2V0SXNFcnJvcigpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9SZXNlbmRfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIlJlc2VuZCIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIHF1ZXVlLlNlbmRRdWV1ZU1lc3NhZ2UobmV3IE1lc3NhZ2UoQ29udmVydGVyLlRvQnl0ZUFycmF5KCJoaSIpLCAiIiwgIjEiLCBudWxsKSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgzLCAxKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICByZXNwID0gdHJhbi5SZVNlbmQoIlJlc2VuZDIiKTsNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRJc0Vycm9yKCkpOw0KICAgICAgDQogICAgICAgIFF1ZXVlICBxdWV1ZTIgPSBjcmVhdGVRdWV1ZSgiUmVzZW5kMiIpOw0KICAgICAgICAgDQogICAgICAgIFJlY2VpdmVNZXNzYWdlc1Jlc3BvbnNlIHJlc3BlID0gcXVldWUyLlBlZWtRdWV1ZU1lc3NhZ2UoMSwgMSk7DQogICAgICAgICBhc3NlcnRFcXVhbHMoMSwgcmVzcGUuZ2V0TWVzc2FnZXNSZWNlaXZlZCgpKTsNCiAgICB9DQoNCiAgICBAVGVzdA0KICAgIHB1YmxpYyB2b2lkIFJlY2l2ZV9Nb2RpZnlfVGVzdCgpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIFF1ZXVlIHF1ZXVlID0gY3JlYXRlUXVldWUoIk1vZGlmeSIpOw0KICAgICAgICBhY2tRdWV1ZShxdWV1ZSk7DQogICAgICAgIHF1ZXVlLlNlbmRRdWV1ZU1lc3NhZ2UobmV3IE1lc3NhZ2UoQ29udmVydGVyLlRvQnl0ZUFycmF5KCJoaSIpLCAiIiwgIjEiLCBudWxsKSk7DQogICAgICAgIFRyYW5zYWN0aW9uIHRyYW4gPSBxdWV1ZS5DcmVhdGVUcmFuc2FjdGlvbigpOw0KICAgICAgICBUcmFuc2FjdGlvbk1lc3NhZ2VzUmVzcG9uc2UgcmVzcCA9IHRyYW4uUmVjZWl2ZSgzLCAxKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKCIxIiwgcmVzcC5nZXRNZXNzYWdlKCkuZ2V0TWVzc2FnZUlEKCkpOw0KICAgICAgICBNZXNzYWdlIG1zZyA9IHJlc3AuZ2V0TWVzc2FnZSgpOw0KICAgICAgICBtc2cuc2V0Qm9keShDb252ZXJ0ZXIuVG9CeXRlQXJyYXkoIndlbGwgaGVsbG8iKSkNCiAgICAgICAgLnNldFF1ZXVlKHF1ZXVlLmdldFF1ZXVlTmFtZSgpKTsNCg0KICAgICAgICByZXNwID0gdHJhbi5Nb2RpZnkobXNnKTsNCiAgICAgICAgYXNzZXJ0RmFsc2UocmVzcC5nZXRFcnJvcigpLCAgcmVzcC5nZXRJc0Vycm9yKCkpOw0KICANCiAgICAgICAgUmVjZWl2ZU1lc3NhZ2VzUmVzcG9uc2UgcmVzcGUgPSBxdWV1ZS5QZWVrUXVldWVNZXNzYWdlKDMsIDEpOyAgDQogICAgICAgIGJ5dGVbXSBiID0gcmVzcGUuZ2V0TWVzc2FnZXMoKS5pdGVyYXRvcigpLm5leHQoKS5nZXRCb2R5KCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBTdHJpbmcgeFN0cmluZyA9IENvbnZlcnRlci5Gcm9tQnl0ZUFycmF5KGIpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oeFN0cmluZyk7DQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oQ29udmVydGVyLkZyb21CeXRlQXJyYXkobXNnLmdldEJvZHkoKSkpOw0KDQogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICANCiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgIH0NCiAgICAgICAgYXNzZXJ0QXJyYXlFcXVhbHMobXNnLmdldEJvZHkoKSwgYik7DQogICAgfQ0KDQoNCiAgICBwcml2YXRlIHZvaWQgYWNrUXVldWUoUXVldWUgcXVldWUpIHRocm93cyBTU0xFeGNlcHRpb24sIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiB7DQogICAgICAgIHF1ZXVlLkFja0FsbFF1ZXVlTWVzc2FnZXMoKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIFF1ZXVlIGNyZWF0ZVF1ZXVlKFN0cmluZyBxdWV1ZU5hbWUpIHRocm93cyBTU0xFeGNlcHRpb24sIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChxdWV1ZU5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcXVldWVOYW1lID0gInRlc3RRdWV1ZSI7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5ldyBRdWV1ZShxdWV1ZU5hbWUsICJKYXZhVGVzdGVyIiwgMSwgMSwgImxvY2FsaG9zdDo1MDAwMCIpOw0KDQogICAgfQ0KfQ=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.442+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/get_Started/rPC_Send_a_Command_Channel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmdldF9TdGFydGVkLnJQQ19TZW5kX2FfQ29tbWFuZF9DaGFubmVsOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCg0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQppbXBvcnQgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuQ2hhbm5lbFBhcmFtZXRlcnM7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuUmVxdWVzdDsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0VHlwZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXNwb25zZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnRvb2xzLkNvbnZlcnRlcjsNCg0KcHVibGljIGNsYXNzIFByb2dyYW0gew0KDQogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIElPRXhjZXB0aW9uIHsNCg0KICAgICAgICBTdHJpbmcgQ2hhbm5lbE5hbWUgPSAiY21kIiwgQ2xpZW50SUQgPSAiaGVsbG8td29ybGQtc2VuZGVyIiwNCiAgICAgICAgICAgICAgICBLdWJlTVFTZXJ2ZXJBZGRyZXNzID0gImxvY2FsaG9zdDo1MDAwMCI7DQogICAgICAgIENoYW5uZWxQYXJhbWV0ZXJzIGNoYW5uZWxQYXJhbWV0ZXJzID0gbmV3IENoYW5uZWxQYXJhbWV0ZXJzKCk7DQogICAgICAgIGNoYW5uZWxQYXJhbWV0ZXJzLnNldENoYW5uZWxOYW1lKENoYW5uZWxOYW1lKTsNCiAgICAgICAgY2hhbm5lbFBhcmFtZXRlcnMuc2V0Q2xpZW50SUQoQ2xpZW50SUQpOw0KICAgICAgICBjaGFubmVsUGFyYW1ldGVycy5zZXRLdWJlTVFBZGRyZXNzKEt1YmVNUVNlcnZlckFkZHJlc3MpOw0KICAgICAgICBjaGFubmVsUGFyYW1ldGVycy5zZXRSZXF1ZXN0VHlwZShSZXF1ZXN0VHlwZS5Db21tYW5kKTsNCiAgICAgICAgY2hhbm5lbFBhcmFtZXRlcnMuc2V0VGltZW91dCgxMDAwMCk7DQogICAgICAgICAgY2hhbm5lbFBhcmFtZXRlcnMuc2V0QXV0aFRva2VuKCJleUpoYkdjaU9pSklVekkxTmlKOS5lMzAudE5pQl9xNFFrLW94LVpyRUFEYUxpOWdKcEtaOUtKVVNQMTZ1cWpIQWRURSIpOw0KICAgICAgICBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5DaGFubmVsIGNoYW5uZWwgPSBuZXcgaW8ua3ViZW1xLnNkay5jb21tYW5kcXVlcnkuQ2hhbm5lbChjaGFubmVsUGFyYW1ldGVycyk7DQogICAgICAgIFJlcXVlc3QgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCk7DQogICAgICAgIHJlcXVlc3Quc2V0Qm9keShDb252ZXJ0ZXIuVG9CeXRlQXJyYXkoImhlbGxvIGt1YmVtcSAtIHNlbmRpbmcgYSBjb21tYW5kLCBwbGVhc2UgcmVwbHkiKSk7DQogICAgICAgIFJlc3BvbnNlIHJlc3VsdDsNCiAgICAgICAgd2hpbGUodHJ1ZSl7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXN1bHQgPSBjaGFubmVsLlNlbmRSZXF1ZXN0KHJlcXVlc3QpOw0KICAgICAgICAgICAgaWYgKCFyZXN1bHQuaXNFeGVjdXRlZCgpKSB7DQogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIlJlc3BvbnNlIGVycm9yOiAlcyIsIHJlc3VsdC5nZXRFcnJvcigpKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50ZigiUmVzcG9uc2UgUmVjZWl2ZWQ6ICVzLCBFeGVjdXRlZEF0OiAlcyIsIHJlc3VsdC5nZXRSZXF1ZXN0SUQoKSwgcmVzdWx0LmdldFRpbWVzdGFtcCgpLnRvU3RyaW5nKCkpOw0KICAgICAgICB9IGNhdGNoIChTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIlNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbjogJXMiLCBlLnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAgICAgDQogICAgDQogICAgfQ0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.510+0300	INFO	request: {"metadata":{"filename":"kubemqGrpc.javax","method":"save","path":"java/kubemq-java/kubemq-java-sdk/bin/main/io/kubemq/sdk/grpc"},"data":"cGFja2FnZSBpby5rdWJlbXEuc2RrLmdycGM7DQoNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLmdlbmVyYXRlRnVsbE1ldGhvZE5hbWU7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5hc3luY0JpZGlTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNDbGllbnRTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNTZXJ2ZXJTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNVbmFyeUNhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5ibG9ja2luZ1NlcnZlclN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5ibG9ja2luZ1VuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLkNsaWVudENhbGxzLmZ1dHVyZVVuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLmFzeW5jQmlkaVN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY0NsaWVudFN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1NlcnZlclN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1VuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLmFzeW5jVW5pbXBsZW1lbnRlZFN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGw7DQoNCi8qKg0KICovDQpAamF2YXguYW5ub3RhdGlvbi5HZW5lcmF0ZWQoDQogICAgdmFsdWUgPSAiYnkgZ1JQQyBwcm90byBjb21waWxlciAodmVyc2lvbiAxLjE2LjEpIiwNCiAgICBjb21tZW50cyA9ICJTb3VyY2U6IGt1YmVtcS5wcm90byIpDQpwdWJsaWMgZmluYWwgY2xhc3Mga3ViZW1xR3JwYyB7DQoNCiAgcHJpdmF0ZSBrdWJlbXFHcnBjKCkge30NCg0KICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTRVJWSUNFX05BTUUgPSAia3ViZW1xLmt1YmVtcSI7DQoNCiAgLy8gU3RhdGljIG1ldGhvZCBkZXNjcmlwdG9ycyB0aGF0IHN0cmljdGx5IHJlZmxlY3QgdGhlIHByb3RvLg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTZW5kRXZlbnQiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50TWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50TWV0aG9kOw0KICAgIGlmICgoZ2V0U2VuZEV2ZW50TWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kRXZlbnRNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFNlbmRFdmVudE1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZEV2ZW50TWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kRXZlbnRNZXRob2QgPSBnZXRTZW5kRXZlbnRNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZEV2ZW50IikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTZW5kRXZlbnQiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kRXZlbnRNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU2VuZEV2ZW50c1N0cmVhbSIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5CSURJX1NUUkVBTUlORykNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50c1N0cmVhbU1ldGhvZDsNCiAgICBpZiAoKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLkJJRElfU1RSRUFNSU5HKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRFdmVudHNTdHJlYW0iKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRFdmVudHNTdHJlYW0iKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU3Vic2NyaWJlVG9FdmVudHMiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlLmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QgPSBrdWJlbXFHcnBjLmdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kID0gZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU3Vic2NyaWJlVG9FdmVudHMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTdWJzY3JpYmVUb0V2ZW50cyIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU3Vic2NyaWJlVG9SZXF1ZXN0cyIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kOw0KICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGdldFN1YnNjcmliZVRvUmVxdWVzdHNNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0Pm5ld0J1aWxkZXIoKQ0KICAgICAgICAgICAgICAuc2V0VHlwZShpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5TRVJWRVJfU1RSRUFNSU5HKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlN1YnNjcmliZVRvUmVxdWVzdHMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU3Vic2NyaWJlVG9SZXF1ZXN0cyIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFN1YnNjcmliZVRvUmVxdWVzdHNNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZT4gZ2V0U2VuZFJlcXVlc3RNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTZW5kUmVxdWVzdCIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IGdldFNlbmRSZXF1ZXN0TWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IGdldFNlbmRSZXF1ZXN0TWV0aG9kOw0KICAgIGlmICgoZ2V0U2VuZFJlcXVlc3RNZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRSZXF1ZXN0TWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUmVxdWVzdE1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZFJlcXVlc3RNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFNlbmRSZXF1ZXN0TWV0aG9kID0gZ2V0U2VuZFJlcXVlc3RNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRSZXF1ZXN0IikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU2VuZFJlcXVlc3QiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kUmVxdWVzdE1ldGhvZDsNCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIHZvbGF0aWxlIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gZ2V0U2VuZFJlc3BvbnNlTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU2VuZFJlc3BvbnNlIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PiBnZXRTZW5kUmVzcG9uc2VNZXRob2QoKSB7DQogICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHk+IGdldFNlbmRSZXNwb25zZU1ldGhvZDsNCiAgICBpZiAoKGdldFNlbmRSZXNwb25zZU1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUmVzcG9uc2VNZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRSZXNwb25zZU1ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0U2VuZFJlc3BvbnNlTWV0aG9kID0gZ2V0U2VuZFJlc3BvbnNlTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZFJlc3BvbnNlIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRSZXNwb25zZSIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFNlbmRSZXNwb25zZU1ldGhvZDsNCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIHZvbGF0aWxlIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4gZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlNlbmRRdWV1ZU1lc3NhZ2UiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2QoKSB7DQogICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2Q7DQogICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0gZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRRdWV1ZU1lc3NhZ2UiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU2VuZFF1ZXVlTWVzc2FnZSIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT4gZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2giLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICBwdWJsaWMgc3RhdGljIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiBnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+IGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2Q7DQogICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0gZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZFF1ZXVlTWVzc2FnZXNCYXRjaCIpKQ0KICAgICAgICAgICAgICAuc2V0U2FtcGxlZFRvTG9jYWxUcmFjaW5nKHRydWUpDQogICAgICAgICAgICAgIC5zZXRSZXF1ZXN0TWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2giKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpIHsNCiAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2Q7DQogICAgaWYgKChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFJlY2VpdmVRdWV1ZU1lc3NhZ2VzTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QgPSBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAuc2V0UmVzcG9uc2VNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIikpDQogICAgICAgICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgfQ0KICAgICByZXR1cm4gZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTdHJlYW1RdWV1ZU1lc3NhZ2UiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuQklESV9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kOw0KICAgIGlmICgoZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QgPSBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuQklESV9TVFJFQU1JTkcpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU3RyZWFtUXVldWVNZXNzYWdlIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTdHJlYW1RdWV1ZU1lc3NhZ2UiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiQWNrQWxsUXVldWVNZXNzYWdlcyIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZDsNCiAgICBpZiAoKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIkFja0FsbFF1ZXVlTWVzc2FnZXMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIkFja0FsbFF1ZXVlTWVzc2FnZXMiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHksDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+IGdldFBpbmdNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJQaW5nIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdD4gZ2V0UGluZ01ldGhvZCgpIHsNCiAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PiBnZXRQaW5nTWV0aG9kOw0KICAgIGlmICgoZ2V0UGluZ01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIGlmICgoZ2V0UGluZ01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCA9IGdldFBpbmdNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlBpbmciKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJQaW5nIikpDQogICAgICAgICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgfQ0KICAgICByZXR1cm4gZ2V0UGluZ01ldGhvZDsNCiAgfQ0KDQogIC8qKg0KICAgKiBDcmVhdGVzIGEgbmV3IGFzeW5jIHN0dWIgdGhhdCBzdXBwb3J0cyBhbGwgY2FsbCB0eXBlcyBmb3IgdGhlIHNlcnZpY2UNCiAgICovDQogIHB1YmxpYyBzdGF0aWMga3ViZW1xU3R1YiBuZXdTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgcmV0dXJuIG5ldyBrdWJlbXFTdHViKGNoYW5uZWwpOw0KICB9DQoNCiAgLyoqDQogICAqIENyZWF0ZXMgYSBuZXcgYmxvY2tpbmctc3R5bGUgc3R1YiB0aGF0IHN1cHBvcnRzIHVuYXJ5IGFuZCBzdHJlYW1pbmcgb3V0cHV0IGNhbGxzIG9uIHRoZSBzZXJ2aWNlDQogICAqLw0KICBwdWJsaWMgc3RhdGljIGt1YmVtcUJsb2NraW5nU3R1YiBuZXdCbG9ja2luZ1N0dWIoDQogICAgICBpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCkgew0KICAgIHJldHVybiBuZXcga3ViZW1xQmxvY2tpbmdTdHViKGNoYW5uZWwpOw0KICB9DQoNCiAgLyoqDQogICAqIENyZWF0ZXMgYSBuZXcgTGlzdGVuYWJsZUZ1dHVyZS1zdHlsZSBzdHViIHRoYXQgc3VwcG9ydHMgdW5hcnkgY2FsbHMgb24gdGhlIHNlcnZpY2UNCiAgICovDQogIHB1YmxpYyBzdGF0aWMga3ViZW1xRnV0dXJlU3R1YiBuZXdGdXR1cmVTdHViKA0KICAgICAgaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwpIHsNCiAgICByZXR1cm4gbmV3IGt1YmVtcUZ1dHVyZVN0dWIoY2hhbm5lbCk7DQogIH0NCg0KICAvKioNCiAgICovDQogIHB1YmxpYyBzdGF0aWMgYWJzdHJhY3QgY2xhc3Mga3ViZW1xSW1wbEJhc2UgaW1wbGVtZW50cyBpby5ncnBjLkJpbmRhYmxlU2VydmljZSB7DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kRXZlbnQoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kRXZlbnRNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50PiBzZW5kRXZlbnRzU3RyZWFtKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHJldHVybiBhc3luY1VuaW1wbGVtZW50ZWRTdHJlYW1pbmdDYWxsKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9FdmVudHMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9SZXF1ZXN0cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kUmVxdWVzdE1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUmVzcG9uc2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmltcGxlbWVudGVkVW5hcnlDYWxsKGdldFNlbmRSZXNwb25zZU1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUXVldWVNZXNzYWdlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2goaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCByZWNlaXZlUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0PiBzdHJlYW1RdWV1ZU1lc3NhZ2UoDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgcmV0dXJuIGFzeW5jVW5pbXBsZW1lbnRlZFN0cmVhbWluZ0NhbGwoZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIGFja0FsbFF1ZXVlTWVzc2FnZXMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHBpbmcoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0UGluZ01ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlIHB1YmxpYyBmaW5hbCBpby5ncnBjLlNlcnZlclNlcnZpY2VEZWZpbml0aW9uIGJpbmRTZXJ2aWNlKCkgew0KICAgICAgcmV0dXJuIGlvLmdycGMuU2VydmVyU2VydmljZURlZmluaXRpb24uYnVpbGRlcihnZXRTZXJ2aWNlRGVzY3JpcHRvcigpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTZW5kRXZlbnRNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4oDQogICAgICAgICAgICAgICAgICB0aGlzLCBNRVRIT0RJRF9TRU5EX0VWRU5UKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jQmlkaVN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTSkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNTZXJ2ZXJTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUsDQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU1VCU0NSSUJFX1RPX0VWRU5UUykpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kKCksDQogICAgICAgICAgICBhc3luY1NlcnZlclN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3Q+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRSZXF1ZXN0TWV0aG9kKCksDQogICAgICAgICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICAgICAgbmV3IE1ldGhvZEhhbmRsZXJzPA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlPigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfUkVRVUVTVCkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTZW5kUmVzcG9uc2VNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfUkVTUE9OU0UpKSkNCiAgICAgICAgICAuYWRkTWV0aG9kKA0KICAgICAgICAgICAgZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFU19CQVRDSCkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfUkVDRUlWRV9RVUVVRV9NRVNTQUdFUykpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jQmlkaVN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NUUkVBTV9RVUVVRV9NRVNTQUdFKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4oDQogICAgICAgICAgICAgICAgICB0aGlzLCBNRVRIT0RJRF9BQ0tfQUxMX1FVRVVFX01FU1NBR0VTKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFBpbmdNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfUElORykpKQ0KICAgICAgICAgIC5idWlsZCgpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKi8NCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFTdHViIGV4dGVuZHMgaW8uZ3JwYy5zdHViLkFic3RyYWN0U3R1YjxrdWJlbXFTdHViPiB7DQogICAgcHJpdmF0ZSBrdWJlbXFTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgICBzdXBlcihjaGFubmVsKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGt1YmVtcVN0dWIoaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwsDQogICAgICAgIGlvLmdycGMuQ2FsbE9wdGlvbnMgY2FsbE9wdGlvbnMpIHsNCiAgICAgIHN1cGVyKGNoYW5uZWwsIGNhbGxPcHRpb25zKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIGt1YmVtcVN0dWIgYnVpbGQoaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwsDQogICAgICAgIGlvLmdycGMuQ2FsbE9wdGlvbnMgY2FsbE9wdGlvbnMpIHsNCiAgICAgIHJldHVybiBuZXcga3ViZW1xU3R1YihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZEV2ZW50KGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kRXZlbnRNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudD4gc2VuZEV2ZW50c1N0cmVhbSgNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICByZXR1cm4gYXN5bmNCaWRpU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzdWJzY3JpYmVUb0V2ZW50cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jU2VydmVyU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9SZXF1ZXN0cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1NlcnZlclN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFJlcXVlc3QoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUmVxdWVzdE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFJlc3BvbnNlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHk+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRSZXNwb25zZU1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFF1ZXVlTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0LCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUXVldWVNZXNzYWdlc0JhdGNoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgcmVjZWl2ZVF1ZXVlTWVzc2FnZXMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdD4gc3RyZWFtUXVldWVNZXNzYWdlKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHJldHVybiBhc3luY0JpZGlTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgYWNrQWxsUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgcGluZyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFBpbmdNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKi8NCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFCbG9ja2luZ1N0dWIgZXh0ZW5kcyBpby5ncnBjLnN0dWIuQWJzdHJhY3RTdHViPGt1YmVtcUJsb2NraW5nU3R1Yj4gew0KICAgIHByaXZhdGUga3ViZW1xQmxvY2tpbmdTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgICBzdXBlcihjaGFubmVsKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGt1YmVtcUJsb2NraW5nU3R1Yihpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCwNCiAgICAgICAgaW8uZ3JwYy5DYWxsT3B0aW9ucyBjYWxsT3B0aW9ucykgew0KICAgICAgc3VwZXIoY2hhbm5lbCwgY2FsbE9wdGlvbnMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQga3ViZW1xQmxvY2tpbmdTdHViIGJ1aWxkKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICByZXR1cm4gbmV3IGt1YmVtcUJsb2NraW5nU3R1YihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHNlbmRFdmVudChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFNlbmRFdmVudE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS51dGlsLkl0ZXJhdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPiBzdWJzY3JpYmVUb0V2ZW50cygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nU2VydmVyU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuSXRlcmF0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBzdWJzY3JpYmVUb1JlcXVlc3RzKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdTZXJ2ZXJTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBzZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U2VuZFJlcXVlc3RNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgc2VuZFJlc3BvbnNlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgc2VuZFF1ZXVlTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLCBnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2goaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZWNlaXZlUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLCBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgYWNrQWxsUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBwaW5nKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0UGluZ01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICovDQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mga3ViZW1xRnV0dXJlU3R1YiBleHRlbmRzIGlvLmdycGMuc3R1Yi5BYnN0cmFjdFN0dWI8a3ViZW1xRnV0dXJlU3R1Yj4gew0KICAgIHByaXZhdGUga3ViZW1xRnV0dXJlU3R1Yihpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCkgew0KICAgICAgc3VwZXIoY2hhbm5lbCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBrdWJlbXFGdXR1cmVTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICBzdXBlcihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBrdWJlbXFGdXR1cmVTdHViIGJ1aWxkKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICByZXR1cm4gbmV3IGt1YmVtcUZ1dHVyZVN0dWIoY2hhbm5lbCwgY2FsbE9wdGlvbnMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuTGlzdGVuYWJsZUZ1dHVyZTxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gc2VuZEV2ZW50KA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZEV2ZW50TWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZT4gc2VuZFJlcXVlc3QoDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRSZXF1ZXN0TWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gc2VuZFJlc3BvbnNlKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiBzZW5kUXVldWVNZXNzYWdlKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuTGlzdGVuYWJsZUZ1dHVyZTxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiBzZW5kUXVldWVNZXNzYWdlc0JhdGNoKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGZ1dHVyZVVuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiByZWNlaXZlUXVldWVNZXNzYWdlcygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGZ1dHVyZVVuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5MaXN0ZW5hYmxlRnV0dXJlPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBhY2tBbGxRdWV1ZU1lc3NhZ2VzKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5MaXN0ZW5hYmxlRnV0dXJlPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdD4gcGluZygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFBpbmdNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QpOw0KICAgIH0NCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX0VWRU5UID0gMDsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NVQlNDUklCRV9UT19FVkVOVFMgPSAxOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTID0gMjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfUkVRVUVTVCA9IDM7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX1JFU1BPTlNFID0gNDsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfUVVFVUVfTUVTU0FHRSA9IDU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX1FVRVVFX01FU1NBR0VTX0JBVENIID0gNjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1JFQ0VJVkVfUVVFVUVfTUVTU0FHRVMgPSA3Ow0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfQUNLX0FMTF9RVUVVRV9NRVNTQUdFUyA9IDg7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9QSU5HID0gOTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTSA9IDEwOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfU1RSRUFNX1FVRVVFX01FU1NBR0UgPSAxMTsNCg0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBNZXRob2RIYW5kbGVyczxSZXEsIFJlc3A+IGltcGxlbWVudHMNCiAgICAgIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5VbmFyeU1ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLlNlcnZlclN0cmVhbWluZ01ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLkNsaWVudFN0cmVhbWluZ01ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLkJpZGlTdHJlYW1pbmdNZXRob2Q8UmVxLCBSZXNwPiB7DQogICAgcHJpdmF0ZSBmaW5hbCBrdWJlbXFJbXBsQmFzZSBzZXJ2aWNlSW1wbDsNCiAgICBwcml2YXRlIGZpbmFsIGludCBtZXRob2RJZDsNCg0KICAgIE1ldGhvZEhhbmRsZXJzKGt1YmVtcUltcGxCYXNlIHNlcnZpY2VJbXBsLCBpbnQgbWV0aG9kSWQpIHsNCiAgICAgIHRoaXMuc2VydmljZUltcGwgPSBzZXJ2aWNlSW1wbDsNCiAgICAgIHRoaXMubWV0aG9kSWQgPSBtZXRob2RJZDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgQGphdmEubGFuZy5TdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQ0KICAgIHB1YmxpYyB2b2lkIGludm9rZShSZXEgcmVxdWVzdCwgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPFJlc3A+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHN3aXRjaCAobWV0aG9kSWQpIHsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9TRU5EX0VWRU5UOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRFdmVudCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NVQlNDUklCRV9UT19FVkVOVFM6DQogICAgICAgICAgc2VydmljZUltcGwuc3Vic2NyaWJlVG9FdmVudHMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnN1YnNjcmliZVRvUmVxdWVzdHMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfUkVRVUVTVDoNCiAgICAgICAgICBzZXJ2aWNlSW1wbC5zZW5kUmVxdWVzdCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0KSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9TRU5EX1JFU1BPTlNFOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRSZXNwb25zZSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRRdWV1ZU1lc3NhZ2UoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfUVVFVUVfTUVTU0FHRVNfQkFUQ0g6DQogICAgICAgICAgc2VydmljZUltcGwuc2VuZFF1ZXVlTWVzc2FnZXNCYXRjaCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9SRUNFSVZFX1FVRVVFX01FU1NBR0VTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9BQ0tfQUxMX1FVRVVFX01FU1NBR0VTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLmFja0FsbFF1ZXVlTWVzc2FnZXMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QpIHJlcXVlc3QsDQogICAgICAgICAgICAgIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9QSU5HOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnBpbmcoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkpIHJlcXVlc3QsDQogICAgICAgICAgICAgIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgdGhyb3cgbmV3IEFzc2VydGlvbkVycm9yKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIEBqYXZhLmxhbmcuU3VwcHJlc3NXYXJuaW5ncygidW5jaGVja2VkIikNCiAgICBwdWJsaWMgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPFJlcT4gaW52b2tlKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8UmVzcD4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgc3dpdGNoIChtZXRob2RJZCkgew0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTToNCiAgICAgICAgICByZXR1cm4gKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxSZXE+KSBzZXJ2aWNlSW1wbC5zZW5kRXZlbnRzU3RyZWFtKA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU1RSRUFNX1FVRVVFX01FU1NBR0U6DQogICAgICAgICAgcmV0dXJuIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8UmVxPikgc2VydmljZUltcGwuc3RyZWFtUXVldWVNZXNzYWdlKA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgdGhyb3cgbmV3IEFzc2VydGlvbkVycm9yKCk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgYWJzdHJhY3QgY2xhc3Mga3ViZW1xQmFzZURlc2NyaXB0b3JTdXBwbGllcg0KICAgICAgaW1wbGVtZW50cyBpby5ncnBjLnByb3RvYnVmLlByb3RvRmlsZURlc2NyaXB0b3JTdXBwbGllciwgaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1NlcnZpY2VEZXNjcmlwdG9yU3VwcGxpZXIgew0KICAgIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXIoKSB7fQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yIGdldEZpbGVEZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuZ2V0RGVzY3JpcHRvcigpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5TZXJ2aWNlRGVzY3JpcHRvciBnZXRTZXJ2aWNlRGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBnZXRGaWxlRGVzY3JpcHRvcigpLmZpbmRTZXJ2aWNlQnlOYW1lKCJrdWJlbXEiKTsNCiAgICB9DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFGaWxlRGVzY3JpcHRvclN1cHBsaWVyDQogICAgICBleHRlbmRzIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXIgew0KICAgIGt1YmVtcUZpbGVEZXNjcmlwdG9yU3VwcGxpZXIoKSB7fQ0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY2xhc3Mga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyDQogICAgICBleHRlbmRzIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXINCiAgICAgIGltcGxlbWVudHMgaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b01ldGhvZERlc2NyaXB0b3JTdXBwbGllciB7DQogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgbWV0aG9kTmFtZTsNCg0KICAgIGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcihTdHJpbmcgbWV0aG9kTmFtZSkgew0KICAgICAgdGhpcy5tZXRob2ROYW1lID0gbWV0aG9kTmFtZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuTWV0aG9kRGVzY3JpcHRvciBnZXRNZXRob2REZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGdldFNlcnZpY2VEZXNjcmlwdG9yKCkuZmluZE1ldGhvZEJ5TmFtZShtZXRob2ROYW1lKTsNCiAgICB9DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLlNlcnZpY2VEZXNjcmlwdG9yIHNlcnZpY2VEZXNjcmlwdG9yOw0KDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5TZXJ2aWNlRGVzY3JpcHRvciBnZXRTZXJ2aWNlRGVzY3JpcHRvcigpIHsNCiAgICBpby5ncnBjLlNlcnZpY2VEZXNjcmlwdG9yIHJlc3VsdCA9IHNlcnZpY2VEZXNjcmlwdG9yOw0KICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIHJlc3VsdCA9IHNlcnZpY2VEZXNjcmlwdG9yOw0KICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsNCiAgICAgICAgICBzZXJ2aWNlRGVzY3JpcHRvciA9IHJlc3VsdCA9IGlvLmdycGMuU2VydmljZURlc2NyaXB0b3IubmV3QnVpbGRlcihTRVJWSUNFX05BTUUpDQogICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFGaWxlRGVzY3JpcHRvclN1cHBsaWVyKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZEV2ZW50TWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZEV2ZW50c1N0cmVhbU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFNlbmRSZXF1ZXN0TWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSkNCiAgICAgICAgICAgICAgLmFkZE1ldGhvZChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSkNCiAgICAgICAgICAgICAgLmFkZE1ldGhvZChnZXRQaW5nTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.556+0300	INFO	request: {"metadata":{"filename":"libraries-with-intellij-classes.xml","method":"save","path":"java/kubemq-java/.idea"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0IHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9ImxpYnJhcmllcy13aXRoLWludGVsbGlqLWNsYXNzZXMiPg0KICAgIDxvcHRpb24gbmFtZT0iaW50ZWxsaWpBcGlDb250YWluaW5nTGlicmFyaWVzIj4NCiAgICAgIDxsaXN0Pg0KICAgICAgICA8TGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJhcnRpZmFjdElkIiB2YWx1ZT0iaWRlYUlVIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMuaW50ZWxsaWouaWRlYSIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgPExpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iYXJ0aWZhY3RJZCIgdmFsdWU9ImlkZWFJVSIgLz4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9Imdyb3VwSWQiIHZhbHVlPSJjb20uamV0YnJhaW5zIiAvPg0KICAgICAgICA8L0xpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICA8TGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJhcnRpZmFjdElkIiB2YWx1ZT0iaWRlYUlDIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMuaW50ZWxsaWouaWRlYSIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgPExpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iYXJ0aWZhY3RJZCIgdmFsdWU9ImlkZWFJQyIgLz4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9Imdyb3VwSWQiIHZhbHVlPSJjb20uamV0YnJhaW5zIiAvPg0KICAgICAgICA8L0xpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICA8TGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJhcnRpZmFjdElkIiB2YWx1ZT0icHljaGFybVBZIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMuaW50ZWxsaWoucHljaGFybSIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgPExpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iYXJ0aWZhY3RJZCIgdmFsdWU9InB5Y2hhcm1QWSIgLz4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9Imdyb3VwSWQiIHZhbHVlPSJjb20uamV0YnJhaW5zIiAvPg0KICAgICAgICA8L0xpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICA8TGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJhcnRpZmFjdElkIiB2YWx1ZT0icHljaGFybVBDIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMuaW50ZWxsaWoucHljaGFybSIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgPExpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iYXJ0aWZhY3RJZCIgdmFsdWU9InB5Y2hhcm1QQyIgLz4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9Imdyb3VwSWQiIHZhbHVlPSJjb20uamV0YnJhaW5zIiAvPg0KICAgICAgICA8L0xpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICA8TGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJhcnRpZmFjdElkIiB2YWx1ZT0iY2xpb24iIC8+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJncm91cElkIiB2YWx1ZT0iY29tLmpldGJyYWlucy5pbnRlbGxpai5jbGlvbiIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgPExpYnJhcnlDb29yZGluYXRlc1N0YXRlPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iYXJ0aWZhY3RJZCIgdmFsdWU9ImNsaW9uIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMiIC8+DQogICAgICAgIDwvTGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgIDxMaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9ImFydGlmYWN0SWQiIHZhbHVlPSJyaWRlclJEIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMuaW50ZWxsaWoucmlkZXIiIC8+DQogICAgICAgIDwvTGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgIDxMaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9ImFydGlmYWN0SWQiIHZhbHVlPSJyaWRlclJEIiAvPg0KICAgICAgICAgIDxvcHRpb24gbmFtZT0iZ3JvdXBJZCIgdmFsdWU9ImNvbS5qZXRicmFpbnMiIC8+DQogICAgICAgIDwvTGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgIDxMaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9ImFydGlmYWN0SWQiIHZhbHVlPSJnb2xhbmQiIC8+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJncm91cElkIiB2YWx1ZT0iY29tLmpldGJyYWlucy5pbnRlbGxpai5nb2xhbmQiIC8+DQogICAgICAgIDwvTGlicmFyeUNvb3JkaW5hdGVzU3RhdGU+DQogICAgICAgIDxMaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgICAgICA8b3B0aW9uIG5hbWU9ImFydGlmYWN0SWQiIHZhbHVlPSJnb2xhbmQiIC8+DQogICAgICAgICAgPG9wdGlvbiBuYW1lPSJncm91cElkIiB2YWx1ZT0iY29tLmpldGJyYWlucyIgLz4NCiAgICAgICAgPC9MaWJyYXJ5Q29vcmRpbmF0ZXNTdGF0ZT4NCiAgICAgIDwvbGlzdD4NCiAgICA8L29wdGlvbj4NCiAgPC9jb21wb25lbnQ+DQo8L3Byb2plY3Q+"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.685+0300	INFO	request: {"metadata":{"filename":"GrpcClient.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/basic"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmJhc2ljOw0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5ncnBjLmt1YmVtcUdycGM7DQppbXBvcnQgaW8uZ3JwYy5NYW5hZ2VkQ2hhbm5lbDsNCmltcG9ydCBpby5ncnBjLk1hbmFnZWRDaGFubmVsQnVpbGRlcjsNCmltcG9ydCBpby5ncnBjLk1ldGFkYXRhOw0KaW1wb3J0IGlvLmdycGMubmV0dHkuc2hhZGVkLmlvLmdycGMubmV0dHkuR3JwY1NzbENvbnRleHRzOw0KaW1wb3J0IGlvLmdycGMubmV0dHkuc2hhZGVkLmlvLmdycGMubmV0dHkuTmV0dHlDaGFubmVsQnVpbGRlcjsNCmltcG9ydCBpby5ncnBjLnN0dWIuTWV0YWRhdGFVdGlsczsNCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZzMuU3RyaW5nVXRpbHM7DQppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsNCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEuaW8uRmlsZTsNCmltcG9ydCBqYXZhLnRleHQuTWVzc2FnZUZvcm1hdDsNCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsNCg0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLk1ldGFkYXRhLkFTQ0lJX1NUUklOR19NQVJTSEFMTEVSOw0KDQpwdWJsaWMgY2xhc3MgR3JwY0NsaWVudCB7DQoNCiAgICBwcm90ZWN0ZWQgU3RyaW5nIF9rdWJlbXFBZGRyZXNzOw0KICAgIHByb3RlY3RlZCBNZXRhZGF0YSBfbWV0YWRhdGEgPSBudWxsOw0KICAgIHByb3RlY3RlZCBTdHJpbmcgX2F1dGhUb2tlbiA9IG51bGw7DQogICAgcHJpdmF0ZSBNYW5hZ2VkQ2hhbm5lbCBjaGFubmVsID0gbnVsbDsNCiAgICBwcml2YXRlIGt1YmVtcUdycGMua3ViZW1xQmxvY2tpbmdTdHViIGJsb2NraW5nU3R1YiA9IG51bGw7DQogICAgcHJpdmF0ZSBrdWJlbXFHcnBjLmt1YmVtcVN0dWIgc3R1YiA9IG51bGw7DQoNCiAgICBwcm90ZWN0ZWQgR3JwY0NsaWVudCgpIHsNCiAgICAgICAgSW5pdFJlZ2lzdHJhdGlvbigpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2VydmVyQWRkcmVzcygpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gew0KICAgICAgICByZXR1cm4gZ2V0S3ViZU1RQWRkcmVzcygpOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFNlcnZlckFkZHJlc3MoU3RyaW5nIHZhbHVlKSB7DQogICAgICAgIHRoaXMuX2t1YmVtcUFkZHJlc3MgPSB2YWx1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgTWV0YWRhdGEgZ2V0TWV0YWRhdGEoKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9tZXRhZGF0YTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBhZGRBdXRoVG9rZW4oU3RyaW5nIGF1dGhUb2tlbikgew0KICAgICAgICBpZiAoYXV0aFRva2VuID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0aGlzLl9tZXRhZGF0YSA9PSBudWxsKSB7DQogICAgICAgICAgICBfbWV0YWRhdGEgPSBuZXcgTWV0YWRhdGEoKTsNCiAgICAgICAgfQ0KICAgICAgICBNZXRhZGF0YS5LZXk8U3RyaW5nPiBrZXkgPSBNZXRhZGF0YS5LZXkub2YoImF1dGhvcml6YXRpb24iLCBBU0NJSV9TVFJJTkdfTUFSU0hBTExFUik7DQogICAgICAgIF9tZXRhZGF0YS5wdXQoa2V5LCBhdXRoVG9rZW4pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICANCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZSBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3IgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQga3ViZW1xR3JwYy5rdWJlbXFCbG9ja2luZ1N0dWIgR2V0S3ViZU1RQ2xpZW50KCkNCiAgICAgICAgICAgIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiB7DQogICAgICAgIGlmIChibG9ja2luZ1N0dWIgPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gT3BlbiBjb25uZWN0aW9uDQogICAgICAgICAgICBpZiAoY2hhbm5lbCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgY2hhbm5lbCA9IGNvbnN0cnVjdENoYW5uZWwoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmxvY2tpbmdTdHViID0gY29uc3RydWN0QmxvY2tpbmdDbGllbnQoY2hhbm5lbCk7DQoNCiAgICAgICAgICAgIGlmIChfbWV0YWRhdGEgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGJsb2NraW5nU3R1YiA9IE1ldGFkYXRhVXRpbHMuYXR0YWNoSGVhZGVycyhibG9ja2luZ1N0dWIsIF9tZXRhZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gYmxvY2tpbmdTdHViOw0KICAgIH0NCg0KICAgICAvKioNCiAgICAgKiAgDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUgZGV0ZXJtaW5lZC4NCiAgICAgKiBAdGhyb3dzIFNTTEV4Y2VwdGlvbiAgICAgICAgICAgICAgICAgICAgICBJbmRpY2F0ZXMgc29tZSBraW5kIG9mIGVycm9yIGRldGVjdGVkIGJ5IGFuIFNTTCBzdWJzeXN0ZW0uICAgDQogICAgICovDQogICAgcHJvdGVjdGVkIGt1YmVtcUdycGMua3ViZW1xU3R1YiBHZXRLdWJlTVFBc3luY0NsaWVudCgpDQogICAgICAgICAgICB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICBpZiAoc3R1YiA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyBPcGVuIGNvbm5lY3Rpb24NCiAgICAgICAgICAgIGlmIChjaGFubmVsID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBjaGFubmVsID0gY29uc3RydWN0Q2hhbm5lbCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzdHViID0gY29uc3RydWN0QXN5bmNDbGllbnQoY2hhbm5lbCk7DQogICAgICAgICAgICBpZiAoX21ldGFkYXRhICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBzdHViID0gTWV0YWRhdGFVdGlscy5hdHRhY2hIZWFkZXJzKHN0dWIsIF9tZXRhZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc3R1YjsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzaHV0ZG93bigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7DQogICAgICAgIGNoYW5uZWwuc2h1dGRvd24oKS5hd2FpdFRlcm1pbmF0aW9uKDUsIFRpbWVVbml0Lk5BTk9TRUNPTkRTKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzaHV0ZG93bk5vdygpIHsNCiAgICAgICAgY2hhbm5lbC5zaHV0ZG93bk5vdygpOw0KICAgIH0NCiAgDQogICAgcHVibGljIGJvb2xlYW4gaXNUZXJtaW5hdGVkKCkgew0KICAgICAgICByZXR1cm4gY2hhbm5lbC5pc1Rlcm1pbmF0ZWQoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb25zdHJ1Y3QgYmxvY2tpbmdTdHViIGNvbm5lY3RpbmcgdG8gS3ViZU1RIHNlcnZlciBhdCB7QGNvZGUgaG9zdH0NCiAgICAgKiAoaG9zdDpwb3J0KS4NCiAgICAgKg0KICAgICAqIEByZXR1cm4gaW8uZ3JwYy5NYW5hZ2VkQ2hhbm5lbCBvYmplY3QgdXNlZCB0byBhY2Nlc3MgdGhlIEt1YmVNUSBzZXJ2ZXINCiAgICAgKi8NCiAgICBwcml2YXRlIE1hbmFnZWRDaGFubmVsIGNvbnN0cnVjdENoYW5uZWwoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gew0KICAgICAgICBTdHJpbmcga3ViZW1xQWRkcmVzcyA9IGdldEt1YmVNUUFkZHJlc3MoKTsNCiAgICAgICAgU3RyaW5nIGNsaWVudENlcnRGaWxlID0gQ29uZmlndXJhdGlvbkxvYWRlci5HZXRDZXJpZmljYXRlRmlsZSgpOw0KDQogICAgICAgIExvZ2dlciBsb2dnZXIgPSBnZXRMb2dnZXIoKTsNCiAgICAgICAgaWYgKGxvZ2dlci5pc0luZm9FbmFibGVkKCkpIHsNCiAgICAgICAgICAgIGdldExvZ2dlcigpLmluZm8oTWVzc2FnZUZvcm1hdC5mb3JtYXQoImNvbnN0cnVjdGluZyBjaGFubmVsIHRvIEt1YmVNUSBvbiB7MH0iLCBrdWJlbXFBZGRyZXNzKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzQmxhbmsoY2xpZW50Q2VydEZpbGUpKSB7DQogICAgICAgICAgICByZXR1cm4gTmV0dHlDaGFubmVsQnVpbGRlci5mb3JUYXJnZXQoa3ViZW1xQWRkcmVzcykNCiAgICAgICAgICAgICAgICAgICAgLnNzbENvbnRleHQoR3JwY1NzbENvbnRleHRzLmZvckNsaWVudCgpLnRydXN0TWFuYWdlcihuZXcgRmlsZShjbGllbnRDZXJ0RmlsZSkpLmJ1aWxkKCkpLmJ1aWxkKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBPcGVuIEluc2VjdXJlIGNvbm5lY3Rpb24NCiAgICAgICAgICAgIHJldHVybiBNYW5hZ2VkQ2hhbm5lbEJ1aWxkZXIuZm9yVGFyZ2V0KGt1YmVtcUFkZHJlc3MpLnVzZVBsYWludGV4dCgpLmJ1aWxkKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwcml2YXRlIG9yZy5zbGY0ai5Mb2dnZXIgZ2V0TG9nZ2VyKCkgew0KICAgICAgICByZXR1cm4gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoR3JwY0NsaWVudC5jbGFzcyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29uc3RydWN0IGJsb2NraW5nIGJsb2NraW5nU3R1YiBmb3IgYWNjZXNzaW5nIEt1YmVNUSBzZXJ2ZXIgdXNpbmcgdGhlDQogICAgICogZXhpc3Rpbmcge0Bjb2RlIGNoYW5uZWx9DQogICAgICoNCiAgICAgKiBAcGFyYW0gY2hhbm5lbCBDbGllbnQgY2hhbm5lbCBjb25uZWN0aW5nIHRvIEt1YmVNUSBzZXJ2ZXINCiAgICAgKiBAcmV0dXJuIEJsb2NraW5nU3R1YiBmb3IgYWNjZXNzaW5nIEt1YmVNUSBzZXJ2ZXINCiAgICAgKi8NCiAgICBwcml2YXRlIGt1YmVtcUdycGMua3ViZW1xQmxvY2tpbmdTdHViIGNvbnN0cnVjdEJsb2NraW5nQ2xpZW50KE1hbmFnZWRDaGFubmVsIGNoYW5uZWwpIHsNCiAgICAgICAgcmV0dXJuIGt1YmVtcUdycGMubmV3QmxvY2tpbmdTdHViKGNoYW5uZWwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbnN0cnVjdCBhc3luYyBibG9ja2luZ1N0dWIgZm9yIGFjY2Vzc2luZyBLdWJlTVEgc2VydmVyIHVzaW5nIHRoZSBleGlzdGluZw0KICAgICAqIHtAY29kZSBjaGFubmVsfQ0KICAgICAqDQogICAgICogQHBhcmFtIGNoYW5uZWwgQ2xpZW50IGNoYW5uZWwgY29ubmVjdGluZyB0byBLdWJlTVEgc2VydmVyDQogICAgICogQHJldHVybiBTdHViIGZvciBhY2Nlc3NpbmcgS3ViZU1RIHNlcnZlcg0KICAgICAqLw0KICAgIHByaXZhdGUga3ViZW1xR3JwYy5rdWJlbXFTdHViIGNvbnN0cnVjdEFzeW5jQ2xpZW50KE1hbmFnZWRDaGFubmVsIGNoYW5uZWwpIHsNCiAgICAgICAgcmV0dXJuIGt1YmVtcUdycGMubmV3U3R1YihjaGFubmVsKTsgIA0KICAgIH0NCg0KICAgIHByaXZhdGUgU3RyaW5nIGdldEt1YmVNUUFkZHJlc3MoKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIHsNCiAgICAgICAgLy8gX2t1YmVtcUFkZHJlc3Mgd2FzIHN1cHBsaWVkIGluIHRoZSBkZXJpdmVkIGNvbnN0cnVjdG9yDQogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc05vdEJsYW5rKF9rdWJlbXFBZGRyZXNzKSkNCiAgICAgICAgICAgIHJldHVybiBfa3ViZW1xQWRkcmVzczsNCg0KICAgICAgICBfa3ViZW1xQWRkcmVzcyA9IENvbmZpZ3VyYXRpb25Mb2FkZXIuR2V0U2VydmVyQWRkcmVzcygpOw0KDQogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0JsYW5rKF9rdWJlbXFBZGRyZXNzKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiAoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBfa3ViZW1xQWRkcmVzczsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgSW5pdFJlZ2lzdHJhdGlvbigpIHsNCiAgICAgICAgU3RyaW5nIHJlZ2lzdHJhdGlvbktleSA9IENvbmZpZ3VyYXRpb25Mb2FkZXIuR2V0UmVnaXN0cmF0aW9uS2V5KCk7DQoNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzTm90QmxhbmsocmVnaXN0cmF0aW9uS2V5KSkgew0KICAgICAgICAgICAgX21ldGFkYXRhID0gbmV3IE1ldGFkYXRhKCk7DQogICAgICAgICAgICBNZXRhZGF0YS5LZXk8U3RyaW5nPiBrZXkgPSBNZXRhZGF0YS5LZXkub2YoIlgtS3ViZW1xLVNlcnZlci1Ub2tlbiIsIEFTQ0lJX1NUUklOR19NQVJTSEFMTEVSKTsNCiAgICAgICAgICAgIF9tZXRhZGF0YS5wdXQoa2V5LCByZWdpc3RyYXRpb25LZXkpOw0KICAgICAgICB9DQogICAgfQ0KDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.911+0300	INFO	request: {"metadata":{"filename":"workspace.xml","method":"save","path":"java/poc/test/.idea"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxwcm9qZWN0IHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9IkNoYW5nZUxpc3RNYW5hZ2VyIj4NCiAgICA8bGlzdCBkZWZhdWx0PSJ0cnVlIiBpZD0iOTY4N2I4NzUtNjMwOS00NzBkLTk1Y2ItYTI0ZjljMzIyMzVkIiBuYW1lPSJEZWZhdWx0IENoYW5nZWxpc3QiIGNvbW1lbnQ9IiIgLz4NCiAgICA8b3B0aW9uIG5hbWU9IlNIT1dfRElBTE9HIiB2YWx1ZT0iZmFsc2UiIC8+DQogICAgPG9wdGlvbiBuYW1lPSJISUdITElHSFRfQ09ORkxJQ1RTIiB2YWx1ZT0idHJ1ZSIgLz4NCiAgICA8b3B0aW9uIG5hbWU9IkhJR0hMSUdIVF9OT05fQUNUSVZFX0NIQU5HRUxJU1QiIHZhbHVlPSJmYWxzZSIgLz4NCiAgICA8b3B0aW9uIG5hbWU9IkxBU1RfUkVTT0xVVElPTiIgdmFsdWU9IklHTk9SRSIgLz4NCiAgPC9jb21wb25lbnQ+DQogIDxjb21wb25lbnQgbmFtZT0iS3ViZXJuZXRlc0FwaVBlcnNpc3RlbmNlIj4NCiAgICA8b3B0aW9uIG5hbWU9ImNvbnRleHQiIHZhbHVlPSJrM2QtazNzLWRlZmF1bHQiIC8+DQogICAgPG9wdGlvbiBuYW1lPSJuYW1lc3BhY2UiIHZhbHVlPSJkZWZhdWx0IiAvPg0KICA8L2NvbXBvbmVudD4NCiAgPGNvbXBvbmVudCBuYW1lPSJQcm9qZWN0SWQiIGlkPSIxcjdsYjRqNG9RdHVJcWVaUTByRmx1djRvUTkiIC8+DQogIDxjb21wb25lbnQgbmFtZT0iUHJvamVjdFZpZXciPg0KICAgIDxuYXZpZ2F0b3IgY3VycmVudFZpZXc9IlByb2plY3RQYW5lIiBwcm9wb3J0aW9ucz0iIiB2ZXJzaW9uPSIxIiBzcGxpdHRlclByb3BvcnRpb249IjAuNSI+DQogICAgICA8ZmxhdHRlblBhY2thZ2VzIC8+DQogICAgICA8c2hvd01lbWJlcnMgLz4NCiAgICAgIDxzaG93TW9kdWxlcyAvPg0KICAgICAgPHNob3dMaWJyYXJ5Q29udGVudHMgLz4NCiAgICAgIDxoaWRlRW1wdHlQYWNrYWdlcyAvPg0KICAgICAgPGFiYnJldmlhdGVQYWNrYWdlTmFtZXMgLz4NCiAgICAgIDxhdXRvc2Nyb2xsVG9Tb3VyY2UgLz4NCiAgICAgIDxhdXRvc2Nyb2xsRnJvbVNvdXJjZSAvPg0KICAgICAgPHNvcnRCeVR5cGUgLz4NCiAgICA8L25hdmlnYXRvcj4NCiAgICA8cGFuZXM+DQogICAgICA8cGFuZSBpZD0iU2NvcGUiIC8+DQogICAgICA8cGFuZSBpZD0iUGFja2FnZXNQYW5lIiAvPg0KICAgICAgPHBhbmUgaWQ9IlByb2plY3RQYW5lIj4NCiAgICAgICAgPHN1YlBhbmU+DQogICAgICAgICAgPFBBVEg+DQogICAgICAgICAgICA8UEFUSF9FTEVNRU5UPg0KICAgICAgICAgICAgICA8b3B0aW9uIG5hbWU9Im15SXRlbUlkIiB2YWx1ZT0idW50aXRsZWQxMDQiIC8+DQogICAgICAgICAgICAgIDxvcHRpb24gbmFtZT0ibXlJdGVtVHlwZSIgdmFsdWU9ImNvbS5pbnRlbGxpai5pZGUucHJvamVjdFZpZXcuaW1wbC5ub2Rlcy5Qcm9qZWN0Vmlld1Byb2plY3ROb2RlIiAvPg0KICAgICAgICAgICAgPC9QQVRIX0VMRU1FTlQ+DQogICAgICAgICAgPC9QQVRIPg0KICAgICAgICAgIDxQQVRIPg0KICAgICAgICAgICAgPFBBVEhfRUxFTUVOVD4NCiAgICAgICAgICAgICAgPG9wdGlvbiBuYW1lPSJteUl0ZW1JZCIgdmFsdWU9InVudGl0bGVkMTA0IiAvPg0KICAgICAgICAgICAgICA8b3B0aW9uIG5hbWU9Im15SXRlbVR5cGUiIHZhbHVlPSJjb20uaW50ZWxsaWouaWRlLnByb2plY3RWaWV3LmltcGwubm9kZXMuUHJvamVjdFZpZXdQcm9qZWN0Tm9kZSIgLz4NCiAgICAgICAgICAgIDwvUEFUSF9FTEVNRU5UPg0KICAgICAgICAgICAgPFBBVEhfRUxFTUVOVD4NCiAgICAgICAgICAgICAgPG9wdGlvbiBuYW1lPSJteUl0ZW1JZCIgdmFsdWU9InVudGl0bGVkMTA0IiAvPg0KICAgICAgICAgICAgICA8b3B0aW9uIG5hbWU9Im15SXRlbVR5cGUiIHZhbHVlPSJjb20uaW50ZWxsaWouaWRlLnByb2plY3RWaWV3LmltcGwubm9kZXMuUHNpRGlyZWN0b3J5Tm9kZSIgLz4NCiAgICAgICAgICAgIDwvUEFUSF9FTEVNRU5UPg0KICAgICAgICAgIDwvUEFUSD4NCiAgICAgICAgICA8UEFUSD4NCiAgICAgICAgICAgIDxQQVRIX0VMRU1FTlQ+DQogICAgICAgICAgICAgIDxvcHRpb24gbmFtZT0ibXlJdGVtSWQiIHZhbHVlPSJ1bnRpdGxlZDEwNCIgLz4NCiAgICAgICAgICAgICAgPG9wdGlvbiBuYW1lPSJteUl0ZW1UeXBlIiB2YWx1ZT0iY29tLmludGVsbGlqLmlkZS5wcm9qZWN0Vmlldy5pbXBsLm5vZGVzLlByb2plY3RWaWV3UHJvamVjdE5vZGUiIC8+DQogICAgICAgICAgICA8L1BBVEhfRUxFTUVOVD4NCiAgICAgICAgICAgIDxQQVRIX0VMRU1FTlQ+DQogICAgICAgICAgICAgIDxvcHRpb24gbmFtZT0ibXlJdGVtSWQiIHZhbHVlPSJ1bnRpdGxlZDEwNCIgLz4NCiAgICAgICAgICAgICAgPG9wdGlvbiBuYW1lPSJteUl0ZW1UeXBlIiB2YWx1ZT0iY29tLmludGVsbGlqLmlkZS5wcm9qZWN0Vmlldy5pbXBsLm5vZGVzLlBzaURpcmVjdG9yeU5vZGUiIC8+DQogICAgICAgICAgICA8L1BBVEhfRUxFTUVOVD4NCiAgICAgICAgICAgIDxQQVRIX0VMRU1FTlQ+DQogICAgICAgICAgICAgIDxvcHRpb24gbmFtZT0ibXlJdGVtSWQiIHZhbHVlPSJzcmMiIC8+DQogICAgICAgICAgICAgIDxvcHRpb24gbmFtZT0ibXlJdGVtVHlwZSIgdmFsdWU9ImNvbS5pbnRlbGxpai5pZGUucHJvamVjdFZpZXcuaW1wbC5ub2Rlcy5Qc2lEaXJlY3RvcnlOb2RlIiAvPg0KICAgICAgICAgICAgPC9QQVRIX0VMRU1FTlQ+DQogICAgICAgICAgICA8UEFUSF9FTEVNRU5UPg0KICAgICAgICAgICAgICA8b3B0aW9uIG5hbWU9Im15SXRlbUlkIiB2YWx1ZT0iY29tcGFueSIgLz4NCiAgICAgICAgICAgICAgPG9wdGlvbiBuYW1lPSJteUl0ZW1UeXBlIiB2YWx1ZT0iY29tLmludGVsbGlqLmlkZS5wcm9qZWN0Vmlldy5pbXBsLm5vZGVzLlBzaURpcmVjdG9yeU5vZGUiIC8+DQogICAgICAgICAgICA8L1BBVEhfRUxFTUVOVD4NCiAgICAgICAgICA8L1BBVEg+DQogICAgICAgIDwvc3ViUGFuZT4NCiAgICAgIDwvcGFuZT4NCiAgICA8L3BhbmVzPg0KICA8L2NvbXBvbmVudD4NCiAgPGNvbXBvbmVudCBuYW1lPSJQcm9qZWN0Vmlld1N0YXRlIj4NCiAgICA8b3B0aW9uIG5hbWU9ImhpZGVFbXB0eU1pZGRsZVBhY2thZ2VzIiB2YWx1ZT0idHJ1ZSIgLz4NCiAgICA8b3B0aW9uIG5hbWU9InNob3dMaWJyYXJ5Q29udGVudHMiIHZhbHVlPSJ0cnVlIiAvPg0KICA8L2NvbXBvbmVudD4NCiAgPGNvbXBvbmVudCBuYW1lPSJQcm9wZXJ0aWVzQ29tcG9uZW50Ij4NCiAgICA8cHJvcGVydHkgbmFtZT0iQUNUSVZFX0NMT1VEX1BST0pFQ1RfQUNDT1VOVCIgdmFsdWU9Imxpb3IubmFiYXRAa3ViZW1xLmlvIiAvPg0KICAgIDxwcm9wZXJ0eSBuYW1lPSJBQ1RJVkVfQ0xPVURfUFJPSkVDVF9JRCIgdmFsdWU9Imt1YmVtcSIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0iQUNUSVZFX0NMT1VEX1BST0pFQ1RfTkFNRSIgdmFsdWU9Imt1YmVtcSIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0iQUNUSVZFX0NMT1VEX1BST0pFQ1RfTlVNQkVSIiB2YWx1ZT0iOTY4MjMxNTQ5NjYyIiAvPg0KICAgIDxwcm9wZXJ0eSBuYW1lPSJXZWJTZXJ2ZXJUb29sV2luZG93RmFjdG9yeVN0YXRlIiB2YWx1ZT0iZmFsc2UiIC8+DQogICAgPHByb3BlcnR5IG5hbWU9ImNvbS5nb29nbGUuY2xvdWRjb2RlLmlkZV9zZXNzaW9uX2luZGV4IiB2YWx1ZT0iMjAyMTA0MTRfMDAxMCIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0iZ28uaW1wb3J0LnNldHRpbmdzLm1pZ3JhdGVkIiB2YWx1ZT0idHJ1ZSIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0ibGFzdF9vcGVuZWRfZmlsZV9wYXRoIiB2YWx1ZT0iJFBST0pFQ1RfRElSJC8uLi8uLi9rdWJlbXEtSmF2YSIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0icHJvamVjdC5zdHJ1Y3R1cmUubGFzdC5lZGl0ZWQiIHZhbHVlPSJQcm9qZWN0IiAvPg0KICAgIDxwcm9wZXJ0eSBuYW1lPSJwcm9qZWN0LnN0cnVjdHVyZS5wcm9wb3J0aW9uIiB2YWx1ZT0iMC4xNSIgLz4NCiAgICA8cHJvcGVydHkgbmFtZT0icHJvamVjdC5zdHJ1Y3R1cmUuc2lkZS5wcm9wb3J0aW9uIiB2YWx1ZT0iMC4wIiAvPg0KICAgIDxwcm9wZXJ0eSBuYW1lPSJzZXR0aW5ncy5lZGl0b3Iuc2VsZWN0ZWQuY29uZmlndXJhYmxlIiB2YWx1ZT0icHJlZmVyZW5jZXMubG9va0ZlZWwiIC8+DQogIDwvY29tcG9uZW50Pg0KICA8Y29tcG9uZW50IG5hbWU9IlJ1bk1hbmFnZXIiPg0KICAgIDxjb25maWd1cmF0aW9uIG5hbWU9Ik1haW4iIHR5cGU9IkFwcGxpY2F0aW9uIiBmYWN0b3J5TmFtZT0iQXBwbGljYXRpb24iIHRlbXBvcmFyeT0idHJ1ZSI+DQogICAgICA8b3B0aW9uIG5hbWU9Ik1BSU5fQ0xBU1NfTkFNRSIgdmFsdWU9ImNvbS5jb21wYW55Lk1haW4iIC8+DQogICAgICA8bW9kdWxlIG5hbWU9InRlc3QiIC8+DQogICAgICA8b3B0aW9uIG5hbWU9IldPUktJTkdfRElSRUNUT1JZIiB2YWx1ZT0iZmlsZTovLyRQUk9KRUNUX0RJUiQiIC8+DQogICAgICA8UnVubmVyU2V0dGluZ3MgUnVubmVySWQ9IlJ1biIgLz4NCiAgICAgIDxDb25maWd1cmF0aW9uV3JhcHBlciBSdW5uZXJJZD0iUnVuIiAvPg0KICAgICAgPG1ldGhvZCB2PSIyIj4NCiAgICAgICAgPG9wdGlvbiBuYW1lPSJNYWtlIiBlbmFibGVkPSJ0cnVlIiAvPg0KICAgICAgPC9tZXRob2Q+DQogICAgPC9jb25maWd1cmF0aW9uPg0KICAgIDxyZWNlbnRfdGVtcG9yYXJ5Pg0KICAgICAgPGxpc3Q+DQogICAgICAgIDxpdGVtIGl0ZW12YWx1ZT0iQXBwbGljYXRpb24uTWFpbiIgLz4NCiAgICAgIDwvbGlzdD4NCiAgICA8L3JlY2VudF90ZW1wb3Jhcnk+DQogIDwvY29tcG9uZW50Pg0KICA8Y29tcG9uZW50IG5hbWU9IlNwZWxsQ2hlY2tlclNldHRpbmdzIiBSdW50aW1lRGljdGlvbmFyaWVzPSIwIiBGb2xkZXJzPSIwIiBDdXN0b21EaWN0aW9uYXJpZXM9IjAiIERlZmF1bHREaWN0aW9uYXJ5PSJhcHBsaWNhdGlvbi1sZXZlbCIgVXNlU2luZ2xlRGljdGlvbmFyeT0idHJ1ZSIgdHJhbnNmZXJyZWQ9InRydWUiIC8+DQogIDxjb21wb25lbnQgbmFtZT0iVGFza01hbmFnZXIiPg0KICAgIDx0YXNrIGFjdGl2ZT0idHJ1ZSIgaWQ9IkRlZmF1bHQiIHN1bW1hcnk9IkRlZmF1bHQgdGFzayI+DQogICAgICA8Y2hhbmdlbGlzdCBpZD0iOTY4N2I4NzUtNjMwOS00NzBkLTk1Y2ItYTI0ZjljMzIyMzVkIiBuYW1lPSJEZWZhdWx0IENoYW5nZWxpc3QiIGNvbW1lbnQ9IiIgLz4NCiAgICAgIDxjcmVhdGVkPjE2MTgzMzUwNzc5Mzk8L2NyZWF0ZWQ+DQogICAgICA8b3B0aW9uIG5hbWU9Im51bWJlciIgdmFsdWU9IkRlZmF1bHQiIC8+DQogICAgICA8b3B0aW9uIG5hbWU9InByZXNlbnRhYmxlSWQiIHZhbHVlPSJEZWZhdWx0IiAvPg0KICAgICAgPHVwZGF0ZWQ+MTYxODMzNTA3NzkzOTwvdXBkYXRlZD4NCiAgICAgIDx3b3JrSXRlbSBmcm9tPSIxNjE4MzM1MDc5NDA1IiBkdXJhdGlvbj0iMjQ1NDAwMCIgLz4NCiAgICAgIDx3b3JrSXRlbSBmcm9tPSIxNjE4MzczMzUyNzMwIiBkdXJhdGlvbj0iNzIwMDAiIC8+DQogICAgICA8d29ya0l0ZW0gZnJvbT0iMTYxODM3MzQ0ODQ3MiIgZHVyYXRpb249IjM2MDAwIiAvPg0KICAgIDwvdGFzaz4NCiAgICA8c2VydmVycyAvPg0KICA8L2NvbXBvbmVudD4NCiAgPGNvbXBvbmVudCBuYW1lPSJUeXBlU2NyaXB0R2VuZXJhdGVkRmlsZXNNYW5hZ2VyIj4NCiAgICA8b3B0aW9uIG5hbWU9InZlcnNpb24iIHZhbHVlPSIzIiAvPg0KICA8L2NvbXBvbmVudD4NCjwvcHJvamVjdD4="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.918+0300	INFO	request: {"metadata":{"filename":"kubemqGrpc.javax","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/grpc"},"data":"cGFja2FnZSBpby5rdWJlbXEuc2RrLmdycGM7DQoNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLmdlbmVyYXRlRnVsbE1ldGhvZE5hbWU7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5hc3luY0JpZGlTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNDbGllbnRTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNTZXJ2ZXJTdHJlYW1pbmdDYWxsOw0KaW1wb3J0IHN0YXRpYyBpby5ncnBjLnN0dWIuQ2xpZW50Q2FsbHMuYXN5bmNVbmFyeUNhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5ibG9ja2luZ1NlcnZlclN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5DbGllbnRDYWxscy5ibG9ja2luZ1VuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLkNsaWVudENhbGxzLmZ1dHVyZVVuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLmFzeW5jQmlkaVN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY0NsaWVudFN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1NlcnZlclN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1VuYXJ5Q2FsbDsNCmltcG9ydCBzdGF0aWMgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLmFzeW5jVW5pbXBsZW1lbnRlZFN0cmVhbWluZ0NhbGw7DQppbXBvcnQgc3RhdGljIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5hc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGw7DQoNCi8qKg0KICovDQpAamF2YXguYW5ub3RhdGlvbi5HZW5lcmF0ZWQoDQogICAgdmFsdWUgPSAiYnkgZ1JQQyBwcm90byBjb21waWxlciAodmVyc2lvbiAxLjE2LjEpIiwNCiAgICBjb21tZW50cyA9ICJTb3VyY2U6IGt1YmVtcS5wcm90byIpDQpwdWJsaWMgZmluYWwgY2xhc3Mga3ViZW1xR3JwYyB7DQoNCiAgcHJpdmF0ZSBrdWJlbXFHcnBjKCkge30NCg0KICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTRVJWSUNFX05BTUUgPSAia3ViZW1xLmt1YmVtcSI7DQoNCiAgLy8gU3RhdGljIG1ldGhvZCBkZXNjcmlwdG9ycyB0aGF0IHN0cmljdGx5IHJlZmxlY3QgdGhlIHByb3RvLg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTZW5kRXZlbnQiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50TWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50TWV0aG9kOw0KICAgIGlmICgoZ2V0U2VuZEV2ZW50TWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kRXZlbnRNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFNlbmRFdmVudE1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZEV2ZW50TWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kRXZlbnRNZXRob2QgPSBnZXRTZW5kRXZlbnRNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZEV2ZW50IikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTZW5kRXZlbnQiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kRXZlbnRNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU2VuZEV2ZW50c1N0cmVhbSIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5CSURJX1NUUkVBTUlORykNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gZ2V0U2VuZEV2ZW50c1N0cmVhbU1ldGhvZDsNCiAgICBpZiAoKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QgPSBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLkJJRElfU1RSRUFNSU5HKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRFdmVudHNTdHJlYW0iKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRFdmVudHNTdHJlYW0iKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU3Vic2NyaWJlVG9FdmVudHMiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlLmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QgPSBrdWJlbXFHcnBjLmdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kID0gZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU3Vic2NyaWJlVG9FdmVudHMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50UmVjZWl2ZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTdWJzY3JpYmVUb0V2ZW50cyIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU3Vic2NyaWJlVG9SZXF1ZXN0cyIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlNFUlZFUl9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kOw0KICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIGlmICgoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCA9IGdldFN1YnNjcmliZVRvUmVxdWVzdHNNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0Pm5ld0J1aWxkZXIoKQ0KICAgICAgICAgICAgICAuc2V0VHlwZShpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5TRVJWRVJfU1RSRUFNSU5HKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlN1YnNjcmliZVRvUmVxdWVzdHMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU3Vic2NyaWJlVG9SZXF1ZXN0cyIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFN1YnNjcmliZVRvUmVxdWVzdHNNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZT4gZ2V0U2VuZFJlcXVlc3RNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTZW5kUmVxdWVzdCIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IGdldFNlbmRSZXF1ZXN0TWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IGdldFNlbmRSZXF1ZXN0TWV0aG9kOw0KICAgIGlmICgoZ2V0U2VuZFJlcXVlc3RNZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRSZXF1ZXN0TWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUmVxdWVzdE1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZFJlcXVlc3RNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldFNlbmRSZXF1ZXN0TWV0aG9kID0gZ2V0U2VuZFJlcXVlc3RNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRSZXF1ZXN0IikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU2VuZFJlcXVlc3QiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kUmVxdWVzdE1ldGhvZDsNCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIHZvbGF0aWxlIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlLA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gZ2V0U2VuZFJlc3BvbnNlTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiU2VuZFJlc3BvbnNlIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PiBnZXRTZW5kUmVzcG9uc2VNZXRob2QoKSB7DQogICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHk+IGdldFNlbmRSZXNwb25zZU1ldGhvZDsNCiAgICBpZiAoKGdldFNlbmRSZXNwb25zZU1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUmVzcG9uc2VNZXRob2QgPSBrdWJlbXFHcnBjLmdldFNlbmRSZXNwb25zZU1ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0U2VuZFJlc3BvbnNlTWV0aG9kID0gZ2V0U2VuZFJlc3BvbnNlTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZFJlc3BvbnNlIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRSZXNwb25zZSIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFNlbmRSZXNwb25zZU1ldGhvZDsNCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIHZvbGF0aWxlIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4gZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlNlbmRRdWV1ZU1lc3NhZ2UiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2UsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2QoKSB7DQogICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2Q7DQogICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kID0gZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlLCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlNlbmRRdWV1ZU1lc3NhZ2UiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAgICAgLnNldFNjaGVtYURlc2NyaXB0b3IobmV3IGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcigiU2VuZFF1ZXVlTWVzc2FnZSIpKQ0KICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgIH0NCiAgICAgcmV0dXJuIGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT4gZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2giLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmNsYXNzLA0KICAgICAgbWV0aG9kVHlwZSA9IGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICBwdWJsaWMgc3RhdGljIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiBnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+IGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2Q7DQogICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICBzeW5jaHJvbml6ZWQgKGt1YmVtcUdycGMuY2xhc3MpIHsNCiAgICAgICAgaWYgKChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kID0gZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU2VuZFF1ZXVlTWVzc2FnZXNCYXRjaCIpKQ0KICAgICAgICAgICAgICAuc2V0U2FtcGxlZFRvTG9jYWxUcmFjaW5nKHRydWUpDQogICAgICAgICAgICAgIC5zZXRSZXF1ZXN0TWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2giKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZDsNCg0KICBAaW8uZ3JwYy5zdHViLmFubm90YXRpb25zLlJwY01ldGhvZCgNCiAgICAgIGZ1bGxNZXRob2ROYW1lID0gU0VSVklDRV9OQU1FICsgJy8nICsgIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuVU5BUlkpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpIHsNCiAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QsIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2Q7DQogICAgaWYgKChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFJlY2VpdmVRdWV1ZU1lc3NhZ2VzTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QgPSBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCA9IA0KICAgICAgICAgICAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpKQ0KICAgICAgICAgICAgICAuc2V0UmVzcG9uc2VNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIlJlY2VpdmVRdWV1ZU1lc3NhZ2VzIikpDQogICAgICAgICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgfQ0KICAgICByZXR1cm4gZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJTdHJlYW1RdWV1ZU1lc3NhZ2UiLA0KICAgICAgcmVxdWVzdFR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmNsYXNzLA0KICAgICAgcmVzcG9uc2VUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuY2xhc3MsDQogICAgICBtZXRob2RUeXBlID0gaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuQklESV9TVFJFQU1JTkcpDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1JlcXVlc3QsDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kOw0KICAgIGlmICgoZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kID0ga3ViZW1xR3JwYy5nZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCA9IGt1YmVtcUdycGMuZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKSA9PSBudWxsKSB7DQogICAgICAgICAga3ViZW1xR3JwYy5nZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QgPSBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgLnNldFR5cGUoaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLk1ldGhvZFR5cGUuQklESV9TVFJFQU1JTkcpDQogICAgICAgICAgICAgIC5zZXRGdWxsTWV0aG9kTmFtZShnZW5lcmF0ZUZ1bGxNZXRob2ROYW1lKA0KICAgICAgICAgICAgICAgICAgImt1YmVtcS5rdWJlbXEiLCAiU3RyZWFtUXVldWVNZXNzYWdlIikpDQogICAgICAgICAgICAgIC5zZXRTYW1wbGVkVG9Mb2NhbFRyYWNpbmcodHJ1ZSkNCiAgICAgICAgICAgICAgLnNldFJlcXVlc3RNYXJzaGFsbGVyKGlvLmdycGMucHJvdG9idWYuUHJvdG9VdGlscy5tYXJzaGFsbGVyKA0KICAgICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgIC5zZXRSZXNwb25zZU1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJTdHJlYW1RdWV1ZU1lc3NhZ2UiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2Q7DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kOw0KDQogIEBpby5ncnBjLnN0dWIuYW5ub3RhdGlvbnMuUnBjTWV0aG9kKA0KICAgICAgZnVsbE1ldGhvZE5hbWUgPSBTRVJWSUNFX05BTUUgKyAnLycgKyAiQWNrQWxsUXVldWVNZXNzYWdlcyIsDQogICAgICByZXF1ZXN0VHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QuY2xhc3MsDQogICAgICByZXNwb25zZVR5cGUgPSBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZS5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kKCkgew0KICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZDsNCiAgICBpZiAoKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgIHN5bmNocm9uaXplZCAoa3ViZW1xR3JwYy5jbGFzcykgew0KICAgICAgICBpZiAoKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QpID09IG51bGwpIHsNCiAgICAgICAgICBrdWJlbXFHcnBjLmdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QgPSBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kID0gDQogICAgICAgICAgICAgIGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci48aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIkFja0FsbFF1ZXVlTWVzc2FnZXMiKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFNZXRob2REZXNjcmlwdG9yU3VwcGxpZXIoIkFja0FsbFF1ZXVlTWVzc2FnZXMiKSkNCiAgICAgICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICB9DQogICAgIHJldHVybiBnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kOw0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgdm9sYXRpbGUgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHksDQogICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+IGdldFBpbmdNZXRob2Q7DQoNCiAgQGlvLmdycGMuc3R1Yi5hbm5vdGF0aW9ucy5ScGNNZXRob2QoDQogICAgICBmdWxsTWV0aG9kTmFtZSA9IFNFUlZJQ0VfTkFNRSArICcvJyArICJQaW5nIiwNCiAgICAgIHJlcXVlc3RUeXBlID0gaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eS5jbGFzcywNCiAgICAgIHJlc3BvbnNlVHlwZSA9IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5jbGFzcywNCiAgICAgIG1ldGhvZFR5cGUgPSBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3IuTWV0aG9kVHlwZS5VTkFSWSkNCiAgcHVibGljIHN0YXRpYyBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwNCiAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdD4gZ2V0UGluZ01ldGhvZCgpIHsNCiAgICBpby5ncnBjLk1ldGhvZERlc2NyaXB0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PiBnZXRQaW5nTWV0aG9kOw0KICAgIGlmICgoZ2V0UGluZ01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIGlmICgoZ2V0UGluZ01ldGhvZCA9IGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCkgPT0gbnVsbCkgew0KICAgICAgICAgIGt1YmVtcUdycGMuZ2V0UGluZ01ldGhvZCA9IGdldFBpbmdNZXRob2QgPSANCiAgICAgICAgICAgICAgaW8uZ3JwYy5NZXRob2REZXNjcmlwdG9yLjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+bmV3QnVpbGRlcigpDQogICAgICAgICAgICAgIC5zZXRUeXBlKGlvLmdycGMuTWV0aG9kRGVzY3JpcHRvci5NZXRob2RUeXBlLlVOQVJZKQ0KICAgICAgICAgICAgICAuc2V0RnVsbE1ldGhvZE5hbWUoZ2VuZXJhdGVGdWxsTWV0aG9kTmFtZSgNCiAgICAgICAgICAgICAgICAgICJrdWJlbXEua3ViZW1xIiwgIlBpbmciKSkNCiAgICAgICAgICAgICAgLnNldFNhbXBsZWRUb0xvY2FsVHJhY2luZyh0cnVlKQ0KICAgICAgICAgICAgICAuc2V0UmVxdWVzdE1hcnNoYWxsZXIoaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1V0aWxzLm1hcnNoYWxsZXIoDQogICAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5LmdldERlZmF1bHRJbnN0YW5jZSgpKSkNCiAgICAgICAgICAgICAgLnNldFJlc3BvbnNlTWFyc2hhbGxlcihpby5ncnBjLnByb3RvYnVmLlByb3RvVXRpbHMubWFyc2hhbGxlcigNCiAgICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkpDQogICAgICAgICAgICAgICAgICAuc2V0U2NoZW1hRGVzY3JpcHRvcihuZXcga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyKCJQaW5nIikpDQogICAgICAgICAgICAgICAgICAuYnVpbGQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgfQ0KICAgICByZXR1cm4gZ2V0UGluZ01ldGhvZDsNCiAgfQ0KDQogIC8qKg0KICAgKiBDcmVhdGVzIGEgbmV3IGFzeW5jIHN0dWIgdGhhdCBzdXBwb3J0cyBhbGwgY2FsbCB0eXBlcyBmb3IgdGhlIHNlcnZpY2UNCiAgICovDQogIHB1YmxpYyBzdGF0aWMga3ViZW1xU3R1YiBuZXdTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgcmV0dXJuIG5ldyBrdWJlbXFTdHViKGNoYW5uZWwpOw0KICB9DQoNCiAgLyoqDQogICAqIENyZWF0ZXMgYSBuZXcgYmxvY2tpbmctc3R5bGUgc3R1YiB0aGF0IHN1cHBvcnRzIHVuYXJ5IGFuZCBzdHJlYW1pbmcgb3V0cHV0IGNhbGxzIG9uIHRoZSBzZXJ2aWNlDQogICAqLw0KICBwdWJsaWMgc3RhdGljIGt1YmVtcUJsb2NraW5nU3R1YiBuZXdCbG9ja2luZ1N0dWIoDQogICAgICBpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCkgew0KICAgIHJldHVybiBuZXcga3ViZW1xQmxvY2tpbmdTdHViKGNoYW5uZWwpOw0KICB9DQoNCiAgLyoqDQogICAqIENyZWF0ZXMgYSBuZXcgTGlzdGVuYWJsZUZ1dHVyZS1zdHlsZSBzdHViIHRoYXQgc3VwcG9ydHMgdW5hcnkgY2FsbHMgb24gdGhlIHNlcnZpY2UNCiAgICovDQogIHB1YmxpYyBzdGF0aWMga3ViZW1xRnV0dXJlU3R1YiBuZXdGdXR1cmVTdHViKA0KICAgICAgaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwpIHsNCiAgICByZXR1cm4gbmV3IGt1YmVtcUZ1dHVyZVN0dWIoY2hhbm5lbCk7DQogIH0NCg0KICAvKioNCiAgICovDQogIHB1YmxpYyBzdGF0aWMgYWJzdHJhY3QgY2xhc3Mga3ViZW1xSW1wbEJhc2UgaW1wbGVtZW50cyBpby5ncnBjLkJpbmRhYmxlU2VydmljZSB7DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kRXZlbnQoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kRXZlbnRNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50PiBzZW5kRXZlbnRzU3RyZWFtKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHJldHVybiBhc3luY1VuaW1wbGVtZW50ZWRTdHJlYW1pbmdDYWxsKGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9FdmVudHMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U3Vic2NyaWJlVG9FdmVudHNNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9SZXF1ZXN0cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kUmVxdWVzdE1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUmVzcG9uc2UoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmltcGxlbWVudGVkVW5hcnlDYWxsKGdldFNlbmRSZXNwb25zZU1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUXVldWVNZXNzYWdlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlIHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2goaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCByZWNlaXZlUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0PiBzdHJlYW1RdWV1ZU1lc3NhZ2UoDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgcmV0dXJuIGFzeW5jVW5pbXBsZW1lbnRlZFN0cmVhbWluZ0NhbGwoZ2V0U3RyZWFtUXVldWVNZXNzYWdlTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIGFja0FsbFF1ZXVlTWVzc2FnZXMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5pbXBsZW1lbnRlZFVuYXJ5Q2FsbChnZXRBY2tBbGxRdWV1ZU1lc3NhZ2VzTWV0aG9kKCksIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHBpbmcoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuaW1wbGVtZW50ZWRVbmFyeUNhbGwoZ2V0UGluZ01ldGhvZCgpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlIHB1YmxpYyBmaW5hbCBpby5ncnBjLlNlcnZlclNlcnZpY2VEZWZpbml0aW9uIGJpbmRTZXJ2aWNlKCkgew0KICAgICAgcmV0dXJuIGlvLmdycGMuU2VydmVyU2VydmljZURlZmluaXRpb24uYnVpbGRlcihnZXRTZXJ2aWNlRGVzY3JpcHRvcigpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTZW5kRXZlbnRNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4oDQogICAgICAgICAgICAgICAgICB0aGlzLCBNRVRIT0RJRF9TRU5EX0VWRU5UKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRFdmVudHNTdHJlYW1NZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jQmlkaVN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTSkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNTZXJ2ZXJTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUsDQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU1VCU0NSSUJFX1RPX0VWRU5UUykpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdWJzY3JpYmVUb1JlcXVlc3RzTWV0aG9kKCksDQogICAgICAgICAgICBhc3luY1NlcnZlclN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3Q+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRSZXF1ZXN0TWV0aG9kKCksDQogICAgICAgICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICAgICAgbmV3IE1ldGhvZEhhbmRsZXJzPA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlPigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfUkVRVUVTVCkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTZW5kUmVzcG9uc2VNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NFTkRfUkVTUE9OU0UpKSkNCiAgICAgICAgICAuYWRkTWV0aG9kKA0KICAgICAgICAgICAgZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQ+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFU19CQVRDSCkpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLA0KICAgICAgICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfUkVDRUlWRV9RVUVVRV9NRVNTQUdFUykpKQ0KICAgICAgICAgIC5hZGRNZXRob2QoDQogICAgICAgICAgICBnZXRTdHJlYW1RdWV1ZU1lc3NhZ2VNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jQmlkaVN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgICAgIG5ldyBNZXRob2RIYW5kbGVyczwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0LA0KICAgICAgICAgICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPigNCiAgICAgICAgICAgICAgICAgIHRoaXMsIE1FVEhPRElEX1NUUkVBTV9RVUVVRV9NRVNTQUdFKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4oDQogICAgICAgICAgICAgICAgICB0aGlzLCBNRVRIT0RJRF9BQ0tfQUxMX1FVRVVFX01FU1NBR0VTKSkpDQogICAgICAgICAgLmFkZE1ldGhvZCgNCiAgICAgICAgICAgIGdldFBpbmdNZXRob2QoKSwNCiAgICAgICAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgICAgICBuZXcgTWV0aG9kSGFuZGxlcnM8DQogICAgICAgICAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSwNCiAgICAgICAgICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+KA0KICAgICAgICAgICAgICAgICAgdGhpcywgTUVUSE9ESURfUElORykpKQ0KICAgICAgICAgIC5idWlsZCgpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKi8NCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFTdHViIGV4dGVuZHMgaW8uZ3JwYy5zdHViLkFic3RyYWN0U3R1YjxrdWJlbXFTdHViPiB7DQogICAgcHJpdmF0ZSBrdWJlbXFTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgICBzdXBlcihjaGFubmVsKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGt1YmVtcVN0dWIoaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwsDQogICAgICAgIGlvLmdycGMuQ2FsbE9wdGlvbnMgY2FsbE9wdGlvbnMpIHsNCiAgICAgIHN1cGVyKGNoYW5uZWwsIGNhbGxPcHRpb25zKTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHJvdGVjdGVkIGt1YmVtcVN0dWIgYnVpbGQoaW8uZ3JwYy5DaGFubmVsIGNoYW5uZWwsDQogICAgICAgIGlvLmdycGMuQ2FsbE9wdGlvbnMgY2FsbE9wdGlvbnMpIHsNCiAgICAgIHJldHVybiBuZXcga3ViZW1xU3R1YihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZEV2ZW50KGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnQgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kRXZlbnRNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudD4gc2VuZEV2ZW50c1N0cmVhbSgNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICByZXR1cm4gYXN5bmNCaWRpU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kRXZlbnRzU3RyZWFtTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzdWJzY3JpYmVUb0V2ZW50cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudFJlY2VpdmU+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jU2VydmVyU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTdWJzY3JpYmVUb0V2ZW50c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlVG9SZXF1ZXN0cyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1NlcnZlclN0cmVhbWluZ0NhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFJlcXVlc3QoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlPiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUmVxdWVzdE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFJlc3BvbnNlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHk+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRSZXNwb25zZU1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2VuZFF1ZXVlTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiByZXNwb25zZU9ic2VydmVyKSB7DQogICAgICBhc3luY1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0LCByZXNwb25zZU9ic2VydmVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzZW5kUXVldWVNZXNzYWdlc0JhdGNoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCByZXF1ZXN0LA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZFF1ZXVlTWVzc2FnZXNCYXRjaE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgcmVjZWl2ZVF1ZXVlTWVzc2FnZXMoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcmVxdWVzdCwNCiAgICAgICAgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0UmVjZWl2ZVF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdD4gc3RyZWFtUXVldWVNZXNzYWdlKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHJldHVybiBhc3luY0JpZGlTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgYWNrQWxsUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXNwb25zZT4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgYXN5bmNVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCwgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIHZvaWQgcGluZyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5IHJlcXVlc3QsDQogICAgICAgIGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlBpbmdSZXN1bHQ+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIGFzeW5jVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFBpbmdNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QsIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKi8NCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFCbG9ja2luZ1N0dWIgZXh0ZW5kcyBpby5ncnBjLnN0dWIuQWJzdHJhY3RTdHViPGt1YmVtcUJsb2NraW5nU3R1Yj4gew0KICAgIHByaXZhdGUga3ViZW1xQmxvY2tpbmdTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsKSB7DQogICAgICBzdXBlcihjaGFubmVsKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIGt1YmVtcUJsb2NraW5nU3R1Yihpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCwNCiAgICAgICAgaW8uZ3JwYy5DYWxsT3B0aW9ucyBjYWxsT3B0aW9ucykgew0KICAgICAgc3VwZXIoY2hhbm5lbCwgY2FsbE9wdGlvbnMpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwcm90ZWN0ZWQga3ViZW1xQmxvY2tpbmdTdHViIGJ1aWxkKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICByZXR1cm4gbmV3IGt1YmVtcUJsb2NraW5nU3R1YihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0IHNlbmRFdmVudChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFNlbmRFdmVudE1ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgamF2YS51dGlsLkl0ZXJhdG9yPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPiBzdWJzY3JpYmVUb0V2ZW50cygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TdWJzY3JpYmUgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nU2VydmVyU3RyZWFtaW5nQ2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBqYXZhLnV0aWwuSXRlcmF0b3I8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0PiBzdWJzY3JpYmVUb1JlcXVlc3RzKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlN1YnNjcmliZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdTZXJ2ZXJTdHJlYW1pbmdDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSBzZW5kUmVxdWVzdChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U2VuZFJlcXVlc3RNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgc2VuZFJlc3BvbnNlKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2UgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgc2VuZFF1ZXVlTWVzc2FnZShpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLCBnZXRTZW5kUXVldWVNZXNzYWdlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2goaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZWNlaXZlUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gYmxvY2tpbmdVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLCBnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgYWNrQWxsUXVldWVNZXNzYWdlcyhpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBibG9ja2luZ1VuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCksIGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBwaW5nKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGJsb2NraW5nVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKSwgZ2V0UGluZ01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpLCByZXF1ZXN0KTsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICovDQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mga3ViZW1xRnV0dXJlU3R1YiBleHRlbmRzIGlvLmdycGMuc3R1Yi5BYnN0cmFjdFN0dWI8a3ViZW1xRnV0dXJlU3R1Yj4gew0KICAgIHByaXZhdGUga3ViZW1xRnV0dXJlU3R1Yihpby5ncnBjLkNoYW5uZWwgY2hhbm5lbCkgew0KICAgICAgc3VwZXIoY2hhbm5lbCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBrdWJlbXFGdXR1cmVTdHViKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICBzdXBlcihjaGFubmVsLCBjYWxsT3B0aW9ucyk7DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHByb3RlY3RlZCBrdWJlbXFGdXR1cmVTdHViIGJ1aWxkKGlvLmdycGMuQ2hhbm5lbCBjaGFubmVsLA0KICAgICAgICBpby5ncnBjLkNhbGxPcHRpb25zIGNhbGxPcHRpb25zKSB7DQogICAgICByZXR1cm4gbmV3IGt1YmVtcUZ1dHVyZVN0dWIoY2hhbm5lbCwgY2FsbE9wdGlvbnMpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuTGlzdGVuYWJsZUZ1dHVyZTxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4gc2VuZEV2ZW50KA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkV2ZW50IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZEV2ZW50TWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZT4gc2VuZFJlcXVlc3QoDQogICAgICAgIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdCByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRSZXF1ZXN0TWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eT4gc2VuZFJlc3BvbnNlKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3BvbnNlIHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5TZW5kUXVldWVNZXNzYWdlUmVzdWx0PiBzZW5kUXVldWVNZXNzYWdlKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFNlbmRRdWV1ZU1lc3NhZ2VNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqLw0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuTGlzdGVuYWJsZUZ1dHVyZTxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlPiBzZW5kUXVldWVNZXNzYWdlc0JhdGNoKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGZ1dHVyZVVuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRTZW5kUXVldWVNZXNzYWdlc0JhdGNoTWV0aG9kKCksIGdldENhbGxPcHRpb25zKCkpLCByZXF1ZXN0KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKi8NCiAgICBwdWJsaWMgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJyZW50Lkxpc3RlbmFibGVGdXR1cmU8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiByZWNlaXZlUXVldWVNZXNzYWdlcygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZWNlaXZlUXVldWVNZXNzYWdlc1JlcXVlc3QgcmVxdWVzdCkgew0KICAgICAgcmV0dXJuIGZ1dHVyZVVuYXJ5Q2FsbCgNCiAgICAgICAgICBnZXRDaGFubmVsKCkubmV3Q2FsbChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5MaXN0ZW5hYmxlRnV0dXJlPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1Jlc3BvbnNlPiBhY2tBbGxRdWV1ZU1lc3NhZ2VzKA0KICAgICAgICBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHJlcXVlc3QpIHsNCiAgICAgIHJldHVybiBmdXR1cmVVbmFyeUNhbGwoDQogICAgICAgICAgZ2V0Q2hhbm5lbCgpLm5ld0NhbGwoZ2V0QWNrQWxsUXVldWVNZXNzYWdlc01ldGhvZCgpLCBnZXRDYWxsT3B0aW9ucygpKSwgcmVxdWVzdCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICovDQogICAgcHVibGljIGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5MaXN0ZW5hYmxlRnV0dXJlPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdD4gcGluZygNCiAgICAgICAgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FbXB0eSByZXF1ZXN0KSB7DQogICAgICByZXR1cm4gZnV0dXJlVW5hcnlDYWxsKA0KICAgICAgICAgIGdldENoYW5uZWwoKS5uZXdDYWxsKGdldFBpbmdNZXRob2QoKSwgZ2V0Q2FsbE9wdGlvbnMoKSksIHJlcXVlc3QpOw0KICAgIH0NCiAgfQ0KDQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX0VWRU5UID0gMDsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NVQlNDUklCRV9UT19FVkVOVFMgPSAxOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTID0gMjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfUkVRVUVTVCA9IDM7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX1JFU1BPTlNFID0gNDsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfUVVFVUVfTUVTU0FHRSA9IDU7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9TRU5EX1FVRVVFX01FU1NBR0VTX0JBVENIID0gNjsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1JFQ0VJVkVfUVVFVUVfTUVTU0FHRVMgPSA3Ow0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfQUNLX0FMTF9RVUVVRV9NRVNTQUdFUyA9IDg7DQogIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNRVRIT0RJRF9QSU5HID0gOTsNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTSA9IDEwOw0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTUVUSE9ESURfU1RSRUFNX1FVRVVFX01FU1NBR0UgPSAxMTsNCg0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBNZXRob2RIYW5kbGVyczxSZXEsIFJlc3A+IGltcGxlbWVudHMNCiAgICAgIGlvLmdycGMuc3R1Yi5TZXJ2ZXJDYWxscy5VbmFyeU1ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLlNlcnZlclN0cmVhbWluZ01ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLkNsaWVudFN0cmVhbWluZ01ldGhvZDxSZXEsIFJlc3A+LA0KICAgICAgaW8uZ3JwYy5zdHViLlNlcnZlckNhbGxzLkJpZGlTdHJlYW1pbmdNZXRob2Q8UmVxLCBSZXNwPiB7DQogICAgcHJpdmF0ZSBmaW5hbCBrdWJlbXFJbXBsQmFzZSBzZXJ2aWNlSW1wbDsNCiAgICBwcml2YXRlIGZpbmFsIGludCBtZXRob2RJZDsNCg0KICAgIE1ldGhvZEhhbmRsZXJzKGt1YmVtcUltcGxCYXNlIHNlcnZpY2VJbXBsLCBpbnQgbWV0aG9kSWQpIHsNCiAgICAgIHRoaXMuc2VydmljZUltcGwgPSBzZXJ2aWNlSW1wbDsNCiAgICAgIHRoaXMubWV0aG9kSWQgPSBtZXRob2RJZDsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgQGphdmEubGFuZy5TdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQ0KICAgIHB1YmxpYyB2b2lkIGludm9rZShSZXEgcmVxdWVzdCwgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPFJlc3A+IHJlc3BvbnNlT2JzZXJ2ZXIpIHsNCiAgICAgIHN3aXRjaCAobWV0aG9kSWQpIHsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9TRU5EX0VWRU5UOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRFdmVudCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5FdmVudCkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlc3VsdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NVQlNDUklCRV9UT19FVkVOVFM6DQogICAgICAgICAgc2VydmljZUltcGwuc3Vic2NyaWJlVG9FdmVudHMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRXZlbnRSZWNlaXZlPikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU1VCU0NSSUJFX1RPX1JFUVVFU1RTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnN1YnNjcmliZVRvUmVxdWVzdHMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3Vic2NyaWJlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfUkVRVUVTVDoNCiAgICAgICAgICBzZXJ2aWNlSW1wbC5zZW5kUmVxdWVzdCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXF1ZXN0KSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9TRU5EX1JFU1BPTlNFOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRSZXNwb25zZSgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5SZXNwb25zZSkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLkVtcHR5PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU0VORF9RVUVVRV9NRVNTQUdFOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnNlbmRRdWV1ZU1lc3NhZ2UoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlKSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdD4pIHJlc3BvbnNlT2JzZXJ2ZXIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfUVVFVUVfTUVTU0FHRVNfQkFUQ0g6DQogICAgICAgICAgc2VydmljZUltcGwuc2VuZFF1ZXVlTWVzc2FnZXNCYXRjaCgoaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5RdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KSByZXF1ZXN0LA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9SRUNFSVZFX1FVRVVFX01FU1NBR0VTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzKChpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVxdWVzdCkgcmVxdWVzdCwNCiAgICAgICAgICAgICAgKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9BQ0tfQUxMX1FVRVVFX01FU1NBR0VTOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLmFja0FsbFF1ZXVlTWVzc2FnZXMoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuQWNrQWxsUXVldWVNZXNzYWdlc1JlcXVlc3QpIHJlcXVlc3QsDQogICAgICAgICAgICAgIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5BY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2U+KSByZXNwb25zZU9ic2VydmVyKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBNRVRIT0RJRF9QSU5HOg0KICAgICAgICAgIHNlcnZpY2VJbXBsLnBpbmcoKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuRW1wdHkpIHJlcXVlc3QsDQogICAgICAgICAgICAgIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8aW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcS5QaW5nUmVzdWx0PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgdGhyb3cgbmV3IEFzc2VydGlvbkVycm9yKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIEBqYXZhLmxhbmcuU3VwcHJlc3NXYXJuaW5ncygidW5jaGVja2VkIikNCiAgICBwdWJsaWMgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPFJlcT4gaW52b2tlKA0KICAgICAgICBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8UmVzcD4gcmVzcG9uc2VPYnNlcnZlcikgew0KICAgICAgc3dpdGNoIChtZXRob2RJZCkgew0KICAgICAgICBjYXNlIE1FVEhPRElEX1NFTkRfRVZFTlRTX1NUUkVBTToNCiAgICAgICAgICByZXR1cm4gKGlvLmdycGMuc3R1Yi5TdHJlYW1PYnNlcnZlcjxSZXE+KSBzZXJ2aWNlSW1wbC5zZW5kRXZlbnRzU3RyZWFtKA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVzdWx0PikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgIGNhc2UgTUVUSE9ESURfU1RSRUFNX1FVRVVFX01FU1NBR0U6DQogICAgICAgICAgcmV0dXJuIChpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI8UmVxPikgc2VydmljZUltcGwuc3RyZWFtUXVldWVNZXNzYWdlKA0KICAgICAgICAgICAgICAoaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyPGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlPikgcmVzcG9uc2VPYnNlcnZlcik7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgdGhyb3cgbmV3IEFzc2VydGlvbkVycm9yKCk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgYWJzdHJhY3QgY2xhc3Mga3ViZW1xQmFzZURlc2NyaXB0b3JTdXBwbGllcg0KICAgICAgaW1wbGVtZW50cyBpby5ncnBjLnByb3RvYnVmLlByb3RvRmlsZURlc2NyaXB0b3JTdXBwbGllciwgaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b1NlcnZpY2VEZXNjcmlwdG9yU3VwcGxpZXIgew0KICAgIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXIoKSB7fQ0KDQogICAgQGphdmEubGFuZy5PdmVycmlkZQ0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yIGdldEZpbGVEZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuZ2V0RGVzY3JpcHRvcigpOw0KICAgIH0NCg0KICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUNCiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5TZXJ2aWNlRGVzY3JpcHRvciBnZXRTZXJ2aWNlRGVzY3JpcHRvcigpIHsNCiAgICAgIHJldHVybiBnZXRGaWxlRGVzY3JpcHRvcigpLmZpbmRTZXJ2aWNlQnlOYW1lKCJrdWJlbXEiKTsNCiAgICB9DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBjbGFzcyBrdWJlbXFGaWxlRGVzY3JpcHRvclN1cHBsaWVyDQogICAgICBleHRlbmRzIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXIgew0KICAgIGt1YmVtcUZpbGVEZXNjcmlwdG9yU3VwcGxpZXIoKSB7fQ0KICB9DQoNCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY2xhc3Mga3ViZW1xTWV0aG9kRGVzY3JpcHRvclN1cHBsaWVyDQogICAgICBleHRlbmRzIGt1YmVtcUJhc2VEZXNjcmlwdG9yU3VwcGxpZXINCiAgICAgIGltcGxlbWVudHMgaW8uZ3JwYy5wcm90b2J1Zi5Qcm90b01ldGhvZERlc2NyaXB0b3JTdXBwbGllciB7DQogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgbWV0aG9kTmFtZTsNCg0KICAgIGt1YmVtcU1ldGhvZERlc2NyaXB0b3JTdXBwbGllcihTdHJpbmcgbWV0aG9kTmFtZSkgew0KICAgICAgdGhpcy5tZXRob2ROYW1lID0gbWV0aG9kTmFtZTsNCiAgICB9DQoNCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlDQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuTWV0aG9kRGVzY3JpcHRvciBnZXRNZXRob2REZXNjcmlwdG9yKCkgew0KICAgICAgcmV0dXJuIGdldFNlcnZpY2VEZXNjcmlwdG9yKCkuZmluZE1ldGhvZEJ5TmFtZShtZXRob2ROYW1lKTsNCiAgICB9DQogIH0NCg0KICBwcml2YXRlIHN0YXRpYyB2b2xhdGlsZSBpby5ncnBjLlNlcnZpY2VEZXNjcmlwdG9yIHNlcnZpY2VEZXNjcmlwdG9yOw0KDQogIHB1YmxpYyBzdGF0aWMgaW8uZ3JwYy5TZXJ2aWNlRGVzY3JpcHRvciBnZXRTZXJ2aWNlRGVzY3JpcHRvcigpIHsNCiAgICBpby5ncnBjLlNlcnZpY2VEZXNjcmlwdG9yIHJlc3VsdCA9IHNlcnZpY2VEZXNjcmlwdG9yOw0KICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgew0KICAgICAgc3luY2hyb25pemVkIChrdWJlbXFHcnBjLmNsYXNzKSB7DQogICAgICAgIHJlc3VsdCA9IHNlcnZpY2VEZXNjcmlwdG9yOw0KICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsNCiAgICAgICAgICBzZXJ2aWNlRGVzY3JpcHRvciA9IHJlc3VsdCA9IGlvLmdycGMuU2VydmljZURlc2NyaXB0b3IubmV3QnVpbGRlcihTRVJWSUNFX05BTUUpDQogICAgICAgICAgICAgIC5zZXRTY2hlbWFEZXNjcmlwdG9yKG5ldyBrdWJlbXFGaWxlRGVzY3JpcHRvclN1cHBsaWVyKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZEV2ZW50TWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZEV2ZW50c1N0cmVhbU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFN1YnNjcmliZVRvRXZlbnRzTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U3Vic2NyaWJlVG9SZXF1ZXN0c01ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFNlbmRSZXF1ZXN0TWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZFJlc3BvbnNlTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5hZGRNZXRob2QoZ2V0U2VuZFF1ZXVlTWVzc2FnZU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFNlbmRRdWV1ZU1lc3NhZ2VzQmF0Y2hNZXRob2QoKSkNCiAgICAgICAgICAgICAgLmFkZE1ldGhvZChnZXRSZWNlaXZlUXVldWVNZXNzYWdlc01ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldFN0cmVhbVF1ZXVlTWVzc2FnZU1ldGhvZCgpKQ0KICAgICAgICAgICAgICAuYWRkTWV0aG9kKGdldEFja0FsbFF1ZXVlTWVzc2FnZXNNZXRob2QoKSkNCiAgICAgICAgICAgICAgLmFkZE1ldGhvZChnZXRQaW5nTWV0aG9kKCkpDQogICAgICAgICAgICAgIC5idWlsZCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:12.967+0300	INFO	request: {"metadata":{"filename":"test.iml","method":"save","path":"java/poc/test"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxtb2R1bGUgdHlwZT0iSkFWQV9NT0RVTEUiIHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9Ik5ld01vZHVsZVJvb3RNYW5hZ2VyIiBpbmhlcml0LWNvbXBpbGVyLW91dHB1dD0idHJ1ZSI+DQogICAgPGV4Y2x1ZGUtb3V0cHV0IC8+DQogICAgPGNvbnRlbnQgdXJsPSJmaWxlOi8vJE1PRFVMRV9ESVIkIj4NCiAgICAgIDxzb3VyY2VGb2xkZXIgdXJsPSJmaWxlOi8vJE1PRFVMRV9ESVIkL3NyYyIgaXNUZXN0U291cmNlPSJmYWxzZSIgLz4NCiAgICA8L2NvbnRlbnQ+DQogICAgPG9yZGVyRW50cnkgdHlwZT0iaW5oZXJpdGVkSmRrIiAvPg0KICAgIDxvcmRlckVudHJ5IHR5cGU9InNvdXJjZUZvbGRlciIgZm9yVGVzdHM9ImZhbHNlIiAvPg0KICA8L2NvbXBvbmVudD4NCjwvbW9kdWxlPg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.066+0300	INFO	request: {"metadata":{"filename":"ReceiveMessagesResponse.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/queue"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnF1ZXVlOw0KDQppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUXVldWVNZXNzYWdlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZTsNCg0KLyoqDQogKiBRdWV1ZSByZXNwb25zZS4NCiAqLw0KcHVibGljIGNsYXNzIFJlY2VpdmVNZXNzYWdlc1Jlc3BvbnNlIHsNCg0KICAgIHByaXZhdGUgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZSByZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlOw0KDQogICAgcHJvdGVjdGVkIFJlY2VpdmVNZXNzYWdlc1Jlc3BvbnNlKFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgcmVjKSB7DQogICAgICAgIHJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UgPSByZWM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVW5pcXVlIGZvciBSZXF1ZXN0DQogICAgICogDQogICAgICogQHJldHVybiBSZXF1ZXN0IElELg0KICAgICAqLw0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVxdWVzdElEKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldFJlcXVlc3RJRCgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybmVkIGZyb20gS3ViZU1RLCBmYWxzZSBpZiBubyBlcnJvci4NCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIEZhbHNlIGlmIG5vIGVycm9yLg0KICAgICAqLw0KICAgIHB1YmxpYyBCb29sZWFuIGdldElzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0SXNFcnJvcigpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVycm9yIG1lc3NhZ2UsIHZhbGlkIG9ubHkgaWYgSXNFcnJvciB0cnVlLg0KICAgICAqIA0KICAgICAqIEByZXR1cm4gRXJyb3IgbWVzc2FnZS4NCiAgICAgKi8NCiAgICBwdWJsaWMgU3RyaW5nIGdldEVycm9yKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlLmdldEVycm9yKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5kaWNhdGUgaWYgdGhlIHJlcXVlc3Qgd2FzIHBlZWssIHRydWUgaWYgcGVlay4NCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgcGVlay4NCiAgICAgKi8NCiAgICBwdWJsaWMgQm9vbGVhbiBnZXRJc1BlZWsoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0SXNQZWFrKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29sbGVjdGlvbiBvZiBNZXNzYWdlcy4NCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIENvbGxlY3Rpb24gb2YgTWVzc2FnZXMuDQogICAgICovDQogICAgcHVibGljIEl0ZXJhYmxlPD8gZXh0ZW5kcyBNZXNzYWdlPiBnZXRNZXNzYWdlcygpIHsNCg0KICAgICAgICBDb2xsZWN0aW9uPE1lc3NhZ2U+IGNsdG4gPSBuZXcgQXJyYXlMaXN0PE1lc3NhZ2U+KCk7IA0KICAgICAgICBmb3IgKFF1ZXVlTWVzc2FnZSBxdWV1ZU1lc3NhZ2UgOiB0aGlzLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0TWVzc2FnZXNMaXN0KCkpIHsNCiAgICAgICAgICAgIGNsdG4uYWRkKG5ldyBNZXNzYWdlKHF1ZXVlTWVzc2FnZSkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjbHRuOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvdW50IG9mIG1lc3NhZ2VzIGV4cGlyZWQuDQogICAgICogDQogICAgICogQHJldHVybiBOdW1iZXIgb2YgbWVzc2FnZXMgZXhwaXJlZC4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW50IGdldE1lc3NhZ2VzRXhwaXJlZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXNwb25zZS5nZXRNZXNzYWdlc0V4cGlyZWQoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb3VudCBvZiByZWNlaXZlZCBtZXNzYWdlcy4NCiAgICAgKiANCiAgICAgKiBAcmV0dXJuIE51bWJlciBvZiByZWNlaXZlZCBtZXNzYWdlcy4NCiAgICAgKi8NCiAgICBwdWJsaWMgaW50IGdldE1lc3NhZ2VzUmVjZWl2ZWQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UuZ2V0TWVzc2FnZXNSZWNlaXZlZCgpOw0KICAgIH0NCg0KfQ=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.221+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/get_Started/queue_Send_a_Message"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmdldF9TdGFydGVkLnF1ZXVlX1NlbmRfYV9NZXNzYWdlOw0KDQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5NZXNzYWdlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsucXVldWUuUXVldWU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5xdWV1ZS5TZW5kTWVzc2FnZVJlc3VsdDsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmJhc2ljLlNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsudG9vbHMuQ29udmVydGVyOw0KDQppbXBvcnQgamF2YXgubmV0LnNzbC5TU0xFeGNlcHRpb247DQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCg0KcHVibGljIGNsYXNzIFByb2dyYW0gew0KDQogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gew0KDQogICAgICAgIFN0cmluZyBxdWV1ZU5hbWUgPSAiaGVsbG8td29ybGQtcXVldWUiLCBjbGllbnRJRCA9ICJ0ZXN0LXF1ZXVlLWNsaWVudC1pZDIiLA0KICAgICAgICAgICAgICAgIGt1YmVNUVNlcnZlckFkZHJlc3MgPSAibG9jYWxob3N0OjUwMDAwIjsNCg0KICAgICAgICBRdWV1ZSBxdWV1ZSA9IG51bGw7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBxdWV1ZSA9IG5ldyBpby5rdWJlbXEuc2RrLnF1ZXVlLlF1ZXVlKHF1ZXVlTmFtZSwgY2xpZW50SUQsIGt1YmVNUVNlcnZlckFkZHJlc3MpOw0KICAgICAgICAgICAgcXVldWUuc2V0TWF4TnVtYmVyT2ZNZXNzYWdlc1F1ZXVlTWVzc2FnZXMoMik7DQogICAgICAgICAgICBxdWV1ZS5zZXRXYWl0VGltZVNlY29uZHNRdWV1ZU1lc3NhZ2VzKDEpOw0KICAgICAgICB9IGNhdGNoIChTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogQ2FuIG5vdCBkZXRlcm1pbmUgS3ViZU1RIHNlcnZlciBhZGRyZXNzLiIpOw0KICAgICAgICB9IGNhdGNoIChTU0xFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogZXJyb3IgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgTWVzc2FnZSBtc2cgPSBuZXcgTWVzc2FnZSgpLnNldEJvZHkoQ29udmVydGVyLlRvQnl0ZUFycmF5KCJzb21lLXNpbXBsZV9xdWV1ZS1xdWV1ZS1tZXNzYWdlIikpDQogICAgICAgICAgICAgICAgLnNldE1ldGFkYXRhKCJlbXB0eSIpOw0KICAgICAgICBTZW5kTWVzc2FnZVJlc3VsdCByZXM7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXMgPSBxdWV1ZS5TZW5kUXVldWVNZXNzYWdlKG1zZyk7DQogICAgICAgICAgICBpZihyZXMuZ2V0SXNFcnJvcigpICApICAgICAgIHsNCiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIm1lc3NhZ2UgZW5xdWV1ZSBlcnJvciwgZXJyb3I6e3Jlcy5FcnJvcn0iKTsNCiAgICAgICAgICAgICAgfSBlbHNlew0KICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigibWVzc2FnZSBzZW50IGF0LCB7cmVzLlNlbnRBdH0iKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChTU0xFeGNlcHRpb24gIGUpIHsNCiAgICAgICAgICAgIC8vIFRPRE8gQXV0by1nZW5lcmF0ZWQgY2F0Y2ggYmxvY2sNCiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgIH0NCiAgICB9DQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.374+0300	INFO	request: {"metadata":{"filename":"Request.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/commandquery/lowlevel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5sb3dsZXZlbDsNCg0KaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0VHlwZTsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xOw0KaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nMy5TdHJpbmdVdGlsczsNCg0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0IGphdmEudXRpbC5NYXA7DQppbXBvcnQgamF2YS51dGlsLk9wdGlvbmFsOw0KaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOw0KDQpwdWJsaWMgY2xhc3MgUmVxdWVzdCB7DQogICAgcHJpdmF0ZSBzdGF0aWMgQXRvbWljSW50ZWdlciBfaWQgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgYSBSZXF1ZXN0IGlkZW50aWZpZXIuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgcmVxdWVzdElkOw0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIHR5cGUgb2YgcmVxdWVzdCBvcGVyYXRpb24gdXNpbmcgUmVxdWVzdFR5cGUuDQogICAgICovDQogICAgcHJpdmF0ZSBSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZTsNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIHRoZSBzZW5kZXIgSUQgdGhhdCB0aGUgUmVxdWVzdCB3aWxsIGJlIHNlbmQgdW5kZXIuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgY2xpZW50SWQ7DQogICAgLyoqDQogICAgICogUmVwcmVzZW50cyBUaGUgY2hhbm5lbCBuYW1lIHRvIHNlbmQgdG8gdXNpbmcgdGhlIEt1YmVNUS4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBjaGFubmVsOw0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgVGhlIGNoYW5uZWwgbmFtZSB0byByZXR1cm4gcmVzcG9uc2UgdG8NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyByZXBseUNoYW5uZWw7DQogICAgLyoqDQogICAgICogUmVwcmVzZW50cyB0ZXh0IGFzIGphdmEubGFuZy5TdHJpbmcuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgbWV0YWRhdGE7DQogICAgLyoqDQogICAgICogUmVwcmVzZW50cyBUaGUgY29udGVudCBvZiB0aGUgaW8ua3ViZW1xLnNkay5yZXF1ZXN0cmVwbHkubG93bGV2ZWwuUmVxdWVzdC4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJ5dGVbXSBib2R5Ow0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIGxpbWl0IGZvciB3YWl0aW5nIGZvciByZXNwb25zZSAoTWlsbGlzZWNvbmRzKS4NCiAgICAgKi8NCiAgICBwcml2YXRlIGludCB0aW1lb3V0Ow0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgaWYgdGhlIHJlcXVlc3Qgc2hvdWxkIGJlIHNhdmVkIGZyb20gQ2FjaGUgYW5kIHVuZGVyIHdoYXQgIktleSIoU3lzdGVtLlN0cmluZykgdG8gc2F2ZSBpdC4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBjYWNoZUtleTsNCiAgICAvKioNCiAgICAgKiBDYWNoZSB0aW1lIHRvIGxpdmUgOiBmb3IgaG93IGxvbmcgZG9lcyB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2F2ZWQgaW4gQ2FjaGUNCiAgICAgKi8NCiAgICBwcml2YXRlIGludCBjYWNoZVRUTDsNCg0KICAgIHByaXZhdGUgTWFwPFN0cmluZywgU3RyaW5nPiB0YWdzOw0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLlJlcXVlc3QuDQogICAgICovDQogICAgcHVibGljIFJlcXVlc3QoKSB7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIGlvLmt1YmVtcS5zZGsucmVxdWVzdHJlcGx5Lmxvd2xldmVsLlJlcXVlc3Qgd2l0aCBhIHNldCBvZiBwYXJhbWV0ZXJzLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlcXVlc3RJZCAgICBSZXByZXNlbnRzIGEgUmVxdWVzdCBpZGVudGlmaWVyLg0KICAgICAqIEBwYXJhbSByZXF1ZXN0VHlwZSAgUmVwcmVzZW50cyB0aGUgdHlwZSBvZiByZXF1ZXN0IG9wZXJhdGlvbiB1c2luZyBSZXF1ZXN0VHlwZS4NCiAgICAgKiBAcGFyYW0gY2xpZW50SWQgICAgIFJlcHJlc2VudHMgdGhlIHNlbmRlciBJRCB0aGF0IHRoZSBSZXF1ZXN0IHdpbGwgYmUgc2VuZCB1bmRlci4NCiAgICAgKiBAcGFyYW0gY2hhbm5lbCAgICAgIFJlcHJlc2VudHMgVGhlIGNoYW5uZWwgbmFtZSB0byBzZW5kIHRvIHVzaW5nIHRoZSBLdWJlTVEuDQogICAgICogQHBhcmFtIHJlcGx5Q2hhbm5lbCBSZXByZXNlbnRzIFRoZSBjaGFubmVsIG5hbWUgdG8gcmV0dXJuIHJlc3BvbnNlIHRvLg0KICAgICAqIEBwYXJhbSBtZXRhZGF0YSAgICAgUmVwcmVzZW50cyB0ZXh0IGFzIGphdmEubGFuZy5TdHJpbmcuDQogICAgICogQHBhcmFtIGJvZHkgICAgICAgICBSZXByZXNlbnRzIFRoZSBjb250ZW50IG9mIHRoZSBpby5rdWJlbXEuc2RrLnJlcXVlc3RyZXBseS5sb3dsZXZlbC5SZXF1ZXN0Lg0KICAgICAqIEBwYXJhbSB0aW1lb3V0ICAgICAgUmVwcmVzZW50cyB0aGUgbGltaXQgZm9yIHdhaXRpbmcgZm9yIHJlc3BvbnNlIChNaWxsaXNlY29uZHMpLg0KICAgICAqIEBwYXJhbSBjYWNoZUtleSAgICAgUmVwcmVzZW50cyBpZiB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2F2ZWQgZnJvbSBDYWNoZSBhbmQgdW5kZXIgd2hhdCAiS2V5IihqYXZhLmxhbmcuU3RyaW5nKSB0byBzYXZlIGl0Lg0KICAgICAqIEBwYXJhbSBjYWNoZVRUTCAgICAgQ2FjaGUgdGltZSB0byBsaXZlIDogZm9yIGhvdyBsb25nIGRvZXMgdGhlIHJlcXVlc3Qgc2hvdWxkIGJlIHNhdmVkIGluIENhY2hlLg0KICAgICAqLw0KICAgIHB1YmxpYyBSZXF1ZXN0KFN0cmluZyByZXF1ZXN0SWQsIFJlcXVlc3RUeXBlIHJlcXVlc3RUeXBlLCBTdHJpbmcgY2xpZW50SWQsIFN0cmluZyBjaGFubmVsLCBTdHJpbmcgcmVwbHlDaGFubmVsLCBTdHJpbmcgbWV0YWRhdGEsIGJ5dGVbXSBib2R5LCBpbnQgdGltZW91dCwgU3RyaW5nIGNhY2hlS2V5LCBpbnQgY2FjaGVUVEwsIE1hcDxTdHJpbmcsU3RyaW5nPiB0YWdzKSB7DQogICAgICAgIHRoaXMucmVxdWVzdElkID0gcmVxdWVzdElkOw0KICAgICAgICB0aGlzLnJlcXVlc3RUeXBlID0gcmVxdWVzdFR5cGU7DQogICAgICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDsNCiAgICAgICAgdGhpcy5jaGFubmVsID0gY2hhbm5lbDsNCiAgICAgICAgdGhpcy5yZXBseUNoYW5uZWwgPSByZXBseUNoYW5uZWw7DQogICAgICAgIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTsNCiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTsNCiAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCiAgICAgICAgdGhpcy5jYWNoZUtleSA9IGNhY2hlS2V5Ow0KICAgICAgICB0aGlzLmNhY2hlVFRMID0gY2FjaGVUVEw7DQogICAgICAgIHRoaXMudGFncyA9IHRhZ3M7DQogICAgfQ0KDQogICAgUmVxdWVzdChLdWJlbXEuUmVxdWVzdCBpbm5lclJlcXVlc3QpIHsNCiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSBTdHJpbmdVdGlscy5pc0VtcHR5KGlubmVyUmVxdWVzdC5nZXRSZXF1ZXN0SUQoKSkNCiAgICAgICAgICAgICAgICA/IEdldE5leHRJZCgpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICA6IGlubmVyUmVxdWVzdC5nZXRSZXF1ZXN0SUQoKTsNCiAgICAgICAgdGhpcy5yZXF1ZXN0VHlwZSA9IFJlcXVlc3RUeXBlLnZhbHVlcygpWyhpbm5lclJlcXVlc3QuZ2V0UmVxdWVzdFR5cGVEYXRhVmFsdWUoKSldOw0KICAgICAgICB0aGlzLmNsaWVudElkID0gT3B0aW9uYWwub2ZOdWxsYWJsZShpbm5lclJlcXVlc3QuZ2V0Q2xpZW50SUQoKSkub3JFbHNlKCIiKTsNCiAgICAgICAgdGhpcy5jaGFubmVsID0gaW5uZXJSZXF1ZXN0LmdldENoYW5uZWwoKTsNCiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IE9wdGlvbmFsLm9mTnVsbGFibGUoaW5uZXJSZXF1ZXN0LmdldE1ldGFkYXRhKCkpLm9yRWxzZSgiIik7DQogICAgICAgIHRoaXMuYm9keSA9IGlubmVyUmVxdWVzdC5nZXRCb2R5KCkudG9CeXRlQXJyYXkoKTsNCiAgICAgICAgdGhpcy5yZXBseUNoYW5uZWwgPSBpbm5lclJlcXVlc3QuZ2V0UmVwbHlDaGFubmVsKCk7DQogICAgICAgIHRoaXMudGltZW91dCA9IGlubmVyUmVxdWVzdC5nZXRUaW1lb3V0KCk7DQogICAgICAgIHRoaXMuY2FjaGVLZXkgPSBPcHRpb25hbC5vZk51bGxhYmxlKGlubmVyUmVxdWVzdC5nZXRDYWNoZUtleSgpKS5vckVsc2UoIiIpOw0KICAgICAgICB0aGlzLmNhY2hlVFRMID0gaW5uZXJSZXF1ZXN0LmdldENhY2hlVFRMKCk7DQogICAgICAgIHRoaXMudGFncyA9IGlubmVyUmVxdWVzdC5nZXRUYWdzTWFwKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29udmVydCBhIFJlcXVlc3QgdG8gYW4gS3ViZW1xLlJlcXVlc3QNCiAgICAgKg0KICAgICAqIEByZXR1cm4gQW4gS3ViZW1xLlJlcXVlc3QNCiAgICAgKi8NCiAgICBLdWJlbXEuUmVxdWVzdCBDb252ZXJ0KCkgew0KICAgICAgICByZXR1cm4gS3ViZW1xLlJlcXVlc3QNCiAgICAgICAgICAgICAgICAubmV3QnVpbGRlcigpDQogICAgICAgICAgICAgICAgLnNldFJlcXVlc3RJRCgoU3RyaW5nVXRpbHMuaXNFbXB0eShyZXF1ZXN0SWQpKSA/IEdldE5leHRJZCgpLnRvU3RyaW5nKCkgOiByZXF1ZXN0SWQpDQogICAgICAgICAgICAgICAgLnNldENsaWVudElEKE9wdGlvbmFsLm9mTnVsbGFibGUoY2xpZW50SWQpLm9yRWxzZSgiIikpDQogICAgICAgICAgICAgICAgLnNldENoYW5uZWwoY2hhbm5lbCkNCiAgICAgICAgICAgICAgICAvLyBSZXBseUNoYW5uZWwgLSBTZXQgb25seSBieSBLdWJlTVEgc2VydmVyDQogICAgICAgICAgICAgICAgLnNldE1ldGFkYXRhKE9wdGlvbmFsLm9mTnVsbGFibGUobWV0YWRhdGEpLm9yRWxzZSgiIikpDQogICAgICAgICAgICAgICAgLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbShib2R5KSkNCiAgICAgICAgICAgICAgICAuc2V0VGltZW91dCh0aW1lb3V0KQ0KICAgICAgICAgICAgICAgIC5zZXRDYWNoZUtleShPcHRpb25hbC5vZk51bGxhYmxlKGNhY2hlS2V5KS5vckVsc2UoIiIpKQ0KICAgICAgICAgICAgICAgIC5zZXRDYWNoZVRUTChjYWNoZVRUTCkNCiAgICAgICAgICAgICAgICAuc2V0UmVxdWVzdFR5cGVEYXRhKGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUmVxdWVzdC5SZXF1ZXN0VHlwZS52YWx1ZXMoKVtyZXF1ZXN0VHlwZS5nZXRWYWx1ZSgpXSkNCiAgICAgICAgICAgICAgICAucHV0QWxsVGFncyhPcHRpb25hbC5vZk51bGxhYmxlKHRhZ3MpLm9yRWxzZShuZXcgSGFzaE1hcDxTdHJpbmcsU3RyaW5nPigpKSkNCiAgICAgICAgICAgICAgICAuYnVpbGQoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgYW4gdW5pcXVlIHRocmVhZCBzYWZldHkgSUQgYmV0d2VlbiAxIHRvIDMyLDc2Nw0KICAgICAqDQogICAgICogQHJldHVybiB1bmlxdWUgSUQgYmV0d2VlbiAxIHRvIDMyLDc2Nw0KICAgICAqLw0KICAgIHByaXZhdGUgSW50ZWdlciBHZXROZXh0SWQoKSB7DQogICAgICAgIHJldHVybiBfaWQudXBkYXRlQW5kR2V0KGkgLT4gaSA9PSBJbnRlZ2VyLk1BWF9WQUxVRSA/IDEgOiBpICsgMSk7DQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRSZXF1ZXN0SWQoKSB7DQogICAgICAgIHJldHVybiByZXF1ZXN0SWQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UmVxdWVzdElkKFN0cmluZyByZXF1ZXN0SWQpIHsNCiAgICAgICAgdGhpcy5yZXF1ZXN0SWQgPSByZXF1ZXN0SWQ7DQogICAgfQ0KDQogICAgcHVibGljIFJlcXVlc3RUeXBlIGdldFJlcXVlc3RUeXBlKCkgew0KICAgICAgICByZXR1cm4gcmVxdWVzdFR5cGU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0UmVxdWVzdFR5cGUoUmVxdWVzdFR5cGUgcmVxdWVzdFR5cGUpIHsNCiAgICAgICAgdGhpcy5yZXF1ZXN0VHlwZSA9IHJlcXVlc3RUeXBlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xpZW50SWQoKSB7DQogICAgICAgIHJldHVybiBjbGllbnRJZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDbGllbnRJZChTdHJpbmcgY2xpZW50SWQpIHsNCiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2hhbm5lbCgpIHsNCiAgICAgICAgcmV0dXJuIGNoYW5uZWw7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2hhbm5lbChTdHJpbmcgY2hhbm5lbCkgew0KICAgICAgICB0aGlzLmNoYW5uZWwgPSBjaGFubmVsOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVwbHlDaGFubmVsKCkgew0KICAgICAgICByZXR1cm4gcmVwbHlDaGFubmVsOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBzZXRSZXBseUNoYW5uZWwoU3RyaW5nIHJlcGx5Q2hhbm5lbCkgew0KICAgICAgICB0aGlzLnJlcGx5Q2hhbm5lbCA9IHJlcGx5Q2hhbm5lbDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgICByZXR1cm4gbWV0YWRhdGE7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0TWV0YWRhdGEoU3RyaW5nIG1ldGFkYXRhKSB7DQogICAgICAgIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJvZHkoKSB7DQogICAgICAgIHJldHVybiBib2R5Ow0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEJvZHkoYnl0ZVtdIGJvZHkpIHsNCiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFRpbWVvdXQoKSB7DQogICAgICAgIHJldHVybiB0aW1lb3V0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFRpbWVvdXQoaW50IHRpbWVvdXQpIHsNCiAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENhY2hlS2V5KCkgew0KICAgICAgICByZXR1cm4gY2FjaGVLZXk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVLZXkoU3RyaW5nIGNhY2hlS2V5KSB7DQogICAgICAgIHRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldENhY2hlVFRMKCkgew0KICAgICAgICByZXR1cm4gY2FjaGVUVEw7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVUVEwoaW50IGNhY2hlVFRMKSB7DQogICAgICAgIHRoaXMuY2FjaGVUVEwgPSBjYWNoZVRUTDsNCiAgICB9DQogICAgcHVibGljIE1hcDxTdHJpbmcsU3RyaW5nPiBnZXRUYWdzKCl7DQogICAgICAgIHJldHVybiB0YWdzOw0KICAgIH0NCg0KCXB1YmxpYyB2b2lkIHNldFRhZ3MoTWFwPFN0cmluZywgU3RyaW5nPiB0YWdzKSB7DQogICAgICAgdGhpcy50YWdzID0gdGFnczsNCgl9DQoNCg0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.425+0300	INFO	request: {"metadata":{"filename":"post-update.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCiMKIyBBbiBleGFtcGxlIGhvb2sgc2NyaXB0IHRvIHByZXBhcmUgYSBwYWNrZWQgcmVwb3NpdG9yeSBmb3IgdXNlIG92ZXIKIyBkdW1iIHRyYW5zcG9ydHMuCiMKIyBUbyBlbmFibGUgdGhpcyBob29rLCByZW5hbWUgdGhpcyBmaWxlIHRvICJwb3N0LXVwZGF0ZSIuCgpleGVjIGdpdCB1cGRhdGUtc2VydmVyLWluZm8K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.449+0300	INFO	request: {"metadata":{"filename":"fileHashes.lock","method":"save","path":"java/kubemq-java/.gradle/4.8/fileHashes"},"data":"A0kwD0b/2kb5AAAAAAAAAA4="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.577+0300	INFO	request: {"metadata":{"filename":"HEAD","method":"save","path":"java/kubemq-java/.git/logs"},"data":"MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCA0MjllNWUyODMzNDg0MzkwMDJkZjAxNTRmNDIxZDExZjVlMTk0YzBkIGt1YmVtcSA8bGlvci5uYWJhdEBrdWJlbXEuaW8+IDE2MTgzODUyNjkgKzAzMDAJY2xvbmU6IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2t1YmVtcS1pby9rdWJlbXEtSmF2YS5naXQK"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.844+0300	INFO	request: {"metadata":{"filename":"pre-receive.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCiMKIyBBbiBleGFtcGxlIGhvb2sgc2NyaXB0IHRvIG1ha2UgdXNlIG9mIHB1c2ggb3B0aW9ucy4KIyBUaGUgZXhhbXBsZSBzaW1wbHkgZWNob2VzIGFsbCBwdXNoIG9wdGlvbnMgdGhhdCBzdGFydCB3aXRoICdlY2hvYmFjaz0nCiMgYW5kIHJlamVjdHMgYWxsIHB1c2hlcyB3aGVuIHRoZSAicmVqZWN0IiBwdXNoIG9wdGlvbiBpcyB1c2VkLgojCiMgVG8gZW5hYmxlIHRoaXMgaG9vaywgcmVuYW1lIHRoaXMgZmlsZSB0byAicHJlLXJlY2VpdmUiLgoKaWYgdGVzdCAtbiAiJEdJVF9QVVNIX09QVElPTl9DT1VOVCIKdGhlbgoJaT0wCgl3aGlsZSB0ZXN0ICIkaSIgLWx0ICIkR0lUX1BVU0hfT1BUSU9OX0NPVU5UIgoJZG8KCQlldmFsICJ2YWx1ZT1cJEdJVF9QVVNIX09QVElPTl8kaSIKCQljYXNlICIkdmFsdWUiIGluCgkJZWNob2JhY2s9KikKCQkJZWNobyAiZWNobyBmcm9tIHRoZSBwcmUtcmVjZWl2ZS1ob29rOiAke3ZhbHVlIyo9fSIgPiYyCgkJCTs7CgkJcmVqZWN0KQoJCQlleGl0IDEKCQllc2FjCgkJaT0kKChpICsgMSkpCglkb25lCmZpCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.884+0300	INFO	request: {"metadata":{"filename":"SubscribeType.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/subscription"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnN1YnNjcmlwdGlvbjsNCg0KLyoqDQogKiBUeXBlIG9mIHN1YnNjcmlwdGlvbiBvcGVyYXRpb24gcGF0dGVybg0KICovDQpwdWJsaWMgZW51bSBTdWJzY3JpYmVUeXBlIHsNCg0KICAgIC8qKg0KICAgICAqIERlZmF1bHQNCiAgICAgKi8NCiAgICBTdWJzY3JpYmVUeXBlVW5kZWZpbmVkKDApLA0KDQogICAgLyoqDQogICAgICogUHViU3ViIGV2ZW50DQogICAgICovDQogICAgRXZlbnRzKDEpLA0KDQogICAgLyoqDQogICAgICogUHViU3ViIGV2ZW50IHdpdGggcGVyc2lzdGVuY2UNCiAgICAgKi8NCiAgICBFdmVudHNTdG9yZSgyKSwNCg0KICAgIC8qKg0KICAgICAqIFJlcVJlcCBwZXJmb3JtIGFjdGlvbg0KICAgICAqLw0KICAgIENvbW1hbmRzKDMpLA0KDQogICAgLyoqDQogICAgICogUmVxUmVwIHJldHVybiBkYXRhDQogICAgICovDQogICAgUXVlcmllcyg0KTsNCg0KICAgIHByaXZhdGUgaW50IHZhbHVlOw0KDQogICAgcHJpdmF0ZSBTdWJzY3JpYmVUeXBlKGludCB2YWx1ZSkgew0KICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7DQogICAgfQ0KDQogICAgcHVibGljIGludCBnZXRWYWx1ZSgpIHsNCiAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgIH0NCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:13.911+0300	INFO	request: {"metadata":{"filename":"EventReceive.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/event"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV2ZW50Ow0KDQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQppbXBvcnQgamF2YS51dGlsLk1hcDsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXE7DQoNCnB1YmxpYyBjbGFzcyBFdmVudFJlY2VpdmUgew0KDQogICAgcHJpdmF0ZSBTdHJpbmcgZXZlbnRJZDsNCiAgICBwcml2YXRlIFN0cmluZyBjaGFubmVsOw0KICAgIHByaXZhdGUgU3RyaW5nIG1ldGFkYXRhOw0KICAgIHByaXZhdGUgYnl0ZVtdIGJvZHk7DQogICAgcHJpdmF0ZSBsb25nIHRpbWVzdGFtcDsNCiAgICBwcml2YXRlIGxvbmcgc2VxdWVuY2U7DQoJcHJpdmF0ZSBNYXA8U3RyaW5nLCBTdHJpbmc+IHRhZ3M7DQoNCiAgICBwdWJsaWMgRXZlbnRSZWNlaXZlKCkgew0KICAgIH0NCg0KICAgIHB1YmxpYyBFdmVudFJlY2VpdmUoS3ViZW1xLkV2ZW50UmVjZWl2ZSBpbm5lcikgew0KICAgICAgICBldmVudElkID0gaW5uZXIuZ2V0RXZlbnRJRCgpOw0KICAgICAgICBjaGFubmVsID0gaW5uZXIuZ2V0Q2hhbm5lbCgpOw0KICAgICAgICBtZXRhZGF0YSA9IGlubmVyLmdldE1ldGFkYXRhKCk7DQogICAgICAgIGJvZHkgPSBpbm5lci5nZXRCb2R5KCkudG9CeXRlQXJyYXkoKTsNCiAgICAgICAgdGltZXN0YW1wID0gaW5uZXIuZ2V0VGltZXN0YW1wKCk7DQogICAgICAgIHNlcXVlbmNlID0gaW5uZXIuZ2V0U2VxdWVuY2UoKTsNCiAgICAgICAgdGFncyA9IGlubmVyLmdldFRhZ3NNYXAoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldEV2ZW50SWQoKSB7DQogICAgICAgIHJldHVybiBldmVudElkOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEV2ZW50SWQoU3RyaW5nIGV2ZW50SWQpIHsNCiAgICAgICAgdGhpcy5ldmVudElkID0gZXZlbnRJZDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENoYW5uZWwoKSB7DQogICAgICAgIHJldHVybiBjaGFubmVsOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldENoYW5uZWwoU3RyaW5nIGNoYW5uZWwpIHsNCiAgICAgICAgdGhpcy5jaGFubmVsID0gY2hhbm5lbDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldE1ldGFkYXRhKCkgew0KICAgICAgICByZXR1cm4gbWV0YWRhdGE7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0TWV0YWRhdGEoU3RyaW5nIG1ldGFkYXRhKSB7DQogICAgICAgIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTsNCiAgICB9DQoNCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJvZHkoKSB7DQogICAgICAgIHJldHVybiBib2R5Ow0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEJvZHkoYnl0ZVtdIGJvZHkpIHsNCiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTsNCiAgICB9DQoNCiAgICBwdWJsaWMgbG9uZyBnZXRUaW1lc3RhbXAoKSB7DQogICAgICAgIHJldHVybiB0aW1lc3RhbXA7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0VGltZXN0YW1wKGxvbmcgdGltZXN0YW1wKSB7DQogICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOw0KICAgIH0NCg0KICAgIHB1YmxpYyBsb25nIGdldFNlcXVlbmNlKCkgew0KICAgICAgICByZXR1cm4gc2VxdWVuY2U7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0U2VxdWVuY2UobG9uZyBzZXF1ZW5jZSkgew0KICAgICAgICB0aGlzLnNlcXVlbmNlID0gc2VxdWVuY2U7DQogICAgfQ0KDQogICAgcHVibGljIE1hcDxTdHJpbmcsIFN0cmluZz4gZ2V0VGFncygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudGFnczsNCiAgICB9DQogICAgcHVibGljIHZvaWQgc2V0VGFnKFN0cmluZyBrZXksIFN0cmluZyB2YWx1ZSl7DQogICAgICAgIGlmICh0YWdzPT1udWxsKXsNCiAgICAgICAgICAgIHRhZ3MgPSAgbmV3IEhhc2hNYXA8U3RyaW5nLFN0cmluZz4oKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnRhZ3MucHV0SWZBYnNlbnQoa2V5LCB2YWx1ZSk7DQogICAgfQ0KDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.049+0300	INFO	request: {"metadata":{"filename":"ChannelParameters.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/commandquery"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeTsNCg0KcHVibGljIGNsYXNzIENoYW5uZWxQYXJhbWV0ZXJzIHsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIHR5cGUgb2YgcmVxdWVzdCBvcGVyYXRpb24gdXNpbmcgUmVxdWVzdFR5cGUuDQogICAgICovDQogICAgcHJpdmF0ZSBSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZTsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgVGhlIGNoYW5uZWwgbmFtZSB0byBzZW5kIHRvIHVzaW5nIHRoZSBLdWJlTVENCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBjaGFubmVsTmFtZTsNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIHRoZSBzZW5kZXIgSUQgdGhhdCB0aGUgbWVzc2FnZXMgd2lsbCBiZSBzZW5kIHVuZGVyDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgY2xpZW50SUQ7DQogICAgLyoqDQogICAgICogUmVwcmVzZW50cyB0aGUgbGltaXQgZm9yIHdhaXRpbmcgZm9yIHJlc3BvbnNlIChNaWxsaXNlY29uZHMpDQogICAgICovDQogICAgcHJpdmF0ZSBpbnQgdGltZW91dDsNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIGlmIHRoZSByZXF1ZXN0IHNob3VsZCBiZSBzYXZlZCBmcm9tIENhY2hlIGFuZCB1bmRlciB3aGF0ICJLZXkiKFN0cmluZykgdG8gc2F2ZSBpdA0KICAgICAqLw0KICAgIHByaXZhdGUgU3RyaW5nIGNhY2hlS2V5Ow0KICAgIC8qKg0KICAgICAqIENhY2hlIHRpbWUgdG8gbGl2ZSA6IGZvciBob3cgbG9uZyBkb2VzIHRoZSByZXF1ZXN0IHNob3VsZCBiZSBzYXZlZCBpbiBDYWNoZQ0KICAgICAqLw0KICAgIHByaXZhdGUgaW50IGNhY2hlVFRMOw0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgVGhlIGFkZHJlc3Mgb2YgdGhlIEt1YmVNUSBzZXJ2ZXINCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBrdWJlTVFBZGRyZXNzOw0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgSldUIHRva2VuIHRvIGJlIHVzZWQgZm9yIEt1YmVNUSBhdXRoZW50aWNhdGlvbi4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBhdXRoVG9rZW47DQoNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBpby5rdWJlbXEuc2RrLmNvbW1hbmRxdWVyeS5SZXF1ZXN0Q2hhbm5lbFBhcmFtZXRlcnMgY2xhc3MNCiAgICAgKi8NCiAgICBwdWJsaWMgQ2hhbm5lbFBhcmFtZXRlcnMoKSB7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIGlvLmt1YmVtcS5zZGsuY29tbWFuZHF1ZXJ5LlJlcXVlc3RDaGFubmVsUGFyYW1ldGVycyBjbGFzcw0KICAgICAqIHdpdGggc2V0IHBhcmFtZXRlcnMNCiAgICAgKg0KICAgICAqIEBwYXJhbSByZXF1ZXN0VHlwZSAgIFJlcHJlc2VudHMgdGhlIHR5cGUgb2YgcmVxdWVzdCBvcGVyYXRpb24gdXNpbmcgUmVxdWVzdFR5cGUuDQogICAgICogQHBhcmFtIGNoYW5uZWxOYW1lICAgUmVwcmVzZW50cyBUaGUgY2hhbm5lbCBuYW1lIHRvIHNlbmQgdG8gdXNpbmcgdGhlIEt1YmVNUQ0KICAgICAqIEBwYXJhbSBjbGllbnRJRCAgICAgIFJlcHJlc2VudHMgdGhlIHNlbmRlciBJRCB0aGF0IHRoZSBtZXNzYWdlcyB3aWxsIGJlIHNlbmQgdW5kZXINCiAgICAgKiBAcGFyYW0gdGltZW91dCAgICAgICBSZXByZXNlbnRzIHRoZSBsaW1pdCBmb3Igd2FpdGluZyBmb3IgcmVzcG9uc2UgKE1pbGxpc2Vjb25kcykNCiAgICAgKiBAcGFyYW0gY2FjaGVLZXkgICAgICBDYWNoZSB0aW1lIHRvIGxpdmUgOiBmb3IgaG93IGxvbmcgZG9lcyB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2F2ZWQgaW4gQ2FjaGUNCiAgICAgKiBAcGFyYW0gY2FjaGVUVEwgICAgICBSZXByZXNlbnRzIFRoZSBhZGRyZXNzIG9mIHRoZSBLdWJlTVEgc2VydmVyDQogICAgICogQHBhcmFtIGt1YmVNUUFkZHJlc3MgUmVwcmVzZW50cyBUaGUgYWRkcmVzcyBvZiB0aGUgS3ViZU1RIHNlcnZlcg0KICAgICAqIEBwYXJhbSBhdXRoVG9rZW4gUmVwcmVzZW50cyBKV1QgdG9rZW4gdG8gYmUgdXNlZCBmb3IgS3ViZU1RIGF1dGhlbnRpY2F0aW9uLg0KICAgICAqLw0KICAgIHB1YmxpYyBDaGFubmVsUGFyYW1ldGVycyhSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZSwgU3RyaW5nIGNoYW5uZWxOYW1lLCBTdHJpbmcgY2xpZW50SUQsIGludCB0aW1lb3V0LCBTdHJpbmcgY2FjaGVLZXksIGludCBjYWNoZVRUTCwgU3RyaW5nIGt1YmVNUUFkZHJlc3MsIFN0cmluZyBhdXRoVG9rZW4pIHsNCiAgICAgICAgdGhpcy5yZXF1ZXN0VHlwZSA9IHJlcXVlc3RUeXBlOw0KICAgICAgICB0aGlzLmNoYW5uZWxOYW1lID0gY2hhbm5lbE5hbWU7DQogICAgICAgIHRoaXMuY2xpZW50SUQgPSBjbGllbnRJRDsNCiAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCiAgICAgICAgdGhpcy5jYWNoZUtleSA9IGNhY2hlS2V5Ow0KICAgICAgICB0aGlzLmNhY2hlVFRMID0gY2FjaGVUVEw7DQogICAgICAgIHRoaXMua3ViZU1RQWRkcmVzcyA9IGt1YmVNUUFkZHJlc3M7DQogICAgICAgIHRoaXMuYXV0aFRva2VuID0gYXV0aFRva2VuOw0KICAgIH0NCg0KICAgIHB1YmxpYyBSZXF1ZXN0VHlwZSBnZXRSZXF1ZXN0VHlwZSgpIHsNCiAgICAgICAgcmV0dXJuIHJlcXVlc3RUeXBlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFJlcXVlc3RUeXBlKFJlcXVlc3RUeXBlIHJlcXVlc3RUeXBlKSB7DQogICAgICAgIHRoaXMucmVxdWVzdFR5cGUgPSByZXF1ZXN0VHlwZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENoYW5uZWxOYW1lKCkgew0KICAgICAgICByZXR1cm4gY2hhbm5lbE5hbWU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2hhbm5lbE5hbWUoU3RyaW5nIGNoYW5uZWxOYW1lKSB7DQogICAgICAgIHRoaXMuY2hhbm5lbE5hbWUgPSBjaGFubmVsTmFtZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENsaWVudElEKCkgew0KICAgICAgICByZXR1cm4gY2xpZW50SUQ7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2xpZW50SUQoU3RyaW5nIGNsaWVudElEKSB7DQogICAgICAgIHRoaXMuY2xpZW50SUQgPSBjbGllbnRJRDsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldFRpbWVvdXQoKSB7DQogICAgICAgIHJldHVybiB0aW1lb3V0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFRpbWVvdXQoaW50IHRpbWVvdXQpIHsNCiAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldENhY2hlS2V5KCkgew0KICAgICAgICByZXR1cm4gY2FjaGVLZXk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVLZXkoU3RyaW5nIGNhY2hlS2V5KSB7DQogICAgICAgIHRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsNCiAgICB9DQoNCiAgICBwdWJsaWMgaW50IGdldENhY2hlVFRMKCkgew0KICAgICAgICByZXR1cm4gY2FjaGVUVEw7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVUVEwoaW50IGNhY2hlVFRMKSB7DQogICAgICAgIHRoaXMuY2FjaGVUVEwgPSBjYWNoZVRUTDsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldEt1YmVNUUFkZHJlc3MoKSB7DQogICAgICAgIHJldHVybiBrdWJlTVFBZGRyZXNzOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEt1YmVNUUFkZHJlc3MoU3RyaW5nIGt1YmVNUUFkZHJlc3MpIHsNCiAgICAgICAgdGhpcy5rdWJlTVFBZGRyZXNzID0ga3ViZU1RQWRkcmVzczsNCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5nIGdldEF1dGhUb2tlbigpew0KICAgICAgICByZXR1cm4gdGhpcy5hdXRoVG9rZW47DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0QXV0aFRva2VuKFN0cmluZyBhdXRoVG9rZW4pew0KICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IGF1dGhUb2tlbjsNCiAgICB9DQogIA0KDQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.309+0300	INFO	request: {"metadata":{"filename":"org.eclipse.buildship.core.prefs","method":"save","path":"java/kubemq-java/examples/.settings"},"data":"Y29ubmVjdGlvbi5wcm9qZWN0LmRpcj0uLg0KZWNsaXBzZS5wcmVmZXJlbmNlcy52ZXJzaW9uPTENCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.319+0300	INFO	request: {"metadata":{"filename":"logback.xml","method":"save","path":"java/kubemq-java/examples/bin/main"},"data":"PGNvbmZpZ3VyYXRpb24+DQogICAgPGFwcGVuZGVyIG5hbWU9IlNURE9VVCIgY2xhc3M9ImNoLnFvcy5sb2diYWNrLmNvcmUuQ29uc29sZUFwcGVuZGVyIj4NCiAgICAgICAgPGVuY29kZXIgY2xhc3M9ImNoLnFvcy5sb2diYWNrLmNsYXNzaWMuZW5jb2Rlci5QYXR0ZXJuTGF5b3V0RW5jb2RlciI+DQogICAgICAgICAgICA8cGF0dGVybj4lZHtISDptbTpzcy5TU1N9IFsldGhyZWFkXSAlLTVsZXZlbCAlbG9nZ2VyezM2fSAtICVtc2clbjwvcGF0dGVybj4NCiAgICAgICAgPC9lbmNvZGVyPg0KICAgIDwvYXBwZW5kZXI+DQogICAgPGxvZ2dlciBuYW1lPSJpby5rdWJlbXEiIGxldmVsPSJUUkFDRSIvPg0KICAgIDxyb290IGxldmVsPSJpbmZvIj4NCiAgICAgICAgPGFwcGVuZGVyLXJlZiByZWY9IlNURE9VVCIvPg0KICAgIDwvcm9vdD4NCjwvY29uZmlndXJhdGlvbj4="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.343+0300	INFO	request: {"metadata":{"filename":".name","method":"save","path":"java/kubemq-java/.idea"},"data":"a3ViZW1xLXNkay1qYXZh"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.376+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/get_Started/pubSub_Subscribe_to_a_Channel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmdldF9TdGFydGVkLnB1YlN1Yl9TdWJzY3JpYmVfdG9fYV9DaGFubmVsOw0KDQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KDQppbXBvcnQgaW8uZ3JwYy5zdHViLlN0cmVhbU9ic2VydmVyOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZXZlbnQuRXZlbnRSZWNlaXZlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZXZlbnQuU3Vic2NyaWJlcjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLnN1YnNjcmlwdGlvbi5TdWJzY3JpYmVSZXF1ZXN0Ow0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuc3Vic2NyaXB0aW9uLlN1YnNjcmliZVR5cGU7DQppbXBvcnQgaW8ua3ViZW1xLnNkay50b29scy5Db252ZXJ0ZXI7DQoNCnB1YmxpYyBjbGFzcyBQcm9ncmFtIHsNCiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBPYmplY3QgbG9jayA9IG5ldyBPYmplY3QoKTsNCiAgDQogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7DQoNCiAgICAgICAgU3RyaW5nIGNoYW5uZWxOYW1lID0gInRlc3RpbmdfZXZlbnRfY2hhbm5lbCIsIGNsaWVudElEID0gImhlbGxvLXdvcmxkLXN1YnNjcmliZXIiLA0KICAgICAgICAgICAgICAgIGt1YmVNUUFkZHJlc3MgPSAibG9jYWxob3N0OjUwMDAwIjsNCiAgICAgICAgU3Vic2NyaWJlciBzdWJzY3JpYmVyID0gbmV3IFN1YnNjcmliZXIoa3ViZU1RQWRkcmVzcyk7DQogICAgICAgIFN1YnNjcmliZVJlcXVlc3Qgc3Vic2NyaWJlUmVxdWVzdCA9IG5ldyBTdWJzY3JpYmVSZXF1ZXN0KCk7DQogICAgICAgIHN1YnNjcmliZVJlcXVlc3Quc2V0Q2hhbm5lbChjaGFubmVsTmFtZSk7DQogICAgICAgIHN1YnNjcmliZVJlcXVlc3Quc2V0Q2xpZW50SUQoY2xpZW50SUQpOw0KICAgICAgICBzdWJzY3JpYmVSZXF1ZXN0LnNldFN1YnNjcmliZVR5cGUoU3Vic2NyaWJlVHlwZS5FdmVudHMpOw0KDQogICAgICAgIFN0cmVhbU9ic2VydmVyPEV2ZW50UmVjZWl2ZT4gc3RyZWFtT2JzZXJ2ZXIgPSBuZXcgU3RyZWFtT2JzZXJ2ZXI8RXZlbnRSZWNlaXZlPigpIHsNCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbk5leHQoRXZlbnRSZWNlaXZlIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIkV2ZW50IFJlY2VpdmVkOiBFdmVudElEOiAlcywgQ2hhbm5lbDogJXMsIE1ldGFkYXRhOiAlcywgQm9keTogJXMiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmdldEV2ZW50SWQoKSwgdmFsdWUuZ2V0Q2hhbm5lbCgpLCB2YWx1ZS5nZXRNZXRhZGF0YSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnRlci5Gcm9tQnl0ZUFycmF5KHZhbHVlLmdldEJvZHkoKSkpOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50ZigiQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbjogJXMiLCBlLmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50ZigiSU9FeGNlcHRpb246ICAlcyIsIGUuZ2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGYoIkV2ZW50IFJlY2VpdmVkIEVycm9yOiAlcyIsIHQuZ2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlZCgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBAT3ZlcnJpZGUNCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uQ29tcGxldGVkKCkgew0KICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAobG9jaykgew0KICAgICAgICAgICAgICAgICAgICBsb2NrLm5vdGlmeSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgU3Vic2NyaWJlKHN1YnNjcmliZXIsIHN1YnNjcmliZVJlcXVlc3QsIHN0cmVhbU9ic2VydmVyKTsNCiAgICAgICAgfSBjYXRjaCAoU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIC8vIFRPRE8gQXV0by1nZW5lcmF0ZWQgY2F0Y2ggYmxvY2sNCiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgIH0NCiAgICAgIA0KICAgIH0NCg0KICAgIA0KDQogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTdWJzY3JpYmUoU3Vic2NyaWJlciBzdWJzY3JpYmVyLFN1YnNjcmliZVJlcXVlc3Qgc3Vic2NyaWJlUmVxdWVzdCwgU3RyZWFtT2JzZXJ2ZXI8RXZlbnRSZWNlaXZlPiBzdHJlYW1PYnNlcnZlcikNCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgU1NMRXhjZXB0aW9uLCBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gew0KICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2spIHsNCiAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLlN1YnNjcmliZVRvRXZlbnRzKHN1YnNjcmliZVJlcXVlc3QsIHN0cmVhbU9ic2VydmVyKTsNCiAgICAgICAgICAgICAgICBsb2NrLndhaXQoKTsNCiAgICAgICAgICAgICAgICBTdWJzY3JpYmUoc3Vic2NyaWJlciwgc3Vic2NyaWJlUmVxdWVzdCwgc3RyZWFtT2JzZXJ2ZXIpOw0KICAgICAgICAgICANCg0KDQogICAgICAgIH0NCiAgICB9DQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.521+0300	INFO	request: {"metadata":{"filename":"Sender.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/event/lowlevel"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV2ZW50Lmxvd2xldmVsOw0KDQoNCmltcG9ydCBpby5rdWJlbXEuc2RrLmJhc2ljLkdycGNDbGllbnQ7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5iYXNpYy5TZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb247DQppbXBvcnQgaW8ua3ViZW1xLnNkay5ldmVudC5SZXN1bHQ7DQppbXBvcnQgaW8ua3ViZW1xLnNkay5ncnBjLkt1YmVtcTsNCmltcG9ydCBpby5ncnBjLnN0dWIuU3RyZWFtT2JzZXJ2ZXI7DQppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsNCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsNCg0KaW1wb3J0IGphdmF4Lm5ldC5zc2wuU1NMRXhjZXB0aW9uOw0KDQovKioNCiAqIFJlcHJlc2VudHMgdGhlIGluc3RhbmNlIHRoYXQgaXMgcmVzcG9uc2libGUgdG8gc2VuZCBtZXNzYWdlcyB0byB0aGUga3ViZW1xLg0KICovDQpwdWJsaWMgY2xhc3MgU2VuZGVyIGV4dGVuZHMgR3JwY0NsaWVudCB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoU2VuZGVyLmNsYXNzKTsgICAgICANCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXcgU2VuZGVyLiBLdWJlTVFBZGRyZXNzIHdpbGwgYmUgcGFyc2VkIGZyb20gQ29uZmlnIG9yDQogICAgICogZW52aXJvbm1lbnQgcGFyYW1ldGVyLg0KICAgICAqIA0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24NCiAgICAgKi8NCiAgICBwdWJsaWMgU2VuZGVyKCkgdGhyb3dzIFNTTEV4Y2VwdGlvbiwgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIHsNCiAgICAgICAgdGhpcyhudWxsLG51bGwpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYSBuZXcgU2VuZGVyIHVuZGVyIHRoZSByZXF1ZXN0ZWQgS3ViZU1RIFNlcnZlciBBZGRyZXNzLg0KICAgICAqDQogICAgICogQHBhcmFtIEt1YmVNUUFkZHJlc3MgS3ViZU1RIHNlcnZlciBhZGRyZXNzLg0KICAgICAqIEBwYXJhbSBhdXRoVG9rZW4gICAgIFNldCBLdWJlTVEgSldUIEF1dGggdG9rZW4gdG8gYmUgdXNlZCBmb3IgS3ViZU1RDQogICAgICogICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi4gICANCiAgICAgKi8NCiAgICBwdWJsaWMgU2VuZGVyKFN0cmluZyBLdWJlTVFBZGRyZXNzLCBTdHJpbmcgYXV0aFRva2VuKSB7DQogICAgICAgIHRoaXMuX2t1YmVtcUFkZHJlc3MgPSBLdWJlTVFBZGRyZXNzOw0KICAgICAgICB0aGlzLmFkZEF1dGhUb2tlbihhdXRoVG9rZW4pOw0KICAgIH0NCg0KICAgIA0KDQogICAgLyoqDQogICAgICogUHVibGlzaCBhIHNpbmdsZSBtZXNzYWdlIHVzaW5nIHRoZSBLdWJlTVEuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbm90aWZpY2F0aW9uIEV2ZW50IHRvIGFkZCB0byB0aGUgcXVldWUNCiAgICAgKiBAcmV0dXJuIGlvLmt1YmVtcS5zZGsuZXZlbnQuTWVzc2FnZURlbGl2ZXJ5UmVwb3J0IHRoYXQgY29udGFpbiBpbmZvIHJlZ2FyZGluZw0KICAgICAqICAgICAgICAgbWVzc2FnZSBzdGF0dXMuDQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLg0KICAgICAqIEB0aHJvd3MgQXV0aG9yaXphdGlvbkV4Y2VwdGlvbiAgICBBdXRob3JpemF0aW9uIEt1YmVNUSB0b2tlbiB0byBiZSB1c2VkIGZvciBLdWJlTVEgY29ubmVjdGlvbi4gDQogICAgICovDQogICAgcHVibGljIFJlc3VsdCBTZW5kRXZlbnQoRXZlbnQgbm90aWZpY2F0aW9uKSB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uLCBTU0xFeGNlcHRpb24gIHsNCiAgICAgICAgS3ViZW1xLkV2ZW50IGV2ZW50ID0gbm90aWZpY2F0aW9uLlRvSW5uZXJFdmVudCgpOw0KICAgICAgIA0KICAgICAgICAgICAgS3ViZW1xLlJlc3VsdCBpbm5lclJlc3VsdCA9IEdldEt1YmVNUUNsaWVudCgpLnNlbmRFdmVudChldmVudCk7DQogICAgICAgIGlmIChpbm5lclJlc3VsdCA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQoaW5uZXJSZXN1bHQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFB1Ymxpc2ggYSBzaW5nbGUgbWVzc2FnZSB1c2luZyB0aGUgS3ViZU1RIHdpdGhvdXQgd2FpdGluZyBmb3IgcmVzcG9uc2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbm90aWZpY2F0aW9uIEV2ZW50IHRvIGFkZCB0byB0aGUgcXVldWUNCiAgICAgKiBAdGhyb3dzIFNlcnZlckFkZHJlc3NOb3RTdXBwbGllZEV4Y2VwdGlvbiBLdWJlTVEgc2VydmVyIGFkZHJlc3MgY2FuIG5vdCBiZSBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3IgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbS4gICANCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBTdHJlYW1FdmVudFdpdGhvdXRSZXNwb25zZShFdmVudCBub3RpZmljYXRpb24pIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbnsNCiAgICAgICAgbm90aWZpY2F0aW9uLnNldFJldHVyblJlc3VsdChmYWxzZSk7ICAgICAgICANCiAgICAgICAgR2V0S3ViZU1RQXN5bmNDbGllbnQoKS5zZW5kRXZlbnRzU3RyZWFtKG51bGwpLm9uTmV4dChub3RpZmljYXRpb24uVG9Jbm5lckV2ZW50KCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFB1Ymxpc2ggYSBjb25zdGFudCBzdHJlYW0gb2YgbWVzc2FnZXMuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbWVzc2FnZURlbGl2ZXJ5UmVwb3J0U3RyZWFtT2JzZXJ2ZXIgT2JzZXJ2ZXIgZm9yIERlbGl2ZXJ5IFJlcG9ydHMuDQogICAgICogQHJldHVybiBTdHJlYW1PYnNlcnZlciB1c2VkIHRvIHN0cmVhbSBtZXNzYWdlcw0KICAgICAqIEB0aHJvd3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIEt1YmVNUSBzZXJ2ZXIgYWRkcmVzcyBjYW4gbm90IGJlIGRldGVybWluZWQuDQogICAgICogQHRocm93cyBTU0xFeGNlcHRpb24gICAgICAgICAgICAgICAgICAgICAgSW5kaWNhdGVzIHNvbWUga2luZCBvZiBlcnJvciBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLiAgICANCiAgICAgKi8NCiAgICBwdWJsaWMgU3RyZWFtT2JzZXJ2ZXI8RXZlbnQ+IFN0cmVhbUV2ZW50KGZpbmFsIFN0cmVhbU9ic2VydmVyPFJlc3VsdD4gbWVzc2FnZURlbGl2ZXJ5UmVwb3J0U3RyZWFtT2JzZXJ2ZXIpIHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24sIFNTTEV4Y2VwdGlvbiAgew0KICAgICAgICBTdHJlYW1PYnNlcnZlcjxLdWJlbXEuRXZlbnQ+IHN0cmVhbU9ic2VydmVyID0gR2V0S3ViZU1RQXN5bmNDbGllbnQoKS5zZW5kRXZlbnRzU3RyZWFtKG5ldyBTdHJlYW1PYnNlcnZlcjxLdWJlbXEuUmVzdWx0PigpIHsNCiAgICAgICAgICAgIEBPdmVycmlkZQ0KICAgICAgICAgICAgcHVibGljIHZvaWQgb25OZXh0KEt1YmVtcS5SZXN1bHQgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICBMb2dSZXNwb25zZSh2YWx1ZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IEt1YmVNUS5HcnBjLk1lc3NhZ2VEZWxpdmVyeVJlcG9ydCB0byBvdXRlciBSZXBvcnQNCiAgICAgICAgICAgICAgICBSZXN1bHQgcmVzdWx0ID0gbmV3IFJlc3VsdCh2YWx1ZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBBY3RpdmF0ZSBlbmQtdXNlciBEZWxpdmVyeSBSZXBvcnQgRGVsZWdhdGUNCiAgICAgICAgICAgICAgICBtZXNzYWdlRGVsaXZlcnlSZXBvcnRTdHJlYW1PYnNlcnZlci5vbk5leHQocmVzdWx0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHQuZ2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICAgICBtZXNzYWdlRGVsaXZlcnlSZXBvcnRTdHJlYW1PYnNlcnZlci5vbkVycm9yKHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBAT3ZlcnJpZGUNCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uQ29tcGxldGVkKCkgew0KICAgICAgICAgICAgICAgIGxvZ2dlci50cmFjZSgiU3RyZWFtTWVzc2FnZVdpdGhvdXREZWxpdmVyeVJlcG9ydCBjb21wbGV0ZWQuIik7DQogICAgICAgICAgICAgICAgbWVzc2FnZURlbGl2ZXJ5UmVwb3J0U3RyZWFtT2JzZXJ2ZXIub25Db21wbGV0ZWQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBTdHJlYW1PYnNlcnZlcjxFdmVudD4oKSB7DQogICAgICAgICAgICBAT3ZlcnJpZGUNCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uTmV4dChFdmVudCBub3RpZmljYXRpb24pIHsNCiAgICAgICAgICAgICAgIC8vIGlmIChub3RpZmljYXRpb24uaXNSZXR1cm5SZXN1bHQoKSkgew0KICAgICAgICAgICAgICAgICAgICBzdHJlYW1PYnNlcnZlci5vbk5leHQobm90aWZpY2F0aW9uLlRvSW5uZXJFdmVudCgpKTsNCiAgICAgICAgICAgICAgLy8gIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkVycm9yKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAgc3RyZWFtT2JzZXJ2ZXIub25FcnJvcih0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgQE92ZXJyaWRlDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkNvbXBsZXRlZCgpIHsNCiAgICAgICAgICAgICAgICBzdHJlYW1PYnNlcnZlci5vbkNvbXBsZXRlZCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBMb2dSZXNwb25zZShLdWJlbXEuUmVzdWx0IHJlc3BvbnNlKSB7DQogICAgICAgIGxvZ2dlci5pbmZvKA0KICAgICAgICAgICAgICAgICJTZW5kZXIgcmVjZWl2ZWQgJ0RlbGl2ZXJ5IFJlcG9ydCc6IEV2ZW50SUQ6J3t9JywgU2VudDogJ3t9JywgRXJyb3I6J3t9JyIsDQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZ2V0RXZlbnRJRCgpLA0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmdldFNlbnQoKSwNCiAgICAgICAgICAgICAgICByZXNwb25zZS5nZXRFcnJvcigpDQogICAgICAgICk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGluZyBjaGVjayBLdWJlbXEgcmVzcG9uc2UuDQogICAgICogDQogICAgICogQHJldHVybiBQaW5nUmVzdWx0DQogICAgICogQHRocm93cyBTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gS3ViZU1RIHNlcnZlciBhZGRyZXNzIGNhbiBub3QgYmUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkLg0KICAgICAqIEB0aHJvd3MgU1NMRXhjZXB0aW9uICAgICAgICAgICAgICAgICAgICAgIEluZGljYXRlcyBzb21lIGtpbmQgb2YgZXJyb3INCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZCBieSBhbiBTU0wgc3Vic3lzdGVtLiAgICAgDQogICAgICovDQoJcHVibGljIGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuUGluZ1Jlc3VsdCBQaW5nKCkgdGhyb3dzIFNTTEV4Y2VwdGlvbiwgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIHsNCgkJcmV0dXJuIEdldEt1YmVNUUNsaWVudCgpLnBpbmcobnVsbCk7DQoJfQ0KfQ0K"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.785+0300	INFO	request: {"metadata":{"filename":"Program.java","method":"save","path":"java/kubemq-java/examples/src/main/java/io/kubemq/sdk/examples/commandqueryresponder"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmV4YW1wbGVzLmNvbW1hbmRxdWVyeXJlc3BvbmRlcjsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuYmFzaWMuU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uOw0KDQppbXBvcnQgamF2YXgubmV0LnNzbC5TU0xFeGNlcHRpb247DQppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsNCg0KcHVibGljIGNsYXNzIFByb2dyYW0gew0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpICB7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOw0KICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlN0YXJ0aW5nIFJlcVJlcFJlc3BvbmRlci4uLiIpOw0KICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oKTsNCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQcmVzcyAnRW50ZXInIHRvIHN0b3AgdGhlIGFwcGxpY2F0aW9uLi4uIik7DQogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBuZXcgQ29tbWFuZFF1ZXJ5UmVzcG9uZGVyKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGNhdGNoIChTZXJ2ZXJBZGRyZXNzTm90U3VwcGxpZWRFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogQ2FuIG5vdCBkZXRlcm1pbmUgS3ViZU1RIHNlcnZlciBhZGRyZXNzLiIpOw0KICAgICAgICB9IGNhdGNoIChTU0xFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogZXJyb3IgZGV0ZWN0ZWQgYnkgYW4gU1NMIHN1YnN5c3RlbSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGludCByZWFkID0gU3lzdGVtLmluLnJlYWQoKTsNCiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvcjogIEkvTyBlcnJvciBvY2N1cnJlZC4iKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.787+0300	INFO	request: {"metadata":{"filename":"packed-refs","method":"save","path":"java/kubemq-java/.git"},"data":"IyBwYWNrLXJlZnMgd2l0aDogcGVlbGVkIGZ1bGx5LXBlZWxlZCBzb3J0ZWQgCjRkNDE3MGU0MTVjMzFlNGM0ZjAyODRlNWE2ZWMyOTA3Mjc1OWIzYjYgcmVmcy9yZW1vdGVzL29yaWdpbi9GaXhUcmFuc2FjdGlvbgo0MjllNWUyODMzNDg0MzkwMDJkZjAxNTRmNDIxZDExZjVlMTk0YzBkIHJlZnMvcmVtb3Rlcy9vcmlnaW4vbWFzdGVyCjM5MzllNmY2OTI0ZWVlZTE1YTUwYTFlZmM5ZjRkMjY2MDM4MTRiMjAgcmVmcy9yZW1vdGVzL29yaWdpbi92Mgo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.807+0300	INFO	request: {"metadata":{"filename":"prepare-commit-msg.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCiMKIyBBbiBleGFtcGxlIGhvb2sgc2NyaXB0IHRvIHByZXBhcmUgdGhlIGNvbW1pdCBsb2cgbWVzc2FnZS4KIyBDYWxsZWQgYnkgImdpdCBjb21taXQiIHdpdGggdGhlIG5hbWUgb2YgdGhlIGZpbGUgdGhhdCBoYXMgdGhlCiMgY29tbWl0IG1lc3NhZ2UsIGZvbGxvd2VkIGJ5IHRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgY29tbWl0CiMgbWVzc2FnZSdzIHNvdXJjZS4gIFRoZSBob29rJ3MgcHVycG9zZSBpcyB0byBlZGl0IHRoZSBjb21taXQKIyBtZXNzYWdlIGZpbGUuICBJZiB0aGUgaG9vayBmYWlscyB3aXRoIGEgbm9uLXplcm8gc3RhdHVzLAojIHRoZSBjb21taXQgaXMgYWJvcnRlZC4KIwojIFRvIGVuYWJsZSB0aGlzIGhvb2ssIHJlbmFtZSB0aGlzIGZpbGUgdG8gInByZXBhcmUtY29tbWl0LW1zZyIuCgojIFRoaXMgaG9vayBpbmNsdWRlcyB0aHJlZSBleGFtcGxlcy4gVGhlIGZpcnN0IG9uZSByZW1vdmVzIHRoZQojICIjIFBsZWFzZSBlbnRlciB0aGUgY29tbWl0IG1lc3NhZ2UuLi4iIGhlbHAgbWVzc2FnZS4KIwojIFRoZSBzZWNvbmQgaW5jbHVkZXMgdGhlIG91dHB1dCBvZiAiZ2l0IGRpZmYgLS1uYW1lLXN0YXR1cyAtciIKIyBpbnRvIHRoZSBtZXNzYWdlLCBqdXN0IGJlZm9yZSB0aGUgImdpdCBzdGF0dXMiIG91dHB1dC4gIEl0IGlzCiMgY29tbWVudGVkIGJlY2F1c2UgaXQgZG9lc24ndCBjb3BlIHdpdGggLS1hbWVuZCBvciB3aXRoIHNxdWFzaGVkCiMgY29tbWl0cy4KIwojIFRoZSB0aGlyZCBleGFtcGxlIGFkZHMgYSBTaWduZWQtb2ZmLWJ5IGxpbmUgdG8gdGhlIG1lc3NhZ2UsIHRoYXQgY2FuCiMgc3RpbGwgYmUgZWRpdGVkLiAgVGhpcyBpcyByYXJlbHkgYSBnb29kIGlkZWEuCgpDT01NSVRfTVNHX0ZJTEU9JDEKQ09NTUlUX1NPVVJDRT0kMgpTSEExPSQzCgovdXNyL2Jpbi9wZXJsIC1pLmJhayAtbmUgJ3ByaW50IHVubGVzcyhtL14uIFBsZWFzZSBlbnRlciB0aGUgY29tbWl0IG1lc3NhZ2UvLi5tL14jJC8pJyAiJENPTU1JVF9NU0dfRklMRSIKCiMgY2FzZSAiJENPTU1JVF9TT1VSQ0UsJFNIQTEiIGluCiMgICx8dGVtcGxhdGUsKQojICAgIC91c3IvYmluL3BlcmwgLWkuYmFrIC1wZSAnCiMgICAgICAgcHJpbnQgIlxuIiAuIGBnaXQgZGlmZiAtLWNhY2hlZCAtLW5hbWUtc3RhdHVzIC1yYAojIAkgaWYgL14jLyAmJiAkZmlyc3QrKyA9PSAwJyAiJENPTU1JVF9NU0dfRklMRSIgOzsKIyAgKikgOzsKIyBlc2FjCgojIFNPQj0kKGdpdCB2YXIgR0lUX0NPTU1JVFRFUl9JREVOVCB8IHNlZCAtbiAncy9eXCguKj5cKS4qJC9TaWduZWQtb2ZmLWJ5OiBcMS9wJykKIyBnaXQgaW50ZXJwcmV0LXRyYWlsZXJzIC0taW4tcGxhY2UgLS10cmFpbGVyICIkU09CIiAiJENPTU1JVF9NU0dfRklMRSIKIyBpZiB0ZXN0IC16ICIkQ09NTUlUX1NPVVJDRSIKIyB0aGVuCiMgICAvdXNyL2Jpbi9wZXJsIC1pLmJhayAtcGUgJ3ByaW50ICJcbiIgaWYgISRmaXJzdF9saW5lKysnICIkQ09NTUlUX01TR19GSUxFIgojIGZpCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.838+0300	INFO	request: {"metadata":{"filename":"HEAD","method":"save","path":"java/kubemq-java/.git/logs/refs/remotes/origin"},"data":"MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCA0MjllNWUyODMzNDg0MzkwMDJkZjAxNTRmNDIxZDExZjVlMTk0YzBkIGt1YmVtcSA8bGlvci5uYWJhdEBrdWJlbXEuaW8+IDE2MTgzODUyNjkgKzAzMDAJY2xvbmU6IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2t1YmVtcS1pby9rdWJlbXEtSmF2YS5naXQK"}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:14.989+0300	INFO	request: {"metadata":{"filename":"kubemq.proto","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/proto"},"data":"c3ludGF4ID0gInByb3RvMyI7DQpvcHRpb24gamF2YV9wYWNrYWdlID0gImlvLmt1YmVtcS5zZGsuZ3JwYyI7DQpvcHRpb24gamF2YV9vdXRlcl9jbGFzc25hbWUgPSAiS3ViZW1xIjsNCnBhY2thZ2Uga3ViZW1xOw0Kc2VydmljZSBrdWJlbXEgew0KICAgIHJwYyBTZW5kRXZlbnQgKEV2ZW50KSByZXR1cm5zIChSZXN1bHQpIHt9DQogICAgcnBjIFNlbmRFdmVudHNTdHJlYW0gKHN0cmVhbSBFdmVudCkgcmV0dXJucyAoc3RyZWFtIFJlc3VsdCkge30NCiAgICBycGMgU3Vic2NyaWJlVG9FdmVudHMgKFN1YnNjcmliZSkgcmV0dXJucyAoc3RyZWFtIEV2ZW50UmVjZWl2ZSkge30NCiAgICBycGMgU3Vic2NyaWJlVG9SZXF1ZXN0cyAoU3Vic2NyaWJlKSByZXR1cm5zIChzdHJlYW0gUmVxdWVzdCkge30NCiAgICBycGMgU2VuZFJlcXVlc3QgKFJlcXVlc3QpIHJldHVybnMgKFJlc3BvbnNlKSB7fQ0KICAgIHJwYyBTZW5kUmVzcG9uc2UoUmVzcG9uc2UpIHJldHVybnMgKEVtcHR5KSB7fQ0KICAgIHJwYyBTZW5kUXVldWVNZXNzYWdlKFF1ZXVlTWVzc2FnZSkgcmV0dXJucyAoU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCkge30NCiAgICBycGMgU2VuZFF1ZXVlTWVzc2FnZXNCYXRjaChRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXF1ZXN0KSByZXR1cm5zIChRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSkge30NCiAgICBycGMgUmVjZWl2ZVF1ZXVlTWVzc2FnZXMoUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSByZXR1cm5zIChSZWNlaXZlUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSB7fQ0KICAgIHJwYyBTdHJlYW1RdWV1ZU1lc3NhZ2Uoc3RyZWFtIFN0cmVhbVF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSByZXR1cm5zIChzdHJlYW0gU3RyZWFtUXVldWVNZXNzYWdlc1Jlc3BvbnNlKSB7fQ0KICAgIHJwYyBBY2tBbGxRdWV1ZU1lc3NhZ2VzKEFja0FsbFF1ZXVlTWVzc2FnZXNSZXF1ZXN0KSByZXR1cm5zIChBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2UpIHt9DQogICAgcnBjIFBpbmcgKEVtcHR5KSByZXR1cm5zIChQaW5nUmVzdWx0KSB7fQ0KfQ0KbWVzc2FnZSBQaW5nUmVzdWx0IHsNCiAgICBzdHJpbmcgIEhvc3QgICAgICAgID0xOw0KICAgIHN0cmluZyBWZXJzaW9uICAgICAgPTI7DQogICAgaW50NjQgIFNlcnZlclN0YXJ0VGltZSAgID0zOw0KICAgIGludDY0ICBTZXJ2ZXJVcFRpbWVTZWNvbmRzID00Ow0KfQ0KbWVzc2FnZSBFbXB0eSB7fQ0KDQptZXNzYWdlIFJlc3VsdCB7DQogICAgc3RyaW5nICBFdmVudElEICAgICA9MTsNCiAgICBib29sICAgIFNlbnQgICAgICAgID0yOw0KICAgIHN0cmluZyAgRXJyb3IgICAgICAgPTM7DQp9DQoNCm1lc3NhZ2UgRXZlbnQgew0KICAgIHN0cmluZyAgRXZlbnRJRCAgICAgICAgICAgICA9MTsNCiAgICBzdHJpbmcgIENsaWVudElEICAgICAgICAgICAgPTI7DQogICAgc3RyaW5nICBDaGFubmVsICAgICAgICAgICAgID0zOw0KICAgIHN0cmluZyAgTWV0YWRhdGEgICAgICAgICAgICA9NDsNCiAgICBieXRlcyAgIEJvZHkgICAgICAgICAgICAgICAgPTU7DQogICAgYm9vbCAgICBTdG9yZSAgICAgICAgICAgICAgID02Ow0KICAgIG1hcDxzdHJpbmcsc3RyaW5nPiAgVGFncyAgICA9NzsNCn0NCg0KbWVzc2FnZSBFdmVudFJlY2VpdmUgew0KICAgIHN0cmluZyAgRXZlbnRJRCAgICAgICAgICAgICA9MTsNCiAgICBzdHJpbmcgIENoYW5uZWwgICAgICAgICAgICAgPTI7DQogICAgc3RyaW5nICBNZXRhZGF0YSAgICAgICAgICAgID0zOw0KICAgIGJ5dGVzICAgQm9keSAgICAgICAgICAgICAgICA9NDsNCiAgICBpbnQ2NCAgIFRpbWVzdGFtcCAgICAgICAgICAgPTU7DQogICAgdWludDY0ICBTZXF1ZW5jZSAgICAgICAgICAgID02Ow0KICAgIG1hcDxzdHJpbmcsc3RyaW5nPiAgVGFncyAgICA9NzsNCn0NCg0KbWVzc2FnZSBTdWJzY3JpYmUgew0KICAgIGVudW0gU3Vic2NyaWJlVHlwZSB7DQogICAgICAgIFN1YnNjcmliZVR5cGVVbmRlZmluZWQgPSAwOw0KICAgICAgICBFdmVudHMgICAgICAgICAgICAgICAgICA9MTsNCiAgICAgICAgRXZlbnRzU3RvcmUgICAgICAgICAgICAgPTI7DQogICAgICAgIENvbW1hbmRzICAgICAgICAgICAgICAgID0zOw0KICAgICAgICBRdWVyaWVzICAgICAgICAgICAgICAgICA9NDsNCg0KICAgIH0NCiAgICBTdWJzY3JpYmVUeXBlIFN1YnNjcmliZVR5cGVEYXRhICAgICAgICAgPTE7DQogICAgc3RyaW5nIENsaWVudElEICAgICAgICAgICAgICAgICAgICAgICAgID0yOw0KICAgIHN0cmluZyBDaGFubmVsICAgICAgICAgICAgICAgICAgICAgICAgICA9MzsNCiAgICBzdHJpbmcgR3JvdXAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPTQ7DQogICAgZW51bSBFdmVudHNTdG9yZVR5cGUgew0KICAgICAgICBFdmVudHNTdG9yZVR5cGVVbmRlZmluZWQgICAgPTA7DQogICAgICAgIFN0YXJ0TmV3T25seSAgICAgICAgICAgICAgICA9MTsNCiAgICAgICAgU3RhcnRGcm9tRmlyc3QgICAgICAgICAgICAgID0yOw0KICAgICAgICBTdGFydEZyb21MYXN0ICAgICAgICAgICAgICAgPTM7DQogICAgICAgIFN0YXJ0QXRTZXF1ZW5jZSAgICAgICAgICAgICA9NDsNCiAgICAgICAgU3RhcnRBdFRpbWUgICAgICAgICAgICAgICAgID01Ow0KICAgICAgICBTdGFydEF0VGltZURlbHRhICAgICAgICAgICAgPTY7DQogICAgfQ0KICAgIEV2ZW50c1N0b3JlVHlwZSBFdmVudHNTdG9yZVR5cGVEYXRhICAgICA9NTsNCiAgICBpbnQ2NCBFdmVudHNTdG9yZVR5cGVWYWx1ZSAgICAgICAgICAgICAgPTY7DQp9DQoNCm1lc3NhZ2UgUmVxdWVzdCB7DQogICAgc3RyaW5nICBSZXF1ZXN0SUQgICAgICAgICAgICA9MTsNCiAgICBlbnVtIFJlcXVlc3RUeXBlIHsNCiAgICAgICAgUmVxdWVzdFR5cGVVbmtub3duICAgICAgPTA7DQogICAgICAgIENvbW1hbmQgICAgICAgICAgICAgICAgID0xOw0KICAgICAgICBRdWVyeSAgICAgICAgICAgICAgICAgICA9MjsNCiAgICB9DQogICAgUmVxdWVzdFR5cGUgUmVxdWVzdFR5cGVEYXRhID0yOw0KICAgIHN0cmluZyAgQ2xpZW50SUQgICAgICAgICAgICA9MzsNCiAgICBzdHJpbmcgIENoYW5uZWwgICAgICAgICAgICAgPTQ7DQogICAgc3RyaW5nICBNZXRhZGF0YSAgICAgICAgICAgID01Ow0KICAgIGJ5dGVzICAgQm9keSAgICAgICAgICAgICAgICA9NjsNCiAgICBzdHJpbmcgIFJlcGx5Q2hhbm5lbCAgICAgICAgPTc7DQogICAgaW50MzIgICBUaW1lb3V0ICAgICAgICAgICAgID04Ow0KICAgIHN0cmluZyAgQ2FjaGVLZXkgICAgICAgICAgICA9OTsNCiAgICBpbnQzMiAgIENhY2hlVFRMICAgICAgICAgICAgPTEwOw0KICAgIGJ5dGVzICAgU3BhbiAgICAgICAgICAgICAgICA9MTE7DQogICAgbWFwPHN0cmluZyxzdHJpbmc+ICBUYWdzICAgICAgICAgICAgID0xMjsNCiB9DQptZXNzYWdlIFJlc3BvbnNlIHsNCiAgICBzdHJpbmcgIENsaWVudElEICAgICAgICA9MTsNCiAgICBzdHJpbmcgIFJlcXVlc3RJRCAgICAgICA9MjsNCiAgICBzdHJpbmcgIFJlcGx5Q2hhbm5lbCAgICA9MzsNCiAgICBzdHJpbmcgIE1ldGFkYXRhICAgICAgICA9NDsNCiAgICBieXRlcyAgIEJvZHkgICAgICAgICAgICA9NTsNCiAgICBib29sICAgIENhY2hlSGl0ICAgICAgICA9NjsNCiAgICBpbnQ2NCAgIFRpbWVzdGFtcCAgICAgICA9NzsNCiAgICBib29sICAgIEV4ZWN1dGVkICAgICAgICA9ODsNCiAgICBzdHJpbmcgIEVycm9yICAgICAgICAgICA9OTsNCiAgICBieXRlcyAgIFNwYW4gICAgICAgICAgICA9MTA7DQogICAgbWFwPHN0cmluZyxzdHJpbmc+ICBUYWdzICA9MTE7DQp9DQoNCm1lc3NhZ2UgUXVldWVNZXNzYWdlIHsNCiAgICBzdHJpbmcgIE1lc3NhZ2VJRCAgICAgICAgPTE7DQogICAgc3RyaW5nICBDbGllbnRJRCAgICAgICAgID0yOw0KICAgIHN0cmluZyAgQ2hhbm5lbCAgICAgICAgPTM7DQogICAgc3RyaW5nICBNZXRhZGF0YSAgICAgICAgID00Ow0KICAgIGJ5dGVzICAgQm9keSAgICAgICAgICAgICA9NTsNCiAgICBtYXA8c3RyaW5nLHN0cmluZz4gIFRhZ3MgICAgICAgICAgICAgPTY7DQogICAgUXVldWVNZXNzYWdlQXR0cmlidXRlcyBBdHRyaWJ1dGVzICAgID03Ow0KICAgIFF1ZXVlTWVzc2FnZVBvbGljeSBQb2xpY3kgICAgICAgICAgICA9ODsNCn0NCm1lc3NhZ2UgUXVldWVNZXNzYWdlc0JhdGNoUmVxdWVzdCB7DQogICAgc3RyaW5nICAgICAgQmF0Y2hJRCAgICAgICAgICAgICAgICAgPTE7DQogICAgcmVwZWF0ZWQgICAgUXVldWVNZXNzYWdlIE1lc3NhZ2VzICAgPTI7DQp9DQptZXNzYWdlIFF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlIHsNCiAgICBzdHJpbmcgICAgICBCYXRjaElEICAgICAgICAgICAgICAgICAgICAgICAgID0xOw0KICAgIHJlcGVhdGVkICAgIFNlbmRRdWV1ZU1lc3NhZ2VSZXN1bHQgUmVzdWx0cyAgPTI7DQogICAgYm9vbCAgICAgICAgSGF2ZUVycm9ycyAgICAgICAgICAgICAgICAgICAgICA9MzsNCn0NCg0KbWVzc2FnZSBRdWV1ZU1lc3NhZ2VBdHRyaWJ1dGVzIHsNCiAgICBpbnQ2NCAgICAgICAgICAgICAgIFRpbWVzdGFtcCAgICAgICAgICAgICAgICAgICA9MTsNCiAgICB1aW50NjQgICAgICAgICAgICAgIFNlcXVlbmNlICAgICAgICAgICAgICAgICAgICA9MjsNCiAgICBzdHJpbmcgICAgICAgICAgICAgIE1ENU9mQm9keSAgICAgICAgICAgICAgICAgICA9MzsNCiAgICBpbnQzMiAgICAgICAgICAgICAgIFJlY2VpdmVDb3VudCAgICAgICAgICAgICAgICA9NDsNCiAgICBib29sICAgICAgICAgICAgICAgIFJlUm91dGVkICAgICAgICAgICAgICAgICAgICA9NTsNCiAgICBzdHJpbmcgICAgICAgICAgICAgIFJlUm91dGVkRnJvbVF1ZXVlICAgICAgICAgICA9NjsNCiAgICBpbnQ2NCAgICAgICAgICAgICAgIEV4cGlyYXRpb25BdCAgICAgICAgICAgICAgICA9NzsNCiAgICBpbnQ2NCAgICAgICAgICAgICAgIERlbGF5ZWRUbyAgICAgICAgICAgICAgICAgICA9ODsNCg0KfQ0KDQptZXNzYWdlIFF1ZXVlTWVzc2FnZVBvbGljeSB7DQogICAgaW50MzIgICAgICAgICAgICAgICBFeHBpcmF0aW9uU2Vjb25kcyAgICAgICAgICAgPTE7DQogICAgaW50MzIgICAgICAgICAgICAgICBEZWxheVNlY29uZHMgICAgICAgICAgICAgICAgPTI7DQogICAgaW50MzIgICAgICAgICAgICAgICBNYXhSZWNlaXZlQ291bnQgICAgICAgICAgICAgPTM7DQogICAgc3RyaW5nICAgICAgICAgICAgICBNYXhSZWNlaXZlUXVldWUgICAgICAgICAgICAgPTQ7DQoNCn0NCm1lc3NhZ2UgU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdCB7DQogICAgc3RyaW5nICBNZXNzYWdlSUQgICAgICAgPTE7DQogICAgaW50NjQgICBTZW50QXQgICAgICAgICAgPTI7DQogICAgaW50NjQgICBFeHBpcmF0aW9uQXQgICAgPTM7DQogICAgaW50NjQgICBEZWxheWVkVG8gICAgICAgPTQ7DQogICAgYm9vbCAgICBJc0Vycm9yICAgICAgICAgPTU7DQogICAgc3RyaW5nICBFcnJvciAgICAgICAgICAgPTY7DQp9DQoNCm1lc3NhZ2UgUmVjZWl2ZVF1ZXVlTWVzc2FnZXNSZXF1ZXN0IHsNCiAgICBzdHJpbmcgUmVxdWVzdElEICAgICAgICAgICAgICAgID0xOw0KICAgIHN0cmluZyAgQ2xpZW50SUQgICAgICAgICAgICAgICAgPTI7DQogICAgc3RyaW5nICBDaGFubmVsICAgICAgICAgICAgICAgPTM7DQogICAgaW50MzIgICBNYXhOdW1iZXJPZk1lc3NhZ2VzICAgICA9NDsNCiAgICBpbnQzMiAgIFdhaXRUaW1lU2Vjb25kcyAgICAgICAgID01Ow0KICAgIGJvb2wgICAgSXNQZWFrICAgICAgICAgICAgICAgICAgICAgPTY7DQp9DQptZXNzYWdlIFJlY2VpdmVRdWV1ZU1lc3NhZ2VzUmVzcG9uc2Ugew0KICAgIHN0cmluZyAgIFJlcXVlc3RJRCAgICAgICAgICAgICAgICAgID0xOw0KICAgIHJlcGVhdGVkIFF1ZXVlTWVzc2FnZSAgIE1lc3NhZ2VzICAgID0yOw0KICAgIGludDMyICAgIE1lc3NhZ2VzUmVjZWl2ZWQgICAgICAgICAgICA9MzsNCiAgICBpbnQzMiAgICBNZXNzYWdlc0V4cGlyZWQgICAgICAgICAgICAgPTQ7DQogICAgYm9vbCAgICAgSXNQZWFrICAgICAgICAgICAgICAgICAgICAgICAgID01Ow0KICAgIGJvb2wgICAgIElzRXJyb3IgICAgICAgICAgICAgICAgICAgICA9NjsNCiAgICBzdHJpbmcgICBFcnJvciAgICAgICAgICAgICAgICAgICAgICAgPTc7DQp9DQoNCg0KbWVzc2FnZSBBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVxdWVzdCB7DQogICAgc3RyaW5nIFJlcXVlc3RJRCAgICAgICAgICAgICAgICAgPTE7DQogICAgc3RyaW5nICBDbGllbnRJRCAgICAgICAgICAgICAgICAgPTI7DQogICAgc3RyaW5nIENoYW5uZWwgICAgICAgICAgICAgICAgICAgPTM7DQogICAgaW50MzIgV2FpdFRpbWVTZWNvbmRzICAgICAgICAgICAgICAgID00Ow0KfQ0KbWVzc2FnZSBBY2tBbGxRdWV1ZU1lc3NhZ2VzUmVzcG9uc2Ugew0KICAgIHN0cmluZyBSZXF1ZXN0SUQgICAgICAgICAgICAgICAgPTE7DQogICAgdWludDY0IEFmZmVjdGVkTWVzc2FnZXMgICAgICAgICA9MjsNCiAgICBib29sICAgIElzRXJyb3IgICAgICAgICAgICAgICAgID0zOw0KICAgIHN0cmluZyAgRXJyb3IgICAgICAgICAgICAgICAgICAgPTQ7DQp9DQoNCmVudW0gU3RyZWFtUmVxdWVzdFR5cGUgew0KICAgIFN0cmVhbVJlcXVlc3RUeXBlVW5rbm93biAgICAgID0wOw0KICAgIFJlY2VpdmVNZXNzYWdlICAgICAgICAgPTE7DQogICAgQWNrTWVzc2FnZSAgICAgICAgICAgICA9MjsNCiAgICBSZWplY3RNZXNzYWdlICAgICAgICAgID0zOw0KICAgIE1vZGlmeVZpc2liaWxpdHkgICAgICAgPTQ7DQogICAgUmVzZW5kTWVzc2FnZSAgICAgICAgICA9NTsNCiAgICBTZW5kTW9kaWZpZWRNZXNzYWdlICAgID02Ow0KfQ0KbWVzc2FnZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVxdWVzdCB7DQogICAgc3RyaW5nIFJlcXVlc3RJRCAgICAgICAgICAgICAgICA9MTsNCiAgICBzdHJpbmcgQ2xpZW50SUQgICAgICAgICAgICAgICAgID0yOw0KICAgIFN0cmVhbVJlcXVlc3RUeXBlIFN0cmVhbVJlcXVlc3RUeXBlRGF0YSAgID0zOw0KICAgIHN0cmluZyBDaGFubmVsICAgICAgICAgICAgICAgICAgPTQ7DQogICAgaW50MzIgVmlzaWJpbGl0eVNlY29uZHMgICAgICAgICA9NTsNCiAgICBpbnQzMiBXYWl0VGltZVNlY29uZHMgICAgICAgICAgICAgICA9NjsNCiAgICB1aW50NjQgUmVmU2VxdWVuY2UgICAgICAgICAgICAgID03Ow0KICAgIFF1ZXVlTWVzc2FnZSBNb2RpZmllZE1lc3NhZ2UgICAgPTg7DQp9DQoNCg0KbWVzc2FnZSBTdHJlYW1RdWV1ZU1lc3NhZ2VzUmVzcG9uc2Ugew0KICAgIHN0cmluZyBSZXF1ZXN0SUQgICAgICAgICAgICAgICAgPTE7DQogICAgU3RyZWFtUmVxdWVzdFR5cGUgU3RyZWFtUmVxdWVzdFR5cGVEYXRhICAgPTI7DQogICAgUXVldWVNZXNzYWdlIE1lc3NhZ2UgICAgICAgICAgICA9MzsNCiAgICBib29sIElzRXJyb3IgICAgICAgICAgICAgICAgICAgID00Ow0KICAgIHN0cmluZyBFcnJvciAgICAgICAgICAgICAgICAgICAgPTU7DQp9DQo="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.265+0300	INFO	request: {"metadata":{"filename":"ServerAddressNotSuppliedException.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/basic"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLmJhc2ljOw0KDQpwdWJsaWMgY2xhc3MgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uIGV4dGVuZHMgRXhjZXB0aW9uIHsNCiAgICAvKioNCiAgICAgKg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDFMOw0KDQogICAgU2VydmVyQWRkcmVzc05vdFN1cHBsaWVkRXhjZXB0aW9uKCkgew0KICAgICAgICBzdXBlcigiU2VydmVyIEFkZHJlc3Mgd2FzIG5vdCBzdXBwbGllZCIpOw0KICAgIH0NCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.268+0300	INFO	request: {"metadata":{"filename":"pre-applypatch.sample","method":"save","path":"java/kubemq-java/.git/hooks"},"data":"IyEvYmluL3NoCiMKIyBBbiBleGFtcGxlIGhvb2sgc2NyaXB0IHRvIHZlcmlmeSB3aGF0IGlzIGFib3V0IHRvIGJlIGNvbW1pdHRlZAojIGJ5IGFwcGx5cGF0Y2ggZnJvbSBhbiBlLW1haWwgbWVzc2FnZS4KIwojIFRoZSBob29rIHNob3VsZCBleGl0IHdpdGggbm9uLXplcm8gc3RhdHVzIGFmdGVyIGlzc3VpbmcgYW4KIyBhcHByb3ByaWF0ZSBtZXNzYWdlIGlmIGl0IHdhbnRzIHRvIHN0b3AgdGhlIGNvbW1pdC4KIwojIFRvIGVuYWJsZSB0aGlzIGhvb2ssIHJlbmFtZSB0aGlzIGZpbGUgdG8gInByZS1hcHBseXBhdGNoIi4KCi4gZ2l0LXNoLXNldHVwCnByZWNvbW1pdD0iJChnaXQgcmV2LXBhcnNlIC0tZ2l0LXBhdGggaG9va3MvcHJlLWNvbW1pdCkiCnRlc3QgLXggIiRwcmVjb21taXQiICYmIGV4ZWMgIiRwcmVjb21taXQiICR7MSsiJEAifQo6Cg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.305+0300	INFO	request: {"metadata":{"filename":"kubemq-java.iml","method":"save","path":"java/kubemq-java/.idea/modules"},"data":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxtb2R1bGUgdHlwZT0iSkFWQV9NT0RVTEUiIHZlcnNpb249IjQiPg0KICA8Y29tcG9uZW50IG5hbWU9Ik5ld01vZHVsZVJvb3RNYW5hZ2VyIiBpbmhlcml0LWNvbXBpbGVyLW91dHB1dD0idHJ1ZSI+DQogICAgPGV4Y2x1ZGUtb3V0cHV0IC8+DQogICAgPGNvbnRlbnQgdXJsPSJmaWxlOi8vJE1PRFVMRV9ESVIkLy4uLy4uIiAvPg0KICAgIDxvcmRlckVudHJ5IHR5cGU9InNvdXJjZUZvbGRlciIgZm9yVGVzdHM9ImZhbHNlIiAvPg0KICA8L2NvbXBvbmVudD4NCjwvbW9kdWxlPg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.305+0300	INFO	request: {"metadata":{"filename":".gitignore","method":"save","path":"java/kubemq-java"},"data":"LmdyYWRsZQ0KDQpidWlsZC8NCiMgQ29tcGlsZWQgY2xhc3MgZmlsZQ0KKi5jbGFzcw0KDQojIExvZyBmaWxlDQoqLmxvZw0KDQojIEJsdWVKIGZpbGVzDQoqLmN0eHQNCg0KIyBNb2JpbGUgVG9vbHMgZm9yIEphdmEgKEoyTUUpDQoubXRqLnRtcC8NCg0KIyBQYWNrYWdlIEZpbGVzICMNCiouamFyDQoqLndhcg0KKi5uYXINCiouZWFyDQoqLnppcA0KKi50YXIuZ3oNCioucmFyDQoNCiMgdmlydHVhbCBtYWNoaW5lIGNyYXNoIGxvZ3MsIHNlZSBodHRwOi8vd3d3LmphdmEuY29tL2VuL2Rvd25sb2FkL2hlbHAvZXJyb3JfaG90c3BvdC54bWwNCmhzX2Vycl9waWQqDQoNCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.748+0300	INFO	request: {"metadata":{"filename":"SendBatchMessageResult.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/queue"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnF1ZXVlOw0KDQppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9ydCBpby5rdWJlbXEuc2RrLmdycGMuS3ViZW1xLlF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlOw0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXEuU2VuZFF1ZXVlTWVzc2FnZVJlc3VsdDsNCg0KLyoqDQogKiBRdWV1ZSByZXF1ZXN0IGJhdGNoIGV4ZWN1dGlvbiByZXN1bHQuDQogKi8NCnB1YmxpYyBjbGFzcyBTZW5kQmF0Y2hNZXNzYWdlUmVzdWx0IHsNCg0KCXByaXZhdGUgUXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgcXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2U7DQoNCiAgICBwcm90ZWN0ZWQgU2VuZEJhdGNoTWVzc2FnZVJlc3VsdChRdWV1ZU1lc3NhZ2VzQmF0Y2hSZXNwb25zZSByZWMpIHsNCiAgICAgICAgcXVldWVNZXNzYWdlc0JhdGNoUmVzcG9uc2UgPXJlYzsNCiAgICB9ICANCiAgICANCiAgICAvKioNCiAgICAgKiBVbmlxdWUgZm9yIFJlcXVlc3QNCiAgICAgKiBAcmV0dXJuIEJhdGNoIElEDQogICAgICovDQogICAgcHVibGljIFN0cmluZyBnZXRCYXRjaElEKCl7DQogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmdldEJhdGNoSUQoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5lZCBpZiBvbmUgb3IgbW9yZSBtZXNzYWdlcyBwcm9jZXNzIGhhcyBlcnJvciwgZmFsc2UgaWYgbm8gZXJyb3IuDQogICAgICogQHJldHVybiBGYWxzZSBpZiBubyBlcnJvci4NCiAgICAgKi8NCiAgICBwdWJsaWMgQm9vbGVhbiBnZXRIYXZlRXJyb3JzKCl7DQogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmdldEhhdmVFcnJvcnMoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb2xsZWN0aW9uIG9mIGJhdGNoIGluZGl2aWR1YWwgZXhlY3V0aW9uIHJlc3VsdC4NCiAgICAgKiBAcmV0dXJuIGV4ZWN1dGlvbiByZXN1bHRzLiANCiAgICAgKi8NCglwdWJsaWMgSXRlcmFibGU8U2VuZE1lc3NhZ2VSZXN1bHQ+IGdldFJlc3VsdHMoKSB7DQogICAgICAgIENvbGxlY3Rpb248U2VuZE1lc3NhZ2VSZXN1bHQ+IGJhdGNoID0gbmV3IEFycmF5TGlzdDxTZW5kTWVzc2FnZVJlc3VsdD4oKTsNCiAgICAgICAgZm9yIChTZW5kUXVldWVNZXNzYWdlUmVzdWx0IHZhciA6ICB0aGlzLnF1ZXVlTWVzc2FnZXNCYXRjaFJlc3BvbnNlLmdldFJlc3VsdHNMaXN0KCkpIHsNCiAgICAgICAgICAgIGJhdGNoLmFkZChuZXcgU2VuZE1lc3NhZ2VSZXN1bHQodmFyKSk7ICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGJhdGNoOyAgICAgICANCgl9DQogICAgDQoNCg0KDQoNCg0KICAgIA0KfQ=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.765+0300	INFO	request: {"metadata":{"filename":"SubscribeRequest.java","method":"save","path":"java/kubemq-java/kubemq-java-sdk/src/main/java/io/kubemq/sdk/subscription"},"data":"LyoNCiAqIE1JVCBMaWNlbnNlDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDE4IEt1YmVNUQ0KICoNCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkNCiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsDQogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzDQogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMNCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsDQogKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SDQogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwNCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQ0KICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUg0KICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwNCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFDQogKiBTT0ZUV0FSRS4NCiAqLw0KcGFja2FnZSBpby5rdWJlbXEuc2RrLnN1YnNjcmlwdGlvbjsNCg0KaW1wb3J0IGlvLmt1YmVtcS5zZGsuZ3JwYy5LdWJlbXE7DQoNCmltcG9ydCBqYXZhLnV0aWwuT3B0aW9uYWw7DQoNCi8qKg0KICogUmVwcmVzZW50cyBhIHNldCBvZiBwYXJhbWV0ZXJzIHdoaWNoIHRoZSBTdWJzY3JpYmVyIHVzZXMgdG8gc3Vic2NyaWJlIHRvIHRoZSBLdWJlTVEuDQogKi8NCnB1YmxpYyBjbGFzcyBTdWJzY3JpYmVSZXF1ZXN0IHsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIHR5cGUgb2YgU3Vic2NyaWJlciBvcGVyYXRpb24uDQogICAgICovDQogICAgcHJpdmF0ZSBTdWJzY3JpYmVUeXBlIHN1YnNjcmliZVR5cGU7DQoNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIGFuIGlkZW50aWZpZXIgdGhhdCB3aWxsIHN1YnNjcmliZSB0byBrdWJlTVEgdW5kZXIuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgY2xpZW50SUQ7DQoNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIHRoZSBjaGFubmVsIG5hbWUgdGhhdCB3aWxsIHN1YnNjcmliZSB0byB1bmRlciBrdWJlTVEuDQogICAgICovDQogICAgcHJpdmF0ZSBTdHJpbmcgY2hhbm5lbDsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIGdyb3VwIHRoZSBjaGFubmVsIGlzIGFzc2lnbiB0by4NCiAgICAgKi8NCiAgICBwcml2YXRlIFN0cmluZyBncm91cDsNCg0KICAgIC8qKg0KICAgICAqIFJlcHJlc2VudHMgdGhlIHR5cGUgb2Ygc3Vic2NyaXB0aW9uIHRvIHBlcnNpc3RlbmNlIHVzaW5nIEV2ZW50c1N0b3JlVHlwZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIEV2ZW50c1N0b3JlVHlwZSBldmVudHNTdG9yZVR5cGU7DQoNCiAgICAvKioNCiAgICAgKiBSZXByZXNlbnRzIHRoZSB2YWx1ZSBvZiBzdWJzY3JpcHRpb24gdG8gcGVyc2lzdGVuY2UgcXVldWUuDQogICAgICovDQogICAgcHJpdmF0ZSBsb25nIGV2ZW50c1N0b3JlVHlwZVZhbHVlOw0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgU3Vic2NyaWJlUmVxdWVzdC4NCiAgICAgKi8NCiAgICBwdWJsaWMgU3Vic2NyaWJlUmVxdWVzdCgpIHsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgU3Vic2NyaWJlUmVxdWVzdCB1c2luZyBhIHNldCBvZiBwYXJhbWV0ZXJzDQogICAgICoNCiAgICAgKiBAcGFyYW0gc3Vic2NyaWJlVHlwZSAgICAgICAgUmVwcmVzZW50cyB0aGUgdHlwZSBvZiBTdWJzY3JpYmVyIG9wZXJhdGlvbi4NCiAgICAgKiBAcGFyYW0gY2xpZW50SUQgICAgICAgICAgICAgUmVwcmVzZW50cyBhbiBpZGVudGlmaWVyIHRoYXQgd2lsbCBzdWJzY3JpYmUgdG8ga3ViZU1RIHVuZGVyDQogICAgICogQHBhcmFtIGNoYW5uZWwgICAgICAgICAgICAgIFJlcHJlc2VudHMgdGhlIGNoYW5uZWwgbmFtZSB0aGF0IHdpbGwgc3Vic2NyaWJlIHRvIHVuZGVyIGt1YmVNUQ0KICAgICAqIEBwYXJhbSBncm91cCAgICAgICAgICAgICAgICBSZXByZXNlbnRzIHRoZSBncm91cCB0aGUgY2hhbm5lbCBpcyBhc3NpZ24gdG8NCiAgICAgKiBAcGFyYW0gZXZlbnRzU3RvcmVUeXBlICAgICAgUmVwcmVzZW50cyB0aGUgdHlwZSBvZiBzdWJzY3JpcHRpb24gdG8gcGVyc2lzdGVuY2UgdXNpbmcgRXZlbnRzU3RvcmVUeXBlDQogICAgICogQHBhcmFtIGV2ZW50c1N0b3JlVHlwZVZhbHVlIFJlcHJlc2VudHMgdGhlIHZhbHVlIG9mIHN1YnNjcmlwdGlvbiB0byBwZXJzaXN0ZW5jZSBxdWV1ZQ0KICAgICAqLw0KICAgIHB1YmxpYyBTdWJzY3JpYmVSZXF1ZXN0KFN1YnNjcmliZVR5cGUgc3Vic2NyaWJlVHlwZSwgU3RyaW5nIGNsaWVudElELCBTdHJpbmcgY2hhbm5lbCwgU3RyaW5nIGdyb3VwLCBFdmVudHNTdG9yZVR5cGUgZXZlbnRzU3RvcmVUeXBlLCBsb25nIGV2ZW50c1N0b3JlVHlwZVZhbHVlKSB7DQogICAgICAgIHRoaXMuc3Vic2NyaWJlVHlwZSA9IHN1YnNjcmliZVR5cGU7DQogICAgICAgIHRoaXMuY2xpZW50SUQgPSBjbGllbnRJRDsNCiAgICAgICAgdGhpcy5jaGFubmVsID0gY2hhbm5lbDsNCiAgICAgICAgdGhpcy5ncm91cCA9IGdyb3VwOw0KICAgICAgICB0aGlzLmV2ZW50c1N0b3JlVHlwZSA9IGV2ZW50c1N0b3JlVHlwZTsNCiAgICAgICAgdGhpcy5ldmVudHNTdG9yZVR5cGVWYWx1ZSA9IGV2ZW50c1N0b3JlVHlwZVZhbHVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBTdWJzY3JpYmVSZXF1ZXN0KEt1YmVtcS5TdWJzY3JpYmUgaW5uZXIpIHsNCiAgICAgICAgc3Vic2NyaWJlVHlwZSA9IFN1YnNjcmliZVR5cGUudmFsdWVzKClbaW5uZXIuZ2V0U3Vic2NyaWJlVHlwZURhdGFWYWx1ZSgpXTsNCiAgICAgICAgY2xpZW50SUQgPSBpbm5lci5nZXRDbGllbnRJRCgpOw0KICAgICAgICBjaGFubmVsID0gaW5uZXIuZ2V0Q2hhbm5lbCgpOw0KICAgICAgICBncm91cCA9IE9wdGlvbmFsLm9mTnVsbGFibGUoaW5uZXIuZ2V0R3JvdXAoKSkub3JFbHNlKCIiKTsNCiAgICAgICAgZXZlbnRzU3RvcmVUeXBlVmFsdWUgPSBpbm5lci5nZXRFdmVudHNTdG9yZVR5cGVWYWx1ZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBLdWJlbXEuU3Vic2NyaWJlIFRvSW5uZXJTdWJzY3JpYmVSZXF1ZXN0KCkgew0KICAgICAgICByZXR1cm4gS3ViZW1xLlN1YnNjcmliZS5uZXdCdWlsZGVyKCkNCiAgICAgICAgICAgICAgICAuc2V0U3Vic2NyaWJlVHlwZURhdGEoS3ViZW1xLlN1YnNjcmliZS5TdWJzY3JpYmVUeXBlLmZvck51bWJlcihzdWJzY3JpYmVUeXBlLmdldFZhbHVlKCkpKQ0KICAgICAgICAgICAgICAgIC5zZXRDbGllbnRJRChjbGllbnRJRCkNCiAgICAgICAgICAgICAgICAuc2V0Q2hhbm5lbChjaGFubmVsKQ0KICAgICAgICAgICAgICAgIC5zZXRHcm91cChPcHRpb25hbC5vZk51bGxhYmxlKGdyb3VwKS5vckVsc2UoIiIpKQ0KICAgICAgICAgICAgICAgIC5zZXRFdmVudHNTdG9yZVR5cGVEYXRhKEt1YmVtcS5TdWJzY3JpYmUuRXZlbnRzU3RvcmVUeXBlLmZvck51bWJlcihldmVudHNTdG9yZVR5cGUgPT1udWxsID8gIDA6IGV2ZW50c1N0b3JlVHlwZS5nZXRWYWx1ZSgpKSkNCiAgICAgICAgICAgICAgICAuc2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUoZXZlbnRzU3RvcmVUeXBlVmFsdWUpDQogICAgICAgICAgICAgICAgLmJ1aWxkKCk7DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gSXNOb3RWYWxpZFR5cGUoU3RyaW5nIHN1YnNjcmliZXIpIHsNCiAgICAgICAgaWYgKHN1YnNjcmliZXIuZXF1YWxzKCJDb21tYW5kUXVlcnkiKSkgew0KICAgICAgICAgICAgcmV0dXJuIChzdWJzY3JpYmVUeXBlICE9IFN1YnNjcmliZVR5cGUuQ29tbWFuZHMgJiYgc3Vic2NyaWJlVHlwZSAhPSBTdWJzY3JpYmVUeXBlLlF1ZXJpZXMpOw0KICAgICAgICB9IGVsc2UgeyAvLyAoc3Vic2NyaWJlciA9PSAiRXZlbnRzIikNCiAgICAgICAgICAgIHJldHVybiAoc3Vic2NyaWJlVHlwZSAhPSBTdWJzY3JpYmVUeXBlLkV2ZW50cyAmJiBzdWJzY3JpYmVUeXBlICE9IFN1YnNjcmliZVR5cGUuRXZlbnRzU3RvcmUpOw0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICBwdWJsaWMgU3Vic2NyaWJlVHlwZSBnZXRTdWJzY3JpYmVUeXBlKCkgew0KICAgICAgICByZXR1cm4gc3Vic2NyaWJlVHlwZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRTdWJzY3JpYmVUeXBlKFN1YnNjcmliZVR5cGUgc3Vic2NyaWJlVHlwZSkgew0KICAgICAgICB0aGlzLnN1YnNjcmliZVR5cGUgPSBzdWJzY3JpYmVUeXBlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSB1bmlxdWUgY2xpZW50IGlkZW50aWZpZXIgdGhhdCB3aWxsIHN1YnNjcmliZSB0byBrdWJlTVEgdW5kZXINCiAgICAgKg0KICAgICAqIEByZXR1cm4gU3RyaW5nDQogICAgICovDQogICAgcHVibGljIFN0cmluZyBnZXRDbGllbnRJRCgpIHsNCiAgICAgICAgcmV0dXJuIGNsaWVudElEOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIGNsaWVudElEIGlzIGEgdW5pcXVlIGlkZW50aWZpZXIgdGhhdCBjbGllbnQgd2lsbCBzdWJzY3JpYmUgdG8ga3ViZU1RIHVuZGVyDQogICAgICoNCiAgICAgKiBAcGFyYW0gY2xpZW50SUQgbXVzdCBiZSB1bmlxdWUgYW1vbmcgY2xpZW50cw0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHNldENsaWVudElEKFN0cmluZyBjbGllbnRJRCkgew0KICAgICAgICB0aGlzLmNsaWVudElEID0gY2xpZW50SUQ7DQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRDaGFubmVsKCkgew0KICAgICAgICByZXR1cm4gY2hhbm5lbDsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFubmVsKFN0cmluZyBjaGFubmVsKSB7DQogICAgICAgIHRoaXMuY2hhbm5lbCA9IGNoYW5uZWw7DQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRHcm91cCgpIHsNCiAgICAgICAgcmV0dXJuIGdyb3VwOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldEdyb3VwKFN0cmluZyBncm91cCkgew0KICAgICAgICB0aGlzLmdyb3VwID0gZ3JvdXA7DQogICAgfQ0KDQogICAgcHVibGljIEV2ZW50c1N0b3JlVHlwZSBnZXRFdmVudHNTdG9yZVR5cGUoKSB7DQogICAgICAgIHJldHVybiBldmVudHNTdG9yZVR5cGU7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgc2V0RXZlbnRzU3RvcmVUeXBlKEV2ZW50c1N0b3JlVHlwZSBldmVudHNTdG9yZVR5cGUpIHsNCiAgICAgICAgdGhpcy5ldmVudHNTdG9yZVR5cGUgPSBldmVudHNTdG9yZVR5cGU7DQogICAgfQ0KDQogICAgcHVibGljIGxvbmcgZ2V0RXZlbnRzU3RvcmVUeXBlVmFsdWUoKSB7DQogICAgICAgIHJldHVybiBldmVudHNTdG9yZVR5cGVWYWx1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRFdmVudHNTdG9yZVR5cGVWYWx1ZShsb25nIGV2ZW50c1N0b3JlVHlwZVZhbHVlKSB7DQogICAgICAgIHRoaXMuZXZlbnRzU3RvcmVUeXBlVmFsdWUgPSBldmVudHNTdG9yZVR5cGVWYWx1ZTsNCiAgICB9DQoNCn0NCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.774+0300	INFO	request: {"metadata":{"filename":"description","method":"save","path":"java/kubemq-java/.git"},"data":"VW5uYW1lZCByZXBvc2l0b3J5OyBlZGl0IHRoaXMgZmlsZSAnZGVzY3JpcHRpb24nIHRvIG5hbWUgdGhlIHJlcG9zaXRvcnkuCg=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
2021-06-26T13:14:15.914+0300	INFO	request: {"metadata":{"filename":"pack-f562c702dbfc68ffd2ef9223d3d4e98d89850f51.idx","method":"save","path":"java/kubemq-java/.git/objects/pack"},"data":"/3RPYwAAAAIAAAAFAAAACgAAABEAAAAbAAAAJAAAACYAAAAvAAAANAAAADsAAAA/AAAASAAAAE0AAABUAAAAVQAAAFwAAABiAAAAagAAAHAAAAB0AAAAfQAAAIYAAACMAAAAlgAAAJsAAACfAAAApQAAALAAAACzAAAAtwAAAMEAAADLAAAA0wAAAN4AAADkAAAA6wAAAO4AAADxAAAA+QAAAP8AAAEFAAABCgAAARAAAAEYAAABHQAAASAAAAErAAABMgAAATsAAAFBAAABSAAAAU8AAAFRAAABWQAAAWMAAAFsAAABdQAAAYAAAAGFAAABigAAAZIAAAGXAAABngAAAaoAAAGxAAABtwAAAbwAAAHFAAAB0AAAAdUAAAHcAAAB4QAAAeQAAAHpAAAB7wAAAfUAAAH9AAACAgAAAgkAAAIQAAACFAAAAhgAAAIeAAACIgAAAigAAAIyAAACOQAAAj4AAAJEAAACTgAAAlYAAAJaAAACYAAAAmkAAAJtAAACcAAAAnYAAAJ7AAAChQAAAosAAAKSAAACmAAAAp0AAAKhAAACpwAAAq4AAAKyAAACvgAAAscAAALPAAAC1QAAAtoAAALbAAAC5QAAAuwAAALzAAAC+QAAAv8AAAMHAAADDwAAAxkAAAMeAAADJQAAAykAAAMvAAADNgAAAz4AAANGAAADTwAAA1IAAANcAAADYAAAA2gAAANxAAADdgAAA4AAAAOHAAADigAAA5QAAAOWAAADmQAAA5sAAAOjAAADrAAAA7AAAAO0AAADugAAA74AAAPBAAADxgAAA80AAAPUAAAD1wAAA98AAAPkAAAD7AAAA/UAAAP4AAAD/wAABAAAAAQIAAAEDgAABBUAAAQbAAAEHwAABCgAAAQzAAAENwAABDsAAARCAAAERQAABEwAAARPAAAEVQAABF0AAARhAAAEbwAABHcAAAR+AAAEhQAABIkAAASNAAAEkwAABJkAAASfAAAEpQAABLIAAAS5AAAEvwAABMgAAATOAAAE0QAABNoAAATeAAAE4gAABOoAAATuAAAE8AAABPsAAAUDAAAFBwAABQ8AAAUUAAAFFQAABRgAAAUfAAAFIwAABSgAAAUsAAAFMwAABTgAAAU9AAAFQwAABUoAAAVNAAAFWQAABVsAAAVlAAAFbQAABW8AAAV3AAAFfQAABYMAAAWJAAAFjQAABZQAAAWgAAAFpQAABagAAAWzAAAFuAAABb0AAAXAAAAFyAAABc8AAAXSAAAF2gAABeUAAAXtAAAF8AAABfUAAAX+AAAGAwAABggAAAYOAAAGFAAABhgAAAYfAAAGJAAABigAAAYsAAAGMwAABjcAAAZEAAAGTAAABk8AAAZaACB6dkqe+BfVeis2j3YPIqznzv8ASHrwGl/YK+KxveAv7ZG7LxHUOwBReQfKlKl+WJr3kTPNeXkeFlaAAI+t/lrtIR9ks0XgPVR8IO1fA4YA3PcR+wQbEunkFEUQQWhOQToorQENynFHGW0a+AhsK20zH/n8DWi6ARZZAcafpHvS7rOj51ayh/VARBsBJwDwWJ2o0It2NJSM35sUr7OT3AFu5/GWm/HJEOG1RbwCe7zOtU9JAbHaX3+q5qa9zB4x73JaZxqXPbkCLfNLJiR4a5svbzpqIF+GeDcAtQJbKJTmm8jY0BiHlHC/sBGHdFYfAmdQW6YiXSIbdRFCsntZAIg1LGQCi3q4WqvXhgAJ21sCxpM9uKQkOgLVqeE9kWJvmzBgAME3LnS6SfTNAt5FYvpV7ZAtlYFPi55arsRgJr8C/UyGDzEWI+P6jfbZ+5/7mIsQyAMM8Psj9RdS8IqPv+K3fHXmfJf2A0D3z1Ztc2IxTnaJvRv7kUpXZrUDkI/zgOgpvTvrPcAcfeMM/XHlLAOn5p+KymZS/YClbqp++B4FSFt8A76RowKt944mOZuNCX/ZfsbLZrQDxZ/kosuiHeaM1ZS0qRxAUixetQPHiOU70YZQE6QKPNL7u5ypO7fjA9IsE7hblocOy41WcaPSMhduZmMD8G27Ms1DftWVfPPn+mLDhoDI2wP3vjVALEsD9Ka+FhCEoPJwi2G5BBy/H50sTT6j02rFig7qM80E2FAERAxPfTgGmQFEEj6JVuamBrNTzwRLL4oNENIKr1NiHAhTJ5F5qpXaBFoIwzjLhyjbEjG0OQrBvzshCN8EnORW9ItOLQMCYTUhOMRLDI99YgTODigSwlI3ySwqlOK8zhVMhE7pBOJnFfg9SleCBWOP9wTQjl9B0j4E7RQeBUGlfWqHGxlqTnP/yfdnVATtOIL0PK7K13smdmQ9+n6W4MSNBRrtAzmiNBpkJfIBTRdGhBr8pSEFcEBxdXY49q9PUflO2HvJEFtxIwZVlp7Bki93ykiE6Kvw3suydvCqBnV0aUniNY7QlUM0fvGcfeE0MBEGhVQ1uqcRtxk0nIHqHAGyVUoKDQaeryt1Qd7HfU2aim+RBODQZEo2BqfeSYj7FTdmjaP5twaJX7ZJV1cG1cgluJTK7zpvWidIf8Xt5cVWPgbcMMhdCam3fsiTQfwgIKRdBQIwBuVgECMs1z9cSTOGP7zvCOXEklcG/V5JtUwpfAcSNknbHF6I2/g1bgcbn03fMCwlj0+o/sjuiG+23h6vBynvo7F0HqciqpqPnNwGarDWmBQHemMe13QOzDjLrqcgNZcUPYonSweZq5cFIfUMxUV+Sf4Kjk0doQ+KB/TKdHlHM8//caj6rxVn2nt1YAQILSIsQlhRDsCQjQZWLxiB+LYnQAhFCJ6j44qTo/ZH9UIJZmQSQfkTCEsPkYqKxp7Kp4+0qBYLspT7xn8IVeem/lEp6bIiI4WKC4cxKfvb/Qifao+1mxKEyeATLhMzbQrK7n9iCPUavt+1lZcyh5AqArd/HsaK8FkI+CB2nceRT9yJAikfmXubwwq+Swl+HmWkrbO/0wWOY7O+ou4i4IFqCZ7dTYaLFEAQ+GGQXkbYcSNg7o0JswT8Zt7Bo+lmTv4x+kFYN245AAnplXMad/WDcOryhCrpgdfkuggjCgBnxHaprwmMfyhiyrQ1bHByYaUKAujAy+/zCZcZS9isGaqXR+8ERwoe2ec7qcv5Z+Q3qATFM2KBN7s9CiuN9/zETU43574zwbVfU7TCpasKR2kt1bnr2awSYeT8plQ04LtJZwpOY1PS+taIRtE7Q2Wh5g2ClJPdCleIJS2caErzHKNs0QHjNbf8KUAKW2++HCe3g6FD9MTpn70u993VHwp/qBT+XvHzGU7lM+XjBiT0ruzMCxd+3VE8jJxXKJA3C2tsnz1EzwALJ9irzadJoYhhHAjIIfdUndwJ9QtlfJDjJlPp8gQcKUEssrD4lVjcC5AUmt+uhfWAkJSD2viT7DjejwYL7FsNenTni2MoifQayIf9MJmh4QxDMIOZO/0c5sxiT19bylr4DexdDKZIlmFhl7amizT7IE2Q6kzMNsIM3mS+fMwDh9Myodpmb3P4l7ws+Qzuc/XTPfvCdxDCzjDdOpF1/TywDO7biopMQXrtTaWA6elTSTfd5F4M/N6mM5P1CyN88G9kBr4qgEyGIwz+R1UJZpucaZuUS5GGcYRfRQfCDeQWTNg0EFfJ3/Cj94rFcwWpEQMOSbiRgP6BYBTKOr9hdt6nex8gGQ6B/TbdSY8dgwiCN6OD5i9zoFswDtiTCAJS1IAcl6/1kdcpe9imyt8O6UIuBhBRLl+DGTS/Iv2XCeoaNA7plEROeR1ySfFhupPuozldDUsWDv1TDoKnN3pXuJ6GqiDMEEWBnDcO/y+dsD8P73SyPlQrKr0bEb4z6g8pJ32BtRTQq/8HNG2o4GWiVxXhD1coyr3ZPehbUkz+PVb9VCaaJqgPjBqdnea/tfkZnvhrNEed3FbPcw+hjD75x1cPDOnF0Q8RCx9pbsODD9N+XiFjzNdKd3m2T+wtZYvBgk0P4GYcvucYcyiq/yBH7xWkTOW/nhABA8cyBtAxaBWjnSoeEDZrSfX9EBOxSv49aPzESzjgC2wP6FdYkb0QIlK8Xe4o89irKsXFxGoDBhsrohAqpSu1Wr5q2u2q+MWYGIo0Kg0gENKyYxq6qwqydpjd5y15EdhgcgkQ1ZdlqUpFR0RF2c0hWlqFewRaGhDVvVYN9dJLbdQfsuHg3+U7VrYkENfSI4Aw11Dxf4bHaGjdsLve7sARBqofkuzWjf+iD9bt7TvAe+mucBFRMVz9DS0cQ+hGm8EC8y+x3ZdkEVHFHtkRWXb7u/TsdA24/hC2vUsRWsYEM5OXuu4THRwDmFEeAjKSpRGMCuuFLzQE5Lt3BUC2qsupW1l+EcRXvwVKXUt8QYNQLgb4F59FOF8SMX4w0lT6kEc6Kp0Blvm1qDSrPhJZjilzoEbXnoaz1ZrP4GXVW8M/EmZvtemw9l3JCPsQjnzxU0BMaPgSpiywXu4V09c5Qtev7vMgvq/dZBMRJ3JEYbmj/l3NpC8/g6h/OtzHEzC+ckylGdNDP8thtDG5QALRWRkTNvDq5boIEIixoPq68PSh50KFnBM9eOcdjw0ftlM6nXClp+kW82eaE0y89dHhCDwoKcZm/CjCkyKgqwsTbIAFRcccn4mE/OlBj4y90AO1wBOOy1YnnyVZTaD3l2LkYijPjZ25E5JmHgK0FILbBBSLbnEu1smlXlUTzYj+UE30Yx0OsedlQkXd+ouQJxQDmHHN55dSfaU6pfzn06V+3tygFDe6Y8Sgu4ZmFsTGANwGwhaTMRoUWlM7ioMA7PV0KPpTLuZvM61csxRejWcmFJSogDGhlncc/L6SXxTrFGAaHlR25jODdapVwwMj4qolShYUYQkQox3iPjc8h9mCKKZjxN+lWRRxJmZ1CGDjNpbuSx7iy0eymnUUFKjGxRqH4I39kdZtgo6+LgCgdOoU9RzM+z0a89lQgBJNYq66JpfL+xUp2tztVOD0M1hdAo1Tvbkw1bITFXJ1kBKWIwqKK/9hrH5IytsSH3cVfWeCjHUIqpUISK88tJ33H2yb9BWHnj2AuStM0lsjgStMH3kBXuXAFY+CEzadmzq4304CujAfrJRj/bkVpLWWDY3QVVJduR6YhlYGE2VJWBYNsyYtc6z97/o7IyLbnrn/82xAFg8sybhjVQwfLwA+Wbfd5sv6EwoWEvw4bWEU+GLXsTzzZ6BKK/VvYBYWQFOGDKQDUOL3XSpF9y/ncgE7FixNZd+nEhQ43j/TYg4B6FVzlCwWNkCdB0WvPEQaOPEvGLSkkiTvbRaRvLiI0COup26oJVVR5xVODqCzFqmt3PbfIIecC9gf8OHfgtk90fYW7MsmvLEAh2vBJHMbwji+PUlLVxbwmBUBUWWLyHsTLjPjmB6IVPfFFyoP7O7A/ULfquD1i0g6cMnxlqwXOgXiJ9K2aPDGTJqvkLuVbLeJUhfLV4ggPOaqK/sgMn3TWELN2B1/F8/FpwNIo4slui/akuLDq+Uyf6gX/eOFAjJVNWxjUom4gZEuqxYtbBhkXqBIabi1sjTUThwg0+xvcmByGIuVZHSTTQ5xpwFAy6AgfEj32JgYph9BmOVA44ce1AQ2tp576DbvWhjsaokwTJW+S9g8671NiMZdWMfgGQCzF4jPeNMkGf883t4o+ZIWNf8ZCyBm8z9KNA5oKS0PUYtA87pEbxkyH3iFYtXwJaAHgWk7a1f6gTBVGUi5B08QFtFdUF0YW8P3PeuC2MgZuRd7ml6ZWq3+5gFmtBrANZI4Vxn7QAvaFDvCvdJDZYdaxcyEqJRDGgyUHj4sx5FeAK+y5eLgkpCinqQaEhjmiCsC31Tpb2Vidh1qaTLZmRoecEWB1Gdp8R7XGVHiES7aDliAGiXHRNZfkQLPDtHu5CKQgwDx9WUaa7XzdvBiQQ9enX+2gS4VqyHV8hpzvSkRkZ3jGeg2MTcQ4f9Wm7pwGoGpqsKRq21809Jlxw3PnOkpdf0alhHZEuMBtpZe1PGnuy1O7GgfPBqfwOrEQhrL+yHj/XEYuylGB/zLGsJwA8ON2XSvgaUd9/JFtr2tS9sa4nJRd4nr8jTD9b3V61oH62b8eRsuDcUiiXIVE35WoGVaBWxahptdG4lfGxg/ohBapcGNcmF3SnjpmAsbz2WqfnZZm89f06tnEobDx166RxxyIxVkKMBJMJUAxHVe1ohsDH2vHKK0l8LNdIA3tOSY3u5+c8QZQ2UcweTt1FabfKJIudX7VT5AV9ZS0xzYgjboDjaaX++Oo0onGy3jpH4iHSFKOi1OruYw1xjafoR8w1s/VEQdN7FD0BoIPAV/SYilUszKnbBgvB07P9Fr81Eei7ruelDfzHoV/xckHVJHLLTfuQOQKeV7N80z/GmHTyIdYNaJIK3F9m13rd1I4FTR/c570h18cyPLHWQkZ5mZ8+OHGryHSBFRHX7Gj6q3gKxlXCHbR8MwSuz+M7Adguj7+XRFLenFJXMVHVYY50oK6B28AVrC0XakBrnQoYid/d5PGYHeHdibExncPkPSSqzFlXRDLzNnFigeE3AT/ia7+/FzSez548PMkonTeR4etBI3aj3wSpzOmMJGKW9+yFTFHiXWiY8S+qQt/YykMJvRRy6s3vMeOcMy7Xf5iymD37Vy2yoSRvLlgh5FLu+nkcQuv9MFW91IIxAzmnLzHlSv7udVkt0WAmmVnxKOA4wSSNYehOYr2pwCNg5sJCbaCnZFvlHuNR6J5113WM4pgoWp58mLrDa6KsDFHq9J12Ya12TF0q5qQ6dAluMgTdke8AcHRFaC5UXDYnsvGTT8uZBOOx8seJWeJjk5bor18qar8jfhwLbbHzTDutKOPIR9BL4P+Wt3HQttOIYfQ/XmUmdI8HavHYobNsmztIaWFx9gkc2FtOu6a0WScStMYuYnc3bKH3BIAVdsfQz35YC73KgqHc41X/4fsO8tfv8o84StkLlktAHa/I4UtB/ZU9UO7zD9OjVXEeKWCJzpn2ESH9nGrL4WyOEiKx5xRqhS8CqVQoQgAgt9kqOkvb9wmevJQVr0pr1wGSAneDCtOEJfitxbTTvxP2zur1fEID4eEHCeUOZWfLkfFdd1wkqOucQgUAYGTICBeEdzw5BwCMdnuj6DzyBbE7ze/XQVu75k5O7R0UPZVzPgIJpDBIEHjJEr0i9PtKka2Dw7qO8gstPgg59ne/vXO9pMAn1e93A4TSC5VfW2pdz3+CzWtbEkFjy92TnOILzQmC63lywQEVdI1Dli+gQfJ98g3ChkIDHDDpLrjiD7BnaCrCE6NyDoIUY+yicPi1oPZ4GmPOh0gv+UIRGD6SiuvBx1+zpJ3VZSW1T44XQhMMjRQjJ74AKEga1KrTpt6qjuxiFQOamuzgdP5cgnhDiKcmaEEdm2IYwzAVfEZmjs57BC68LZJ/y63Awhu17BWWQbezNlQYfjdw8k9E3Z3SHeMWLrQULIkn0XOm8zo7lnqMmVIirdPvYRtypasiY9RpPuDxuz8Z4iaH+Fzav15CrCasBGJHqKnKmyfSJ94tThsl+BViZz+CMJmuRa6UzcIn6VKUiPLOThIRXNbWEajT2vUzMizHcASjksCX51KtsuGj+ZdqSV7CLixsez/G2yJpS/t0v7OofxzPaLIvYuSNoG2c38PbVHZCi9lu7WQIgjcQhlyYZYLFwbnkPq8Nwov37sgiP2DC+PWRktLCD6+lg+MCyXdgtpI/Zfz+YpGR+a7/aptPcq/Xxm5EwkFofBgCMbldJfenfllUl35jJZaCQhaQUL0BIYApOSAjPLLCoH1rakJGpIn2eH7lCw/yO7VFhqILYd5mQlBki9XTtZ8rHkoUoEZyHK8xXiaCUS4pyO7wxBnjsfTJGEprIeR/JQJSXro+mMCWcNRREUo2sejtsSRGclMkACMLJyX/k5az0rorAeiIZCcyVNMlsjMWAHORyKcOkDxCq21z8KJWfIFQ4xe4RFl8oTOdJ3DLlM/KslmsC+pS/MKI5OomSJoOFzsLjUWyWglxNndY/QgwSvkvU6/elvNiDAJhEc57llhR8+se41k3nIesxebt4maV+kwgW4LEwypLUbji9F6iONDiZste8JQ2ms6xrOls+MxoGYZr0bJnnrlZDO/UYHFKuZH01+g7fOPa8mt/kKdDl0zQMSTB6pfo15YVS17SbSqfM8W5OUU34Ed5TCXjNwxkTeJzaaF/q3wJGRPNuzdrpI8AxAW30nRTj+t6lWj9xIVhohI/6uBsJwACdRYJxW1+yPrHGBWDHvKkI+MeaaJ6QjksVJAJ/TM29Me5CNvBmOvpsn3YzmACBv+eVJe+S54l26lNoCwCftKlp39YDwRLhUph3DIP1vj+oOKDgsVwj5b8EHAVo2yBF4xrJQztgoUyeH+3BhnwhYqZxIxBp+4P7vMShnALK55v0Urd7z9mgEQkC+qZoSKKS3eNjq4Nxjgy4btoUvahgOju8oydWaDUDr42GFk8uAqHLNJnTDpikYCqY+aEEzYolc4/hii34VwcfqKXbcWgXacqIppVJX0PB9CP9YYecpg469rpFLpqrjZUB7tZF2w/h35SnBcK5xik605ukL4dfnIHP8eI2eKcjlJv6vBvP+2mTp2J/t8su7p2kpylxh69jbiwXldO7/EWCYk3yNwyoctwRMPOsr/hNuVt4PKxG2jFXaKimwwPYbpvzr8V2dirdz8NFTiqIqO1WzQhjNJrHwnvDIyYRqYKqCSypDZFH0kTwkIfvaVz0Itp/ywf4TKmXkajDjPINjlzMNoJs+ErAR3akqbSWbilf4hn8dHRtBybVz56zgvip0EzuyJzlUBJiUL2IJST2h/CNKKvOqv1rH0yT8Rf1lihGU72vvlLsrg08XdEsD/G6AiwrIQ4rxaGOcmyuyD2igssobNLBo9gHVf3+ZNPu8K7xyMo+hHwOKni/yONDZ09pVXxUr4lPKYxjg5M5Xkbcf2BQZHJl5Eiv0nD/OS9+7DgItcXX8j6VNhDVJLBu+uaebx3JUz0xNZvZ+2f1KtKssynGvjJmEK8ns/WmRisRxzdyNJizSc21m3OSDqlRP5eVxRwzwsxMXLQXTfeNeZaJKVfwCNtXZHJ2eKTwtOHGVHm+ksXJMKHb25RoXjTt4Ui1GooqJCTCLyNePgOrcql/8juv+LXQu3m7PlNfDi5OMRRuEqLgycc4tfY/3/Q4zj+QonD3r7tHMN4T8iy2LsOPS+Gn2WhXVKzchUaNYEm5fLY05+urQwgNfnEjgHf9ye2I2txAtlu0aaZyno85NGIpI/6nDvBG0ry2dAS05CY56u2S2JMzpxv1ovBjELa7vShH1atyjnQ45GITTYTKeKh8t0EJwhDk8I6IF5rPWfd9a+Pr8Li6TCRkhd12Umv3a/YRI7v2/MAI4LscC00Rx2AcPnOqBsaDzuzyDsg8uyMpKDJ2w5xa32vHU6ubmfJYtLy7fzMnw/WKXw4Ds/pBnskAq8YVJLuNKvrwti9UqOTmBXUo9jUMYAXEu6S6sz5i/lrQBGK/ersvpiEm1Ny7uU20XJCwbb3ZZ5GeZy8bVRFXoL0+JswtTLXrbsCA/VT+wp+mJv7IvYGEgtYgGUnntO9zJtyf+zAJs2i9k9xZPa/4OW5hjU9gOFmG3M0qNL2m1XkNmR7la1e+lNUzTKE5W51AvjOeGFLI6ZhCW1GLfGk0Lx1bREC+2siuEqeYrQXNjH40QG618MQ0lL8S9SGqNwF+f3EGrTSVsPITNKMMv6TeBOPi1zbxi9/xztXbCMpm6Ny/w52x3lp+rZyTC7jM7SyCqtbDBMDd0nVwYsIrRgmM72NuX0QAOY8UwZvndINHH+7uad5ipJuARsJ9QfDCCUwcl/pULrah6qmWE8QgYtQMGMIW6wE16OT+fdIXOULBCQmqUo9IwtJgPdfbr5BOG/UcowJRoBSwKHzDH5YLgolU2mMDMA/1HB0UmYMsGMTAMvw9XDirBLkrsScUiy24nFlUxRPLPPyjapSLc1Wt39J/jXW8lazGwiUzQDnKPgnzAsvM4JMVITP7uMbjapv4bmktimFi191Z+PVVp8+8xwEof1O0di8oMRoOLolEZfSC6vTHpV/yfpTeJcLsYjDTA9O/PZJtoMfdZpyknLfiPTQObWDXW/BZJercyMxhx/uHbfb84InI5swEnvvOABzI5XN8coEsgj1YRgfT+Q96v8txIMjm9u2JbZaKcWBYXV2Q+aGko5ssySIKQFauZSJr/fVyna+asbrd3VTKMS7rs3vg8XFgtpbS9587Qa0kLMpY+Gi55LzODroNU0s23HpzY1e4y5oNTol/IL7TqBLEKGo7+BsJJkTMOgeIA9U+4cP9uMuH7K5Dyh0COM3IagdZAX3hxzirqcyMaN46E3g00B/sk+5ieCWTqb9oBEd+zWkMOTjQO6dzmUEEqHWbszKDid7+NcFTRNBBwmyEvWwjd8vZdL4rKUzBEBMc0H4png/k0iUDQNrA9TGNupH7i8jQ/gCLozSM04ohDDm5mtPBOnZZhNEasocyn+gEjMWyuEzRwqsha9KI0jinu5t1DkfGu9+nAwimSPmpjiDSrPYzloZk0wvbfZXIe7erYQR78NQaNlfz67mO49HZespuNzmLbmxA1GP7fV5JOk8HIFOG094e0cdg67zVYwr+EIs/QBtDf9r0KniofYiUjNWCPX3nsufjVDgD5uy3LTCAXKwM1mBfWLhB+MpmldTaMdUbGMedT+jWrx96EecQsgonO8EoQ1AfR4929NbLGbr0UzcxMmS1w3AIa4VzGhCs1txplmvUQsA6CjzuPZGmsvQcoMzW8JUbXHRb6ZluUjetgVvUjqeqENeiHl5Nek0OUVuyK8SV95j0LlFc2AprHfHBX/l9hyyqfsLqv/OTWJjZBah5B8ccdXu6aLThZyS+6mf8gNk8RHxUntLly4Uqa7TwM25LNu1k2U5l8MqDRbYM7TiQcDeKnddF9+zZT2de//+JV/a1LGdIEqJvbIaELNlfICaMpTUA7hGVf/U3EG8dnxB42aqNZ9n+ruexNJ7WBGrPpQtbEOjbJjtT/hgm8cqmH75IpXS01Uze0Nv2JpuTiABlMt5hauHjzycsf8ys3FHk1lnRNx4EmaXx+MrAIjptBITcjcqeMu2X1WtcbUeHCBLqqC3muNyxMTPz44a/GElqeVMlkiH9vw+o3QOGPfOx/0D5cjwtYBMwil70ytzdOfRd+3y4YKUFFPXQ9P/o0QwIkN1aoVrNSUV2gZdMSXtMgcCPfVg43W6VYXasbkUcZoWVyKq9kGyD8oDeYpNsjil90gMqkXx06o4gXiHxmN8i8xNxcfFn5DyH89CKdZ5ROnOc4Bx4QFIDY2vGA3T74noRWUwKNLjhEulvMpEk5URAMe6RJdONSvUhjOGhzNAqMEpp1r3zrHs02m0ozafI4h+cwU2pMBUYO15v5oukQksIZ5DiiqEmZJrgF27h0HSHAvTiXY1KKOKPBhg5zVy1f+1xZ1X4Hqj4h5HM46paoKMTyqvGmr45nETnf1SV4iDjztFObHrDKD97krJ0pSH3rjEz3OPhtWgN13LGOmQA8ejCx358QYFw4+KGIh8l6IQmOu5fjhcTrIXw3mTj/owOvl3YW2gp5qK+hvD/o8DM0OTnm9pJO7uFaUKHvyfTSZgOBSyA5UTvCIXjRWZOR5EFh35ENQl53lDl4ufuI4e5NDCc5uTE1QszNT78kOcP2+7GfMJKO8Z8NgYNj58LO0eQ56+vLX3I53V70BfGH99+c1wXPvzodzq7YimxmdGfJiZS9JHdjqIKXOjwbOMTiQFbeb4sqok7eXn1cL6c6QgB0AkndG4EO6LJ7C1rnQtRrbjrKXVqY5IOEeF6SMmoAUYJYfwZbOvSd+qn6MriU0ORwVuG3A5hJVCQ7L6ZaA/Rg1CvOHZCjZOk4p5eCdzs1jBayrQqNLC1iGlOvXt5rjyzDO0U6p+cSfhUZOTPVjbPEY99zVus7XHt/uPEaaONkV/eIof4nrFfhXzuTdr0vu2c9tj/Z9nhTyul4ghDXO6/dGKT3De31D1x5U4MCbGc+aes77k+JXfONPFyaJqbpLZ9/qorm7Tv2Feh92Z8WTjvrO5vfegY/p9uSPGfreGydJDBo6yQTBSsIiwWNjMc8hL0X3d+6KAcxqLqW2roQpDvOWzzDoZqc9W86csjqaBXBwpNT56M2PMtItGMapnMmo+GrgJ5+35GvElg80lN8gDOg9Zu0mw8hDkLkqZ/0qT0GXB/e445hOxs5wpSfLx5SThHoPQ61wcfgUACDrJgzC2Zwd2RxaSA9Phxt/OoGGyRVSzQ7Hq3qrISYxT1DVNIENk5iHS6J93wuRAwLb2xSPdhgTpG6J378SI7EDjZ+LGSGB7o94amCkDarbbx0mI2WQrA9Wpjdpj3sjQd30+BnK/Pl1F3bGY0IrRCpPhs1hW0exhP45iwjEYQP+lNmR00+HUuXRISpwM6f4jtJ5zhGz3ZwVT4olnXQg7Q0uMGYAJ/v+f7t3hHpPmO/AXcGbZlsGkfSlHs80vOzb8o+catWH7Euhts6DAftl/dMcvdInj6LScT4lgBpypyJZ+d6smJRS0E5PpNm3pPm6YLhyuyBzjAbT5db6lM+rhrtEaeAfYrtNItpfpjHyCij0D6uS5ZcNF/0/qkfZ9CS5Bhc0VIQPq+UAYcOXtRSoHdB5+HkBa2Cbiw+0ZCzM9/c56lisPvvUVB8CNrACT7gsnJgBXa6A8tnDg5HuxKwTpagPxd3c6clPXfPq9z40R0VT7oV0GQ/F6rvIlRWj/4e8xe7ALKH9kTEnT9Dm1T3QS1vxa3imMJBvMCkgSXZP18oNzyijo1yrKMAzzhXvxnIOzA/gZynYWSLDm1AWmt+5ja5B9xkOj/bhi1/azpdXMNz/5vhBj76zmy+P/Auj/akN2apmyoTIJwcui90vNhAKb6KAdtAqxghjy2VJ4HTf2GIEEBmAs8+69SIr9lc/naBKJJitd5qQGlRt6AKUNvYszX0YSerRGyzRD9AbOxaRxUT+bAyKxqGfFcykkC33EDYwjNjTZjuOLncaytZy7J4nYOVQNtZmE3RA58eYmYYTJ03T4ogB6JBAltruimOFqlpMvWfLPFDMWOYzEGWv7XIr2Z06wWd8LW9g2atXPiyQaWP0zpTFmrYpfFpvBjthVw9VslB6moFLw+LrWGUd3VTXIaUg6KVOkHtOQ9Gkcn18jnyqav57jWvUW+GQjtfob0FYAy5sBuYhV0Sf8ogHMxCPOutX3DysGm+m3DH713GWbNVekJPOwUZNVyuzPb3a+9Di4mRw2eGQmbLl7wOD6IL8OovkYRdKlh+fwtCae9BtgeOWA7401sEoXy+r6NWIkJ9EeymCFFcssSmrkCulrqeALiVQp5eKDNIQ5AC3wFU9CHRH14ZTA1CsusttLVe5csS+laoLu+fSzZkF0LeCJJjHd8VnrxGfUf3AEr8giPdQw2ijHIq65cy+6Snbnot1FVpePJDNYzpaNnEaHh93qOP7Q0JoXTIG0M67T52fmJwyPsCV42t1D0jMTa9Q09NIZK/l0qNBT4K2iQqiFkSuU9DUpdJor3KKbPaKYPzRM/ZOVVoW0NnifWmDTZz+SO7bGbNdAG8gpR/Q3gWBYhzSCs1w7mvu+ABJ3H7+KFDqfVCjl5slIHHPJC/FBVVXfRdI0O3Lk1EbvIuKWTGPm1p+RNM99saQ7v9cWO5NPUIMRCUjIRrbzEfiN1DwtWkczVk5RbYuBP7wTUrk/YphERgZORanfaWhwLVFFEvqt4ZXm1URGE/ocZSG62siln3uNAs6be2xo1EcrZrCtbl5xCfaM5DJZNIbMW3r0STs5ZMTtxCG36ixMCbzOI6ZQhgRNf/14sfFjrKV50IIK1PXHTLcrJFKpgozlhaxtbrFip49excgp39ZEU/AmOECvaDHmZEGACRRZCUxkI4RUcpYnTmMLupxvRoUeFNCNfWvqRFcdNMp/CAMRZ+tDYxvb1cBY+zKUXM8JJ/iV+7BTIgrKAjhbWvVC/HReCdVHmu4o3JiemsNEudG9NZ8NtF5CUvPgjfdJr4MPi/PFnyPE1eBUYPKppUSteQ1Y4hWcXRs/mIxfg0Rj45fbXH1jSOAg1yo7ZiriTPAA9GZY5h4Lh2JKBsaDP897jEmSVb1EbTwgYHis+p64sK06tjzwrFl/iLRv/OaueyXtcT/08pGFulPIBTyNtHREgEj2UqRWxphSmqNY9eG14xyEf6rF+dG6u+bINy5lbA3k+PsR5ZR/vvd0OBUg31x9nKI+BawoTyfQBIV75ABbhzEML6Af81lIm08uzh00ivx/1BFLDxz3AoiEZ40q9u53u1SMMzzybgzQhfMU2Il6U0QBOAibFI4zHFSOWRyHVe5l+c1n7f49H7yEj4GyDYjgvZDXxfPanC/xRUaxPUSRdKvk5/0UheCNv+rRLWH1xROGVJF9MzzdwbJ6gsd51sj98tqABFK0k8/2vw+Mf0NIEr+VhaDypGWSp+SXQrT8OC9v5jDr/S/snq0PKK9M9JlgtSWbRrF5fjVPJgKtM2kRCHtknP/VgMrEe5bpx4hWlpepabycLjShs0fqRXtUZZUnQfqF+D9/iYHYlKNMSHc6et7+PxXxzUFkCN3w7K6kpD1cLT1jzmFkJcyf8t8bQBzkpSSoiE7XUmX893m2ACKyk5BPq2EyFKsatP4pnENdLVhDkzuG2lIkO2AUrzMJhTTKoVk9IQP0STHQ7KudYXSzh1iC5fMO/Ou3EZvmu02Qz4OCpLVAGrh2lCtESQDbxMwCx2Axris0tXrLFjJN//9zgHbszjukKkeceqS2DXiGWImuazyQXuSmBH0VSfPZxLexpM8xIz9W4//o9bQslWXCYMM0uTSDrrgFGbM3Vs/Byje7UT0NR9S9MFUyRGXsBKCr7HGVubcCZ2pRZL9J7uJ4sLmydJNORIG3sd6+4Ka0wUZpkX9AHT/0XKX5kLL4ou5SvHTE7PpEeT8byj1fyK60XfWyiS8V5MsepVgheOFZcfKzLz7C0TQ7SEkkzCG+a+K1u6r8+1QRb8PDyhp0AATOEMZg4FdZ9gZXulzmro0aeUxy9NFNT1YhPmzVmcRqrPRQ4tUelrOk1BcOQVwx5MTwKE5absKQcnWbO2TUTnlwhQ1ABnNfhDfm0YPGb5GIJNVyo0F1Bu0Kt2EUrcA3R85FZ5ek2L9Az3OVM+9KoqF84R9LDw2Er1TZPqiGCcFPf7IgC8SLKbATegClpN7/rtDXM9h6PhwomlOTl9hW/aFE4gJsnTYjv3PUvh0KIwjwjkAxuuTjSgbec3vFR5jlx9YPw5J2QcHspOkndMCJtHAvTLaeqMedINR3wsEE6o1DMttDrphYBYJvRyK1iDXwc0TsIF3oeiQN8zeJoxWYkEPbsdbz9OyPmjfA0EtMM124MFXhhKhPyjOk7fizYVs2ZeJ2Mf90swGMK0hvvzTx+yuuAwmMpGeM5KT3NBgTtT6oVPvPoi30ARbegtBlSqiUzhF/v9uk/WUJa6EqC6vfmTmsQmy6cORU95T+c6iZ0ciQFd2JviYFnm2Flp3dFQcIbn/idL+ALg4hGM5RRVBHfIUVB6zt8yfAFi/D9bs+2B/86mVpvdUO43ARwcsdse4Y1zmrSxok5YAFlQ8Fi/jhGVW0LvJShF//br6GVD8VED9H6AJAyX8KYEj504VeuQUXN9UVH0bLSJwAEOOwrxgJcB8gLdeetRWasPcbtK2zxIeIh6jo2PBsa281GxlC+3r6Tt+Zg9Uz0resWvicXUUcE6CTDi+uKSIaPAhqjw1uYqOcRR0/iJvGZRWqVlQV/r3+su+8bJAlIL10KqiOHl++VSbfZhxzCSWAbRUhy9hvrkvcUvRF6y4Y4IaR+AlTFSPba2Gg7JKw2kNiWEjQMV4gDQ3FL31EXm9qUQPbAffNO+66hHgXBZUztHDvlbsOihJ/29F17mAKRYQrpTi29NdQrAm6ScrRphQKsH1K4w4lOOJl4G2aUvLYRpcu5OAfypba7eU5ILNqvK4c0bRmZfRtpJYUDVOvNTlPLTd1+KYnjkYquarBUAtAR6flPvuDayKLlz9rpagBB5XHnlYpkUVAQLX9CyWtJQz83oQFYZANFn3HZUDkkLA5zZ38c/ibmHb1zB/o2qolQYYsptXG2ymfvrebQqfKv2Ih3KVEunSxqLAGueY1TwI5TnFbtHuGJUXJmGPn3mdEbe6UtzC2l04unvjFSTQq7u1dWjEu21dBliz0R3THiHVJznqvZtzIhfsADKfzi/DmEYy6VUo1n4wzT7TOQboKysEA5HKWgPaVTGr8/vgjszefPZ6Q3+26hIGj5jVO5gjuOUYfwS/KNOzLZWUx5RRZRVBnznYH5SwlMBfUfjRgoA6RJyv1VA1HI3dO0Z38IJmQA94ktm9K3WVVeAeN7CT6OwD4QZpO2wQv9AuHxVXjFyX0cyNtpoxg1StQQVZqoisFV650rUb1Eu4if3Bq+4/j+5No10VZYPDC3ve6v3dx/UnzvRk0syCi1Vz60EYZq58oExX1gQtVQmaTg/+1aqfQlaasbkkFuLskfPPVNBTqGKVsHQApIWIHiUjr9fdhTIUFoesMtWxguaCdFWWNlGs/pFMuPzQtIiyVbm3g2cb9Zw1eixc2/46s5HTzRlVvB3E5mIMKcqIUwnv3ahrcNfAyVXDnltQDfYt5i/CleJQwaWkXJk9lc/lq5QHc4yW3taQdJJNpsaAF2LV146t41O9oopUUgFzy7OHn4v4I9XhWRkNLTdq3xw+OIIUwCxyqAM2Ffg0ZdnbnXULP8mAAaQShFWfx5DV/Fh6CfTASsB5fDS4s99h/TWI9hYGWd1KVHLb2UWoVvlmSeSv5UExFgaBoQEA+zeh3yyQLpkAcqtSRN9WEIAy2jMKBTqPsVq0ekeRXevGL9YRUKHF3DVQCZ+CTMOm9zaV9TGDlhOyM6wm9ykCRhANc83H5JDrvvHWIkJe1GO45+CSNlLbI/mglcbxo5Yjyl+pP64TcgJv5eO614+goxpBVi80X2PbenEPLcR9DrgpJdvq+6eWMQYezLzW6Kt1w1Gdz1Vk6DO87dY+bjG6bnXQEZMu5XmGl+rGaDVL1khUfo3mxXfHGRNTnqBSPj/YuPsWSKfOlrr12A93LxHCNQoZns0WHlZJT9gIomIPJFoSF1HBfyeHS0C0VlO0by3xpetnVbk1cF/kHQDKdQyWVQZWrWGh0fbQyEdfYMDKANVOtZZgcr0VKWF3eJ1cYPW2RSmwKE7fFmmXfJ36csyxp3vG93bqGXJ+ig6WfCFtnsOTaRwulAeExGGC9GQ1vhaJ6+Ojtj2pmdF7whBG2Yu7fJTiVph5ZCFvoUurlOJBP9XumhoFE8ZWtT0fa0ioQs9lTMpXbzMyI6z8cZa9eA1msjn4TnBu7CM+QPYkGH8qVtDC3SdovEBAQ9o9/1XybcJvuRbW2pRpiNJAZtojSDwVXvhfkIGitdbsSx+E/jhQtbK0xoSPXYcdXezNFvHsnuof1Pf+YAOaP3Zn/GxFugJW9DdS0vphIWJnDUTOvwgbe0n53Fb6bQ6wGCCWM03AGHzWkH0S2Hfg1wP2hlOv3zdWWdLZW/qVGiI5ne1XBVx25BT3hRjFP5CG70awadcXQRcIUEUAOETMZu3cKxHFxHFLsbwwlwok4xnIfX/7sCKqDD2f66ifnR8XE0iKM0eUn72v39YTdwozndAVGxcUbuAdKZukp9UBL0W2iqzuiqVC1xjToMuoOmBXgrFLDSgcRhfsfZiXPVNPHBaXlMA+HOrzO/7B3Ih/Nlc/q0mJKrg+6GertQ9fZYA/f2FRl1txk5AVlFIoLRkIyxVCpZfKdGlXY2c9KnBMycXXWm6wbJoaw0M1zhdoIR+NNlvmcjSVo1EnjGStuCN8l28Osqh9LIc17mUov0wIZFa+oGRXkOTbbVdgUEA9csbRYooB8w8EAxexepD8eH/cuQtXRZnUYJOTZfMZF7Xdrhnt8XgbD31okTw1ZS4ZYI0Xy02dFbx9w4khVs9c94ZkalUotFfbxjT5TQdzYDDefxdmW0L5l2As199i5P3kcQ5qOFWFzr9mIauJkeoX6JSbPSEF0Vkt4cdHIm2VP+5jJNfqbET/hnf9mlcBHXpYcyCd+Pbel/MdgHjfKIyEkAYd86yulFnV+9KYBGtr7ar5JqZFMkgH/a6/nzM8XZgIv69qHB3CsLMk4lRoTJ1AC3it2CA15rdQLY3ALXnOSJELSi+EOR0YOBIcRm/7SGfslcv8HOzg90Df29g6cwvp5W3muCmxqkBz8bfLyVzTWEFgmQwScwMxpoTCpJjq1Gdh3ogYVLQ+VmJ2UXW1cC/iH76SMqqHd9hW3vMfTjdf9oXwMwEkZst2qiesWFsW/L+qod6g4MQrbw7r5UOTBmUYXnB6kKRooZgsrdC64yfYgVQ1ddhj14mg0eLhWjXk/vg8zSpNAz25mGa0LF25/faYzSO8cFpObkiQz2vYahiTpy24Aoe38o40pAJ4zDqo9Rhs4OI/2BAy+to9XY7d9i0XHtxFmHpWq/URzHy4SHtZAEJcO9f833oYmWbOVM7GXG2OYj8jQnl3339v+piaxpPMWOeAHxmu6XT8v8wdzbo8WJ58/fNIFsuOB+yLto5CTTT1AGeYsgDjXK885WyI5TPWR+hOwem5h1i06KKz6pLjnBB0l8+X4hwA1bVf2LzsJcoFXdwvTap3BNeEiwh3a+GYxs81pEj7YEsC8+QS63kakd9lfFjMdYI0OzR5VuMQrxzWbtg7XLEDGNaC1H30xzY7T2uSLX3db153jJSY5AbOJTHSmt1vKnG4OMlgmDUdhZjkX2kwB1+TByCYpaDc0FkdIImpmPKNDFYNDtQJqguuv6cOyZdBYU5Y+BzkZybk3L8RSuS3eGcybiLnGlkDmXnL/rUlkE+MT+9gOFZmwTl+2RGXzku1UcS1u+T9RT+9w4GK5uMZIIf2ENqc/WJTeaXCR+tyXd544xkjBWHKR5VgZoGM88MEDCfXgqO+mST6VjM4UQbdPj4w+H6B6jhLVZEZLGAUyMqAzHdpkcstGwXKyd0yGNlRTvd0AozwTUlZKZoNr8R8iJlFGVamzwmUX6zce5V26xXck/1Ix3gZYd0RqPavctvsFap43LhzmRsHwVlxmcjN4GevUH1XwnOQXtBmF2KVGXj2c+/b98aK+TThMPreFe2cwlgZml0hWLYKfrppAghvYSPxA7C701mvFaZDA7+QxFXfoONwQP/MRdzcWbIF99UrpeIXOAlbYdjZM5kDpsHZu14ftwNbQcXjrIJt+ayWsPyCbBnVIFdhIV3Tmgmt7uwHvJHKkI30Wd0LV4zD6yT6x7emnzV+WCDCWDcZ37dwWp+/hlMak0JE/1L+seUEQFnsguNFNp1GQsuDWsPpBUkEa56CGfyw5ockmsfFo7jmP02PTCufAXSZ/PaOEhX4cjGal86Mf1C8Dxj09RoAm4pCOllZoIqZG6ItKrGO2J/02gNNt58+QWqMxkdLRJsBYk2tIldaIHUJYXwc0U3btXXQcpKvnMk+8Noi7bGbVW6PoZBfCNh2N7RS/HXo2iw+XxKkvCZYSe4ZVRb7Pq78MDAaNh8ktInKE3iZfPyqu5b7h6nGLho4/AFN8Gb3KMNA4/I9+zhj+Waa2koowKu4boAj2cUjN6iP/ZDofSlaax5SXKBNc8uwqNa46yHV+wY36tprqDCx0UKuMRK2tfGd7PvdYsYeWn5fJ6sti6w7EUCw0vICevwXdTNag8zH6J+VA/UhPUvKBfKbdothEZqG83kzol2Peqai4uxFVxfFGxXz2oscB4V+wHI45b7DAills0DITUdaj7fwhBADG2zfKjQ/A/nlPWag69qQeANdZsAAgurKkGxzR91FX5DBGptEfbKHe85MxbM2GNzwRKC15psaqUdcew5S7ibtAMAP6tZEZFfSOlqwVbZ3S3XVjGKMOL4kOGJ6CogF2rb4p7sD8krKrUaBJiALsQKsB9gauCvKKwqOWaULwW3lki/fXUd71Vq8g+hKhXvyZMps9R0Gy93ARfNnmr4eOOhA7/Efv1Ahkyx/uCdbdbaaw2Sisf3HhGBccPe/9i0WiYEvuxrRE+82SDjq2RI/yX6buWORSjk0WtcUsL9J0qKlxPA7vdlldmXwVxda193A9gy0chWb4AF+V1xp5aRxg5rxO4TOaUpvbLTw48ytQyTFvyGx2vMy9usLW13E8bZEQN5bwp2ybPPa9iQzfeQyk1Dd4ilo5vqgeaD2Mpr2+4Wv1xU+GiH++NKzX6XGGjKZWvyeI3iryp+SKWY/NbaG9WuiakRbDVvBUbXzAIpCj35QbLprr50NR9sRrF7CX8NEmV7aqVDPFLMmQ6GVWxsvJzreUaF+K/r1iU/1+9iqhQvbJHUWKhkB1kmieixaC3AtrOe7o5sossqtubXYGQTMZOkL5EnOLSq3WyjsQpuGCE8tG75Z1pFiNwtXtkLbL4FRLYC4OYR/KMVXHLiRaQjU7hs+M9eGd9jiNTrVf5HvqikMc1oGW0n4vWpA+dFH22DBk1rSwmufifvbWFXtzkA/8GdYcvIhJRCl3moTRRtqq6hoAn/0N6tY2TkITNfMtbGq221yhqyAhAPnqNOfrI0dJf4gBwbbeaT3knUJ2LfwwRgDC2/lg8zlpFt9Si+HYASnTQoMJ9uhheKiSVg/G4yS9G9jxjmWsL2P7IWLtaqmizhbjXvyRJqbo4y2VkQnV61GrubA2RuUrxBWwyyWAqsGMwbjOkrqyVqe25YPy/pwLnSnL5H2BwfsV+WSSAJbuoSaHYusBDgWOQyTr5t9yVvMnlvd+Bxt3Q4keST4oyeof9lrHTeF3AAorknzuxdZiaP1gMu9Ia8IIk2cA1OO/Dm22GH7MWqnuiFeYyypJRwSlIvncg8DHp6cCsSejtBawInVHBTwsayRdIhJpdnVm2TfooM5GU9cG8izDMVuJiHBeYzcEqt31/zwK9wgVIgF+UZchSzwbhMbf98kZPP4XCQeBQHMWJfFynbnormDhGgVvWucJJ8w925/5IxIPFCLNUoIiRC/yRwqMUUbXPkNCgvOQX7NGyESevCgXDoqFLGvjBvGOr2hbcgJzaKniV+cSEpMWjXXLbtbKfKi78OJHIWlWVxXjNgB5crruLUVEOaavsNHx/ajnGmr7sFVc2eCJkT8KktdatvpGMQceG2WSSB9dAdxgrQWwN9eqG4bmNx7DE5mfiQo3Colvw3YVyB2X2ZwXHtYG/Ye/vqOon09ZQK11cSKPE1cfH5h2BsZ3K2+FfFOK+8uDeNJ3pyDZY3KshUPaIFX6onrL4o1+otqnKXY4Xh/7HCmn4naGKBiz6cFC+ecqC9gvKUfO8kjCl9g3iGhS7uwDtywPi9K6HmhYVq0sOxIogxkqG4vXLtzNtM8l13w2ZC/OCG+WcqKYr5cvhMX1RmS23NxFsc9RpCdjqe2npy/ujD3njL1JnEYkki/4459QfqkXMDV/JV6TDN5bxGcaB21Va4nrl1czNTfyKg99J+yIWO3biGgE89VH5zORMMi6l9A3V6q7idWHfqP/+CE3NbCNFCDvhwpkObZGGumrMQ5KEjc2EnC3d8psynr3hbS2EWyhQEQpdz3fHQaEpbbzM7sidBQ9mEcoRwwnQTvkp0/Cg9d0BYlYcOenxb1VqGdFo4AieYRBDlj+0btfuqT3mPXPR0dJPyZImhnafSWSVLNhOocKEO1nSo0aFH0jlodIn/WDUZHrhFaMIidMWa7sR5WWumcAnzoqtHZ7rnpkd05gCgRgJhgq4oj6fh4Cz/eZpe1HUGRigZzi0KqojiQ4Rscg7N++A7dS1kPz0qIrwDusDba6B3eSx7dTN1Pov9sz2PzhbUpITzvLfyxn/jknWDa5+wqJcQym9hF1JKzbG5JEFxdYam09bD9iYIFbHvvYhoUYVUSCl1n2juOtv3nCtABHbug6eJG/uOK3XVEP9okJJm+O20S8IvhPKgkXzTdeLUoDSEJRwRiY1uPfsyMSgdfnR2I1Oklsf9h/AKNi9FjmBomdHPzHY53w+M90VD3g4SiSq2vK4Y9G0TdmhK68KQSRmb3qpzyQSlx3+ft+12foK4bKxd6vA2jv4Anj1AeWnnSXaJHxw6z6dJxVGzcbbC1xX1ke/XdqN+LtwUF5g0757jFukzxg+3XH12xyECFdE/bZfhEXa4r2zy38ApeXbYeDjKcbPV5JJwzInMWjTVtmhddwH5De9UzVyLsPov4Hjy/RK6HSZ3JFvdRnBh2338+2BV0jnddeuQsHcvtzP2RO2ENEvBtz17ywKlHAMJdzusQDQOzqmzORe5yjnL5BLpIgJ3Q4mvEI6TNqRN8mRx13hmzuF1DXdUhgkbs0umtuOg0waIOmKh/8hUd3CS8/ZaDTBk95+ER/O70V+NLKF3qSMsokDJfh0+e4sg8meEQjr2Q3eynYFJjhM9JL1nh6EgmYSJFflnd/wrX0iysBoh/fBwTZ9KHqavL0x4Cvt0aMV5calCK85+D4zwAvEuZng9TN6HqMrxpeB+NJ0MRHU+pUfreGFSEdYARNcaBjMLfT98+6NFySt4a6NW3z1teKWGtFqepFg9VoAZU3iPF4vdYwteJ/DcNM3T2LnYu5jyeVYg06NQ/oj3RAJJrckJ5zIybvt5XvYfYdpMNdYvzuV3u63/bdbbfXlzGTf2moIJdgu1TlfKyBGuhltleYi0LpDoSY8HExJ9jzuDLWE6dBV5j1Paik6o9PTrTDy1xu1XwW0SK3m3Kbv7oRu3FsBBl3I/Ifo+wqzyecAiQ2UE9bn6H1IXYbhs6RVIX/l6YOUoYD8bAbj1yl0notowJdi/p3q5de8WEzBEm3UQYwfM1ApSDbp9esgfBHaB9VBxOyRKqJ2Rhp86KDt61urTO4VOM/W250AMumR6R7JlC3s8uZhIpEOnwYr/5hgyQoTXZH8Se1s8hEpucoBEGCqFpOHagjX9IW17y14uLT3dX4iaqdVp9IwnkVubgXvcyJNM2159lRS9R/6eLotLX1iPe/HYp+FND0iSszgWy/yfyh4Cx8J79D4M4D473eMJVHRpt88TSXKe+XwO96Y2tlBhv7lz2IPKN30l097sfGKfRWCZywmzzV7seArKIOM0S8t8f+juYBxB8yQpka3gGGaJcBVi93y4hOnJH7KyWYdr8gKI4IWmpBdyfLwVdl1x8o8fTRcBqMzp2kPAbyh85fA6lB8IuQ9zZXT2Ec4fS1DjrHzsdHcRTDrybtNFT5+RqvUiCdD/fSBYOcckk8rgBW9JvqE1ff4B9TZ9MttAEytPr6dx7Z/gBqTEZ4FyW31KR5FHwVO0WR2e7VlZ7ajnev67fZY2VH41kLJWPOcVDWQEZ2bVAop9xsTUkdZdRZVmi1Cf2EV5qPZS+33mDmHv8sN2G+Nk2l8uBtg5cnHOfee/lRSZYbSIe9uLh+mUne9EGQ196fZc6NFl1geOS9oI0onAzZMaRH4Wgkyn6Ms6v6u5ZqhD74FwAT+afmmAEZzITtrQzP34EQ5ObJI4nyV+bYlP9mysvUE5JiSmbEitqSMcq3527K+YnNCfu528v6MEerwFC09zfnfVwongumLqo3WLYTxhb9hHw2J+g46JVvQAzhwpHvhmRxV7mFW7KH6dpDZfKlBFSbFOMvwK+4Ks8uRifqmgK4Z+EP/dPI4Ns91bqoEb/sV/HbNc7PeutxOPa4Jrdio7GblJfH8d2CVFGT+8BLJrfvWqFPuC6Cd+fzRdmouXjW54sRAMgopZEF7LOU9/QXTcHz66g5IRih9m71iUA5Q5O39PMNqrQQjkDw/BUWY6z9yZyuztf2gjvMD1A0yEmDYM5O+FpFc68oJ/gVqv7Vy9dN3IhojvaPdE2GRyQH+mH8SFBIseajqWFMZcWe0aQDJof728rNG7EJIGCnCEU6rWY1ncVpGAZVesBTZUqVlSKOR+4wMJ/jmOQYCADqFpZpmNW022mcoHv70GQleQgOnXkww4bTJ2NZfJgMUk+P4ng3eBG0DAud7k7ZfjvDSSm/A/b7jRhIFJT9RoA2ep0qkVn8BCGGdguMv0gWLB4asDMMu2ZCMo4iOn94ivN4KBZRHzYZYtWbSk2rRvhyIo0UTgGoFshCwSdyP3uBwWTSYsl6HMhxSJgXU38Zd+FEkrsJBEOD63xmR75JCBjcVHbbF6Q0bIsuDNtt0K080ccIHYNo1DKrGQbn5xODlRYWtCKtMugd56d7gM7+a701mA56o1KBlRIxiB/VuMHTYe5Tnl3t7ot9n0jNWpLIKEj2SaqdXNKNm+dtvKQCGlcYpDgo+FGJhRQwMnlsIB+mNwb+ZF3kKCzsfgpvu7CSAid1x4jr9me0V7F4LmF84TzYhMsxNPkqknInwMVvdYgy91nJo5k1CaMxCm5CT4uPpndziDY1h2hkyv3r8LXDSjsUIapU7yk4NrbNDukIwx5I3MOkzeb/S7VUIYg3TTtrEcL+WZYhOCbePEzXGutpGDi9FoYrpI5X1SRPcthAyx3g3sp4OM2heka8RiySdxG0c4Cxt7zcWBg8gbpo9bG4YYTfV7at2enp9c+Z2DzVQpcTXL5NJwJawXQEG+T88XFIRUTClEvEPBozjJ4ff71GXswng2hH/mCifYvRhH90lCQu4JlFdfJziEi777e7icJ7VnCkNwFp7kinaUJYSd9jZ251A9ub0KhejoPOf7O9MzhKsotCTh0cUAGKW4piY9TcDEIaGEzAgbI7gbPOBl8koedxX3yfzwGYTNEOQfYtrhgCB2E/smfPpAV/3hhNBBO1e7Q26fgGaoFZ8rKY2l7JqE9VmzTRLz9PZ3Z7uRuSYvkYkAXoU2R/8Vz+hMRle3T3Q472hYpshwhVEcXxEkkfMf0HWw7j8SOUOZEr2FeLme8UN7lVAepzpkoOKhTboLt4XN+XGAOC4rd3YKxA16vM/dtnRqheRSQ9NyvLYZYQXvOFO51Q0+wFeGJ3ruvdoy8GrjqCwq3RaFsFvyjYY2DMwQ5mUA+ELE+IwMYIGZMtgJhkZX+4XcxKIlv/XXVDFApte/H0eGYXpR3mPFye3UAx1rU6FSe+ydkIZ5kTzyExHFX5JkUlcKP6dl4sHvhqudDdAze4rkzqr1RphpK+tF/eCGxTEF/uPAoYro2RljPWUTRDUOEobgLhFMpKKedTD/s72cWY4pJb0khu0ZW8LeXLqG8EIZvUzzQxtaU32G+9qADbUTkxjWaCSQXWqScqRN9YdAkokbcM+fYvh4CB/jtQaoOXF0h0SUyd/C65VE7TJFRw7sRkVYiVqHRq3GXyigyoBrilAVYgiQGznYtIeLSnxFtyg12BbkLBhyY0j1uJ9Ph49e06NzAJWuwLPwqIbHP2sngoeHm4CWTsPaxQ6LikHLa+pG+wke5YffoMtwvrEI9QGBmvdBDWDo7CciiANZNjsUyJ3uIc0Mq1qZTJduLLWIIMnyKW6Bh+0bExqmjFjSSBoGGIhzthK/b8PY3wWdTN0IvbOyRampiRejcLz0863o+XT5Mb0r1KDEZ5yJK7B2em23gBLkPQRJ7seZH42aIIk7U8861lp8M2j/wOAY/iGdeoBciUC4q2pQLU0cB5bPCAWXT4b+wLKJUTUPE4f5Ui9GuFYT6jm49jlwa4mdIbrd07dBTkAKoQfMC8oSre9LicKTkUXpVR2hCQqiz2u/9CspNgqJ5jmSOMXeGaofy4kpHDO/WsnZmYnt6EK6dRLdbz4+kkDrDwllz32bifSDm159IZ35iPWT1UkOwb/auFiKoHUTkHUyN0rXjHYQcrsW0YZBhorBaVjoRj0JOSCrfm15wCGioHwdizb7KUtq4dmojJSFkU9NlWwwGNqL3issMmGlSYA7XmTaQXW/iUn3roviMoI9Y+EnGn7M0+JMWWmKQHRSjHlFWeTu5zvuO57SnFGDtywAw6uMoE5gkRS1sK/McR9sBEYkIpnjFY0+WxOiNeFPmGAVbSfthApVDsA6jVuCuHPGdwVOtGVVdxIHhYhPeESNYlgtFV4p6yPi5A1wXJO1jReWS41oR6XUZxL3QFzLm4tbpAYV4otMjYZeiNWYKMEGcxUOCR2BE7PwDFuNr41GnQFkneddO2ggHlt4bNd2u43AYiGkhxF/J0nSWVonWdx2So10jc2MDxwhK0eNdfDSnXgXdiCKjb2ODlflX6PluxDyu6yxrn+KF3mw6o4QjbmY+XS8HNrIchh5ugeH5sWPjiWTl5cpJBUrZG57b05U8VEAkPyOMVbb096ye9uGBAcDADQGeP28BI5MZCjCSBoy96TCREtLWUndoQHxjmNC0iU/mT+LKUvIDSspVxnaWSGOe17qbobBopJsIDbVQiRw+8woaI6ENKlgIBH+I4aqr/8kRZNeD5h3jutHYW9s0kq3m1mJxoChMVu++dSPD4E1A3qTeqyN1zav6C25UW8ioY8ZlLXKZVZz637rDIUJijDRf3znj5shBeRshJkysEzXPtjPsSSMHQuPtTIRKev446yQHI6fBeWzRTKRtpAoOecxANsBBbS/oSuMMbzsR+yukDXTLBrijhgLci7+Q32DU26TdaKQNkyXOknWmdr02wT2V6zMpB0RY5CyYzNqBlREmFywPC5lCZkVi2GRkSrwePzZ47i9ZbLkSnQncv0bk4CRSmQR3ttrIk35wpXNwvfz9ietM5GbaUFcko9ULTgPjhylumC/r5B5karSDkN9D7G33HRzOoWm6JaD3/+RtEq00Ov9dE6fxrqY4OpZWqyxR5G631rdh5ziMAx4FKHl/52Ze7qSkhBy32Y2+N1uuQWZEkTrKR3ly6SSKZKMTclO+RqhCgG1zX7waRoffpKDcicrqHwcqrR+WnJQy05QK0MrkpXxC4j/qBwY3l8xKUHjLx0xLZyTBdZj+WGUa2FvO1ct83WHwN5CqJOnvmRMJsSIXkFjtYEwM8re/fTHk9i/+3kQPuip1vDln5JoU/ZrvPyUH5LqL7zALD3zT5W4e06wqdzaEZRU0uuH+akwyUnX4J9YHXdxcrpFlHZaa3ORoMbqXb9W2KWdOXFU3C6Upd0NOl8xoWMSVVvVEGxMveqBYpTDq5KrIC3SKmcNb4A/0y09t9wSlQoC2BVsfEDfglA8kiI5bj0KSRCVHV+PBHGM8sFn4OMeusj5n3u0rpVKw6NhRIuqR+yvdc09F/xHK20klXB2rxWv2Z3OGU0b1kncfVrS9PeVgXFQk9wmX9GCpjatKj7S73ptT5WaLsmVIo8aTAn3kAmdOcVC4obVleZGpijvE5H4t/cD+UKmitvzuVyWGEJx0Z9nqZ4+Zwin2QYeztdoc5ZVcJGWUX1jxYfEGqGg6a+bUoLQlq31xnbOG5tfLI9EyIj/ZOGkzs6WuQo5cb7uaWDoJ6hs14DO+O1B6ZbXTcpAEVi6OqivXOG8rqYHcM98lvMcgF2vW2WMIkjk50Mu0GrEkR+W+7NM3xGV8iJnOf9SgHhLJ9TR0JcUHZs4ifzs2A8fHQgGotz35mNVl2GCG42EWu/zZfe69EBOR8wd+cOX6fEDDdK6VaOhh1yyoIrcKf9WNJgiKvxfdD5iAcTBxD7k66y8jaYTmFFRI6NMjQ1RFfjHjD/xRXKGWM2YiKC1ZuLKcy1qManWpoyOX5QYs5iZTJZj68u/yvPwWwu7TMgS9+eHmLmMlRhBXs9lw6dI4RcBvH4RRxyY0BTn0RYDA7S3G7SN6kQ2A6roopjk2ifL6O8odT1yVHaxUtpLXcddmPnBHrB7RH6qMEMIlJcCaOPDagqZQSaMO/ImNM/0g05LYOkhCyHKJJlM6XDaTZRRP0B9iIrrL+BBmH+jmaav+eXrOQER1L1ZZ7VU0XjueC+Zyr2GD9ZJDxliArseNXsdkPaF95nOWz20UQr36AwQKPEXt+1eyN89miaD/CK0GvmCjzwuqc+XJFaJiz6aMY3HhnD0qHJlyKFh2DEOFVEncpo01Gg4ceLBSpAk6EziNRl6HG6Nmj/VA+En3Z1wFi7aH+RUtaEmv+SaRnUSx3qjUxo6xyHuL/ZSXhBwLZpOgGpF9DCBLLoKRMrXOtMJjnwLmsMOetp9X6+NrMY1icg5YpoJTcWazUILZIX3cGMHq4XelpHMF0fHcJsXY8SlpAoEiM/1FSx5O/APN+Zimxv6/V2mzNkYGzpsb/BPvIe+4Y2bJoZ19E67amsH8RAF99TMv/MMLpsz72Y1eBDJ6jcE/u29AiSdwKBLm28tLWHX+Gcj4XhKrajVBrvf4N+bp5VBuvmp2gDV/lrEa/ovusepmpvjPHLEFZM2czM+EzKD4VwuvRV2m/iWbGGKQeVFxpBpNzoBxZKj82ub/Nf5uWM8vR8hLZ7s9icePBicDZxwPNRJt7ptAZfIAS8+TlIt6UcxnNP3B0mCk5allCLTWJl4KA2m3Cec2krDi7kV2z80eAowF845332DP50tAGwuRIC/OK9p2LDaqfBOLYXNnToKUYUL98HOlHR0oMq4n0uRTrOdP+WpWh/0XTX5u2h+1coir9ucA51MeOUnEaORTmRawXxlChljazo6nYc/MbmXcn4eBoxU7A8R/J46WJGduC0shmMiN3+LJ1dztAJuxTP1Kp3ZuSk8Er6xdvNBfiKwSan82Y+NnnEeOU9lWxfXVkDmU7URJCSrX9WfEsJDFKtpieVQJyoD1CbahFHGnJ8qN9RPRKgwvdNqeNoWOxUW4tZonys8noGgFT1hMp8/RoobI2V23/qfTlT8Y48u0qM77HCQcxmLeqwDLp9dT+vWbb6V+V5OrrQ3TiFw7Arfn5OGmEE7q1GGlkUTE3BcOglXDuKfnFrua7eJFoO/EwNFynNpHLWrw5/sKnSFXZT1r9zyFhb8ykf08JmNoBFsWPBx3QBxgimt7dKW9vn/AGmgZNsmPEZA+AlqxIyJHqjn5t68haCBijMLaqasZKIaX92C1GuXW1rpoItbB/5/fTQxchB3Y/rrAfUDGe2gku/y8U6q29CEn0nbUR8x9mYHLqCWHaMTLMPIO+g8Ux4sYfPpB05joQ0EOucmT3q3ag8KN3FP5VUKLWehGKowuq4I+WDN3AO8BkMynO+umaE22kcO5blLOwByC2tE/inqmB87oaO/SK5ZZNPi58cSJONVeZdhnoihqGVPZxHMaB6f5nXOzzZBpKHJVKHXn6s5RjyZliNhcZ5voJIi3MBsofqTqCXxZFsjMjifRCWPDZJcHNSiAi6yXdSylCdoC/diDqtsKNiZWKIxIgZiNhmGWnTuzOFLyPefcYpeomAiJ4biJejMAzwEyWcyPPf0l9+iozTpGemHwkeJJJYGhxia6bNMnaK+Rs1WJ2a41fyhaBBowtSapalgotFYrfzhzThe6lU5VFLFeg78I6qjL1ja4apPCzEgyb56m1DpGYeBMqN4tUCPb/mxfYo0xQKLcsHf110wo4ew+2MbMcxWw7TyaMIqwTzFKNmj9kguR7hhyQQZU886k3ho8849MKQImmAOLI2W9Pjxsieylh+7DFO0pFLSTpzrvdSMCWSXEJFudRxtZuikbzm+aIG9T6LkK6dX5KRZlZMdhaStJ04nD+6kjgHdyyEfDRypFn5xpMQjoyT++3hl0zCHDIn9Gq/AdeCkxOK0gAEbsGQyPTPlH2C4W3+5MKTFcVZvT3bx4d1FoTlSMl5nSK17pOHU9IFvVzvhdzczavLnK5iblKmk5zpQDMIZ1r7EPkfw+8A6h7UuD6UViO8idSDu6C03AZewKAAktrdqpSvAQZkUB89L3WE4A7R4D/57RQ2lOWS+s4CmST3Z36xjvPbWAW3zTKVL/AunnVf5Bw3hfGwz2mGwipr3pXRak8pLbtqixvrHKRU6rh1VC8Glj2w033YXyZYEFuf1S3X/DT5v0qWz+aXbqJ01irdaJ0cT2St1QsJdpb8Tj4liaxLqgdxNx64KxvkEOIilwU0hPm0B2noTlwUZ4akLWwR176XT0CUV/3VLm9Dj8q6I1+1bec9npeDxgxSYDMV2jW9+twlA1sor+NKmF48EMESZdIOOy+pnvhVoRdA+VaaABmOWRi+mdRkQMAVd/N48jYFwpqn2k/JImPezpWPhn4xMryavkAum/zntdoIlnrAUj8+Q8xjIMfUphqcZQzOAE+qUdkCOUUCY3wIoc8txpya4w/ewrAZaRsy38OZ6bw+mTCCnQI2ZNuVQqneCrNg3EAT+wcWGJ6enpKhLCbIBbLnCAHq0Zdjj26OEqAEshKB1ZT7Vmu+R38U6rtxCHu2oH6YfpP1oktCE8jZalGUfEUg9mag6xjw+kaJNzpVgncShFK45CsJDqFagh9dG5yPuSewaWnJqoez5N+2owrK6XEw+/Yr20/kEhaY3lrvmF6jESfcKrZZW5R0hYSf0kZOte4gmqN/kLunx4LWPc4WObs4G43RUroKpTX0vPvYNJo4Damk5HPDDJWe6VanKsTdqE3xGjraPDxQsUCZE711Vqdr86nrSs544hL2ocDclevWXHcGqGy8W39C8a4jU0so/JNdEn5XzRaoqb1vmgsk5/ry7ohilhbIXc7ocqkNoqTfqUXm17RgigtgnUknfhEOqTV3eP7LLsAZsP9ugZgA0LCVWyapmTXWc7Pfv49EmnPGagNaYosdkqrWtc9aSnNdCm8F6nZech+qS2dOqukAyPY257fbvixJ5yV1swD3fZatezsd8Z9RYsIJICCe+SF78c7PZq2wF1sqe0x79kZDGhDj2W5HOoUurmXY7xydx0vHmPmyr//gRvuVr/6wgaK2NQ4Y9iQ+e/oFHUXUTzVB4rC7cps0MRnR8tzpnNOEOiKYoU+CsUZC9X7swROCWxBKJYud/7AKUTaxb1kWjueOEE/zIu0hgz34HiC6arGyyrBWJS/80LBXdzYkIjmAO46KsuDkQe1GGOr80iGB9bfL9jS3DDq0QAJkCNBosF2opol/aQWQ9AyRyrTrvpjy7b9HsB3+6dzj5VNUxr++tPdahFGjrECwPAuQB+PKiIOP8DK1Uo+s2yQcmFzSZk1IIU6Kc8exJrWocVo83jbkBOU/l2BBRVCAvYcOta5y3gdbjWS4VpdWO/fBrrNoT062/8tnJBZpou7wsEf6cO8R/gzJQrcX8hf7Gy6aWmy1ekO2FBHczfjCuIxTtKYPzsxS6J3J4cj1PO8yj+q5OW3YefJs0UaLs2+4gdil8Zq5irlK0waAVP36r4WtxRLMv2RxBPDSukkb3pgcD1402V+QkrbYdHA9ACK8O9ON+sNnj7yFcz5+GlMvf2RUprxiZaWliE9iAEgA39lOdQ+CVlAGvGyA1EEkLt+QHPUtBnW+ScRfoEa89npm7zx1XhqDwrUFvSzi4uuTwr06eFUWKNLKiK3B3zMuK5ppelf6vXwNAJHzQsc51fThi+YB3FyotMK9//FrspTbYboS1WTkYExipw+ekr4vVmJXF9szITBYhtGy0yHXbU3ivkVMFouqsuM6fNt2qL8QP2gkJKq+hJpuvs5McEGPLaIG75U5LVsFqr6RwfQKoHdxMA2o2WYoLisYtKwivqgPBNNppVGbEKlMLyvMP4llRpq+46Jr1WYT9w4r3zsgcVw6o0mZAr8n3MBgArClrx6tI2fViuRI9wHmwA69Qr2HAElVYiGs4EEzbTKQrwbAGIdEipBxviqi4xkfvRJDakesXsA1S113Yx0vNjIKNMICus/CdgUOwONiqEjhDwXgOzwON7pIXUXH707BfAtha7BP7DVZMjlgeMU1CmZrBsKI3TMcjkaw+685dNU4jA1oEmHqwo3MhKYHUO2qtIjMcae9LtGtETrDplRxyyAOomQBmoxm/uYp6lCPWsQcmdR3SfVA1rjf2eie8sfRTqm6xiGrbRsCF3oQvEoPBo8JRUb/JiLGVeMogN3wHD5JQbID0mlJzL2UwsZ2SW0G6rkilkYrD6Ybz07c0vSmxxV0ht0GhGzYdsB4B9LAskxvJW7HPAONN5xDncxgFwO7XgA5Vwf11sfkJwG5Lg82RHdXQs5yEDKHD9eqyBqMpxpFyiWPEOvSiwSUbRWBtL7IYH/6gev5gAhd7rtqWxKyAa9N2sh35VYINoTCV9kde18FqX55r0wayTTCRdb7dC3L5FtIhMCpVNp+sDLJyOEuCfNXoTZiajucBny0ZZ8tSsnxkta3zyTsr2UJBFV6m4eUkM+my3x8XSW1Dkh1B0d4X1usVvTaYJrNL6bKWrel81vGjKmHQ+yzcd5PPs2xPFtdL0K1MiqjdFGyWm6dh0b6zcVNE7u+kj8g6/jM519BlfCrXJLPxLTSBh6uU6HQTjs27BQsvds/ItAl4t9nZOMlo9kzN07rrp+A6F9W0fWE01QSThjW62RebpkkvvyHycbSU1wFGMwj+4c3R6gfwajEZ0qQ+tNoBch3NfK/zenhUd6kpXEt26Z21C++5l1NMPXAF4RvWl5E230z0B7U4stYyorVkcJyPXwimB0DGwlhFtY7Um5ptaIYYINPASEJ1UxGzsGO1kBfisde/QmtGyAx5jLguNBe847X64qbFhQsa5r+IrEvHuSKA0luetfsoSy8mEg3Muca2LPXfRq0Tx9a2FboD8BJMIfqAlBd/8gg/5ClVi7YtU7s4T6bXKmHC5YDJgSfAU5SAtk15UHcNvb59d4mdYqPnf5muSiu2chAbYbfy5sI7COy78E+2I5ZDmraFKKQw+suh5dLwhrhyBn4fAbBztssyjeGomEzDcdLf6gkT7j2JwDC3ClhJlSfCjynNXTTsXQ6KiCxTRrcSZeET9AZU+W4o4l/r9KwY2TRytyw5iRa1c2wppvMLc2EYAsgfCBW3RjrY1l0JIEEte9HhB9K+cQA+ybdY4jZHRLVRVkkGrtcrB9ViqqSpt3QSlpY8S8jyZcse2CYVRj7uQoy4GnIL81ypMZgruASI1DJmKPqK8Lhs8MMXrhobpF4q9UbbKIroEQOhuIYit/Ma7SH9nwOa0Fbk/M82V8y4kTswKP5wH3tgqYvi0A+YmndkbLjhdykGWItfO8U/RBdNh4+R989buOgqf5vjElFTbm+rtt0PSd3a0+K5DPYSY7xBO1On9cf9qB+SipbEarkoJHsjqQ4mZPxNn1A23gc9kxy5uSoJGw5zYuurnEJDnwI1N6L7O+K5K2Cda8+6fHgJrWt2VrgmCZ5V77lIe9r/oYApLg+Ap8yFEHyQ2MJyuWvs132GG3jNrYmtaPjgPdjHMqa5dd93u2k/QmsBs2lSfC8oXHooW7mXRIIbmQCNKlBkfvHxZwljElJyuax2uNLydXBDvB/6TTMD0BS83ga5v/lptvuld6GMcMqL74taRJ+FJbnsGLcaB5smUl8IvWdAaA+Sg2AxufFcbMqErBxK9pyXsrKDxf6DQoK5/x2T8hrIIgi0ZdvKd2kjFPo0BroIDHwNtkTjKR9zsOcXkRTNuf8buhV7wzvZIDry5Hd3OGvEkqQ93P26QWQLEq4/3oqadiReycAdIMEJ2bpgYIZNvT1l8t2YB+IRJgv0wnRnupzXl1PmMXZ5SUljhdRbkgcIJDG6rHDn2WDFjhh54Fvkz+pCY+vv07qtUAsE7l7vF9PK+pRGTNBsGAmQuwMiaudJPhc0wpzNkQZiuLgTz8i7EiXUXFrENhlOA2ukTNKsK90wvbtD5F/4S33e9MtKrlFIWgUjr0j4u6uTRpZeHt7si/iyctxRRD4iuDO726W4s4hEjg6fmJo0fTtkq+BHsLvcXhPDtW1/aRv64UoTAUXulX0KvCqo1OQcKaRAyQpaQTZuzNwKz/K8PX0t1rWeI2RGNJEayvwn/LAHUbxgV83vDfEkYdx/sUe0ohqXkDwzvGHvXv1A2fTADUfqrfKBukU2zty8Y5F9qEcyWgjTJDnQKTpz3BIe1LyeFguZ0DUazDHYeC6Gp4tISKUkvKiWjC1RzmzBJXLQzU3jnrv9nAG8re/noVLcb0e6ZoobZ9/XfwpfALzRy70N6aqlb/AelzS7jt8lWYZ3vQstvrtwY/tNGlHS/FGnkHpUoxa9H5UgzvelsoF5iPtUzzo+r/J6cb0gmRivphyfdi4PhvKWJoM0ubS6vaGQrBGhQNngmmBUVMYnJ1Wmbaq9silxlm/aNpeWo9fTdkmsS8dbS73bDNo1rS3Z2dZVjx0P4grJnTfgviA6NQ/qPHkzb3srqtKlwD4h+hi+uVSdurzkOox6Qn0SPmfkHrHa2b7dKhZFLnEwx0dTfLHjOvOeog0FvydaSVe3gkPU0dJTf03wJRXWb56/KAxvC3S5qVpb3Pd6ImK04znM8b9Km6PZdIOtm4cZ6BRwNMYEAUpwv0+hKWyKhcSZ0j3g2mZGR0XyWee/b83WA+OT+6Ks4zJ1MknUqaVLlr988RXJZ0VRPVAkcOH+jQwsaQhAv3030SSO/exCx///Fg1yBxG79sC/yeRQxhBRFnTLxnBdc1JeGPITAb/45YAAhCt2PVMVm1pEq4RcplLewAOsM6/f8wlvA+jrro4qB3bzshzAMyTgNa2zOHxxn3Ndb/2B6TH/3cA297UAp38JNs0XsG5ylcQgBtccwDtJWh6oMweOPrDYRyeeBbGxcTfBJq0JFbSwYGDNbSnxB6v+xy8m88HI+RIkz10cPRdLCfK2t3q0cgpKwc2f4KT/Aer5Cqt7IcT8b+LeDrnB+HpY8//misJayIfpGDUFzAsFu8IkaItHgPgUfm7RoPANqB+kId6TwlmIS7fDmXNeHW3Fq49DoXdyTlHCblyG3c9xcWeZ1dAEnp4p+5IwksJ/QcMToGBHqFml/bugbE/x8CsIwo71boT6ExS5871tADSwxZgTTcHCu6nxnXbO/nasT2Ockdjxr2cbfsL14OmDKmqKGIS5CzR9PPJPAoDawv5JTfWmuQRvtbeBZzG9rtKxDzDDHBZIJOs7eIA9VtoHXmDj7rLzZsNKhs38qBKYtSFggtDTV89uLtWew3SONxrz0sijR61i3zHTuEHDEvDD6fYcux9biGvKJHNqFrSwCEOkAsTBTveKbQ99gghAcQ3uiPLjTiMBxNnpC/9Jyy+iie7slEEcaUakclfFGVTe2FeMJYIaWgXAkElzk8ycnMUlTywfNwJGZmSG9gR0vP3Rz7Z9xVBuXlPjJZ3v1YrYHBxUCLB9mAvFg8ErLAXCeThPCtf+7mv6Jrp5h8WrHz3ndRTb3fQMWG5o+Xe9MK3sxbgR57+KpXKSKFDQVzDkVCl9hv3FuQLrWs//qnDPO6uUax0j/7aClcXKmkNWRXOvARcUHS1IY3SFOExDxc6MoY/SFtetSNJXzHqgC/2guujF7zK2ux6J+Ku/HqBsBRXnB/y8QMXwIhKcgdlQz/Aq6zIYH4RZhCfYxhKo2xK2Nie/0zyL19U8ButMenjGFopk2m9d6s+lAHOP/tMm7bTsP8Y3zXH1o1WqgzBZJB87CJrMwUifxkzc7aKL7L7sN7buJYNI4ICl/XjGVjPPs/ZLkGhlRinYwsSoEbOYnMaWmwxOt7RONcDe1zFOOLRHxNBvxpgQAEk9uBL6wes1zJj0Rs2MivfG9IS8Gy9sZnEcntzIiT2uvqtdJscMNOqxSD+B7hBi4txzE4q7+pcjxxac+lzSw0TFYmbcZCWH9XNwqTPHgvxrOJn4deUfhs2+/2rGPwIIvced4msmW8kbD2zs7x7XL1qqxB/IyBWUhkLJh1u2te6fZ0sMGfWBqcPIWW8clhg4GlqYc08rPNr39n9/A8hhx4dKu/WjnXgfRKo3bQiuugA2yGcfrwTLhL1NigE4onNAYjaqn7zIrCJenbRs1KztRsx4b/WCgwZHwci9CiwA3IY2QPRKybNYPF8HfsVAyMavchEJlur4Xj8mLPTUv7CMTXjI9Lpy1RO08mNGJuZcS4Ek7em7tMkvcd81o8RsrG7YKxMXkEO290VnyWNMqqqRLlFkJWicF+yrZb8Ss5vJr2AvfZJXWMLUfaOTq87ah97Tk8nQzYwZd8T5bXYayNDgvfF6HpcDydDgrVrbbFF2/9yhnlnsVk49H6zKTIrkkumHiX8osFx9GMP7jpJX8suIqBUPmGTnzDeayE+pNFFi4EZty4mgyUnzs7G39kPPZ5rGTjlDhiHLlDTPqjMd+qEX0pl6GtY1DNpE88wKViWwfM/MDMqJ7Eyh6o+uLvkGzDYW/O7+0XR2t9XTTOh/9pqOykXMkt63kqt+/AiBFKSmA0rXUU3TbczN09UX/FJJvq76YAaRzxUPL6PmzNN8gI08gyxUBdnbV5YdLPA3VnPM3aNVqKIrV5MUTZ/5e4+AC7Ef48zf21of4vHhhJrcaEC4ltCfkoVHzY0Nq2vYcU0g6JaoiOb1CTN06ITNrBB6qOP9nYw2hh5nIZqZZCp7u82tCBpgBmagc4Ms9jAYJ8EwO/unzf+IjV8Q76EXdCG71vS0zq5/EGrOHLfno37mGk/W9iE5cTzfVoRbB84oz3/BT2Ed/jOp4JbXlHWVAO5SzpCXmcDq70jVQfqNMpx8sx1A/rXOq8go4d3kUKxYb+8w7KDswiTe/s7xglokwN7krV9c6LnZ4LMd9HpFzx9p+IfpVpHjr6ldpftfVScHdCfPNZed5uvFHqKX74qaHmQwZP9jec9GKNHBTN/yBXkVYVr1lJ5p3tlCz86PsXv/v/p/+f7zA2dc+FYUtD/QBnr++Gh/IQeurh1aUupcEhk2otAqed6uiw84a6ARw9wXf2XMsxgC0JOr5kYhpx8nQzcjycH545q8Bn/Qt/3ikeWjZ4cR+wtP8dLkOnhFbNDE+2BRHp2MFQuZTPeMe4mx4J9j0NupaB/QV9WDwe6yjpdiFSb4FgHQ7i2mQIv1cTeI/GRYtG7x51+05dFdZbtM9xlqUGy/VhlJMZsd4+SU0XMsqZyV4QFUOtgbvB0DtQy8p0LRls3LimiKa9uQKlSo0qlzLtDWD9GkXLSynrvsTSbfRtxjIaMbwj7C0dstfE2DFiUOJn0gQwnpVic7/OHST2mkS+VfbP281LXLvFLYazAxw9Ja6s8oXQuYC1uAI8RnILS+UB2r0nbhxJnodC76KEzghX7px1sVz3TSiNgRH6QO8ReNUxiffREFg/D89tKrPF3zUKGrIQGioKJ2B62PysSD0zj7khVX5tyxp8TsETFIxwU4RTvTalHWaZxVruVwlkqH1Q7+PP5dAdOWLWNFbSgsb7WMB9vqQGSelm/j06+R6NHUjJHPL8AEeZReSIJ5nxfT7rZKXAf4LpR6RvLSJ5YAvraJudP5ZQ8AFkkFuh0pc6fgO8MOFTpq1BOG5Mg+k/sOcBFuTUxZrUPcQy3UWDVckBgQff7tP0II3I03L+vOWtS2dBYpDMyhmfOb9XfJzn22E+Di1Mp24p9howlRLjARCd0pOrpYZKLU7o7Y3LBIIovrHG4U3GWtFA2dP9TvxAD+KUvc/uastCA++1G0ea+j1PcYMcX3pV10E0vocZAXqGnHviLViCqDBu4/vZEDuvT8QRmRvMiQ19WWSJZIaBSAsDUkT9yWICpdPspk1cnpU5wsuIp+Y7Lwh9qZMPW2hw/WBCjNDHNNuzzXZ+H3JHuiKosYFdZLP/VLD6+rcuanelhTbmRlLf/w1mIboRjSavo+CEGZPKxo0dQR9MbWic8ETOFlAOKurM1xTIfNV8lBLNallrHrSjxuKl3WKUawqSyouXf31sMRpTAVWDW5X3bjZ4Z4ls5dGjLWxB41z9zWvUzG8JERqMdbkxbnidbGXCaVmV+guYbFIbC9556ypIIg1suahNegA2I+evSiOkMfsZbY16LW1VRaLUad5wF1AorAFBVb/yAFCdbgSdAJ5POOOJeUXEEGS13WuJ5c1un3k9Rrb6HKTuNBxg7ayuezKS3XCduMWhJmjX/RVsMhUbdhXqRsU9d/dE2Myl6pYu7oiW6Tx4TBVXqO2AP+qQyMwbXiCRIChnylfs22dnHYD+HnlltiKOj+YElXbtapvyOz3dhbgyhN2qtsxC3o0FSh4tder6xT2I63qnQz4q80jjQ1rNK6gIYOe0/YkvzITtHgXobfZCwn6QHnyucFr9iVhH46IhA1lh0umf3JJPZ+IUfl2KKf/SJA+rGtX2NPBVTAQKNvFYbYuq7WCUcP1XK/tzTrJeg1IlTW4NjIFLpFJ6MxJDu7UuKBWy2B450w2M2xlEn0oZODBdig77DqZ1dcMGrZB4IY9o09U1GZr+7dwUdnKSEIpNkRiPYP/yP9W0VU1KrqET6ZmWTv2TYWHaxgRezqj2ZvywShHCOcaxfZQZpbaNdMUmQuFWD1+3kQoBvoP9lemXdhEgrrjZOJld+RL5f3cPNQ2anEbA84cC5MEy/q9aHsC3TE3j/ZrbfgrSqQh9N/gPJtzeNMAN3b/tnrVq/vYwrq6IUmwL+qyE+iFWdx2lskEEqBqFpU5F7nzVTJD1e842Ha3yPPsXLBHB1G/FLrglVXVXGd2NtQJptIdZPm+IDaR81e7eMEWIv022bMmG1TlRghk5nLm7WS0O5poTnbeygwfHRRNT1/c2oLmJ6Sk4A/Ett+We4nst3NHhoxq7M7xT3PRqaI26wMr6eCnfZAND4gLGxWOsro+xnbujSS/R1hPgSvWl9IEVQx10VK3dvswVvGObDHPeq18GRvF2icZeAI2/0NmWaVXgVMz9zyuEWOE+W6BZHcPQjaB1jCF/Gn1qBI5uFbQ95EONxY3TbNgcwRyTr2ihrqxVaQMujV3HaXNZdEF4BlJ2JC6DIhF3oYhgfcwh1uUQtXnA0V+ZesO4tCEyDkRNzjBqfN5x8utTGzObaDoJ6McbsJ3P0ta6ZzFod5/D/FXTU+jqRWlZDdCVjFWtm/Y158Vr/gQCjzZPPbMd0x21xtNlyFkfZaw654RaHyHb+O3Tn+s5WJ5+mlzBDUPs8oK2TXenvdRNzNhqAoDi7TWZYwszMzNNgvk91bEdKX3TALcK4OxjTS/y/devOa3ZgjWSRFn52fekYP64kUOlaR1mbeH5s8dBmR4e3m5e49n6hJBXNqvd5GtwJayR3db6G+/axmGtc8lm+o3nroQcqp4hHgzmJ8hcyJoef1wUPeh1TioxEFuH1DLktfr6Is+WT3I96N+lBZp48WkThg8E81kY+vYmlo3sudjErZpLRKjnso6qDWaCba+brfGfQqOXWiv24abC4yrLWlKd5n0t+McbRkZtwfTzwJGZ1FaH3eQ6dn38JFnKcoPrFMV6A03B2P/JHChk7f9IQCz+iV675pDL91DGcZ0NhtX+AImJ1/2mpCwN7ucMTzXwVBHOjY4CSCXTQ2DUT53yn8teLd2Gf+bX7gUW7oCj6iRTBZCXBq1FzJ04IJ6eBxrA7lZTpobFFfAw4eADUBz3L84Ie+q7jI425o44Rx6DURQc3mZ2fgoODloSJDlZqRupak++ps9as3TuDmP77sm4FtoBQyeVtMG5hfnejX4QvLFhLVBdib6nGPU2blHgWbnWfhLs5AM3U4hjN6zo50qveO8q46UOE0JmwPkZvJ5C856CKM4815WLh54T0C5aoo37+ja8qKac8ChEX2Dl7hQPilHV3UNregeRHV9AumAC6VueFVIiGZ5J2r1Kg4PsozEaxvmTra4WOGuEbl2Neom5vLH1b650T0Bbfhfj7TE3iYenW81B3uICGoloKqYuGeb+8vJqUcCeVztnVD1RqyKBZj4adnk8UWRaUXQlh1AP1cfcO0vvDhuqzGVQNGEuIBM0skF9hy925xseH6ymYIk4/gE66KsYxxNBGZtiun4hbwoAJ/GKNjKLlLh3TUarjY4hniVJzFBeXM9YQp0tc6PXfwLiTF+uJjKYdRWTSvb1rYZ8vHxTKGm2yd4nSNgPHDkfHaNmOgYQy+Pkk20V7ik+ebTWSLmOyXS4ssn6iDDT1KMOMWAU3wuWiZmMErnDdqWSnfgo8K41GvpCe6xO7L7gq1PolVeRizdmfj2dPxantTvVNalMXbvgN51jrXhuQMNnBjwli9pd5gAVQI20kK45HI5B9ZSz/oDqtJSa5b0dt0RwQv/9LkPPOOo7rGZzAlQ4a/9ZBMjtUtYuRXctn4X5u6Tyk+Kd4+5YZJr3L65Fu0l7bpIVx2ZTuNV3pFVl8pzl3kYJLgIvAHzW+Xl2aXWpN5zSY+ZuR0VXsRMszw5/vb/YglMMVqzRge5HYwTvJ+H1bNVF6/d0vPl9FqEwbkmHaYvRtFEHlsudh8PvsvIVyONeS4ITMU4+J/nShFlYZkZLyO3CL65OTAweQGPsZNHFYUnO6fKteiluLlCCB195GgV52iHRvxUllybPfXT+Um8Sd029zxxK3IMXut/KoE7E8v5ToGmFoKbXawksN+ToyZ5zzEh6LlO8OX99Cak+WnBqU96yjKddh4n+XsSJua7JlpnhPaCV0weHsyQcXT5h30v37m10UlUF6CXVb0H4ZlvX3mSb5SNB3YqEp0X0tduOMbYPt3wuZUYYup9VDMBnshlIKH4dTO4X485l2T8a9xgtSO1F1Ib80n53jKbanmwf/ia47hpg5WeAtpGR4YUEP2qudPAno27bDkTnyb0L1Vm9U2JQrZ57oGieXzZXhfiWt8xgSSYENQ0v7n1mZIzudie2tlaMucHGrLQVj0aOgKnLzRWzhrEvkEGEiooVN5TR/U6DL/2YkkQUjQVzB9fNnTE/NFjfXoT0rZPveJgvWfmLOpU6BrNowP4ehsShPKBJ+Twm7Zu2nB1M2REfF86HGFVFFynsjblsOW9eGIfOvXbsXoiVIW/TwMOvTEUiM0d19Bt960LujxZ0BLxcHB81FpJsHp6dJqn6pC6PsC2RGRbqYOwGs4nj0KGyzqp1DpE8aJZK/TKTaQ/up3Up7lsiLUj+kXYJx/i3o/kjRTXzSmeHcwMPLD6UfKNFc8zYrdGsoGnQykCa2SwB7pbDKFvzECH1vytKSNQdzAnQgVsumosdlf4U6aQZCFB4DACMrgAevt6fehaLCMvmbdEX8Tk878IAGeMDvp/zcYtRupa1KBGrYkBZEn2N1LderlE5ATLenygFCpQmaUi6EElWVq6vA+hPzpko+AbPZRnbP4GbYK5fzq+F5Qt+Qme9lta0jJF7+U+jBmHOsZNhtXEeYUsJDqwvG1EwnaLsHk6xwqNsnjqp7Ezgwjj/7uX8nezA7rJJxcEQgTqO2xkiSVkDX33J5bXOuGxQ6SN63LTb66km6fmciZ8XD866yGQw0HTq6FGXvZ2ieV0ZPx3HTrrMJbaqJL3i6MLotowljov/J2H+vw26TvxqE1NrDAjBp1Y2QxLltS6/uo31r+YrotjvsE512k3XNp9DrsCSyhWq0wUhgbNP0dWd7HXwYlfuwfYg7Q4pnHWl7GLOhQmOt6+lnV7DbXUimWlnZc673zrSL2DSqvd8rsOrKA5JaW6YNrCtPApHq5R2kPZ+xGpphYqoKCMGnk2NxaqcizSUjc7Jht5byEhp4KR/xpDhm+1YHJ1VjsmYmNNBaTPTfAyts2qOYC9FocNuyfsCtWPUBCYLSc8XT0SRgxz5297OdMShmqIVusOHgQ6CnNkVKYQMbs9eP1dVQPzxuiVNpg1j79PQVZquz7cu8lzQrkJO8j5U4BRjRFBJk47Rdr1lceLm/tsDfzPN6WXYFHLwLtG3A+ah/BZ1htkYfnK+ZesWwf3+04Uv/HHDyC6ve3g9Fe/+KmOLcv7XeWmDlZJjDSyT03zbGTetbWwITtq/9UJVOK11GeeV2MTx36Jp40rO3kKoM57BS928mMRVuk/uxozdQu7e47s5KXJM0Dct+KK6f+K+kRepPt8qseK3nLIzta3O5IcBpWICtkAe5op56pFgM/YevZHJfPCvIQO8S67n0ay3w4iTYe/qAe21LnMh45PXDurhf3/K8Q7h95Si71aeA0jhQEnO8G5Zj0zYl66o4s6bOmPh38+eaq71svyNzZ67drzclTo0gjFGeYr0rvb0OG0duMAJQgf9fE7dfVLoespe/Q4BKyIAOQlM/jGIwZ40xTsCMs7+/MwUsW0toVS43+v4/kiicU9OLwBMOLdgALTRYZO1ficYJVWOJ9YPAVMzi7tLX6XkvSS4SZcH5wC1v+8CDgCdW6HxyJlJDZejJ+r8/L4qzwMa0D1qcNwQrBlNL8ygbZ8oxQefCa6z3IUacEmnS9f4ZZJjxyOmdt8J2+knkBtjzLhQUtEXf/vupjZYHwocngv87wuZ71CWIhpV/uEf2e5fDc9wbAZUxxR7UC628kQ4p8WABl8PB2PT1LMBy59+W5UDInDz19mpDxJLq1J8AzlxrtH5LexXlfQpvGqfGHPDxHI/NB8ZbUtXbdtCucENqW8b5bcWvG5n/jBdJpyJvHQ/dKZQTx28NhqD+tOvyzp7iur5W57v8QFvHsRiaRVuB2tVHtat+GNtafRfn78hTwVHlTP3rOkCPsr9BvQCOPEGnyWtKgRvv/yc7/r8MCQOT7xoOp1fJ+TiH4qtT/5Ylkl50mK5++hdj18qLaYIKQRh08trxH+j4x0DObGbLysIT1ILLP55Q/3z+NtOwYivpwlfMw7hkkjsy1C3LGbR2zCab5nUSe81Iq23r9PHH4jfPIgScQqPM8mjTzbUjBQu+0+KEx+0+dq2MTbXbWevOdj1EVj3jepQTS6LIGx+BKqtF+86a9W6eoMm++ui8QPVYz5/0dzkDz+Gc+1fnFxHwoAQl4Js8fpEs5cvQHPVAW0v2oRoWGsyv0ewhSqR8w9BbRqzIRElp9oQTFxC3lHE5gTQj0J4EOAIrRQ6YbclDVRlal28SXtvRmncHzAHwe03YrpdXFycaN/EsK9Mik8gGHtWtBCccfPXv7q8f8N+H01UoZP/bUhABcXT+ECJfV04/vm/WImbmrG7HugTFgea1U1k3hkYN79ZZAlckCwiGddo2ZV5FGG3+hGUX1l4DbgNQP8lH8L2vosEYWbAtKP/XxhRXg7SMOBsmf5nrU1wZT4vGs9jfrhCs/s8SNvwK+BRiMRK3vwqX2VTs0WeLhV6bGFcHzG2oE8btxOPadeJ/laTpjk9onXXsw/Tq9+TLP9qjexy9xc2nVOXN4TQy37UGIoET2u5ZCKAPjCctDh+UMfVsUklI0R/bcDarFr6wN2Lv/3S6+hSHygALD9uiZSP1/ZzoWgjz/TpGjiLza/WH3CzJeSQAXIuVTV4u5ioY1u8/W1/d2LWQqEpTjzAF3dcRF08J8qhmo947LURkb5ULZcDSs0AEbrISnhI73q1d7Tz4OBGdeVqrctXRMZVlQoffXNBUVDsT8pP2ktfCR2dYc6BLp+A1bOY72mFpaiVGCDGccwj6eUCT4ZSWHfIDZYRmP+hqa/8NPFGZ5X/iXp/HLI4n4X+Y4FCXSnwqYZvtl+LnE9B0Y0ISabwXqA/NF4+g7scr5VTFi8SLHGzRjURLnF8PnM7WyEvmO5EpbcivuquQNKZz51GYAGOLw+cSVkL0OejaGfr/dD50NUrQIyQv5+Qpg+dnAZc6t9UawAYTdKaeH0PpLIEhzxp8Kdj8AxtnUPa/3egzk+lbht9zDlyLteU8jVK+5rN39G9r6Z18C/cHF+bORj6ocq4a/DYyCTvqzL7shWrNZM3Ju7728KWvt9VyL+sW0GWF5/mBgpCHovL0RxcDF37H66toiouEmJKxAVTSR+S2vnuPv0vrw12B6jn7YPHKeDe54Fm2iv/+t+xaF4BrJA+VTrG3Zlh0xgzwQlSn7Nv1ZndQM3YytBHeJbLFsilHhb/uKSMopu7D8EvZxDbDU9tBYEtNm+7OSgAhHRmW2WCzgeP3+lAigprD8TRRF/UWKCsXRrFK3AQdgWnVP6fxbgyU19WkOIreaIIYsRi8x0CKr/FzcVeIxx64xWmpTJArUCzN6hPz8ik7diT9ij4sfMSV7zWA8GBCF8vyV60wXO1ltJg8vwkIGLrKkXa5J/KFEvJWz/eXppI2RrV6fS1NqhyT8rYgipRWttQlaAbYpVf3lEeuWx/y7blqKTJwjZRKpBcUDrkOyUEAT/MTqfjQKw+ICi4OZbZ2vfZOuiYn8zT2NrJWHZQUKejUlPKo2VlyzXfzPXiNuDrz7xwzkLM/NSIuYryKG/NXlPAGvQD5iNQRTg9arLeXbrOv82l9sOGjfVJH/2g4n1OZfVHykX/0JyZqYztNH18iBEeX3ASl0ZZJV/UQytBoplg3v9ZDE1gT8CCJv8yz9Rvq69Iojpy+qWish23lFUnQzxP1ZJ8qYXnJDf0lgHhVZ6W811pGs/WMzJhiwrs7l4UyTzKkoVDlni5H9Y+tLm7YIsItCTZcomUdQNew/y/2SkYwq8R4jddsHJS31WKNz55/O/b3FcOIFXE9VY9gh3mL+QNwvS5X+JBGRL33D0Pfb+f98d/bn3i1bO/7lXyBnVUFuG/BGqwqydh2vRzHX/uupRHXaKJ1GfB81jWbfW7ISwy7/BY0ORyZJsCvStPMX9VhqEdS6J/8XtI1v8KObvDIxpnvfHk45nJ4f/zTgfddB7+mOG46V6LAiWzAWExb/NSucMA1iccn97zTh2m0icd33tf9T2tLVP8mopONwN+7fCngyuh2R/2Cnct57U53xPIFpj7iiJItny6n/ZbbxL0JRJwR1cvFJj4PyPezhhP9mG0fM4fe92JyAD46fnJdVHHlA/2YikjixXOO6bR2QuEo/Ct+PW1T/ucvynuPF4ghAxWPe7u/vh5i5gP/ijdphBOJdtEytV10Eoa29n3j8WQ4Pv4EUC7xW+yK9tyXcQ7OjggLYKEbgS1u6eIDcRZw2eSANS1Fd5BovdI14dsgoxNo9sERV74xYBw/DZOhAPjRTOR21zIJwOU14/3GY9mXdr3fiCWqw6Ue6AwVwaTAQ6p1If/az74fq2Q43jgf3Nhz2qZbrEGcFGo1n2U8EsW5N2WysGTyPsHgZlFkihmTTOrzRhdU8Aw9/jpA1lSNXeamVsLb5KMzYurCfReqpxTbXcLCWHgKJ/2Ypyx8NM9QxZZCvycP5JBpXYTrPsEhQfKi2xWaHgWy4Awmh3V1r0XbssH+OVM+omvE3Y6kkzoYWg7t3XxgSGa8tCwrvuSJjYrNhNYdaZwU13Q+//mH3NhPJ+PW4XXd/WUP+lJ6FMFgpCt9iWoMrI+jqLO6nTDKh0/fa0q1fJOEOGgkl0jcDAdvqzFj2B+ma6bSACaeaz0y87t3ne7PeB+ACjr6/esvaV/yPx8PsBTFKyrrkegEHGSbmSWyGxhSzAlf+ks/lx+idPLI06ESc8TBHrRuL+JACXUAOUf884nWDP5vAB9MtWnQ6nuOQVQICAPBVCsumOMd8T+cQ0NoEOGSfdPvw4Gb2fsjKozlVEvfAfhfAmD0nw5MK7YV0At4g/UJilwZ3rzcAWR9d30AFgf2qJQiLgQTCWa0/72EYNV6mZgBc2rS0OVqxF4dArBGan91t3DAHl/akpLMjI3OLYSkMyFQJGWgI+7bDsXtPaDy2HacCG7JrskfUXGb1eoS6IQ0dxyVjqyZv0SSSpnxVzFFL3c7Rqo9Dczp2KiUQD7sQYHB5Cd1vw/oRDLGMM6DiCZrV1fGawj+OrrDtl7BG1zB7sYjG60xuvWkF5SgrpBlNSF4DYmQf/fkykHUEdAmszGGfLaMGEfH3oVeneGh9fyKCjPwCTjGqXkTLTbOVO+aW61mMs5jn3gZwGdM47zsAZSNbMzLPVAQL3uUo33zSf9EVkUMFc/NoRvRerOIzhyWBbXsxqzWL6CFAnNVgv2vvhoauZ/LmRNURlYd2VTcF157BSP540anfj2bYtWlVWLC5UBrwmAbl4s18+jXwvVoNH0gbSeguHuIHiXUPd+YLtNTwFKpvwUrMjq5J/3lsC6DTMwXTxDoVtzpWIV4lU+lA6j9oxmpPdS7muqelFYFm+WNc5E6SAtJR26mz1h7vZd0LI3f51vrSm4k1azaxdrO+RTAymS03vFBdLoaq3AeAZQvjuKegFybDDI+jpV4MU8uE5d0y57l51o1i6tNTJ+8joS2fWTN0EafuBeyvf+Drgn9Gg30eAKX2V4Ubr2C+6hlNQK1S5/EGrpyrrY1BV6ufXJlT4UP0lBODLR5hHcLTUTZ8fBECGWyoP0OuBY/mXrsAlf8Wgo8qf5+maGXX9XjDHddJV6ZXqkfugAyucNcQCLIA9rcTc3Z95c/fHB5gO5pLO5W6fzvG9RDjXGDiiiX4ky5ERlMvSN4TsA5Qq658jcUfRa9pVJkFxijJDCA7AGQZUOD+ghpnxJd/WnIkq+K8+0Cld8DbwoR4afk1vs0AthOBnviIOrzhKgcvkN9RqTjOJuxMg8nqt0a0edH2OHVqbl8PP06Tm4gNHh3aU+NHbms8lERuvGimRqTOtVG1ioZ4w1KPoTHZEJb37aulsFJZWnDYG3MPuP516tY2kPj+R/1e1jxujOIiZQQSzBSgTHwhYZXIFD7xkareruLuyoYZ5P5TqRV8Dfj+1Kz1ySqAHofintLVtPAU/EsDEgn3hY76nv6lCbhsQRYAk2UdnYsX9BUPH4RoPWpZorEISCmmIewCRRY4WMfXyXl1lfDWVyTAQRYIlUYFBrdf+h0wRt+LWDRci+/b715+s8MtHho6FrDp0Y7PawWPIlfLk4PPDmW6epTGt507uSYDHhKswIeX5X9YZ2KK0spi0oH9lN//kXlPCEf3tv/IS58eSCt91CuOYY4gEQ46Rc+TijgALgHdG0GOc1dFBydvzZLUd+VGMzFtSrqBQwh7r8UZR18ysMri3cT9lmH2e1ctIObDkEhyUm3b5FN7Jo+fOUiiejFL6WQCxr1ofc1b2n1jWEnsVPW/UHeKYWlCDKXsgDT9nXbUzfvm65G0T3Snkd0PXK5rrXr5dwK6psc8bjus8OcJRRuN5fe+ofYLlNAcp8uFVpzOznPBdH3nL971YbiS8kipadeIT0iD+MB6cKEhDuHG9wdZ72tHQ4FONpdTjHoWmMieI4RkJTkma6D6STSrXT9WZ8h2X+yFjtnJYQ/8XqMmpZK24lVVytgC9KiKR00c92+PYcFUHRV/LWkI8spoqNhvBC64HVfGn+mK4Cne9Z9pP6mvB9KjQxKAsdwepxrn0hJvx6Ov+jhT/SA8JiKSxgPZaxT1Tzj/ejTQNFAfjKebi/GXL4YgTdeUoLSKRg96k54pxLHlrixxyyuTlicic32HHvyx74aDGqHez5maTwDOWKRiPxJfkgYiVVPTPIn417PJPJytx1jSr8ZPYlXcRywT7uUgKRndFkCb1OvRwGzJrHpBJF13jPR7s9DAEiDbq/IJs+8SBKcIFCz0QQgERohZFcPqZ+y8m13/WysUu/b4ypfWpbu7gzr2n/Jw8fpgyb1G4hO8lCcsyxwnpuWtmHPNx6PMAGl4LXP+bLq1hFaxzuA98YoPyZOgxU84MF7JSNfiU6eRQNFiK+fd9/VbHJTvYyMnTpXoU+OozkwFuLl93S+JKum0ZdaEd0cBfaTNI32yiM61GHQJAIz3u/EQxnYcXR/vluswsY1j4frlXXa/t1/Ra9DMHTlju6g5GLu9yQ5qsh7DfDyc47HDlJgvtJf5jPU4WJaSKcQ+ir0y1tX8MU//F4bKUqXISytTJ7v9+wZPJ/qfej+vDul6Xx8qz3db+kWYTglNKy1D4Y/zTnDexduFNKXqQTgb06jtJHBYv/pefINj+04JDmv6ER1hgcfTlhny/t45DJvGG3WSQ2k+P6EXIUJTW34dD/IJLLSxpLyDAAbI5D9Eqd9JQ74/1j0auTDnEwara+E56R/aWKNFdTSzv81IIqSsL07B/wHREF14399IksNLPCmQ6KsLNnKynP05YHp3jTySEs8t2y0YEN2bf57Jt4OYwVxJbUbbmmVAZrtO6C7cOu7DloMja3QJ0xeTUr1bSWQCVQmWw/fmnw8LSSOCW4lwkbv1TXmjrWsZzgo0fupm4MO5Pseay0vltg5L35n3dTQidFC61vJWRUUyseqd57ma5z4iRgjij7Kk5ZYMUzYvJSwPb2RpXWGt3DAKCYh9p8UkBLe+IeijKNyE2pbwboAsnXa4JhqcjcMCmf70dL1U+b0RX0ZsIbtH2AFiph8bzazPN/uCZhGtkim+Ju5qq6u6zoNV2dggRQLO/qFIgVUSvTdLkDdWFcLL4/JxTWhv9WSeIRD5K0rl/pfqQFkZjiEbHHEOW3Xy3CZui5/TEVz0MJZ1gfE4tdJq3DfUgP+8oaOu60MePps+Tx4IPApTDOy7lRaCnZT+KLQ7PWgsxHnUkq5B85zz4YDgUJ99uxYxHp1RQpbBipJYf4brmTEnK13kJawn3FevSmWN1JP5SOHsjFTIPE08z48cEMBeMxi1gq7SQvdmNH6zD+EPajIbDEFsATYTKT1u+LSqFBYV+eKTMO20E2nCfRNFmsfxxHDG8onGQQiY2XZ11GVTTH6HVWbIMa+hkhU0GHEA/DHazRySJqh6rvT3IUAiH8TUbn2vVyFCU10eyWOJQ1/oy4TOasAx+pxqCC3AZ3aru0MsGUR9eFkRtO+u3X0RoDCBb98lmkmzYca3GUeFgF21LTsJLNym7MAEM4ipBKMDsFWW0xjOENRVG6BJzL/am5EU+wMDG6CzzmgOG+a8ia60ojPhksr5ccrvKYQS0fij/Ee/n9gMTjmBNQgKoAAm/4JGeCF5VPNpkcNCZKAVXY8lwyL27VzU7xr0kgE4PyJPVzw7soNtQAux8uXKKL9QYIVEO+B0sC+IAVyFgq9V9DwN0y3kmzydiDZ7DXkVfgaGanS4BW7YSRDKhEbN8v+2JCCdwrn175U+JP+d2d3coGn7sSiu66HBK2j+REN/JvoT+Ei+37uxIebJjv7NVPMOAML07hN/f5JK5/PlmDjN0KapatxqVVy8atub9xavtie0Jd21SAIUthKruQdZTx+ALPna6j2LykMpWFfPo83JC1q3weMUb88NnvAu6IZINGwK90MXFnvlIp/bwUQ1KfbSZwGCQ6sArIgzTa+4azrIDqXA2BpASY3aS4XypvLiVsHHB1gLjwTgTWuRvkoN8Dlv1npCirdB4q83kSv2eaMQ/c89AGk1Uky2CvCV4c7+rCszIzL5LBWrro4+T7qDTT1PpTHkddmDyF2jKK0TnhaoG+PefvXbvHOD9XtK+ygo27uG/gJNS/yjRwnn4lTuYGy3CWZw+eqE35xIlb0vabNVEgNxBjGWtSAZubay4R35ZHG5Qc8tiwTgepHzDxHdzfq9zrDbiONvCb/V5HxBLv1j5Q7AljbEebcPBUFlzJ+BJC7L+CwLrEpLxykJMERKaFDBw4lOvqV/n+G0kl48He1sMD6tzoFHcNtZ23uBFKnv04IY0yA7IXymDsUH+LTeXajAUyPe1gxsJbgAV8BB4sm3k0hs/jX4Q6Q2FUyGsntIC0juj5PhAf9WLQC8ePa9HUTnB86VlpxetSdRS+ta5luzxFvqpSnY6hNbb7ObMGTfpHABNw4veQwGB86XR7TvDzbDjF8QP+D2qAanPd47RQW8T7vZp2G7YPx2ZTu1PT3fegVAHi0PdxxZoy7VboRKi9w1gQoUc7RELoYks9L+pvOLmJQZkZmHIpH5lymN/IBaMJR9I3o0DCujWLw0hVvOK/lfk7861PJBJU3P8MwpnQaJx8PU2ZbjqE132/Fe7euKtHxhjXjtBgyaawHXT+pDoP4LxV4DkyAn/gTzUmlMn8tBVNmofM5Irem9VkHG/F8jM7YyIFPRy/w0z7xSWx3+NhsPq7VKWMCMN6V4BtQ37xZjkXDhzY3aXV8vtoXG1rw6SA+zRjcb9HS7hD8r6fmfFgptBI4G1McfK60A7KPNcNp6BxWTmsfTyh48xLYiJIMURy97/MMcifQy5RqQfvLRo92g05sqlHubcwMqc2Jk9xMIrM/7Z4i7pVpkyD5Y5HGIHQ5o6BNDX6twwsRb9YQzMO7I3H7daBLg9D2U+BgN7cB7l33c3lZEokZMVwVNUxGrCifL9+NSprBo9zkBRLCnLfQMm5i5dM8vMfNON2/mZ5MC+askTeOGAN9aLzslXSapzm+ZhRroyAZCwBU7j8x0yZQmZUy9+VTv1Eb+9ExFzWuhwGDa85YMH8qud70+RI1Gjwive/kftY2IjOvndUgoklDNM1PABxeJi9uYDwbbzK10NcpfigBELV49qeITj6tpB6zMn/Ye/HBX95SsqJmYMn6GZnVBKLwKDglxSFhj0NfbRSc6NZ6yskaWUP7xwG38JMI4tYzikSsRWaRk3+zXurWB//JCIUeXR+2wxWJl6nUvy5W57SlsXGpelcD+dRuJLQmEqeg2UfC9qjwpuU+DOYqgr4QhyBIwp4/Q7vXQR1KjaS0/V0VZ1YKZQmV+FqsAgJp3ftzWnMaLj7VV76mbvDezTATQTDgvjCpRXvDn/o9MS+M8WZky9tBEbZGH0hokcNkEsiyzM1KWEd2nQu/edsmzCwBPAqsbhojmIJqGh4GG3UCBc4ZTP8xGwNFP71XYD4x0U4zqkX97PQc9D9xI1BbtqHK5SZJocXcRnn7cBLalrYs9GYkJYMKCt04tEdC47LkPl00nhBwsZAZXRvhnN4cqm8MSEdwPmhWoaxj0Zo6/vTCPbA16QiMHWCCPTSiu2PafFiu79RXE4P9nWQsEnkcSLZ3168gwLFcLWjdhSGV2cwC1lVVZ7ov/GQ3h0tdDg5KoDWcALupeKmCU7ySuF3aAGeih7NdXdqlbtsTztegbRr2e7uqZfd9xauKvUt1kSoNrT0WnvuwbahHij6pziWFi44sZw6H7zQ1JVHmDIRcS853oFvbHSISmn57bJtZTyU0vf4YuO8Syq1DuAB+EOFkf3QJLXUvOjpk+fRxiBVNbPL9YWX/fT/QlbbqFKr5qRZbJZC//uwz5y93X+PmlSSKR/Ml12j/rKthV3GxqUnuvz0kf+tO/btIrUhLZbneqZVM5BqizNPGmfiqJTBR+4t/AmsxWhcPJjyXyuCGOGu+U0iGv2fH2J76dL7Q/+TWFwTD+JBf3umuinQTO0XNJV5Ntl3YIgEXjACK8BwAdjiCaSkWaE/F373xkDE/KWvl/a5lbRiVUSDEddEByPULi7/paK8+8Vps5E3gQPRQyNVZy6iIROKHnK40N4ihm7ncLaNrDkzkXExJZgE00zszwTAQaH43Y9IO78wO1v0kVU3ts0PPb/DUODKKDT7hHa8ShlBTM/DUGIdP6Sa9Z79QVJR3qN30mL13uMM8xYrIJmNiOjdbOAMM2y54GpQOGP79iiGpOamHh70rOxa1AZ9AUVAzD7vzC6dnTbd6OiCL3WjFeQTVZN0tyLtCXFyzZfOwpvFyccuhbhfJo1veZjS4stMRnWyVPS4ctRMbHXNOO274aRY/rjqXZo12eo/Dg+ao5XaLqWaHsQkFkhrWYzLHDz3qjo/sxOGeaR02raCN7U9PnSRmq3Zn2ULFzzu5ZRqsF1Zzb7UblfHRgetMqQ3GIGPG8xZpfQzDCLIGAgcIMClA1FAwgdQWQYOhYCSrFL59/XU5wtqF0+2UkZb5FJg4rferBnt72d4UHpmr26LzQN7ECGG0ENXTv4SIkB+1fxq2BB3CNZZmmE8Pu+Mdy4joy66FHPhKrHUJge8fZqtmkMEiORjYk91xvDJVYhxww0pw6zzFo3NNT5s6zFPs3ZksNVBGau1wRNYPmZLyAiJi70L9i6BySGYmmRxPVjMbYYrhPK5JO7otUNOXNmZ2dTjIWGJQPiL+L5QBz0vyTzDIVT+fLcWIRV5VYsgQXf2OcFqw78X6n9GO1d64FOAyoUflqlKzPCe2aMTazYakkTiN6oTcgDOChGFtrfth1rJT9RvTxmf56rIgrhFt0X8UPc88OB1++SPwHyQ1CsZZE1uLQDyljmQIs2LAgM9JPJ8/3xtHJ9kPGLBIqm0q+jT+qI0L6v2xn7gbxvVKuYqzjDg5HwNumBH5OG4JmNOH103ImIRbbtht+kOLWe1dUTxMBWP7GV8D6tNZXFxV3KxzpAVi9NPYqVRTh7cbpwCtSgTkU23I3baxG7pbNm5uWun+yBFKz6I0h3PMnwCK+e5fHcj/cM2RyYii7Y6tOWQBdArV1WKLMoMO1J1xtWeWo1bwdTaCtDRVdXfIuTnkf4zqutvTk3jbhNM9otvCgO8PDfTwGMo+VIclvD1NsLM74AS8iot9U48HbmWt21x43Y+o1giLOkPGEgy71uGRET1Xj33eRLPQDkToAEVjKeaTpa0LPfwkIV3mCnCYA+qQFnyNpegFvm6VYD+/btGp8+jAUhhQ/6/Yr7N8BO4JZBwCWm2ajb+znTlW4xPZHqfTTJZCYCTPZ1v3ReRnFSBWxX4Lt+bvFn8IY//1+zUmeUbwC3XTIsM9Ps2sT+n/Bo2KrUue+Db5a754sqNmJMNJw6KxlZEvcMizu93WJopSfc9JyoVQU8l2+XixgU9FH5cQhPdiuL7UVihMqOKcCCsteoXvU9OioKx+KtJcjlvtXkyJ10lD4ugUt0RbEqcsx+Yzs+21/wuzYS3yMvOp7BnqeXYxw0jeT49W0td7sfZ8mL6WFM/1P7ZT5tOD80itx9GStLFFzor8UsWfP6bQQHNsIyv3+id+ZSRFXOwFUoGGj085ijDLmZiCeBLDYa3d7cDH0OFLqJvgfiYGMFlD1RuPFWxxsJWPyasD/4fFr51TXapLgJHPy7NBlbMN7q/u0i8tR4lSi0cLRYhYJ832RBj3qrlrxwfpIVIuEuEfiAwniNZ8NE4T8QxrRyB4KzXdczu2KYDnyXwJ1H+oeh77tYcM4w/XdDaYpUIIE4Gdc4RG0NdNehMWN9DPU0TGK0gysCJLlPI7IZ2fWugZgSvya3OA/hpZiBvnxF57o2/FmEztnAu2u+G0N7NTS6PGTbs05/Vz8mLiYvY2NrI5QQXOTgHDxBdNjbE2i3Z5XkuzrSan6jS6Z0kiq5VdZUMCsy/d17gjfuOPBFCgrMPBSSshbr+CzJ5ROqVlKdlDW4SUYIFQPzbYpYuZPKPoNdrLMq9SHkHhAnQ/3XPFXflgVcyz0w8RCouIfd4BDTNuTGjZshUEuSgl7+bew+0yfDjycqKFDkjUxi2NLl8z5DNVDE5VCz8TrVq2xJkAeotGQB5ti8sCwUX3DQrm3YTPhPQLJaY20llr4guyYkCaNRtZaf4Qp3Kk/hrqMP6oAt1PNWpb8VWY/k5uC2drsyZhG/vZRsNFyHKXbtgGtjq4DcMhTB2mPnw9+Q4+8bED+wLyt1J1QATJ7XyQYIcXK07+xH4dOUgF3sv/wyAFG6mZaJEnRlLjvRz97uUthWkfhWWSlNFayjqxwCippOSbYy+uW8uuONHyBGNOSCdNEOFUciB2FNtE2npp9PPXjJbTPJGkQ2Ev8PZmPogUWxu92YpZV7eWQbQDC5zOsQ16AgEXQfD0EkkdrAAOYVQAJpgkAAuCIAApauwAKKegAA/YhAAoBTgACxpgAArrRAAO8sgAJlX4ABRv/AAPdxQAKO4kABEhWAAPomAAKmzUABUJPAAAoOwAEZzAACbn3AAOsfAADz3QAACMRAAnaUwAD8FEACnVuAAQ8FwAD3rkACj+JAAA+qAAKkFAACjzWAAF8vgAEieQAA74TAABOIQAJlNEAAC3SAAog8wAJwsUABDSFAAQBPQABe4AAAKlZAAXS0QAD+cwAAId0AAPOBgAKTeIABJHhAAk7SAAD7/0AAs+2AAhVgQAJlakAAFLRAAhWCwAKYYUAAq9fAACKjQADsCgABLQsAAmSggAEEUoABwtEAAoXiAAKzeoAAHH8AApRYQABboYAA38kAAmyWwAJyosABnziAAOvjgAKFPUACaaNAAnAcwAIepwACcE1AAj3HAAF7iIACk0DAAP1igAArFUACYh/AAoVPwAErXgAAX06AASGngAD+icABpy7AAMK4gAAII8ABTHgAAoiLgADeSAAA0rOAAmMjAADVJMAAHayAAQBaQADySQAAFKVAAPvYwAD4oUAChMAAAnE4wAERqMACkRWAAQN+gAJ8XUAA+2zAAmV0AAEC1wABDyyAAF9igAKPjIAA70NAAp8TQADBgwACZLTAAOxDAAD/EsABEjjAAn2LAAKQScAA5W6AAgzUQAEDdAABXOsAANxugADX4IACd9fAApCVgADwjQABDzyAAoKhwAElz8ACcdfAAmqGQAD79MABDQVAARDNwAAa8MACmRbAAP/jwAKXlgAA+DpAAAtDAAAJFwAA5nQAAAqsgADODMAAtj4AAWrYgAJrkkABDVKAANypgADzWoAABt9AACupAAKjLIAA4FTAAKrWQAAUcAAAFq4AAChsQAJvhQAA/u0AAO4awAD448AA+5jAAPsQAAApiYAA+V2AApzKgADVMUAAv+oAAmXeQAAIncAA/csAAltsQAKAmoAADcxAAP7jAAKLR8ACuWrAAANoQAGeosAAAAMAAMCcQACoTcACZQ3AAP5DQAJmjEABG5GAAPT/AAKUQEAA4ByAAAjvAADl6UAChc4AApW7QAKXOgAAAmlAAmj1QAD7vIABYWBAApPugAD5CYAAFChAABEXwAJicwABJP9AABeDwAKlWwAA+XKAAAOSQAJiXwABJeGAArTBQAEDAEAA5TFAAo+xwAAYxUAA36bAAj2hgADdO4ACk7bAAo9lAAD49UACBFwAANPPAAEDQ8ACjSvAAM4awADl+YAClPtAAmv1AAJyQMACjKhAApscQAF03kABAqjAAn3lwAKRIEAChcGAARrMgAJmbkABDr8AAmR8gAKPoEACalYAAp8gwAJafYACikmAAh6TAAGBosAA5s2AARIuAAKJtMACdlNAAPp3wAJ2yMAACZNAAQxzQAKLJEACdoCAAQ33wAED+sAChO+AALzUAAAbEoAAGAkAAoNVAADsUsAA+6rAAOQBAAD3ZwAA5sIAAmRyQADls4ACcoEAASNeQAAD6kACpZNAAmQKQAKzo0ACYmiAAQKHAAFb64AA3vWAAPPTAAJwWAAAuvEAAh4/gADxbAACh4EAAOcZAAD+LwAA8tqAAQOggAAbCUAA5bmAAnIuwAKLGkACnwHAApYhwAKNIUACjClAAArcgAKKN8AAX3aAAoDagAKRmIACnILAAo7OQAD/ZwAA/zDAAm/FgAESXEAAH3MAAcgHQAJ4RQAA/M2AAA8qgAAhFEAAv94AAm8egAKfm4AAw8KAAWsBQAIMtEACmVpAAU2gAAJd3MACnSNAAhjuQAJqmkACk/hAAQKjAAKJoQABJtmAAA/xwADle0AA88iAAmHgwAD1soABPPUAAQQEgADry8ABEcgAAmYFgAKFZEACcpXAAQzfgAKZP4ACZlLAARF6AAENr0ABRTHAAopTQAD0HYAA95zAAmsmwAD8+oACaUpAANcRwAG5mcAAE5VAAQLgwAAiQQACao/AAPydAADAFQACnCPAArl9QAD8CUAAD2FAApbTwAJlkAACe7WAAqiJwAJ3DQABH1iAANV5AAAqf4ACY5LAACt+QADzbQACZSnAAfKnAADXyQACY0DAAohfwAFUvMABgj6AAPklgAKaL8AAX1gAAoxEwADTB0AAFIUAAPL9QAJ2q0AAupaAARihAAK0cIAAKmsAAUMKgAJve0AAI0pAAOp2wACqTQABA08AABPOgAKTYoAChOLAAPhRgAJrEUAA1+vAAokxQAKXE0ACjTWAAp3lgAJmR4ABkIlAAPQowAD2zUAA56JAAovigAEwc8AA8gyAAKjWQAD7jAABx9fAASThQAKnaEACZNFAAP3cQAFrIoACjHAAAmS+gAJm9sABKLPAAPoRwAKBtUABIpFAAqWnwADeLoACiHsAAQOyAAC0e4ABJLvAAn7xwAECxIABajoAArNoAAACFoACMIgAApX7QAKPK4AAFreAAQOSwADl8wACjagAAUDJgADfZ0AADflAACOugAJ798ACZlzAAMRcgAC34UACRouAApsrAADde4AAEtAAAOBnQAAqFMAAHT8AARi5AAAPHsAA7QZAAPl/AADms8ABDPrAAPIjQADvVIAClspAAP19wAK16AACbZUAAZe3QAAp4IAA8jUAAmmwAAELUgAADIlAAQtowADQfIAChW5AABgUAAKQpsABDCaAAA+3wAJwaUACaY0AAACQQADXDcACbKdAAPmJgAKeOsAAARqAALUtQAGe70AA/v7AACLiwAD9kgACtd5AAQysAAJwpIABXF+AApBegADwTsACmUTAAUuUAAAoWUAA3hzAApOHwAKW6AABDH1AAQw6wAJ3XoABLyNAAAV3gAD5E0ABDjLAABdNQAJyisABUg0AAmumgAKn8QABENRAAnyVAAKFtMACgb+AAnf5QAKKi4AAu0IAALIdwAH85wAA6HPAAP5egAD6lcAClANAAAnmgAKQzUACjuwAALwxQAKzhAAACHdAAmWkAADDdsAA+cNAArMdAAKJiUABE8SAAClCQAD3ksAA/whAAPqBQADBN4ABH5PAACAKgADfRUABuffAAmlewAD5Z0AA+vsAATFOQAJMm8ACcHvAAqYxQAKT2oACZhcAACJWwAEOhYAA5HOAAqWegAD+JQACYtzAApUxgADKTcAAwPcAAZfsgAKZDwAA+sNAAm9wgAAKhgAClGTAAm8SQAENDwAA/9aAAPR0gADEZ0ACjbVAAPiXQAKJR4AADs7AAPhEwAKdA8AA8GRAAqAXgAHYakAA6sVAARG9AAJQZEAA0eUAAMfKQAD9ToACmtQAAOO0wAJ7xwACcnaAAmm8wADrRMAAFBwAAp2QAAKf2EAA+VMAAAQ8wAC2xMAB9IlAAObjAAELj4AChSvAAPVGwAAeYcAA6iPAAPA4wAJ740AAAccAAN+/QAKQaUAAFJlAAPWlwAAH1oABFJbAAnAIgAC2fEABDFIAApEqAAFAIMAACw5AATaEAAKF7IAAx9CAAnaLAAKFoEAA9GBAAAhLQAJwmYABMAVAAOS+AAGKg8AA+vCAAR+hwAKIRoABESWAAQ1BAAI2sMACg/oAAKqvwAJh/sAA90sAARFTQAJrz8AAAZsAAp4JwAKTTAABDACAAN2lAAD0i4AA5abAAOB+QAJwEkACoYrAAmlBAAKY2QAA3/7AAPN2wADegAAAK4kAAKlNgAKNfgAAFpuAAoNwQAK5cgAClOuAAotlgAGzz4AAwdIAAQ2VwAAUCsAA3xRAAmv/wAGvF0AA09bAAOswwAEAN4ACOM8AAPPxgAHqu8ABDaKAAUzrAAD7UMACaRLAAPUnwAAhI8ACko9AAgxqwAKEtYABDNWAAoX2QAD4g0ACs5hAAVASgAKDl8ABe3ZAAoXYQAAQncAAAe8AAPTsgACqpIAA3yzAAAYSwAJ8SUABAGXAAPclwAKNmsAA1SqAAp/DQADB5gAAKkxAApgJwAEOcQAA4IaAAmamAAJ3F8AA1vsAAPOtQAKM9AAAHxOAAOYDgAJsCYABXTtAAOimwADwCgACcIVAAjaHQAD3t8ABAlyAAKoaAAKiIEAAs9SAAmNTQADfPgAClJkAAPyEQAEMy4AAH+eAAK7JAAJ8AsACZjMAAB9ZQAJlrcACZsbAAoRhwAAjpEABA+bAAQPUQACskQAArx4AAogXAAKRc8ABABnAABAeQAIEOwABMV/AApORQADfzwAAw/EAAOSaAAJswkACeDgAAPi+QAEdU0ACYjWAApa4wAJ8ZwACn81AAUjrwADpYUAAGuAAAmU+AAEMYUACZVDAAKyJAADeOEAAqWWAAPDswAK5X4ABDFnAAl3GAAJ8DcACo0CAAP07AADPwEAAKnWAAm/igAAPnkAABBMAAnbpQAG8uQACgNDAAOq7wAERg8AA6RfAAlqdQAAjVsACY3FAAlSewAADu8AA33/AAO/nQAAeT0AA86NAAOwbQAJ2ZIAA/pPAAmGsgAKOvMACpUMAAmxCwAJ3SkACmZiAAnc4wAAXV0ACf/7AAP7OQAKPxEAAIsvAAPqtwAArZoAAzsNAACpEwAD+aUACmdnAAPUTAAJhsoAA/ViAAKQCgAEHK4ACjDNAAQJRAAEUicACjQVAAQsXgAD7Y0ACi1vAAoOpQAKf4sACl+uAAPhngAJ8UsACUcrAAOg8QAJvZsACd5nAAm/XgAGJisAChHZAAOYzQADfnQAA8lLAAPUcwAJrBwAA/hPAAmZ4AAAKXQABNWzAAMo+gAJlIEACmsVAAPVgQADSpgAAE9iAAOoLQADpkYACZPxAAmNcwAEAfIAAEtmAAN4XAAENgwAA9o1AAP3xwADwmYACtEJAAqUWQAKO18AA+UmAAmMXwAJ3A4ACjyIAAoncAAHdy0AChMnAAoNLAAKeuUABCUqAAAcIAAD2wsAAE+JAAPnOQAKlNcACnN+AAPKTgADKA0ACPnEAAmtlAAD0RAACgU8AAMeAQAD3hgABC1wAAPa5QAD7d0ACnc2AAP0uQAKFWYAA/n5AAQR8AAJm4oAA+IzAApx7AAFdGwAA/GvAAqFfQAEdEAAB0/gAAqkxwADyGUAA9AmAAXefwAD6uQAA6NVAALssgAD0f8ABI0cAAN51gAK1ykAAAxJAAMBqAAJkqkAA9KPAAAf9QADwdgACYk2AArP6gAAUj4AA+bmAAPsFAAJmKYABAvVAAnw/QAAjaMABDyGAAOotwADr+EABIqeAAN2wAADksUABC5xAANU/gADqPgAA/K1AAN3xwAKT5AABCq9AAF9EgAJk4AACnWVAAMP5QADnycAA5SSAAR0yQAKVI8ACbzTAAQ5LgADOvQAAB67AAo9QgAIrDwABuiZAAQyGwAAXOMABCwrAAPUIgAEPvkACYiqAAQ1lAAKIMkABaomAAVFwwAKXRIABCroAApA1wAD9dAABERBAARPRQAACPwAA5imAAjimAAEAcUACdy7AANU6AAKJWQAChXlAApGIQAD65wACjpcAAPfCQAJ77gABAhdAAne9QAD4EYABVtWAAp4iQAKeSEAAqjtAAmJ8wAKK14ACnq1AAnbZAAKfscAAKgcAAUGVgAKMlYACgQDAAOeCAAEMkMACdvmAAM8uwAAClIAAKpRAANH0gAKotoAA4CTAAQKzQAAcjcACb0rAAmIRQAJm7EAAFopAAQPCwAElhkAA85aAAo/9wAKTyAAAFsJAABdhwAD1U4ACUJIAAN1HAAD4L0ABCsaAAPoIQAABbsAA//YAApRtwAE3k4ACiw/AAmqkAAKP2IAA1YXAAPfMAAJjL4AA5+ZAAolrgAKLBgACKyLAAQAjQAKEkIABdDnAAm9AgAAo/cACbO7AAK8TQAGnEsAClgrAApUTgACxscAAI7kAABAzQAJqvIAA+aUAAoTUwADcj8AAEL4AANBdAAERPwAA/q9AAp83wAJh9QACkBHAAmlUwADvcIAA8xFAAP65wAJl8EAA3uvAACJNQAEC60ACnR4AAVLHgAEhkUAA3Y2AAWYjwAKDZsACjqmAAPpJwAEM8UAACUFAAQxEgAGvLsACkV+AAp5egAKNF8ACk23AAozfwAAT+0AB/WLAAPy3QAEMooAB6txAAQ3rAAC8i8ACYbzAAOkkAAKhyUACb/bAAP7DgAKXwsACnYTAAhCvwADQhwAAHYjAAPk3AAEz6QACnA9AAF8lQAElOIAA3kIAAQ5VgAFG40AA6evAAo9bQAD61IAAKdbAApDiQAAP0MACj2/AAPSXAAKMTkACj+1AASWjwADr1YAAF2vAAQwUwAKQU4AA9qeAApDXQAJdCQACb+zAAAM+AAENeUACoRsAAo6gQAABRgABarKAApjkQAANnoAA/OOAAiSlAAACvcAA+hxAAPvHQAD2nYAAEPAAAOSpQAKDhIAA15TAAorzgAEST0AA9TJAABbXAAE+TgACZZmAAOP0QADdTYAA9FaAAopdwAJhhwABJbYAAo6ywAD2lgABe2DAAmY9wAKgiMACiuJAASTXQAJ4IQACY2dAAnfOAAKEN4ACamBAAOLWgAKJf4AA9+MAAU9uAAKKo0ACg3rAAdOHgAJhzkACoD5AAfRowAKI2cACiz2AARrlQADzi0ABJPVAAOaDgAEOQYABS0HAAeSggAEQ+UAAvsbAAPddgAJiiEABDArAAQNggAJlusACcDfAAM56wADgukAChKIAAqVPgAJmgoACjnlAACJswAD+pYACii2AAQBCgAAf/MAAE5rAAOMPAAJAbAABVN5AApm7gAD+OUABDgSAAOCYAAE55sAA73sAAmV+QACqYUAA+j4AAosvgAKLUUAA/xyAAOwxwAKdcEACVh5AArmGAAJ4F0AA++tAAQy2gAJUG0ACaWnAAOXLQAKez0ACZplAAQKQwAJ72cAAqjEAAQnuwAE6LUACi3KAAQ8WwAEJmIABbzUAAYpfQADvj8AAW9SAAP9aAAJgrMAA+a7AAPc5wAJr2cACk1dAAQHvwAD0asACd+gAArNWwAFC7gACYeqAAmu8wAEegUACZrBAACjxAAAWzAAA+F0AAmOugAC7egACj83AAQ02QAJ3dUAA+CWAAoWIQAFZI0ACkPpAAOuJgAHOM8AAKU8AAp16wAD0MsAA+fXAAOSAQAKZLYACd4CAAA5OAAFCrIACZwCAAnAmgAKH9oAAquEAAQMQAAKQgcAA9+3AAPbXAAAHg8AChasAABL4wADq94ABOpdAAo/ygAECDgAAKqPAAmvrgAAfR8ACRh/AAQInQAKDsQACnNJAAm9VAADEQEAAvEgAAAv+wADw+UACY4QAAQAtwAKfp8ACiXUAAPAigADmHwACj0cAAYJfgAEEb0ACs46AAndoQABfi4AChg+AAN6JwAD55EAA+owAAmbQwAD7KYAAKF+AAonJQAKW3kAA8QYAAQOIQAKVloAA1IgAAnergAAExYACaQdAARt4gAF7FMACtikAAfIiQAD5k4ACakNAApC5QAAoCYACokpAAYowwAEMwEACk6LAAp1JAAJwj8AAKBZAACLFwAECacAA+z+AALt/wAKYHQAAIfNAABZPwAD6ZUAA8j6AAOXVwACq60ACta6AAPF4wAAJawAA8ufAAQ1ugAD3EEAAXzmAAmDKgAD3/wAAKZZAApSAgAKQI0AA80lAANLxQAKRDAAA93sAAAo2AAAOJsACfC7AApVHwADvZwACspRAAZ8SAACr0AACnEOAABRnwAG84AAA+lQAAALowADm2AAAFy6AAODpwADG4YABab5AACufwAE+40AA+jFAArRjwADgOsAAJ7wAASTqwAAdk8ACimeAApdLwAC8ycACoXVAAFvJwADNjcABDDBAAPhxwAAP4sAA7ikAATZdAAJpLoACdyGAAPM1QACqawAA37aAAWpqAADf94AA/lUAAM09gAEOe4AADyVAAngsQAJ2uAAAqTFAACPFwAAHMkACnfeAAMoaAAAHWsAACb5AAUeywAApygAA8yOAAF9sQAKf7IAAGnxAAQQXQADebAACakmAAPM/gAKVpYABBucAAomrQAD/3wACtDWAApFVAAI+j4AAuEkAASMugAKzIsACZI4AAo97QAJ3VAACtm/AAPqhAAERaYACjUCAAOyJQADg3QAArpWAAnafwAD7NUACkMLAAPjZwAKMYwABAhzAAPgbAAEOZ4ACZrwAAO0kAAKPFsAA878AAPuBAAKBLsAA3+VAARGzQAJl+0ACTk6AAPisgAD52YACmldAAnwagAJiQ4AA3lmAAOezgAERlUAA6TmAAN6UwAJqdIABPcUAArXTwAD314AA9NtAAmkdAAKIKMACjFkAAQPwQAJyUYAAxFHAACHVAAJsT4ACnTeAARqjQADyq8AAEApAAnx6wABd9oACiA0AAO/xgAJyYwAA0LAAAQAHQAKQ8AAA+P7AACmpwAKV6IACdncAApA/QAK1uIAA5d+AAQI/QADDagAABjqAAomUQAJ3h8ABJpjAAq26QAEKiMAA+M5AAokFgAANE4ABDiYAAmgHwAI2Q8ACamqAAf1GgAD+CAAABU/AAom/QADu9UACbs3AACK3gAEJi8ABmwKAArUGgAD9RAACiMAAAKpWgAJ4DMABJJ6AAVeVwAD9B0AA+xzAAmTyAAKOc0ABBzg9WLHAtv8aP/S75Ij09TpjYmFD1E8WlYoGPiXpMmXQ+G32T62j8RFHw=="}, response: {"metadata":{"result":"ok"},"data":null,"is_error":false,"error":""}, error:<nil>	{"source": "sync.down"}
